var $NGL_shaderTextHash={};$NGL_shaderTextHash["SphereImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool flag2 = false;","bool interior = false;","vec3 cameraPos;","vec3 cameraNormal;","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){","","    vec3 cameraSpherePos = -vPointViewPosition;","    cameraSpherePos.z += vRadius;","","    vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );","    vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );","    vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );","","    float B = dot( rayDirection, cameraSphereDir );","    float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );","","    if( det < 0.0 ){","        discard;","        return false;","    }","        float sqrtDet = sqrt( det );","        float posT = mix( B + sqrtDet, B + sqrtDet, ortho );","        float negT = mix( B - sqrtDet, sqrtDet - B, ortho );","","        cameraPos = rayDirection * negT + rayOrigin;","","        #ifdef NEAR_CLIP","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else if( calcClip( cameraPos ) > 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    flag2 = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #else","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #endif","","        cameraNormal = normalize( cameraPos - cameraSpherePos );","        cameraNormal *= float(!interior) * 2.0 - 1.0;","         return !interior;","","}","","void main(void){","","    bool flag = Impostor( cameraPos, cameraNormal );","","    #ifdef NEAR_CLIP","        if( calcClip( cameraPos ) > 0.0 )","            discard;","    #endif","","    // FIXME not compatible with custom clipping plane","    //Set the depth based on the new cameraPos.","    gl_FragDepthEXT = calcDepth( cameraPos );","    if( !flag ){","","        // clamp to near clipping plane and add a tiny value to","        // make spheres with a greater radius occlude smaller ones","        #ifdef NEAR_CLIP","if( flag2 ){","    gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","}else if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #else","if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #endif","","    }","","    // bugfix (mac only?)","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vNormal = cameraNormal;","        vec3 vViewPosition = -cameraPos;","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        //include fog_fragment","        #ifdef USE_FOG","            #ifdef USE_LOGDEPTHBUF_EXT","                float depth = gl_FragDepthEXT / gl_FragCoord.w;","            #else","                float depth = gl_FragCoord.z / gl_FragCoord.w;","            #endif","            #ifdef FOG_EXP2","                float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );","            #else","                float fogFactor = smoothstep( fogNear, fogFar, depth );","            #endif","            gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","        #endif","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["SphereImpostor.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        position.x, position.y, position.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere();","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - custom clipping","// - three.js lighting","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    varying vec3 vColor1;","    varying vec3 vColor2;","    #include common","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool interior = false;","","float distSq3( vec3 v3a, vec3 v3b ){","    return (","        ( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +","        ( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +","        ( v3a.z - v3b.z ) * ( v3a.z - v3b.z )","    );","}","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","void main(){","","    vec3 point = w.xyz / w.w;","","    // unpacking","    vec3 base = base_radius.xyz;","    float vRadius = base_radius.w;","    vec3 end = end_b.xyz;","    float b = end_b.w;","","    vec3 end_cyl = end;","    vec3 surface_point = point;","","    vec3 ray_target = surface_point;","    vec3 ray_origin = vec3(0.0);","    vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);","    mat3 basis = mat3( U, V, axis );","","    vec3 diff = ray_target - 0.5 * (base + end_cyl);","    vec3 P = diff * basis;","","    // angle (cos) between cylinder cylinder_axis and ray direction","    float dz = dot( axis, ray_direction );","","    float radius2 = vRadius*vRadius;","","    // calculate distance to the cylinder from ray origin","    vec3 D = vec3(dot(U, ray_direction),","                dot(V, ray_direction),","                dz);","    float a0 = P.x*P.x + P.y*P.y - radius2;","    float a1 = P.x*D.x + P.y*D.y;","    float a2 = D.x*D.x + D.y*D.y;","","    // calculate a dicriminant of the above quadratic equation","    float d = a1*a1 - a0*a2;","    if (d < 0.0)","        // outside of the cylinder","        discard;","","    float dist = (-a1 + sqrt(d)) / a2;","","    // point of intersection on cylinder surface","    vec3 new_point = ray_target + dist * ray_direction;","","    vec3 tmp_point = new_point - base;","    vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );","","    ray_origin = mix( ray_origin, surface_point, ortho );","","    // test caps","    float front_cap_test = dot( tmp_point, axis );","    float end_cap_test = dot((new_point - end_cyl), axis);","","    // to calculate caps, simply check the angle between","    // the point of intersection - cylinder end vector","    // and a cap plane normal (which is the cylinder cylinder_axis)","    // if the angle < 0, the point is outside of cylinder","    // test front cap","","    #ifndef CAP","        vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","        vec3 tmp_point2 = new_point2 - base;","    #endif","","    // flat","    if (front_cap_test < 0.0)","    {","        // ray-plane intersection","        float dNV = dot(-axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(-axis, (base)) / dNV;","        vec3 front_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if (dot(front_point - base, front_point-base) > radius2)","            discard;","","        #ifdef CAP","            new_point = front_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(axis, end_cyl) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - end_cyl, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    // test end cap","","","    // flat","    if( end_cap_test > 0.0 )","    {","        // ray-plane intersection","        float dNV = dot(axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(axis, end_cyl) / dNV;","        vec3 end_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if( dot(end_point - end_cyl, end_point-base) > radius2 )","            discard;","","        #ifdef CAP","            new_point = end_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(-axis, (base)) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - base, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    gl_FragDepthEXT = calcDepth( new_point );","","    #ifdef NEAR_CLIP","        if( calcClip( new_point ) > 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            if( calcClip( new_point ) > 0.0 )","                discard;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","            }","        }else if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #else","        if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #endif","","    // this is a workaround necessary for Mac","    // otherwise the modified fragment won't clip properly","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vViewPosition = -new_point;","        vec3 vNormal = _normal;","        vec3 vColor;","","        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){","            if( b < 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }else{","            if( b > 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","     //ifdef USE_COLOR","     //diffuseColor.r *= vColor[0];","     //diffuseColor.g *= vColor[1];","     //diffuseColor.b *= vColor[2];","     //endif","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        //include fog_fragment","        #ifdef USE_FOG","            #ifdef USE_LOGDEPTHBUF_EXT","                float depth = gl_FragDepthEXT / gl_FragCoord.w;","            #else","                float depth = gl_FragCoord.z / gl_FragCoord.w;","            #endif","            #ifdef FOG_EXP2","                float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );","            #else","                float fogFactor = smoothstep( fogNear, fogFar, depth );","            #endif","            gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","        #endif","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = position;","    vec3 center = ( position2 + position1 ) / 2.0;","    vec3 dir = normalize( position2 - position1 );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["SphereInstancing.frag"]=$NGL_shaderTextHash["SphereImpostor.frag"],$NGL_shaderTextHash["SphereInstancing.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(vec4 updatePosition){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        updatePosition.x, updatePosition.y, updatePosition.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","//    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vec4 mvPosition = modelViewMatrix * vec4( updatePosition.xyz, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","//    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere(updatePosition);","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderInstancing.frag"]=$NGL_shaderTextHash["CylinderImpostor.frag"],$NGL_shaderTextHash["CylinderInstancing.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","varying float fogNear;","varying float fogFar;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = ( position2 + position1 ) / 2.0;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition1 = matrix * vec4(position1, 1.0);","    vec4 updatePosition2 = matrix * vec4(position2, 1.0);","    vec3 center = ( updatePosition2.xyz + updatePosition1.xyz ) / 2.0;","","    //vec3 dir = normalize( position2 - position1 );","    vec3 dir = normalize( updatePosition2.xyz - updatePosition1.xyz );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["Instancing.frag"]=["#define STANDARD","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform float clipRadius;","uniform mat4 projectionMatrix;","uniform float ortho;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    uniform float objectId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","void main(){","    #include nearclip_fragment","    #include radiusclip_fragment","","    #if defined( PICKING )","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #elif defined( NOLIGHT )","","        gl_FragColor = vec4( vColor, opacity );","","    #else","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","        #include normal_flip","        #include normal_fragment_begin","","        //include dull_interior_fragment","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        #include interior_fragment","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","        #include opaque_back_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["Instancing.vert"]=["#define STANDARD","","uniform mat4 projectionMatrixInverse;","uniform float nearClip;","uniform vec3 clipCenter;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","attribute float cylinder;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    #include unpack_color","    attribute float primitiveId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #include color_pars_vertex","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","#endif","","#include common","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","    bCylinder = cylinder;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","    #if defined( PICKING )","        vPickingColor = unpackColor( primitiveId );","    #elif defined( NOLIGHT )","        vColor = color;","    #else","        #include color_vertex","        //include beginnormal_vertex","        //vec3 objectNormal = vec3( normal );","        vec3 objectNormal = vec3(matrix * vec4(normal,0.0));","        #include defaultnormal_vertex","        // Normal computed with derivatives when FLAT_SHADED","        #ifndef FLAT_SHADED","            vNormal = normalize( transformedNormal );","        #endif","    #endif","","    //include begin_vertex","    vec3 transformed = updatePosition.xyz;","    //include project_vertex","    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","","    #if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","        vViewPosition = -mvPosition.xyz;","    #endif","","    #if defined( RADIUS_CLIP )","        vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;","    #endif","","    #include nearclip_vertex","","}"].join("\n"),THREE.RenderableObject=function(){"use strict";this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){"use strict";this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){"use strict";this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){"use strict";this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){"use strict";this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){"use strict";this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){"use strict";var $,J,r,ee,te,ie,oe,re,ne,ae,se,ce=[],de=0,le=[],t=0,i=[],o=0,n=[],a=0,s=[],c=0,ue={objects:[],lights:[],elements:[]},pe=new THREE.Vector3,fe=new THREE.Vector3,ve=new THREE.Vector3,he=new THREE.Vector3,me=new THREE.Vector4,d=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),g=new THREE.Box3,y=new Array(3),ge=(new Array(4),new THREE.Matrix4),ye=new THREE.Matrix4,Ee=new THREE.Matrix4,_e=new THREE.Matrix3,be=new THREE.Frustum,we=new THREE.Vector4,xe=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pkRay=function(e,t){console.error("THREE.Projector: .pkRay() is now raycaster.setFromCamera().")};var Te=new function(){function o(e){var t=e.position,i=e.positionWorld,o=e.positionScreen;i.copy(t).applyMatrix4(se),o.copy(i).applyMatrix4(ye);var r=1/o.w;o.x*=r,o.y*=r,o.z*=r,e.visible=-1<=o.x&&o.x<=1&&-1<=o.y&&o.y<=1&&-1<=o.z&&o.z<=1}function l(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(y[0]=e.positionScreen,y[1]=t.positionScreen,y[2]=i.positionScreen,d.isIntersectionBox(g.setFromPoints(y)))}function u(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}var p=[],f=[],v=null,h=null,m=new THREE.Matrix3;return{setObject:function(e){h=(v=e).material,m.getNormalMatrix(v.matrixWorld),p.length=0,f.length=0},projectVertex:o,checkTriangleVisibility:l,checkBackfaceCulling:u,pushVertex:function(e,t,i){(r=Ce()).position.set(e,t,i),o(r)},pushNormal:function(e,t,i){p.push(e,t,i)},pushUv:function(e,t){f.push(e,t)},pushLine:function(e,t){var i=le[e],o=le[t];(oe=Se()).id=v.id,oe.v1.copy(i),oe.v2.copy(o),oe.z=(i.positionScreen.z+o.positionScreen.z)/2,oe.material=v.material,ue.elements.push(oe)},pushTriangle:function(e,t,i){var o=le[e],r=le[t],n=le[i];if(!1!==l(o,r,n)&&(h.side===THREE.DoubleSide||!0===u(o,r,n))){(te=Re()).id=v.id,te.v1.copy(o),te.v2.copy(r),te.v3.copy(n),te.z=(o.positionScreen.z+r.positionScreen.z+n.positionScreen.z)/3;for(var a=0;a<3;a++){var s=3*arguments[a],c=te.vertexNormalsModel[a];c.set(p[s],p[1+s],p[2+s]),c.applyMatrix3(m).normalize();var d=2*arguments[a];te.uvs[a].set(f[d],f[1+d])}te.vertexNormalsLength=3,te.material=v.material,ue.elements.push(te)}}}};function Ce(){if(ee!==t)return le[ee++];var e=new THREE.RenderableVertex;return le.push(e),t++,ee++,e}function Re(){if(ie!==o)return i[ie++];var e=new THREE.RenderableFace;return i.push(e),o++,ie++,e}function Se(){if(re!==a)return n[re++];var e=new THREE.RenderableLine;return n.push(e),a++,re++,e}function Le(){if(ae!==c)return s[ae++];var e=new THREE.RenderableSprite;return s.push(e),c++,ae++,e}function Ae(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function Ie(e,t){var i=0,o=1,r=e.z+e.w,n=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return 0<=r&&0<=n&&0<=a&&0<=s||!(r<0&&n<0||a<0&&s<0)&&(r<0?i=Math.max(i,r/(r-n)):n<0&&(o=Math.min(o,r/(r-n))),a<0?i=Math.max(i,a/(a-s)):s<0&&(o=Math.min(o,a/(a-s))),!(o<i)&&(e.lerp(t,i),t.lerp(e,1-o),!0))}this.projectScene=function(e,t,i,o){ae=re=ie=0,!(ue.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),ge.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),ye.multiplyMatrices(t.projectionMatrix,ge),be.setFromMatrix(ye),J=0,ue.objects.length=0,ue.lights.length=0,e.traverseVisible(function(e){if(e instanceof THREE.Light)ue.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Sprite){if(!1===e.material.visible)return;!1!==e.frustumCulled&&!0!==be.intersectsObject(e)||(($=function(){if(J!==de)return ce[J++];var e=new THREE.RenderableObject;return ce.push(e),de++,J++,e}()).id=e.id,$.object=e,he.setFromMatrixPosition(e.matrixWorld),he.applyProjection(ye),$.z=he.z,ue.objects.push($))}}),!0===i&&ue.objects.sort(Ae);for(var r=0,n=ue.objects.length;r<n;r++){var a=ue.objects[r].object,s=a.geometry;if(Te.setObject(a),se=a.matrixWorld,ee=0,a instanceof THREE.Mesh){if(s instanceof THREE.BufferGeometry){var c=s.attributes,d=s.offsets;if(void 0===c.position)continue;for(var l=0,u=(Z=c.position.array).length;l<u;l+=3)Te.pushVertex(Z[l],Z[l+1],Z[l+2]);if(void 0!==c.normal){var p=c.normal.array;for(l=0,u=p.length;l<u;l+=3)Te.pushNormal(p[l],p[l+1],p[l+2])}if(void 0!==c.uv){var f=c.uv.array;for(l=0,u=f.length;l<u;l+=2)Te.pushUv(f[l],f[l+1])}if(void 0!==c.index){var v=c.index.array;if(0<d.length)for(r=0;r<d.length;r++){var h=d[r],m=h.index;for(l=h.start,u=h.start+h.count;l<u;l+=3)Te.pushTriangle(v[l]+m,v[l+1]+m,v[l+2]+m)}else for(l=0,u=v.length;l<u;l+=3)Te.pushTriangle(v[l],v[l+1],v[l+2])}else for(l=0,u=Z.length/3;l<u;l+=3)Te.pushTriangle(l,l+1,l+2)}else if(s instanceof THREE.Geometry){var g=s.vertices,y=s.faces,E=s.faceVertexUvs[0];_e.getNormalMatrix(se);for(var _=a.material instanceof THREE.MeshFaceMaterial,b=!0==_?a.material:null,w=0,x=g.length;w<x;w++){var T=g[w];Te.pushVertex(T.x,T.y,T.z)}for(var C=0,R=y.length;C<R;C++){var S=y[C],L=!0==_?b.materials[S.materialIndex]:a.material;if(void 0!==L){var A=L.side,I=le[S.a],N=le[S.b],O=le[S.c];if(!0===L.morphTargets){var P=s.morphTargets,M=a.morphTargetInfluences,z=I.position,H=N.position,D=O.position;pe.set(0,0,0),fe.set(0,0,0),ve.set(0,0,0);for(var j=0,F=P.length;j<F;j++){var V=M[j];if(0!==V){var k=P[j].vertices;pe.x+=(k[S.a].x-z.x)*V,pe.y+=(k[S.a].y-z.y)*V,pe.z+=(k[S.a].z-z.z)*V,fe.x+=(k[S.b].x-H.x)*V,fe.y+=(k[S.b].y-H.y)*V,fe.z+=(k[S.b].z-H.z)*V,ve.x+=(k[S.c].x-D.x)*V,ve.y+=(k[S.c].y-D.y)*V,ve.z+=(k[S.c].z-D.z)*V}}I.position.add(pe),N.position.add(fe),O.position.add(ve),Te.projectVertex(I),Te.projectVertex(N),Te.projectVertex(O)}if(!1!==Te.checkTriangleVisibility(I,N,O)){var U=Te.checkBackfaceCulling(I,N,O);if(A!==THREE.DoubleSide){if(A===THREE.FrontSide&&!1===U)continue;if(A===THREE.BackSide&&!0===U)continue}(te=Re()).id=a.id,te.v1.copy(I),te.v2.copy(N),te.v3.copy(O),te.normalModel.copy(S.normal),!1!==U||A!==THREE.BackSide&&A!==THREE.DoubleSide||te.normalModel.negate(),te.normalModel.applyMatrix3(_e).normalize();for(var B=S.vertexNormals,G=0,X=Math.min(B.length,3);G<X;G++){var q=te.vertexNormalsModel[G];q.copy(B[G]),!1!==U||A!==THREE.BackSide&&A!==THREE.DoubleSide||q.negate(),q.applyMatrix3(_e).normalize()}te.vertexNormalsLength=B.length;var W=E[C];if(void 0!==W)for(var Y=0;Y<3;Y++)te.uvs[Y].copy(W[Y]);te.color=S.color,te.material=L,te.z=(I.positionScreen.z+N.positionScreen.z+O.positionScreen.z)/3,ue.elements.push(te)}}}}}else if(a instanceof THREE.Line){if(s instanceof THREE.BufferGeometry){if(void 0!==(c=s.attributes).position){var Z;for(l=0,u=(Z=c.position.array).length;l<u;l+=3)Te.pushVertex(Z[l],Z[l+1],Z[l+2]);if(void 0!==c.index)for(l=0,u=(v=c.index.array).length;l<u;l+=2)Te.pushLine(v[l],v[l+1]);else{var Q=a.mode===THREE.LinePieces?2:1;for(l=0,u=Z.length/3-1;l<u;l+=Q)Te.pushLine(l,l+1)}}}else if(s instanceof THREE.Geometry){if(Ee.multiplyMatrices(ye,se),0===(g=a.geometry.vertices).length)continue;(I=Ce()).positionScreen.copy(g[0]).applyMatrix4(Ee);for(Q=a.mode===THREE.LinePieces?2:1,w=1,x=g.length;w<x;w++)(I=Ce()).positionScreen.copy(g[w]).applyMatrix4(Ee),0<(w+1)%Q||(N=le[ee-2],we.copy(I.positionScreen),xe.copy(N.positionScreen),!0===Ie(we,xe)&&(we.multiplyScalar(1/we.w),xe.multiplyScalar(1/xe.w),(oe=Se()).id=a.id,oe.v1.positionScreen.copy(we),oe.v2.positionScreen.copy(xe),oe.z=Math.max(we.z,xe.z),oe.material=a.material,a.material.vertexColors===THREE.VertexColors&&(oe.vertexColors[0].copy(a.geometry.colors[w]),oe.vertexColors[1].copy(a.geometry.colors[w-1])),ue.elements.push(oe)))}}else if(a instanceof THREE.Sprite){me.set(se.elements[12],se.elements[13],se.elements[14],1),me.applyMatrix4(ye);var K=1/me.w;me.z*=K,-1<=me.z&&me.z<=1&&((ne=Le()).id=a.id,ne.x=me.x*K,ne.y=me.y*K,ne.z=me.z,ne.object=a,ne.rotation=a.rotation,ne.scale.x=a.scale.x*Math.abs(ne.x-(me.x+t.projectionMatrix.elements[0])/(me.w+t.projectionMatrix.elements[12])),ne.scale.y=a.scale.y*Math.abs(ne.y-(me.y+t.projectionMatrix.elements[5])/(me.w+t.projectionMatrix.elements[13])),ne.material=a.material,ue.elements.push(ne))}}return!0===o&&ue.elements.sort(Ae),ue}},THREE.TrackballControls=function(e,t,o){"use strict";var n=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3;this._state=this.STATE.NONE;var r=this.STATE.NONE,a=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var s=0,c=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var d={type:"change"},l={type:"start"},u={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var p,f,v,h,m,g,y,E,_,b=(p=new THREE.Vector2,function(e,t){return p.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),p}),w=(f=new THREE.Vector3,v=new THREE.Vector3,h=new THREE.Vector3,function(e,t){h.set((e-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(.5*n.screen.height+n.screen.top-t)/(.5*n.screen.height),0);var i=h.length();return n.noRoll?i<Math.SQRT1_2?h.z=Math.sqrt(1-i*i):h.z=.5/i:1<i?h.normalize():h.z=Math.sqrt(1-i*i),a.copy(n.object.position).sub(n.target),f.copy(n.object.up).setLength(h.y),f.add(v.copy(n.object.up).cross(a).setLength(h.x)),f.add(a.setLength(h.z)),f});function x(e){!1===n.enabled||Object.keys(window).length<2||(window.removeEventListener("keydown",x),r=n._state,n._state===n.STATE.NONE&&(e.keyCode!==n.keys[n.STATE.ROTATE]||n.noRotate?e.keyCode!==n.keys[n.STATE.ZOOM]||n.noZoom?e.keyCode!==n.keys[n.STATE.PAN]||n.noPan||(n._state=n.STATE.PAN):n._state=n.STATE.ZOOM:n._state=n.STATE.ROTATE))}function T(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state!==n.STATE.ROTATE||n.noRotate?n._state!==n.STATE.ZOOM||n.noZoom?n._state!==n.STATE.PAN||n.noPan||n._panEnd.copy(b(e.pageX,e.pageY)):n._zoomEnd.copy(b(e.pageX,e.pageY)):n._rotateEnd.copy(w(e.pageX,e.pageY)))}function C(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state=n.STATE.NONE,document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",C),n.dispatchEvent(u))}function R(e){if(!(!1===n.enabled||Object.keys(window).length<2)){e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),n._zoomStart.y=.005*t,n.dispatchEvent(l),n.dispatchEvent(u)}}this.rotateCamera=(m=new THREE.Vector3,g=new THREE.Quaternion,function(e,t){var i;void 0===e&&(i=Math.acos(n._rotateStart.dot(n._rotateEnd)/n._rotateStart.length()/n._rotateEnd.length())),!i&&void 0===e||(void 0===e?(m.crossVectors(n._rotateStart,n._rotateEnd).normalize(),i*=n.rotateSpeed,g.setFromAxisAngle(m,-i)):g.copy(e),void 0===o||void 0===o.quaternion||void 0!==t&&!0!==t||o.quaternion.multiplyQuaternions(g,o.quaternion),a.applyQuaternion(g),n.object.up.applyQuaternion(g),n._rotateEnd.applyQuaternion(g),n.staticMoving?n._rotateStart.copy(n._rotateEnd):(g.setFromAxisAngle(m,i*(n.dynamicDampingFactor-1)),n._rotateStart.applyQuaternion(g)))}),this.zoomCamera=function(e,t){var i;n._state===n.STATE.TOUCH_ZOOM_PAN?(void 0!==e?i=e:(i=s/c,s=c),a.multiplyScalar(i),void 0===o||void 0===o._zoomFactor||void 0!==t&&!0!==t||(o._zoomFactor*=i)):(i=void 0!==e?e:1+(n._zoomEnd.y-n._zoomStart.y)*n.zoomSpeed,void 0===o||void 0===o._zoomFactor||void 0!==t&&!0!==t||(o._zoomFactor*=i),1!==i&&(a.multiplyScalar(i),n.staticMoving?n._zoomStart.copy(n._zoomEnd):n._zoomStart.y+=(n._zoomEnd.y-n._zoomStart.y)*this.dynamicDampingFactor))},this.panCamera=(y=new THREE.Vector2,E=new THREE.Vector3,_=new THREE.Vector3,function(e,t){void 0!==e?(y=e,void 0===o||void 0===o.mouseChange||void 0!==t&&!0!==t||o.mouseChange.add(e)):(y.copy(n._panEnd).sub(n._panStart),void 0===o||void 0===o.mouseChange||void 0!==t&&!0!==t||o.mouseChange.add(n._panEnd).sub(n._panStart)),y.lengthSq()&&(y.multiplyScalar(a.length()*n.panSpeed),_.copy(a).cross(n.object.up).setLength(y.x),_.add(E.copy(n.object.up).setLength(y.y)),n.object.position.add(_),n.target.add(_),n.staticMoving?n._panStart.copy(n._panEnd):n._panStart.add(y.subVectors(n._panEnd,n._panStart).multiplyScalar(n.dynamicDampingFactor)))}),this.checkDistances=function(){n.noZoom&&n.noPan||(a.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.addVectors(n.target,a.setLength(n.maxDistance)),a.lengthSq()<n.minDistance*n.minDistance&&n.object.position.addVectors(n.target,a.setLength(n.minDistance)))},this.update=function(e){a.subVectors(n.object.position,n.target),n.noRotate||(void 0!==e&&void 0!==e.quaternion?n.rotateCamera(e.quaternion,e.update):n.rotateCamera()),n.noZoom||(void 0!==e&&void 0!==e._zoomFactor?n.zoomCamera(e._zoomFactor,e.update):n.zoomCamera()),n.noPan||(void 0!==e&&void 0!==e.mouseChange?n.panCamera(e.mouseChange,e.update):n.panCamera()),n.object.position.addVectors(n.target,a),n.checkDistances(),n.object.lookAt(n.target),1e-6<i.distanceToSquared(n.object.position)&&(n.dispatchEvent(d),i.copy(n.object.position))},this.reset=function(){n._state=n.STATE.NONE,r=n.STATE.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),a.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(d),i.copy(n.object.position)},2<=Object.keys(window).length&&(this.domElement.addEventListener("contextmn",function(e){},!1),this.domElement.addEventListener("mousedown",function(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state===n.STATE.NONE&&(n._state=e.button),n._state!==n.STATE.ROTATE||n.noRotate?n._state!==n.STATE.ZOOM||n.noZoom?n._state!==n.STATE.PAN||n.noPan||(n._panStart.copy(b(e.pageX,e.pageY)),n._panEnd.copy(n._panStart)):(n._zoomStart.copy(b(e.pageX,e.pageY)),n._zoomEnd.copy(n._zoomStart)):(n._rotateStart.copy(w(e.pageX,e.pageY)),n._rotateEnd.copy(n._rotateStart)),document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",C,!1),n.dispatchEvent(l))},!1),this.domElement.addEventListener("mousewheel",R,!1),this.domElement.addEventListener("DOMMouseScroll",R,!1),this.domElement.addEventListener("touchstart",function(e){if(!(!1===n.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:n._state=n.STATE.TOUCH_ROTATE,n._rotateStart.copy(w(e.touches[0].pageX,e.touches[0].pageY)),n._rotateEnd.copy(n._rotateStart);break;case 2:n._state=n.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=s=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panStart.copy(b(o,r)),n._panEnd.copy(n._panStart);break;default:n._state=n.STATE.NONE}n.dispatchEvent(l)}},!1),this.domElement.addEventListener("touchend",function(e){if(!(!1===n.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:n._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY)),n._rotateStart.copy(n._rotateEnd);break;case 2:s=c=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panEnd.copy(b(t,i)),n._panStart.copy(n._panEnd)}n._state=n.STATE.NONE,n.dispatchEvent(u)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!(!1===n.enabled||Object.keys(window).length<2))switch(e.stopPropagation(),e.touches.length){case 1:n._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panEnd.copy(b(o,r));break;default:n._state=n.STATE.NONE}},!1),2<=Object.keys(window).length&&window.addEventListener("keydown",x,!1),2<=Object.keys(window).length&&window.addEventListener("keyup",function(e){!1===n.enabled||Object.keys(window).length<2||(n._state=r,window.addEventListener("keydown",x,!1))},!1)),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,t,o){this.icn3d;var n=this,a={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2;this.zoomSpeed*=.01,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var i=new THREE.Vector3;this._state=a.NONE;var r=a.NONE,s=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var c=1,d=0,l=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var u={type:"change"},p={type:"start"},f={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var v,h,m,g,y,E,_,b,w,x=(v=new THREE.Vector2,function(e,t){return v.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),v}),T=(h=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,function(e,t){g.set((e-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(.5*n.screen.height+n.screen.top-t)/(.5*n.screen.height),0);var i=g.length();return n.noRoll?i<Math.SQRT1_2?g.z=Math.sqrt(1-i*i):g.z=.5/i:1<i?g.normalize():g.z=Math.sqrt(1-i*i),s.copy(n.object.position).sub(n.target),h.copy(n.object.up).setLength(g.y),h.add(m.copy(n.object.up).cross(s).setLength(g.x)),h.add(s.setLength(g.z)),h});function C(e){!1===n.enabled||Object.keys(window).length<2||(window.removeEventListener("keydown",C),r=n._state,n._state===a.NONE&&(e.keyCode!==n.keys[a.ROTATE]||n.noRotate?e.keyCode!==n.keys[a.ZOOM]||n.noZoom?e.keyCode!==n.keys[a.PAN]||n.noPan||(n._state=a.PAN):n._state=a.ZOOM:n._state=a.ROTATE))}function R(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state!==a.ROTATE||n.noRotate?n._state!==a.ZOOM||n.noZoom?n._state!==a.PAN||n.noPan||n._panEnd.copy(x(e.pageX,e.pageY)):n._zoomEnd.copy(x(e.pageX,e.pageY)):n._rotateEnd.copy(T(e.pageX,e.pageY)))}function S(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state=a.NONE,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",S),n.dispatchEvent(f))}function L(e){if(!(!1===n.enabled||Object.keys(window).length<2)){e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),n._zoomStart.y=.01*t,n.dispatchEvent(p),n.dispatchEvent(f)}}this.rotateCamera=(y=new THREE.Vector3,E=new THREE.Quaternion,function(e,t){var i;void 0===e&&(i=Math.acos(n._rotateStart.dot(n._rotateEnd)/n._rotateStart.length()/n._rotateEnd.length())),!i&&void 0===e||(void 0===e?(y.crossVectors(n._rotateStart,n._rotateEnd).normalize(),i*=n.rotateSpeed,E.setFromAxisAngle(y,-i)):E.copy(e),void 0===o||void 0===o.quaternion||void 0!==t&&!0!==t||o.quaternion.multiplyQuaternions(E,o.quaternion),s.applyQuaternion(E),n.object.up.applyQuaternion(E),n._rotateEnd.applyQuaternion(E),n.staticMoving?n._rotateStart.copy(n._rotateEnd):(E.setFromAxisAngle(y,i*(n.dynamicDampingFactor-1)),n._rotateStart.applyQuaternion(E)))}),this.zoomCamera=function(e,t){var i;n._state===a.TOUCH_ZOOM_PAN?void 0!==e?i=e:(i=d/l,d=l):i=void 0!==e?e:1+(n._zoomEnd.y-n._zoomStart.y)*n.zoomSpeed/.01,void 0===o||void 0===o._zoomFactor||void 0!==t&&!0!==t||(o._zoomFactor*=i),1!==i&&(c=i,n.object.left=c*n.left0+(1-c)*n.center0.x,n.object.right=c*n.right0+(1-c)*n.center0.x,n.object.top=c*n.top0+(1-c)*n.center0.y,n.object.bottom=c*n.bottom0+(1-c)*n.center0.y,n.staticMoving?n._zoomStart.copy(n._zoomEnd):n._zoomStart.y+=(n._zoomEnd.y-n._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=(_=new THREE.Vector2,b=new THREE.Vector3,w=new THREE.Vector3,function(e,t){void 0!==e?(_=e,void 0===o||void 0===o.mouseChange||void 0!==t&&!0!==t||o.mouseChange.add(e)):(_.copy(n._panEnd).sub(n._panStart),void 0===o||void 0===o.mouseChange||void 0!==t&&!0!==t||o.mouseChange.add(n._panEnd).sub(n._panStart)),_.lengthSq()&&(_.multiplyScalar(s.length()*n.panSpeed),w.copy(s).cross(n.object.up).setLength(_.x),w.add(b.copy(n.object.up).setLength(_.y)),n.object.position.add(w),n.target.add(w),n.staticMoving?n._panStart.copy(n._panEnd):n._panStart.add(_.subVectors(n._panEnd,n._panStart).multiplyScalar(n.dynamicDampingFactor)))}),this.update=function(e){s.subVectors(n.object.position,n.target),n.noRotate||(void 0!==e&&void 0!==e.quaternion?n.rotateCamera(e.quaternion,e.update):n.rotateCamera()),n.noZoom||(void 0!==e&&void 0!==e._zoomFactor?n.zoomCamera(e._zoomFactor,e.update):n.zoomCamera(),n.object.updateProjectionMatrix()),n.noPan||(void 0!==e&&void 0!==e.mouseChange?n.panCamera(e.mouseChange,e.update):n.panCamera()),n.object.position.addVectors(n.target,s),n.object.lookAt(n.target),1e-6<i.distanceToSquared(n.object.position)&&(n.dispatchEvent(u),i.copy(n.object.position))},this.reset=function(){n._state=a.NONE,r=a.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),s.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(u),i.copy(n.object.position)},2<=Object.keys(window).length&&(this.domElement.addEventListener("contextmn",function(e){},!1),this.domElement.addEventListener("mousedown",function(e){!1===n.enabled||Object.keys(window).length<2||(e.stopPropagation(),n._state===a.NONE&&(n._state=e.button),n._state!==a.ROTATE||n.noRotate?n._state!==a.ZOOM||n.noZoom?n._state!==a.PAN||n.noPan||(n._panStart.copy(x(e.pageX,e.pageY)),n._panEnd.copy(n._panStart)):(n._zoomStart.copy(x(e.pageX,e.pageY)),n._zoomEnd.copy(n._zoomStart)):(n._rotateStart.copy(T(e.pageX,e.pageY)),n._rotateEnd.copy(n._rotateStart)),document.addEventListener("mousemove",R,!1),document.addEventListener("mouseup",S,!1),n.dispatchEvent(p))},!1),this.domElement.addEventListener("mousewheel",L,!1),this.domElement.addEventListener("DOMMouseScroll",L,!1),this.domElement.addEventListener("touchstart",function(e){if(!(!1===n.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:n._state=a.TOUCH_ROTATE,n._rotateStart.copy(T(e.touches[0].pageX,e.touches[0].pageY)),n._rotateEnd.copy(n._rotateStart);break;case 2:n._state=a.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;l=d=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panStart.copy(x(o,r)),n._panEnd.copy(n._panStart);break;default:n._state=a.NONE}n.dispatchEvent(p)}},!1),this.domElement.addEventListener("touchend",function(e){if(!(!1===n.enabled||Object.keys(window).length<2)){switch(e.touches.length){case 1:n._rotateEnd.copy(T(e.touches[0].pageX,e.touches[0].pageY)),n._rotateStart.copy(n._rotateEnd);break;case 2:d=l=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panEnd.copy(x(t,i)),n._panStart.copy(n._panEnd)}n._state=a.NONE,n.dispatchEvent(f)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!(!1===n.enabled||Object.keys(window).length<2))switch(e.stopPropagation(),e.touches.length){case 1:n._rotateEnd.copy(T(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;l=Math.sqrt(t*t+i*i);var o=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;n._panEnd.copy(x(o,r));break;default:n._state=a.NONE}},!1),window.addEventListener("keydown",C,!1),window.addEventListener("keyup",function(e){!1===n.enabled||Object.keys(window).length<2||(n._state=r,window.addEventListener("keydown",C,!1))},!1)),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls;var MMTF={};function initIcn3dpyMMTF(e){function p(e,t,i){for(var o=(e.byteLength,0),r=i.length;o<r;o++){var n=i.charCodeAt(o);if(n<128)e.setUint8(t++,n>>>0&127|0);else if(n<2048)e.setUint8(t++,n>>>6&31|192),e.setUint8(t++,n>>>0&63|128);else if(n<65536)e.setUint8(t++,n>>>12&15|224),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128);else{if(!(n<1114112))throw new Error("bad codepoint "+n);e.setUint8(t++,n>>>18&7|240),e.setUint8(t++,n>>>12&63|128),e.setUint8(t++,n>>>6&63|128),e.setUint8(t++,n>>>0&63|128)}}}function f(e){for(var t=0,i=0,o=e.length;i<o;i++){var r=e.charCodeAt(i);if(r<128)t+=1;else if(r<2048)t+=2;else if(r<65536)t+=3;else{if(!(r<1114112))throw new Error("bad codepoint "+r);t+=4}}return t}function t(e){var t=new ArrayBuffer(function e(t){var i=typeof t;if("string"==i){if((o=f(t))<32)return 1+o;if(o<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if(t instanceof Uint8Array){if((o=t.byteLength)<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if("number"==i){if(Math.floor(t)!==t)return 9;if(0<=t){if(t<128)return 1;if(t<256)return 2;if(t<65536)return 3;if(t<4294967296)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(-32<=t)return 1;if(-128<=t)return 2;if(-32768<=t)return 3;if(-2147483648<=t)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"==i||null===t)return 1;if("object"!=i)throw new Error("Unknown type "+i);var o,r=0;if(Array.isArray(t)){o=t.length;for(var n=0;n<o;n++)r+=e(t[n])}else{var a=Object.keys(t);for(o=a.length,n=0;n<o;n++){var s=a[n];r+=e(s)+e(t[s])}}if(o<16)return 1+r;if(o<65536)return 3+r;if(o<4294967296)return 5+r;throw new Error("Array or object too long 0x"+o.toString(16))}(e));return function e(t,i,o){var r=typeof t;if("string"==r){if((n=f(t))<32)return i.setUint8(o,160|n),p(i,o+1,t),1+n;if(n<256)return i.setUint8(o,217),i.setUint8(o+1,n),p(i,o+2,t),2+n;if(n<65536)return i.setUint8(o,218),i.setUint16(o+1,n),p(i,o+3,t),3+n;if(n<4294967296)return i.setUint8(o,219),i.setUint32(o+1,n),p(i,o+5,t),5+n}if(t instanceof Uint8Array){var n=t.byteLength,a=new Uint8Array(i.buffer);if(n<256)return i.setUint8(o,196),i.setUint8(o+1,n),a.set(t,o+2),2+n;if(n<65536)return i.setUint8(o,197),i.setUint16(o+1,n),a.set(t,o+3),3+n;if(n<4294967296)return i.setUint8(o,198),i.setUint32(o+1,n),a.set(t,o+5),5+n}if("number"==r){if(!isFinite(t))throw new Error("Number not finite: "+t);if(Math.floor(t)!==t)return i.setUint8(o,203),i.setFloat64(o+1,t),9;if(0<=t){if(t<128)return i.setUint8(o,t),1;if(t<256)return i.setUint8(o,204),i.setUint8(o+1,t),2;if(t<65536)return i.setUint8(o,205),i.setUint16(o+1,t),3;if(t<4294967296)return i.setUint8(o,206),i.setUint32(o+1,t),5;throw new Error("Number too big 0x"+t.toString(16))}if(-32<=t)return i.setInt8(o,t),1;if(-128<=t)return i.setUint8(o,208),i.setInt8(o+1,t),2;if(-32768<=t)return i.setUint8(o,209),i.setInt16(o+1,t),3;if(-2147483648<=t)return i.setUint8(o,210),i.setInt32(o+1,t),5;throw new Error("Number too small -0x"+(-t).toString(16).substr(1))}if(null===t)return i.setUint8(o,192),1;if("boolean"==r)return i.setUint8(o,t?195:194),1;if("object"!=r)throw new Error("Unknown type "+r);var s=0,c=Array.isArray(t);if(c)n=t.length;else{var d=Object.keys(t);n=d.length}if(n<16?(i.setUint8(o,n|(c?144:128)),s=1):n<65536?(i.setUint8(o,c?220:222),i.setUint16(o+1,n),s=3):n<4294967296&&(i.setUint8(o,c?221:223),i.setUint32(o+1,n),s=5),c)for(var l=0;l<n;l++)s+=e(t[l],i,o+s);else for(l=0;l<n;l++){var u=d[l];s+=e(u,i,o+s),s+=e(t[u],i,o+s)}return s}(e,new DataView(t),0),new Uint8Array(t)}function s(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0}function u(e){return s(DataView,e)}function c(e){return s(Uint8Array,e)}function d(e){return s(Int8Array,e)}function l(e){return s(Int32Array,e,4)}function v(e,t){var i=e.length/2;t=t||new Int16Array(i);for(var o=0,r=0;o<i;++o,r+=2)t[o]=e[r]<<8^e[r+1]<<0;return t}function h(e,t){var i=e.length/4;t=t||new Int32Array(i);for(var o=0,r=0;o<i;++o,r+=4)t[o]=e[r]<<24^e[r+1]<<16^e[r+2]<<8^e[r+3]<<0;return t}function i(e,t){for(var i=e.length,o=u(t=t||new Uint8Array(4*i)),r=0;r<i;++r)o.setInt32(4*r,e[r]);return c(t)}function m(e,t,i){var o=e.length,r=1/t;i=i||new Float32Array(o);for(var n=0;n<o;++n)i[n]=e[n]*r;return i}function r(e,t,i){var o=e.length;i=i||new Int32Array(o);for(var r=0;r<o;++r)i[r]=Math.round(e[r]*t);return i}function g(e,t){var i,o;if(!t){var r=0;for(i=0,o=e.length;i<o;i+=2)r+=e[i+1];t=new e.constructor(r)}var n=0;for(i=0,o=e.length;i<o;i+=2)for(var a=e[i],s=e[i+1],c=0;c<s;++c)t[n]=a,++n;return t}function o(e){if(0===e.length)return new Int32Array;var t,i,o=2;for(t=1,i=e.length;t<i;++t)e[t-1]!==e[t]&&(o+=2);var r=new Int32Array(o),n=0,a=1;for(t=1,i=e.length;t<i;++t)e[t-1]!==e[t]?(r[n]=e[t-1],r[n+1]=a,a=1,n+=2):++a;return r[n]=e[e.length-1],r[n+1]=a,r}function y(e,t){var i=e.length;t=t||new e.constructor(i),i&&(t[0]=e[0]);for(var o=1;o<i;++o)t[o]=e[o]+t[o-1];return t}function n(e,t){var i=e.length;(t=t||new e.constructor(i))[0]=e[0];for(var o=1;o<i;++o)t[o]=e[o]-e[o-1];return t}function E(e,t){var i,o,r=e instanceof Int8Array?127:32767,n=-r-1,a=e.length;if(!t){var s=0;for(i=0;i<a;++i)e[i]<r&&e[i]>n&&++s;t=new Int32Array(s)}for(o=i=0;i<a;){for(var c=0;e[i]===r||e[i]===n;)c+=e[i],++i;c+=e[i],++i,t[o]=c,++o}return t}function _(e,t,i){return m(E(e,l(i)),t,i)}function b(e,t,i){var o,r,n,a=E(e,l(i));return r=t,n=s(Float32Array,o=a,4),m(y(o,l(n)),r,n)}function a(e,t,i){return function(e,t){var i,o=t?127:32767,r=-o-1,n=e.length,a=0;for(i=0;i<n;++i){0===(d=e[i])?++a:0<d?(a+=Math.ceil(d/o),d%o==0&&(a+=1)):(a+=Math.ceil(d/r),d%r==0&&(a+=1))}var s=new(t?Int8Array:Int16Array)(a),c=0;for(i=0;i<n;++i){var d;if(0<=(d=e[i]))for(;o<=d;)s[c]=o,++c,d-=o;else for(;d<=r;)s[c]=r,++c,d-=r;s[c]=d,++c}return s}(n(r(e,t),o),i);var o}function w(e,t,i,o){var r=new ArrayBuffer(12+o.byteLength),n=new Uint8Array(r),a=new DataView(r);return a.setInt32(0,e),a.setInt32(4,t),i&&n.set(i,8),n.set(o,12),n}function x(e){return w(2,e.length,void 0,c(e))}function T(e){return w(4,e.length,void 0,i(e))}function C(e,t){return w(5,e.length/t,i([t]),c(e))}function R(e){return w(6,e.length,void 0,i(o(e)))}function S(e){return w(8,e.length,void 0,i(o(n(e))))}function L(e,t){return w(9,e.length,i([t]),i(o(r(e,t))))}function A(e,t){return w(10,e.length,i([t]),function(e,t){for(var i=e.length,o=u(t=t||new Uint8Array(2*i)),r=0;r<i;++r)o.setInt16(2*r,e[r]);return c(t)}(a(e,t)))}function I(t){var i={};return H.forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),t.bondAtomList&&(i.bondAtomList=T(t.bondAtomList)),t.bondOrderList&&(i.bondOrderList=x(t.bondOrderList)),i.xCoordList=A(t.xCoordList,1e3),i.yCoordList=A(t.yCoordList,1e3),i.zCoordList=A(t.zCoordList,1e3),t.bFactorList&&(i.bFactorList=A(t.bFactorList,100)),t.atomIdList&&(i.atomIdList=S(t.atomIdList)),t.altLocList&&(i.altLocList=R(t.altLocList)),t.occupancyList&&(i.occupancyList=L(t.occupancyList,100)),i.groupIdList=S(t.groupIdList),i.groupTypeList=T(t.groupTypeList),t.secStructList&&(i.secStructList=x(t.secStructList)),t.insCodeList&&(i.insCodeList=R(t.insCodeList)),t.sequenceIndexList&&(i.sequenceIndexList=S(t.sequenceIndexList)),i.chainIdList=C(t.chainIdList,4),t.chainNameList&&(i.chainNameList=C(t.chainNameList,4)),i}function N(r){function o(e){for(var t={},i=0;i<e;i++){t[c()]=c()}return t}function n(e){var t=r.subarray(d,d+e);return d+=e,t}function a(e){var t=r.subarray(d,d+e);d+=e;if(65535<e){for(var i=[],o=0;o<t.length;o+=65535)i.push(String.fromCharCode.apply(null,t.subarray(o,o+65535)));return i.join("")}return String.fromCharCode.apply(null,t)}function s(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=c();return t}function c(){var e,t,i=r[d];if(0==(128&i))return d++,i;if(128==(240&i))return d++,o(t=15&i);if(144==(240&i))return d++,s(t=15&i);if(160==(224&i))return d++,a(t=31&i);if(224==(224&i))return e=l.getInt8(d),d++,e;switch(i){case 192:return d++,null;case 194:return d++,!1;case 195:return d++,!0;case 196:return t=l.getUint8(d+1),d+=2,n(t);case 197:return t=l.getUint16(d+1),d+=3,n(t);case 198:return t=l.getUint32(d+1),d+=5,n(t);case 202:return e=l.getFloat32(d+1),d+=5,e;case 203:return e=l.getFloat64(d+1),d+=9,e;case 204:return e=r[d+1],d+=2,e;case 205:return e=l.getUint16(d+1),d+=3,e;case 206:return e=l.getUint32(d+1),d+=5,e;case 208:return e=l.getInt8(d+1),d+=2,e;case 209:return e=l.getInt16(d+1),d+=3,e;case 210:return e=l.getInt32(d+1),d+=5,e;case 217:return t=l.getUint8(d+1),d+=2,a(t);case 218:return t=l.getUint16(d+1),d+=3,a(t);case 219:return t=l.getUint32(d+1),d+=5,a(t);case 220:return t=l.getUint16(d+1),d+=3,s(t);case 221:return t=l.getUint32(d+1),d+=5,s(t);case 222:return t=l.getUint16(d+1),d+=3,o(t);case 223:return t=l.getUint32(d+1),d+=5,o(t)}throw new Error("Unknown type 0x"+i.toString(16))}var d=0,l=new DataView(r.buffer);return c()}function O(e,t,i,o){switch(e){case 1:return function(e,t){for(var i=e.length,o=u(t=t||new Float32Array(i/4)),r=u(e),n=0,a=0,s=i/4;n<s;++n,a+=4)o.setFloat32(a,r.getFloat32(a),!0);return t}(t);case 2:return d(t);case 3:return v(t);case 4:return h(t);case 5:return c(t);case 6:return g(h(t),new Uint8Array(i));case 7:return g(h(t));case 8:return y(g(h(t)),s);case 9:return r=h(t),n=h(o)[0],m(g(r,l(a)),n,a);case 10:return b(v(t),h(o)[0]);case 11:return m(v(t),h(o)[0]);case 12:return _(v(t),h(o)[0]);case 13:return _(d(t),h(o)[0]);case 14:return E(v(t));case 15:return E(d(t))}var r,n,a,s}function P(c,e){var d=(e=e||{}).ignoreFields,l={};return D.forEach(function(e){var t,i,o,r,n,a=!!d&&-1!==d.indexOf(e),s=c[e];a||void 0===s||(s instanceof Uint8Array?l[e]=O.apply(null,(i=u(t=s),o=i.getInt32(0),r=i.getInt32(4),n=t.subarray(8,12),[o,t=t.subarray(12),r,n])):l[e]=s)}),l}function W(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function M(e,t){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),P(e instanceof Uint8Array?N(e):e,t)}function z(e,t,i,o){var r=new XMLHttpRequest;r.addEventListener("load",function(){try{var e=M(r.response);i(e)}catch(e){o(e)}},!0),r.addEventListener("error",o,!0),r.responseType="arraybuffer",r.open("GET",t+e.toUpperCase()),r.send()}var H=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],D=H.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),j="//mmtf.rcsb.org/v1.0/",F=j+"full/",V=j+"reduced/";return e.encode=function(e){return t(I(e))},e.decode=M,e.traverse=function(e,t,i){var o,r,n,a,s,c,d=(i=i||{}).firstModelOnly,l=t.onModel,u=t.onChain,p=t.onGroup,f=t.onAtom,v=t.onBond,h=0,m=0,g=0,y=0,E=0,_=-1,b=e.chainNameList,w=e.secStructList,x=e.insCodeList,T=e.sequenceIndexList,C=e.atomIdList,R=e.bFactorList,S=e.altLocList,L=e.occupancyList,A=e.bondAtomList,I=e.bondOrderList;for(o=0,r=e.chainsPerModel.length;o<r&&!(d&&0<h);++o){var N=e.chainsPerModel[h];for(l&&l({chainCount:N,modelIndex:h}),n=0;n<N;++n){var O=e.groupsPerChain[m];if(u){var P=W(e.chainIdList.subarray(4*m,4*m+4)),M=null;b&&(M=W(b.subarray(4*m,4*m+4))),u({groupCount:O,chainIndex:m,modelIndex:h,chainId:P,chainName:M})}for(a=0;a<O;++a){var z=e.groupList[e.groupTypeList[g]],H=z.atomNameList.length;if(p){var D=null;w&&(D=w[g]);var j=null;e.insCodeList&&(j=String.fromCharCode(x[g]));var F=null;T&&(F=T[g]),p({atomCount:H,groupIndex:g,chainIndex:m,modelIndex:h,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:z.groupName,singleLetterCode:z.singleLetterCode,chemCompType:z.chemCompType,secStruct:D,insCode:j,sequenceIndex:F})}for(s=0;s<H;++s){if(f){var V=null;C&&(V=C[y]);var k=null;R&&(k=R[y]);var U=null;S&&(U=String.fromCharCode(S[y]));var B=null;L&&(B=L[y]),f({atomIndex:y,groupIndex:g,chainIndex:m,modelIndex:h,atomId:V,element:z.elementList[s],atomName:z.atomNameList[s],formalCharge:z.formalChargeList[s],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:k,altLoc:U,occupancy:B})}y+=1}if(v){var G=z.bondAtomList;for(s=0,c=z.bondOrderList.length;s<c;++s)v({atomIndex1:y-H+G[2*s],atomIndex2:y-H+G[2*s+1],bondOrder:z.bondOrderList[s]})}g+=1}m+=1}if(E=_+1,_=y-1,v&&A)for(s=0,c=A.length;s<c;s+=2){var X=A[s],q=A[s+1];(E<=X&&X<=_||E<=q&&q<=_)&&v({atomIndex1:X,atomIndex2:q,bondOrder:I?I[s/2]:null})}h+=1}},e.fetch=function(e,t,i){z(e,F,t,i)},e.fetchReduced=function(e,t,i){z(e,V,t,i)},e.version="v1.0.1",e.fetchUrl=F,e.fetchReducedUrl=V,e.encodeMsgpack=t,e.encodeMmtf=I,e.decodeMsgpack=N,e.decodeMmtf=P,e}MMTF=initIcn3dpyMMTF(MMTF),function($,J){var o,n="__instance__",a="firstChild",s=setTimeout;function h(e){return void 0!==e}function ee(e){return"object"==typeof e}function c(e){return Object.keys(e).length}function te(e,t,i){return e<t?t:i<e?i:e}function t(e,t){return parseInt(e,t||10)}function p(e){return Math.round(e)}function ie(e){var t,i,o,r,n,a,s,c,d=+e[0],l=+e[1],u=+e[2];switch(a=u*(1-l),s=(s=u*(1-(n=6*d-(r=Math.floor(6*d)))*l))||0,c=(c=u*(1-(1-n)*l))||0,(r=r||0)%6){case 0:t=u,i=c,o=a;break;case 1:t=s,i=u,o=a;break;case 2:t=a,i=u,o=c;break;case 3:t=a,i=s,o=u;break;case 4:t=c,i=a,o=u;break;case 5:t=u,i=a,o=s}return[p(255*t),p(255*i),p(255*o)]}function oe(e){return i(ie(e))}function r(e){var t,i=+e[0],o=+e[1],r=+e[2],n=Math.max(i,o,r),a=Math.min(i,o,r),s=n-a,c=0===n?0:s/n,d=n/255;switch(n){case a:t=0;break;case i:t=o-r+s*(o<r?6:0),t/=6*s;break;case o:t=r-i+2*s,t/=6*s;break;case r:t=i-o+4*s,t/=6*s}return[t,c,d]}function i(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return(t="000000"+t.toString(16)).slice(-6)}function d(e){return r(l(e))}function l(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[t(e[0]+e[1],16),t(e[2]+e[3],16),t(e[4]+e[5],16)]}function u(e){return[e[0]/360,e[1]/100,e[2]/100]}function f(e){return[p(360*e[0]),p(100*e[1]),p(100*e[2])]}function e(e){if(ee(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),i=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e);return"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?d(e.slice(1)):i?u([+i[1],+i[2],+i[3]]):t?r([+t[1],+t[2],+t[3]]):[0,1,1]}(o=$.CP=function(m,g,y){var E=J.body,u=J.documentElement,_=this,t=$.CP,i=!1,r={},b=J.createElement("div"),w="touchstart mousedown",x="touchmove mousemove",T="touchend mouseup",C="orientationchange resize";if(!(_ instanceof t))return new t(m,g);function R(e,t,i){for(var o=0,r=(e=e.split(/\s+/)).length;o<r;++o)t.addEventListener(e[o],i,!1)}function S(e,t,i){for(var o=0,r=(e=e.split(/\s+/)).length;o<r;++o)t.removeEventListener(e[o],i)}function L(e,t){var i="touches",o="clientX",r="clientY",n=t[i]?t[i][0][o]:t[o],a=t[i]?t[i][0][r]:t[r],s=p(e);return{x:n-s.l,y:a-s.t}}function p(e){var t,i,o;return i=e===$?(t=$.pageXOffset||u.scrollLeft,$.pageYOffset||u.scrollTop):(t=(o=e.getBoundingClientRect()).left,o.top),{l:t,t:i}}function A(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function I(e){e&&e.preventDefault()}function N(e){return e===$?{w:$.innerWidth,h:$.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function O(e){return i||!!h(e)&&e}function P(e){i=e}function M(e,t,i){if(!h(r[e]))return _;if(h(i))h(r[e][i])&&r[e][i].apply(_,t);else for(var o in r[e])r[e][o].apply(_,t);return _}t[n][m.id||m.name||c(t[n])]=_,h(g)&&!0!==g||(g=w),P(t.parse(m.getAttribute("data-color")||m.value||[0,1,1])),b.className="color-picker",b.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var z,e=b[a].children,H=O([0,1,1]),D=e[0],j=e[1],F=D[a],V=j[a],k=0,U=0,B=0,G=0,f=0,v=0,X=0,q=0,W=oe(H);function Y(e,t){e&&"h"!==e||M("change:h",t),e&&"sv"!==e||M("change:sv",t),M("change",t)}function Z(){return b.parentNode}function Q(e,t){e||((y||t||E).appendChild(b),_.visible=!0),X=N(b).w,q=N(b).h;var i=N(j),o=N(V),s=N(D).h,c=i.w,d=i.h,l=N(F).h,u=o.w,p=o.h;if(e){function r(e){var t=e.target,i=t===m||A(t,m)===m;i?Q():_.exit(),M(i?"enter":"exit",[_])}b.style.left=b.style.top="-9999px",!1!==g&&R(g,m,r),_.create=function(){return Q(1),M("create",[_]),_},_.destroy=function(){return!1!==g&&S(g,m,r),_.exit(),P(!1),M("destroy",[_]),_}}else K();function f(e){ie(H);var t=ie([H[0],1,1]);j.style.backgroundColor="rgb("+t.join(",")+")",P(H),I(e)}function n(e){var t,i,o,r,n,a;B&&(i=te(L(D,t=e).y,0,s),H[0]=(s-i)/s,F.style.top=i-l/2+"px",f(t),W=oe(H),k||(M("drag:h",[W,_]),M("drag",[W,_]),Y("h",[W,_]))),G&&(r=L(j,o=e),n=te(r.x,0,c),a=te(r.y,0,d),H[1]=1-(c-n)/c,H[2]=(d-a)/d,V.style.right=c-n-u/2+"px",V.style.top=a-p/2+"px",f(o),W=oe(H),U||(M("drag:sv",[W,_]),M("drag",[W,_]),Y("sv",[W,_]))),U=k=0}function a(e){var t=e.target,i=B?"h":"sv",o=[oe(H),_],r=t===m||A(t,m)===m,n=t===b||A(t,b)===b;r||n?n&&(M("stop:"+i,o),M("stop",o),Y(i,o)):Z()&&!1!==g&&(_.exit(),M("exit",[_]),Y(0,o)),G=B=0}function v(e){B=k=1,n(e),I(e),M("start:h",[W,_]),M("start",[W,_]),Y("h",[W,_])}function h(e){G=U=1,n(e),I(e),M("start:sv",[W,_]),M("start",[W,_]),Y("sv",[W,_])}z=function(){H=O(H),f(),F.style.top=s-l/2-s*H[0]+"px",V.style.right=c-u/2-c*H[1]+"px",V.style.top=d-p/2-d*H[2]+"px"},_.exit=function(e){return Z()&&(Z().removeChild(b),_.visible=!1),S(w,D,v),S(w,j,h),S(x,J,n),S(T,J,a),S(C,$,K),_},z(),e||(R(w,D,v),R(w,j,h),R(x,J,n),R(T,J,a),R(C,$,K))}function K(){return _.fit()}return Q(1),s(function(){var e=[oe(H),_];M("create",e),Y(0,e)},0),_.fit=function(e){var t=N($),i=N(u),o=t.w-i.w,r=t.h-u.clientHeight,n=p($),a=p(m);if(f=a.l+n.l,v=a.t+n.t+N(m).h,ee(e))h(e[0])&&(f=e[0]),h(e[1])&&(v=e[1]);else{var s=n.l,c=n.t,d=n.l+t.w-X-o,l=n.t+t.h-q-r;f=te(f,s,d)>>0,v=te(v,c,l)>>0}return b.style.left=f+"px",b.style.top=v+"px",M("fit",[_]),_},_.set=function(e){return h(e)?("string"==typeof e&&(e=t.parse(e)),P(e),z(),_):O()},_.get=function(e){return O(e)},_.target=m,_.picker=b,_.visible=!1,_.on=function(e,t,i){return h(e)?h(t)?(h(r[e])||(r[e]={}),h(i)||(i=c(r[e])),r[e][i]=t,_):r[e]:r},_.off=function(e,t){return h(e)?h(t)?delete r[e][t]:r[e]={}:r={},_},_.fire=M,_.hooks=r,_.enter=function(e){return Q(0,e)},_}).version="1.3.9",o[n]={},o.each=function(i,e){return s(function(){var e,t=o[n];for(e in t)i(t[e],e,t)},0===e?0:e||1),o},o.parse=e,o._HSV2RGB=ie,o._HSV2HEX=oe,o._RGB2HSV=r,o._HEX2HSV=d,o._HEX2RGB=function(e){return[(t=l(e))[0]/255,t[1]/255,t[2]/255];var t},o.HSV2RGB=function(e){return ie(u(e))},o.HSV2HEX=function(e){return oe(u(e))},o.RGB2HSV=function(e){return f(r(e))},o.RGB2HEX=i,o.HEX2HSV=function(e){return f(d(e))},o.HEX2RGB=l}(window,document);var saveAs=function(s){"use strict";if(!(void 0===s||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=s.document,c=function(){return s.URL||s.webkitURL||s},d=e.createElementNS("http://www.w3.org/1999/xhtml","a"),l="download"in d,u=/constructor/i.test(s.HTMLElement)||s.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent),f=s.setImmediate||s.setTimeout,v=function(e){f(function(){throw e},0)},h=function(e){setTimeout(function(){"string"==typeof e?c().revokeObjectURL(e):e.remove()},4e4)},m=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},o=function(e,i,t){t||(e=m(e));function o(){!function(e,t,i){for(var o=(t=[].concat(t)).length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,i||e)}catch(e){v(e)}}}(n,"writestart progress write writeend".split(" "))}var r,n=this,a="application/octet-stream"===(e?e.type:void 0);if(n.readyState=n.INIT,l)return r=r||c().createObjectURL(e),void f(function(){var e,t;d.href=r,d.download=i,e=d,t=new MouseEvent("click"),e.dispatchEvent(t),o(),h(r),n.readyState=n.DONE},0);!function(){if((p||a&&u)&&s.FileReader){var t=new FileReader;return t.onloadend=function(){var e=p?t.result:t.result.replace(/^data:[^;]*;/,"data:attachment/file;");s.open(e,"_blank")||(s.location.href=e),e=void 0,n.readyState=n.DONE,o()},t.readAsDataURL(e),n.readyState=n.INIT}(r=r||c().createObjectURL(e),a)?s.location.href=r:s.open(r,"_blank")||(s.location.href=r);n.readyState=n.DONE,o(),h(r)}()},t=o.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=m(e)),navigator.msSaveOrOpenBlob(e,t)}:(t.abort=function(){},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,function(e,t,i){return new o(e,t||e.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this);!function(e){"use strict";var r=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,l=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),u=l&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),p=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,f=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,n=(l||p)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,i,o,r,n,a,s,c,d;if(!(t=e.match(f)))throw new Error("invalid data URI");for(i=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),o=!!t[4],r=e.slice(t[0].length),n=(o?atob:decodeURIComponent)(r),a=new ArrayBuffer(n.length),s=new Uint8Array(a),c=0;c<n.length;c+=1)s[c]=n.charCodeAt(c);return l?new Blob([u?s:a],{type:i}):((d=new p).append(a),d.getBlob(i))};e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,i){var o=this;setTimeout(function(){i&&r.toDataURL&&n?e(n(o.toDataURL(t,i))):e(o.mozGetAsFile("blob",t))})}:r.toDataURL&&n&&(r.toBlob=function(e,t,i){var o=this;setTimeout(function(){e(n(o.toDataURL(t,i)))})})),"function"==typeof define&&define.amd?define(function(){return n}):"object"==typeof module&&module.exports?module.exports=n:e.dataURLtoBlob=n}(window);
var icn3d=function(e){"use strict";class t{constructor(e){this.icn3dui=e}cloneHash(e){this.icn3dui;var t={};for(var s in void 0===e&&(e={}),e)t[s]=e[s];return t}intHash(e,t){this.icn3dui;var s={};if(void 0===e&&(e={}),void 0===t&&(t={}),Object.keys(e).length<Object.keys(t).length)for(var i in e)void 0!==t&&t[i]&&(s[i]=e[i]);else for(var i in t)void 0!==e&&e[i]&&(s[i]=t[i]);return s}exclHash(e,t){void 0===e&&(e={}),void 0===t&&(t={});var s=this.icn3dui.hashUtilsCls.cloneHash(e);for(var i in s)void 0!==t&&t[i]&&delete s[i];return s}unionHash(e,t){return this.icn3dui.hashUtilsCls.unionHashInPlace(e,t)}unionHashInPlace(e,t){return this.icn3dui,void 0===e&&(e={}),void 0===t&&(t={}),$.extend(e,t),e}unionHashNotInPlace(e,t){return this.icn3dui,$.extend({},e,t)}intHash2Atoms(e,t,s){var i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.intHash(e,t),s)}exclHash2Atoms(e,t,s){var i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.exclHash(e,t),s)}unionHash2Atoms(e,t,s){var i=this.icn3dui;return i.hashUtilsCls.hash2Atoms(i.hashUtilsCls.unionHash(e,t),s)}hash2Atoms(e,t){this.icn3dui;var s={};for(var i in e)s[i]=t[i];return s}hashvalue2array(e){this.icn3dui;var t=[];for(var s in e)t.push(e[s]);return t}}class s{constructor(e){this.icn3dui=e,this.glycanHash={GLC:{c:"1E90FF",s:"sphere"},BGC:{c:"1E90FF",s:"sphere"},NAG:{c:"1E90FF",s:"cube"},NDG:{c:"1E90FF",s:"cube"},GCS:{c:"1E90FF",s:"cube"},PA1:{c:"1E90FF",s:"cube"},GCU:{c:"1E90FF",s:"cone"},BDP:{c:"1E90FF",s:"cone"},G6D:{c:"1E90FF",s:"cone"},DDA:{c:"1E90FF",s:"cylinder"},B6D:{c:"1E90FF",s:"cylinder"},XXM:{c:"1E90FF",s:"cylinder"},MAN:{c:"00FF00",s:"sphere"},BMA:{c:"00FF00",s:"sphere"},BM3:{c:"00FF00",s:"cube"},"95Z":{c:"00FF00",s:"cube"},MAV:{c:"00FF00",s:"cone"},BEM:{c:"00FF00",s:"cone"},RAM:{c:"00FF00",s:"cone"},RM4:{c:"00FF00",s:"cone"},TYV:{c:"00FF00",s:"cylinder"},ARA:{c:"00FF00",s:"cylinder"},ARB:{c:"00FF00",s:"cylinder"},KDN:{c:"00FF00",s:"cylinder"},KDM:{c:"00FF00",s:"cylinder"},"6PZ":{c:"00FF00",s:"cylinder"},GMH:{c:"00FF00",s:"cylinder"},BDF:{c:"00FF00",s:"cylinder"},GAL:{c:"FFFF00",s:"sphere"},GLA:{c:"FFFF00",s:"sphere"},NGA:{c:"FFFF00",s:"cube"},A2G:{c:"FFFF00",s:"cube"},X6X:{c:"FFFF00",s:"cube"},"1GN":{c:"FFFF00",s:"cube"},ADA:{c:"FFFF00",s:"cone"},GTR:{c:"FFFF00",s:"cone"},LDY:{c:"FFFF00",s:"cylinder"},KDO:{c:"FFFF00",s:"cylinder"},T6T:{c:"FFFF00",s:"cylinder"},GUP:{c:"A52A2A",s:"sphere"},GL0:{c:"A52A2A",s:"sphere"},LGU:{c:"A52A2A",s:"cone"},ABE:{c:"A52A2A",s:"cylinder"},XYS:{c:"A52A2A",s:"cylinder"},XYP:{c:"A52A2A",s:"cylinder"},SOE:{c:"A52A2A",s:"cylinder"},PZU:{c:"FF69B4",s:"cylinder"},RIP:{c:"FF69B4",s:"cylinder"},"0MK":{c:"FF69B4",s:"cylinder"},ALL:{c:"8A2BE2",s:"sphere"},AFD:{c:"8A2BE2",s:"sphere"},NAA:{c:"8A2BE2",s:"cube"},SIA:{c:"8A2BE2",s:"cylinder"},SIB:{c:"8A2BE2",s:"cylinder"},AMU:{c:"8A2BE2",s:"cylinder"},X0X:{c:"1E90FF",s:"cone"},X1X:{c:"1E90FF",s:"cone"},NGC:{c:"1E90FF",s:"cylinder"},NGE:{c:"1E90FF",s:"cylinder"},"4N2":{c:"A0522D",s:"sphere"},HSQ:{c:"A0522D",s:"cube"},IDR:{c:"A0522D",s:"cone"},MUR:{c:"A0522D",s:"cylinder"},FUC:{c:"FF0000",s:"cone"},FUL:{c:"FF0000",s:"cone"}},this.nucleotidesArray=["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU","G","A","T","C","U","DG","DA","DT","DC","DU"],this.ionsArray=["  K"," NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I","K","NA","MG","AL","CA","TI","MN","FE","NI","CU","ZN","AG","BA","F","CL","BR","I"],this.cationsTrimArray=["K","NA","MG","AL","CA","TI","MN","FE","NI","CU","ZN","AG","BA"],this.anionsTrimArray=["F","CL","BR","I"],this.ionCharges={K:1,NA:1,MG:2,AL:3,CA:2,TI:3,MN:2,FE:3,NI:2,CU:2,ZN:2,AG:1,BA:2},this.vdwRadii={H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},this.covalentRadii={H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},this.atomColors={H:this.thr(16777215),He:this.thr(16761035),HE:this.thr(16761035),Li:this.thr(11674146),LI:this.thr(11674146),B:this.thr(65280),C:this.thr(13158600),N:this.thr(255),O:this.thr(15728640),F:this.thr(14329120),Na:this.thr(255),NA:this.thr(255),Mg:this.thr(2263842),MG:this.thr(2263842),Al:this.thr(8421520),AL:this.thr(8421520),Si:this.thr(14329120),SI:this.thr(14329120),P:this.thr(16753920),S:this.thr(16762930),Cl:this.thr(65280),CL:this.thr(65280),Ca:this.thr(8421520),CA:this.thr(8421520),Ti:this.thr(8421520),TI:this.thr(8421520),Cr:this.thr(8421520),CR:this.thr(8421520),Mn:this.thr(8421520),MN:this.thr(8421520),Fe:this.thr(16753920),FE:this.thr(16753920),Ni:this.thr(10824234),NI:this.thr(10824234),Cu:this.thr(10824234),CU:this.thr(10824234),Zn:this.thr(10824234),ZN:this.thr(10824234),Br:this.thr(10824234),BR:this.thr(10824234),Ag:this.thr(8421520),AG:this.thr(8421520),I:this.thr(10494192),Ba:this.thr(16753920),BA:this.thr(16753920),Au:this.thr(14329120),AU:this.thr(14329120)},this.defaultAtomColor=this.thr(13421772),this.stdChainColors=[this.thr(16711935),this.thr(255),this.thr(10053171),this.thr(65433),this.thr(16750848),this.thr(16737894),this.thr(3329330),this.thr(2003199),this.thr(16416882),this.thr(16753920),this.thr(52945),this.thr(16738740),this.thr(65280),this.thr(255),this.thr(16711680),this.thr(16776960),this.thr(65535),this.thr(16711935),this.thr(3978097),this.thr(4620980),this.thr(13458524),this.thr(16770229),this.thr(11529966),this.thr(15631086),this.thr(25600),this.thr(139),this.thr(9109504),this.thr(13468991),this.thr(35723),this.thr(9699539)],this.backgroundColors={black:this.thr(0),grey:this.thr(13421772),white:this.thr(16777215),transparent:this.thr(0)},this.residueColors={ALA:this.thr(13158600),ARG:this.thr(1334015),ASN:this.thr(56540),ASP:this.thr(15075850),CYS:this.thr(15132160),GLN:this.thr(56540),GLU:this.thr(15075850),GLY:this.thr(15461355),HIS:this.thr(8553170),ILE:this.thr(1016335),LEU:this.thr(1016335),LYS:this.thr(1334015),MET:this.thr(15132160),PHE:this.thr(3289770),PRO:this.thr(14456450),SER:this.thr(16422400),THR:this.thr(16422400),TRP:this.thr(11819700),TYR:this.thr(3289770),VAL:this.thr(1016335),ASX:this.thr(16738740),GLX:this.thr(16738740),G:this.thr(32768),A:this.thr(6324479),T:this.thr(16744448),C:this.thr(16711680),U:this.thr(16744448),DG:this.thr(32768),DA:this.thr(6324479),DT:this.thr(16744448),DC:this.thr(16711680),DU:this.thr(16744448)},this.residueArea={ALA:247,ARG:366,ASN:290,ASP:285,CYS:271,GLN:336,GLU:325,GLY:217,HIS:340,ILE:324,LEU:328,LYS:373,MET:346,PHE:366,PRO:285,SER:265,THR:288,TRP:414,TYR:387,VAL:293,ASX:290,GLX:336,G:520,A:507,T:515,C:467,U:482,DG:520,DA:507,DT:515,DC:467,DU:482},this.defaultResidueColor=this.thr(12492910),this.chargeColors={"  G":this.thr(16711680),"  A":this.thr(16711680),"  T":this.thr(16711680),"  C":this.thr(16711680),"  U":this.thr(16711680)," DG":this.thr(16711680)," DA":this.thr(16711680)," DT":this.thr(16711680)," DC":this.thr(16711680)," DU":this.thr(16711680),G:this.thr(16711680),A:this.thr(16711680),T:this.thr(16711680),C:this.thr(16711680),U:this.thr(16711680),DG:this.thr(16711680),DA:this.thr(16711680),DT:this.thr(16711680),DC:this.thr(16711680),DU:this.thr(16711680),ARG:this.thr(255),LYS:this.thr(255),ASP:this.thr(16711680),GLU:this.thr(16711680),HIS:this.thr(8421631),GLY:this.thr(8947848),PRO:this.thr(8947848),ALA:this.thr(8947848),VAL:this.thr(8947848),LEU:this.thr(8947848),ILE:this.thr(8947848),PHE:this.thr(8947848),SER:this.thr(8947848),THR:this.thr(8947848),ASN:this.thr(8947848),GLN:this.thr(8947848),TYR:this.thr(8947848),MET:this.thr(8947848),CYS:this.thr(8947848),TRP:this.thr(8947848)},this.hydrophobicColors={"  G":this.thr(16711680),"  A":this.thr(16711680),"  T":this.thr(16711680),"  C":this.thr(16711680),"  U":this.thr(16711680)," DG":this.thr(16711680)," DA":this.thr(16711680)," DT":this.thr(16711680)," DC":this.thr(16711680)," DU":this.thr(16711680),G:this.thr(16711680),A:this.thr(16711680),T:this.thr(16711680),C:this.thr(16711680),U:this.thr(16711680),DG:this.thr(16711680),DA:this.thr(16711680),DT:this.thr(16711680),DC:this.thr(16711680),DU:this.thr(16711680),ARG:this.thr(255),LYS:this.thr(255),ASP:this.thr(16711680),GLU:this.thr(16711680),HIS:this.thr(8421631),TRP:this.thr().setHSL(1/3,1,.5),PHE:this.thr().setHSL(1/3,1,.6945945945945946),TYR:this.thr().setHSL(1/3,1,.745945945945946),LEU:this.thr().setHSL(1/3,1,.5+.645/1.85),ILE:this.thr().setHSL(1/3,1,.5+.77/1.85),CYS:this.thr().setHSL(1/3,1,.5+.805/1.85),MET:this.thr().setHSL(1/3,1,.5+.81/1.85),GLY:this.thr().setHSL(1/6,1,.5+.285/.58),VAL:this.thr().setHSL(1/6,1,.5+.255/.58),SER:this.thr().setHSL(1/6,1,.8879310344827587),THR:this.thr().setHSL(1/6,1,.8793103448275862),ALA:this.thr().setHSL(1/6,1,.853448275862069),ASN:this.thr().setHSL(1/6,1,.6379310344827587),PRO:this.thr().setHSL(1/6,1,.6120689655172413),GLN:this.thr().setHSL(1/6,1,.5)},this.ssColors={helix:this.thr(16711680),sheet:this.thr(32768),coil:this.thr(6324479)},this.ssColors2={helix:this.thr(16711680),sheet:this.thr(16762880),coil:this.thr(6324479)},this.b62ResArray=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],this.b62Matrix=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0,-4],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1,-4],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1,-4],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1,-4],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2,-4],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1,-4],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1,-4],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1,-4],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1,-4],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1,-4],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1,-4],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1,-4],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1,-4],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2,-4],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0,-4],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0,-4],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2,-4],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1,-4],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1,-4],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1,-4],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1,-4],[-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,1]]}thr(e){return this.icn3dui,new THREE.Color(e)}}class i{constructor(e){this.icn3dui=e}isIE(){return this.icn3dui,!!(window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.match(/Trident.*rv\:11\./))}isMobile(){return this.icn3dui,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent)}isMac(){return this.icn3dui,/Mac/i.test(window.navigator.userAgent)}isSessionStorageSupported(){return this.icn3dui,window.sessionStorage}hexToRgb(e,t){this.icn3dui;var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16),a:t}:null}isCalphaPhosOnly(e){this.icn3dui;var t=!1,s=0,i=0;for(var n in e){if(!(s<50))break;"CA"!==e[n].name&&"P"!==e[n].name&&"O3'"!==e[n].name&&"O3*"!==e[n].name&&++i,++s}return i<.5*s&&(t=!0),t}hasCovalentBond(e,t){var s=this.icn3dui,i=s.parasCls.covalentRadii[e.elem.toUpperCase()]+s.parasCls.covalentRadii[t.elem.toUpperCase()],n=e.coord.x-t.coord.x,r=e.coord.y-t.coord.y,a=e.coord.z-t.coord.z;return n*n+r*r+a*a<1.3*i*i}residueName2Abbr(e){this.icn3dui;var t=e.indexOf(" ");switch(t>0&&(e=e.substr(0,t)),e){case"  A":return"A";case"  C":return"C";case"  G":return"G";case"  T":return"T";case"  U":return"U";case"  I":return"I";case" DA":return"A";case" DC":return"C";case" DG":return"G";case" DT":return"T";case" DU":return"U";case" DI":return"I";case"DA":return"A";case"DC":return"C";case"DG":return"G";case"DT":return"T";case"DU":return"U";case"DI":return"I";case"ALA":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLU":return"E";case"GLN":return"Q";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"HOH":case"WAT":return"O";default:return e.trim()}}residueAbbr2Name(e){if(this.icn3dui,e.length>1)return e;switch(e){case"A":return"ALA";case"R":return"ARG";case"N":return"ASN";case"D":return"ASP";case"C":return"CYS";case"E":return"GLU";case"Q":return"GLN";case"G":return"GLY";case"H":return"HIS";case"I":return"ILE";case"L":return"LEU";case"K":return"LYS";case"M":return"MET";case"F":return"PHE";case"P":return"PRO";case"S":return"SER";case"T":return"THR";case"W":return"TRP";case"Y":return"TYR";case"V":return"VAL";case"O":return"HOH";default:return e.trim()}}getJSONFromArray(e){this.icn3dui;for(var t="",s=0,i=e.length;s<i;++s)t+=JSON.stringify(e[s]),s!=i-1&&(t+=", ");return t}checkFileAPI(){this.icn3dui,window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.")}getIdArray(e){this.icn3dui;var t=[];if(e){var s=e.indexOf("_"),i=e.lastIndexOf("_");t.push(e.substr(0,s)),t.push(e.substr(s+1,i-s-1)),t.push(e.substr(i+1))}return t}compResid(e,t,s){var i,n,r=this.icn3dui,a=e.split(","),l=t.split(",");"save1"==s?(i=r.utilsCls.getIdArray(a[0]),n=r.utilsCls.getIdArray(l[0])):"save2"==s&&(i=r.utilsCls.getIdArray(a[1]),n=r.utilsCls.getIdArray(l[1]));var o=i[0]+"_"+i[1],d=n[0]+"_"+n[1],c=parseInt(i[2]),h=parseInt(n[2]);return o>d?1:o<d?-1:o==d?c>h?1:c<h?-1:0:void 0}toggle(e,t,s,i){this.icn3dui;var n=[e,t];for(var r in n){var a=n[r];$("#"+a).toggleClass("ui-icon-plus"),$("#"+a).toggleClass("ui-icon-minus")}for(var r in n=[e,t,s,i]){a=n[r];$("#"+a).toggleClass("icn3d-shown"),$("#"+a).toggleClass("icn3d-hidden")}}setViewerWidthHeight(e){var t,s;if((e=this.icn3dui).bNode)return e.htmlCls.WIDTH=400,void(e.htmlCls.HEIGHT=400);e.htmlCls.WIDTH=$(window).width()-e.htmlCls.LESSWIDTH,e.htmlCls.HEIGHT=$(window).height()-e.htmlCls.EXTRAHEIGHT-e.htmlCls.LESSHEIGHT,void 0!==e.oriWidth&&-1===e.cfg.width.toString().indexOf("%")?(t=e.oriWidth,s=e.oriHeight):(t=$("#"+e.pre+"viewer").css("width"),s=$("#"+e.pre+"viewer").css("height"),void 0===t&&(t=e.htmlCls.WIDTH),void 0===s&&(s=e.htmlCls.HEIGHT),t=-1!==e.cfg.width.toString().indexOf("%")?$(window).width()*e.cfg.width.substr(0,e.cfg.width.toString().indexOf("%"))/100-e.htmlCls.LESSWIDTH:parseInt(e.cfg.width),s=-1!==e.cfg.height.toString().indexOf("%")?$(window).height()*e.cfg.height.substr(0,e.cfg.height.toString().indexOf("%"))/100-e.htmlCls.EXTRAHEIGHT-e.htmlCls.LESSHEIGHT:parseInt(e.cfg.height)),t&&e.htmlCls.WIDTH>t&&(e.htmlCls.WIDTH=t),s&&e.htmlCls.HEIGHT>s&&(e.htmlCls.HEIGHT=s)}}class n{constructor(e){this.icn3dui=e}onId(e,t,s){(this.icn3dui,Object.keys(window).length<2)||("#"==e.substr(0,1)&&(e=e.substr(1)),document.getElementById(e)&&t.split(" ").forEach((t=>{document.getElementById(e).addEventListener(t,s)})))}onIds(e,t,s){var i=this.icn3dui;Array.isArray(e)?e.forEach((e=>{i.myEventCls.onId(e,t,s)})):i.myEventCls.onId(e,t,s)}}class r{constructor(e){this.icn3dui=e}getRmsdSuprCls(e,t,s){var i,n,r,a,l,o,d,c,h,m,p,u,C=this.icn3dui,v=new Array(9),g=new THREE.Vector3,f=new THREE.Vector3,b=[],y=[],w=new Array(3),S=new Array(3),_=new Array(3),A=new Array(3),x=new Array(3),k=new Array(3);if(i=0,s<=1)return{rot:void 0,trans1:void 0,trans2:void 0,rmsd:999};for(n=0;n<s;n++)b.push(e[n].clone()),y.push(t[n].clone()),g.add(e[n]),f.add(t[n]);g.multiplyScalar(1/s),f.multiplyScalar(1/s);var O=g,H=f;for(n=0;n<s;n++)b[n].sub(g),y[n].sub(f);for(n=0,o=d=0;n<s;n++)o+=b[n].x*b[n].x+b[n].y*b[n].y+b[n].z*b[n].z,d+=y[n].x*y[n].x+y[n].y*y[n].y+y[n].z*y[n].z;o/=s,d/=s;var R=new Array(9);for(n=0;n<9;++n)R[n]=0;for(n=0;n<s;n++)R[0]+=b[n].x*y[n].x,R[1]+=b[n].x*y[n].y,R[2]+=b[n].x*y[n].z,R[3]+=b[n].y*y[n].x,R[4]+=b[n].y*y[n].y,R[5]+=b[n].y*y[n].z,R[6]+=b[n].z*y[n].x,R[7]+=b[n].z*y[n].y,R[8]+=b[n].z*y[n].z;for(n=0;n<9;++n)R[n]/=s;var E=C.rmsdSuprCls.getEigenVectors(R);return r=E.k,w=E.h1,S=E.h2,_=E.h3,A=E.k1,x=E.k2,k=E.k3,c=E.d1,h=E.d2,m=E.d3,a=E.flag,u=E.s,1!=r?(i=100,v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1,{rot:v,trans1:O,trans2:H,rmsd:i}):(1==a?(A[0]=R[0]*w[0]+R[3]*w[1]+R[6]*w[2],A[1]=R[1]*w[0]+R[4]*w[1]+R[7]*w[2],A[2]=R[2]*w[0]+R[5]*w[1]+R[8]*w[2],l=Math.sqrt(c),A[0]/=l,A[1]/=l,A[2]/=l,x[0]=R[0]*S[0]+R[3]*S[1]+R[6]*S[2],x[1]=R[1]*S[0]+R[4]*S[1]+R[7]*S[2],x[2]=R[2]*S[0]+R[5]*S[1]+R[8]*S[2],l=Math.sqrt(h),x[0]/=l,x[1]/=l,x[2]/=l,k[0]=R[0]*_[0]+R[3]*_[1]+R[6]*_[2],k[1]=R[1]*_[0]+R[4]*_[1]+R[7]*_[2],k[2]=R[2]*_[0]+R[5]*_[1]+R[8]*_[2],l=Math.sqrt(m),k[0]/=l,k[1]/=l,k[2]/=l):2==a&&(w[0]=R[0]*A[0]+R[1]*A[1]+R[2]*A[2],w[1]=R[3]*A[0]+R[4]*A[1]+R[5]*A[2],w[2]=R[6]*A[0]+R[7]*A[1]+R[8]*A[2],l=Math.sqrt(c),w[0]/=l,w[1]/=l,w[2]/=l,S[0]=R[0]*x[0]+R[1]*x[1]+R[2]*x[2],S[1]=R[3]*x[0]+R[4]*x[1]+R[5]*x[2],S[2]=R[6]*x[0]+R[7]*x[1]+R[8]*x[2],l=Math.sqrt(h),S[0]/=l,S[1]/=l,S[2]/=l,_[0]=R[0]*k[0]+R[1]*k[1]+R[2]*k[2],_[1]=R[3]*k[0]+R[4]*k[1]+R[5]*k[2],_[2]=R[6]*k[0]+R[7]*k[1]+R[8]*k[2],l=Math.sqrt(m),_[0]/=l,_[1]/=l,_[2]/=l),u>0?(v[0]=A[0]*w[0]+x[0]*S[0]+k[0]*_[0],v[1]=A[0]*w[1]+x[0]*S[1]+k[0]*_[1],v[2]=A[0]*w[2]+x[0]*S[2]+k[0]*_[2],v[3]=A[1]*w[0]+x[1]*S[0]+k[1]*_[0],v[4]=A[1]*w[1]+x[1]*S[1]+k[1]*_[1],v[5]=A[1]*w[2]+x[1]*S[2]+k[1]*_[2],v[6]=A[2]*w[0]+x[2]*S[0]+k[2]*_[0],v[7]=A[2]*w[1]+x[2]*S[1]+k[2]*_[1],v[8]=A[2]*w[2]+x[2]*S[2]+k[2]*_[2]):(v[0]=A[0]*w[0]+x[0]*S[0]-k[0]*_[0],v[1]=A[0]*w[1]+x[0]*S[1]-k[0]*_[1],v[2]=A[0]*w[2]+x[0]*S[2]-k[0]*_[2],v[3]=A[1]*w[0]+x[1]*S[0]-k[1]*_[0],v[4]=A[1]*w[1]+x[1]*S[1]-k[1]*_[1],v[5]=A[1]*w[2]+x[1]*S[2]-k[1]*_[2],v[6]=A[2]*w[0]+x[2]*S[0]-k[2]*_[0],v[7]=A[2]*w[1]+x[2]*S[1]-k[2]*_[1],v[8]=A[2]*w[2]+x[2]*S[2]-k[2]*_[2]),{rot:v,trans1:O,trans2:H,rmsd:i=(p=o+d-2*((c=Math.sqrt(c))+(h=Math.sqrt(h))+u*(m=Math.sqrt(m))))>0?Math.sqrt(p):void 0})}eigen_values(e){var t,s,i,n,r,a,l,o,d,c,h,m,p,u,C,v,g,f,b,y;(this.icn3dui,t=e[0],s=e[1],i=e[2],n=e[3],r=e[4],a=e[5],l=e[6],o=e[7],(C=.25*(u=(c=-(t+r+(d=e[8])))*c*c/13.5-c*(h=t*r+(t+r)*d-a*o-s*n-i*l)/3+(m=-t*r*d+t*a*o+s*n*d-s*a*l-i*n*o+i*r*l))*u+(p=-c*c/3+h)*p*p/27)<0)?(b=Math.sqrt(.25*u*u-C),y=Math.acos(-.5*u/b),v=2*Math.cbrt(b)*Math.cos(y/3)):v=Math.cbrt(-.5*u+Math.sqrt(C))+Math.cbrt(-.5*u-Math.sqrt(C));return m/=-(v-=c/3),(g=.5*(-(c+=v)+Math.sqrt(c*c-4*m)))<(f=.5*(-c-Math.sqrt(c*c-4*m)))&&(C=f,g=f=g),v<g&&(C=g,g=v,v=C),g<f&&(C=f,g=f=g),{d1:v,d2:g,d3:f}}null_basis(e,t,s,i,n){var r,a,l,o,d,c,h,m,p,u,C,v,g,f,b,y,w,S;if(this.icn3dui,o=e[0],d=e[1],c=e[2],h=e[3],m=e[4],p=e[5],u=e[6],C=e[7],v=e[8],S=Math.abs(o),Math.abs(d)>S&&(S=Math.abs(d)),Math.abs(c)>S&&(S=Math.abs(c)),Math.abs(h)>S&&(S=Math.abs(h)),Math.abs(m)>S&&(S=Math.abs(m)),Math.abs(p)>S&&(S=Math.abs(p)),Math.abs(u)>S&&(S=Math.abs(u)),Math.abs(C)>S&&(S=Math.abs(C)),Math.abs(v)>S&&(S=Math.abs(v)),S<1e-10)return{k:a=3,v1:t,v2:s,v3:i};if(l=0,o/=S,d/=S,c/=S,h/=S,m/=S,p/=S,u/=S,C/=S,v/=S,Math.abs(o)<n&&Math.abs(h)<n&&Math.abs(u)<n)r=1,t[0]=1,t[1]=0,t[2]=0,Math.abs(d)<n&&Math.abs(m)<n&&Math.abs(C)<n?(r=2,s[0]=0,s[1]=1,s[2]=0,Math.abs(c)<n&&Math.abs(p)<n&&Math.abs(v)<n&&(r=3,i[0]=0,i[1]=0,i[2]=1)):(S=Math.abs(d),Math.abs(m)>S&&(w=o,o=h,h=w,w=d,d=m,m=w,w=c,c=p,p=w,S=Math.abs(d)),Math.abs(C)>S&&(w=o,o=u,u=w,w=d,d=C,C=w,w=c,c=v,v=w),b=p-m*c/d,y=v-C*c/d,Math.abs(b)<n&&Math.abs(y)<n&&(r=2,s[0]=0,s[1]=-c/d,s[2]=1,l=1));else if(S=Math.abs(o),Math.abs(d)>S&&(w=o,o=h,h=w,w=d,d=m,m=w,w=c,c=p,p=w,S=Math.abs(o)),Math.abs(c)>S&&(w=o,o=u,u=w,w=d,d=C,C=w,w=c,c=v,v=w),g=m-h*d/o,f=p-h*c/o,b=C-u*d/o,y=v-u*c/o,Math.abs(g)<n&&Math.abs(b)<n)r=1,t[0]=-d/o,t[1]=1,t[2]=0,Math.abs(f)<n&&Math.abs(y)<n&&(r=2,s[0]=-c/o,s[1]=0,s[2]=1,l=2);else{if(Math.abs(g)<Math.abs(b)&&(w=g,g=b,b=w,w=f,f=y,y=w),!(Math.abs(y-f*b/g)<n))return a=0,t[0]=0,t[1]=0,t[2]=0,{k:a,v1:t,v2:s,v3:i};r=1,t[0]=d/o*(f/g)-c/o,t[1]=-f/g,t[2]=1,l=3}return a=r,l>0&&(1==l?(o=s[0],d=s[1],c=s[2],w=Math.sqrt(o*o+d*d+c*c),s[0]=o/w,s[1]=d/w,s[2]=c/w):2==l?(o=t[0],d=t[1],c=t[2],w=o*(h=s[0])+d*(m=s[1])+c*(p=s[2]),Math.abs(w)>=n&&(s[0]=o+w*h,s[1]=d+w*m,s[2]=c+w*p,h=s[0],m=s[1],p=s[2]),w=Math.sqrt(o*o+d*d+c*c),t[0]=o/w,t[1]=d/w,t[2]=c/w,w=Math.sqrt(h*h+m*m+p*p),s[0]=h/w,s[1]=m/w,s[2]=p/w):(o=t[0],d=t[1],c=t[2],w=Math.sqrt(o*o+d*d+c*c),t[0]=o/w,t[1]=d/w,t[2]=c/w)),{k:a,v1:t,v2:s,v3:i}}getEigenForSelection(e,t){var s,i=this.icn3dui,n=new THREE.Vector3,r=[];for(s=0;s<t;s++)r.push(e[s]),n.add(e[s]);for(n.multiplyScalar(1/t),s=0;s<t;s++)r[s].sub(n);var a=new Array(9);for(s=0;s<9;++s)a[s]=0;for(s=0;s<t;s++)a[0]+=r[s].x*r[s].x,a[1]+=r[s].x*r[s].y,a[2]+=r[s].x*r[s].z,a[3]+=r[s].y*r[s].x,a[4]+=r[s].y*r[s].y,a[5]+=r[s].y*r[s].z,a[6]+=r[s].z*r[s].x,a[7]+=r[s].z*r[s].y,a[8]+=r[s].z*r[s].z;for(s=0;s<9;++s)a[s]/=t;return i.rmsdSuprCls.getEigenVectors(a)}getEigenVectors(e,t){var s,i,n,r,a,l,o,d=this.icn3dui,c=1e-8,h=new Array(9),m=new Array(3),p=new Array(3),u=new Array(3),C=new Array(3),v=new Array(3),g=new Array(3);n=e[0]*(e[4]*e[8]-e[5]*e[7]),n-=e[1]*(e[3]*e[8]-e[5]*e[6]),o=(n+=e[2]*(e[3]*e[7]-e[4]*e[6]))<0?-1:1;for(var f=new Array(3),b=new Array(3),y=0;y<3;++y)f[y]=new THREE.Vector3,b[y]=new THREE.Vector3;f[0].x=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],f[0].y=e[0]*e[3]+e[1]*e[4]+e[2]*e[5],f[0].z=e[0]*e[6]+e[1]*e[7]+e[2]*e[8],f[1].x=f[0].y,f[1].y=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],f[1].z=e[3]*e[6]+e[4]*e[7]+e[5]*e[8],f[2].x=f[0].z,f[2].y=f[1].z,f[2].z=e[6]*e[6]+e[7]*e[7]+e[8]*e[8],b[0].x=e[0]*e[0]+e[3]*e[3]+e[6]*e[6],b[0].y=e[0]*e[1]+e[3]*e[4]+e[6]*e[7],b[0].z=e[0]*e[2]+e[3]*e[5]+e[6]*e[8],b[1].x=b[0].y,b[1].y=e[1]*e[1]+e[4]*e[4]+e[7]*e[7],b[1].z=e[1]*e[2]+e[4]*e[5]+e[7]*e[8],b[2].x=b[0].z,b[2].y=b[1].z,b[2].z=e[2]*e[2]+e[5]*e[5]+e[8]*e[8],h[0]=f[0].x,h[1]=f[0].y,h[2]=f[0].z,h[3]=f[1].x,h[4]=f[1].y,h[5]=f[1].z,h[6]=f[2].x,h[7]=f[2].y,h[8]=f[2].z;var w=d.rmsdSuprCls.eigen_values(h);r=w.d1,a=w.d2,l=w.d3,i=1,h[0]-=r,h[4]-=r,h[8]-=r;var S=d.rmsdSuprCls.null_basis(h,m,p,u,c);return s=S.k,m=S.v1,p=S.v2,u=S.v3,t||(1==s&&(h[0]+=r-a,h[4]+=r-a,h[8]+=r-a,s=(S=d.rmsdSuprCls.null_basis(h,p,u,m,c)).k,p=S.v1,u=S.v2,m=S.v3,1==s&&(h[0]+=a-l,h[4]+=a-l,h[8]+=a-l,s=(S=d.rmsdSuprCls.null_basis(h,u,m,p,c)).k,u=S.v1,m=S.v2,p=S.v3)),1!=s&&(h[0]=b[0].x,h[1]=b[0].y,h[2]=b[0].z,h[3]=b[1].x,h[4]=b[1].y,h[5]=b[1].z,h[6]=b[2].x,h[7]=b[2].y,h[8]=b[2].z,i=2,h[0]-=r,h[4]-=r,h[8]-=r,s=(S=d.rmsdSuprCls.null_basis(h,C,v,g,c)).k,C=S.v1,v=S.v2,g=S.v3,1==s&&(h[0]+=r-a,h[4]+=r-a,h[8]+=r-a,s=(S=d.rmsdSuprCls.null_basis(h,v,g,C,c)).k,v=S.v1,g=S.v2,C=S.v3,1==s&&(h[0]+=a-l,h[4]+=a-l,h[8]+=a-l,s=(S=d.rmsdSuprCls.null_basis(h,g,C,v,c)).k,g=S.v1,C=S.v2,v=S.v3)))),{k:s,h1:m,h2:p,h3:u,k1:C,k2:v,k3:g,d1:r,d2:a,d3:l,flag:i,s:o}}}class a{constructor(e){this.icn3dui=e}subdivide=function(e,t,s,i,n,r,a,l){var o=this.icn3dui,d=[],c=[],h=[],m=new Array,p=void 0!==r?r.length:0,u=void 0!==a?a.length:0;p>0&&Math.abs(r[0].x-e[0].x)<=6&&Math.abs(r[0].y-e[0].y)<=6&&Math.abs(r[0].z-e[0].z)<=6?(m.push(r[0]),p=1):p=0,m.push(e[0]);for(var C=1,v=e.length-1;C<v;++C){var g=e[C],f=e[C+1];m.push(g.smoothen?g.clone().add(f).multiplyScalar(.5):g)}m.push(e[e.length-1]);var b=0;u>0&&Math.abs(a[0].x-e[e.length-1].x)<=6&&Math.abs(a[0].y-e[e.length-1].y)<=6&&Math.abs(a[0].z-e[e.length-1].z)<=6&&(m.push(a[0]),++b),u>1&&Math.abs(a[0].x-a[1].x)<=6&&Math.abs(a[0].y-a[1].y)<=6&&Math.abs(a[0].z-a[1].z)<=6&&(m.push(a[1]),++b);var y=[],w=[],S=[];l&&(b=u>0?u-1:0);C=-1;for(var _,A=m.length,x=1/s;C<=A-3;++C){_=C-p;g=m[-1===C?0:C],f=m[C+1];var k=m[C+2],O=m[C===A-3?A-1:C+3],H=o.subdivideCls.getKnot(1,0,g,f),R=o.subdivideCls.getKnot(1,H,f,k),E=o.subdivideCls.getKnot(1,R,k,O);H-0<1e-4&&(H=1),R-H<1e-4&&(R=H+1),E-R<1e-4&&(E=R+1),C>-1&&(void 0===i||i[_+1])&&C>=-1+p&&C<=A-3-b+1&&(d=d.concat(y),c=c.concat(w),h=h.concat(S)),y=[],w=[],S=[];for(var I=(R-H)*x,D=0;D<s;++D){var T=H+I*D,M=o.subdivideCls.getValueFromKnot(T,0,H,R,E,g.x,f.x,k.x,O.x),P=o.subdivideCls.getValueFromKnot(T,0,H,R,E,g.y,f.y,k.y,O.y),F=o.subdivideCls.getValueFromKnot(T,0,H,R,E,g.z,f.z,k.z,O.z);i?(C>=-1+p&&C<=A-3-b&&i[_+1]&&D<=parseInt(s/2)&&(d.push(new THREE.Vector3(M,P,F)),c.push(i[_+1]),h.push(t[_+1])),C>=-1+p&&C<=A-3-b+1&&i[_+2]&&D>parseInt(s/2)&&(y.push(new THREE.Vector3(M,P,F)),w.push(i[_+2]),S.push(t[_+2]))):C>=-1+p&&C<=A-3-b&&(d.push(new THREE.Vector3(M,P,F)),c.push(_+1),h.push(t[_+1]))}}i&&!i[_+1]||(d=d.concat(y),c=c.concat(w),h=h.concat(S),d.push(m[m.length-1-b]),c.push(m.length-1-b),h.push(t[m.length-1-b])),y=[],w=[],S=[],m=[];var L=[];return L.push(d),L.push(c),L.push(h),L};getKnot(e,t,s,i){return this.icn3dui,s.distanceTo(i)+t}getValueFromKnot(e,t,s,i,n,r,a,l,o){this.icn3dui;var d,c,h=(a-r)/(s-t),m=(l-a)/(i-s),p=(o-l)/(n-i),u=(s+i)*(s+i)-4*(t*s+i*n-t*n);return 0==u?(d=9999,c=9999):(d=6*(3*m*s+2*h*n+p*s-2*h*s-2*m*n-m*i-p*s)/u,c=6*(3*m*i+2*p*t+h*s-2*m*t-2*p*i-h*i-m*s)/u),m*(e-s)+a+((2*d+c)/6/(s-i)*(e-s)*(e-i)*(e-i)+(2*c+d)/6/(i-s)*(e-s)*(e-s)*(e-i))}}class l{constructor(e){this.icn3dui=e}passFloat32(e,t){var s=this.icn3dui,i=e.length;t||(t=new Uint8Array(4*i));for(var n=s.convertTypeCls.getDataView(t),r=0;r<i;++r)n.setFloat32(4*r,e[r],!0);return s.convertTypeCls.getUint8View(t)}passInt8(e,t){var s=this.icn3dui,i=e.length;t||(t=new Uint8Array(1*i));for(var n=s.convertTypeCls.getDataView(t),r=0;r<i;++r)n.setInt8(1*r,e[r],!0);return s.convertTypeCls.getUint8View(t)}passInt16(e,t){var s=this.icn3dui,i=e.length;t||(t=new Uint8Array(2*i));for(var n=s.convertTypeCls.getDataView(t),r=0;r<i;++r)n.setInt16(2*r,e[r],!0);return s.convertTypeCls.getUint8View(t)}passInt32(e,t){var s=this.icn3dui,i=e.length;t||(t=new Uint8Array(4*i));for(var n=s.convertTypeCls.getDataView(t),r=0;r<i;++r)n.setInt32(4*r,e[r],!0);return s.convertTypeCls.getUint8View(t)}getUint8View(e){return this.icn3dui.convertTypeCls.getView(Uint8Array,e)}getDataView(e){return this.icn3dui.convertTypeCls.getView(DataView,e)}getView(e,t,s){return this.icn3dui,t?new e(t.buffer,t.byteOffset,t.byteLength/(s||1)):void 0}getBlobFromBufferAndText(e,t){for(var s=this.icn3dui,i=new Uint8Array(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=s.convertTypeCls.passInt8([t.charCodeAt(r)])[0];var a=[];return a.push(new Blob([i],{type:"application/octet-stream"})),a.push(new Blob([n],{type:"application/octet-stream"})),new Blob(a,{type:"image/png"})}}class o{constructor(e){this.icn3d=e}setCamera(){var e=this.icn3d;if(e.icn3dui,e.bControlGl&&!e.icn3dui.bNode){window.cam=e.cams[e.opts.camera.toLowerCase()];var t=e.maxD;if(window.cam===e.perspectiveCamera)(s=void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>e.maxatomcnt)?window.camMaxDFactor=1:void 0!==window.camMaxDFactorFog?window.camMaxDFactor=window.camMaxDFactorFog:window.camMaxDFactor=2,window.cam_z>0?window.cam.position.z=t*window.camMaxDFactor:window.cam.position.z=-t*window.camMaxDFactor,"yes"===e.opts.slab?s?window.cam.near=.1:void 0!==window.camMaxDFactorFog?window.cam.near=t*window.camMaxDFactorFog-10:window.cam.near=t*window.camMaxDFactor:window.cam.near=.1,window.cam.far=1e4,e.bControlGl&&!e.icn3dui.bNode?window.controls=new THREE.TrackballControls(window.cam,void 0,e):e.icn3dui.bNode?e.controls=new THREE.TrackballControls(e.cam,document,e):e.controls=new THREE.TrackballControls(e.cam,document.getElementById(e.id),e);else window.cam===e.orthographicCamera&&(void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>10*e.maxatomcnt?window.cam.right=e.maxD/2*1.5:window.cam.right=e.maxD/2*2.5,window.cam.left=-window.cam.right,window.cam.top=window.cam.right/e.container.whratio,window.cam.bottom=-window.cam.right/e.container.whratio,"yes"===e.opts.slab?window.cam.near=2*e.maxD:window.cam.near=0,window.cam.far=1e4,e.bControlGl&&!e.icn3dui.bNode?window.controls=new THREE.OrthographicTrackballControls(window.cam,void 0,e):e.icn3dui.bNode?e.controls=new THREE.OrthographicTrackballControls(e.cam,document,e):e.controls=new THREE.OrthographicTrackballControls(e.cam,document.getElementById(e.id),e));window.cam.updateProjectionMatrix()}e.cam=e.cams[e.opts.camera.toLowerCase()];var s;t=e.maxD;e.cam===e.perspectiveCamera?((s=void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>e.maxatomcnt)?e.camMaxDFactor=1:void 0!==e.camMaxDFactorFog?e.camMaxDFactor=e.camMaxDFactorFog:e.camMaxDFactor=2,e.cam_z>0?e.cam.position.z=t*e.camMaxDFactor:e.cam.position.z=-t*e.camMaxDFactor,"yes"===e.opts.slab?s?e.cam.near=.1:void 0!==e.camMaxDFactorFog?e.cam.near=t*e.camMaxDFactorFog-10:e.cam.near=t*e.camMaxDFactor:e.cam.near=.1,e.cam.far=1e4,e.bControlGl&&!e.icn3dui.bNode?window.controls=new THREE.TrackballControls(e.cam,void 0,e):e.icn3dui.bNode?e.controls=new THREE.TrackballControls(e.cam,document,e):e.controls=new THREE.TrackballControls(e.cam,document.getElementById(e.id),e)):e.cam===e.orthographicCamera&&(void 0!==e.biomtMatrices&&e.biomtMatrices.length*e.cnt>10*e.maxatomcnt?e.cam.right=e.maxD/2*1.5:e.cam.right=e.maxD/2*2.5,e.cam.left=-e.cam.right,e.cam.top=e.cam.right/e.container.whratio,e.cam.bottom=-e.cam.right/e.container.whratio,"yes"===e.opts.slab?e.cam.near=2*e.maxD:e.cam.near=0,e.cam.far=1e4,e.bControlGl&&!e.icn3dui.bNode?window.controls=new THREE.OrthographicTrackballControls(e.cam,void 0,e):e.icn3dui.bNode?e.controls=new THREE.OrthographicTrackballControls(e.cam,document,e):e.controls=new THREE.OrthographicTrackballControls(e.cam,document.getElementById(e.id),e));e.cam.updateProjectionMatrix()}}class d{constructor(e){this.icn3d=e}applyCenterOptions(e){var t,s=this.icn3d;switch(s.icn3dui,void 0===e&&(e=s.opts),e.rotationcenter.toLowerCase()){case"molecule center":void 0!==s.center&&this.setRotationCenter(s.center);break;case"pick center":void 0!==s.pAtom&&this.setRotationCenter(s.pAtom.coord);break;case"display center":t=this.centerAtoms(s.dAtoms).center,this.setRotationCenter(t);break;case"highlight center":t=this.centerAtoms(s.hAtoms).center,this.setRotationCenter(t)}}setRotationCenter(e){this.icn3d.icn3dui,this.setCenter(e)}setCenter(e){var t=this.icn3d;t.icn3dui,t.mdl.position.set(0,0,0),t.mdlImpostor.position.set(0,0,0),t.mdl_ghost.position.set(0,0,0),t.mdl.position.sub(e),t.mdlImpostor.position.sub(e),t.mdl_ghost.position.sub(e)}centerSelection(e){var t=this.icn3d,s=t.icn3dui;if(t.opts.rotationcenter="highlight center",void 0===e&&(e=s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)),t._zoomFactor=1,t.mouseChange=new THREE.Vector2(0,0),t.quaternion=new THREE.Quaternion(0,0,0,1),Object.keys(e).length>1){var i=this.centerAtoms(e);t.center=i.center,this.setCenter(t.center),t.cameraCls.setCamera()}}centerAtoms(e){var t=this.icn3d;t.icn3dui;var s=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3(-9999,-9999,-9999),n=new THREE.Vector3,r=0;for(var a in e){var l=t.atoms[a].coord;n.add(l),s.min(l),i.max(l),++r}var o=i.distanceTo(s);return{center:n.multiplyScalar(1/r),maxD:o,pmin:s,pmax:i}}setWidthHeight(e,t){var s=this.icn3d;s.icn3dui,void 0===s.scaleFactor&&(s.scaleFactor=1),s.renderer.setSize(e*s.scaleFactor,t*s.scaleFactor),s.renderer.domElement.style.width=e*s.scaleFactor+"px",s.renderer.domElement.style.height=t*s.scaleFactor+"px",s.renderer.domElement.width=e*s.scaleFactor,s.renderer.domElement.height=t*s.scaleFactor,s.container.whratio=e/t}}class c{constructor(e){this.icn3d=e}setFog(e){var t=this.icn3d,s=t.icn3dui.parasCls.backgroundColors[t.opts.background.toLowerCase()];if(e){var i=t.applyCenterCls.centerAtoms(t.hAtoms);t.maxD=i.maxD,t.maxD<5&&(t.maxD=5)}var n=void 0!==t.biomtMatrices&&t.biomtMatrices.length*t.cnt>t.maxatomcnt;"yes"===t.opts.fog?"perspective"===t.opts.camera?n?(t.scene.fog=void 0,t.bSetFog=!1):(t.scene.fog=new THREE.Fog(s,2.5*t.maxD,4*t.maxD),t.bSetFog=!0,t.camMaxDFactorFog=3):"orthographic"===t.opts.camera&&(t.scene.fog=void 0,t.bSetFog=!1):(t.scene.fog=void 0,t.bSetFog=!1),e&&!n&&t.transformCls.zoominSelection()}}class h{constructor(e){this.icn3d=e}getFirstAtomObj(e){var t=this.icn3d;if(t.icn3dui,void 0!==e&&0!==Object.keys(e).length){var s=Object.keys(e)[0];return t.atoms[s]}}getFirstCalphaAtomObj(e){var t=this.icn3d;if(t.icn3dui,void 0!==e&&0!==Object.keys(e).length){var s;for(var i in e)if("CA"==t.atoms[i].name){s=i;break}return void 0!==s?t.atoms[s]:this.getFirstAtomObj(e)}}getFirstAtomObjByName(e,t){var s,i=this.icn3d;if(i.icn3dui,void 0===e||0===Object.keys(e).length)return i.atoms[0];for(var n in e)if(i.atoms[n].name==t){s=n;break}return void 0!==s?i.atoms[s]:void 0}getLastAtomObj(e){var t=this.icn3d;if(t.icn3dui,void 0===e||0===Object.keys(e).length)return t.atoms[0];var s=Object.keys(e),i=s[s.length-1];return t.atoms[i]}getResiduesFromAtoms(e){var t=this.icn3d;t.icn3dui;var s={};for(var i in e){s[t.atoms[i].structure+"_"+t.atoms[i].chain+"_"+t.atoms[i].resi]=1}return s}getResiduesFromCalphaAtoms(e){var t=this.icn3d;t.icn3dui;var s={};for(var i in e){if("CA"==t.atoms[i].name&&t.proteins.hasOwnProperty(i)||!t.proteins.hasOwnProperty(i))s[t.atoms[i].structure+"_"+t.atoms[i].chain+"_"+t.atoms[i].resi]=1}return s}getChainsFromAtoms(e){var t=this.icn3d;t.icn3dui;var s={};for(var i in e){var n=t.atoms[i];s[n.structure+"_"+n.chain]=1}return s}getAtomFromResi(e,t){var s=this.icn3d;if(s.icn3dui,s.residues.hasOwnProperty(e))for(var i in s.residues[e])if(s.atoms[i].name===t&&!s.atoms[i].het)return s.atoms[i]}getAtomCoordFromResi(e,t){this.icn3d.icn3dui;var s=this.getAtomFromResi(e,t);if(void 0!==s)return void 0!==s.coord2?s.coord2:s.coord}}class m{constructor(e){this.icn3d=e}createStrip(e,t,s,i,n,r,a,l,o,d,c,h,m,p){var u=this.icn3d,C=u.icn3dui;if(!(u.icn3dui.bNode||e.length<2)){if(i=i||u.axisDIV,m&&u.bDoublecolor&&!u.bCalphaOnly){var v=!1,g=C.subdivideCls.subdivide(m,s,i,l,r,c,h,v);m=g[0],this.setCalphaDrawnCoord(m,i,o);for(var f=0,b=p.length;f<b;++f)p[f].normalize();p=C.subdivideCls.subdivide(p,s,i,l,r,c,h,v)[0],s=g[2]}else{if(!a){v=!1;var y=C.subdivideCls.subdivide(e,s,i,l,r,c,h,v),w=C.subdivideCls.subdivide(t,s,i,l,r,c,h,v);e=y[0],t=w[0],s=y[2]}if(e.length<2)return;this.setCalphaDrawnCoord(e,i,o)}if(1===r){var S=u.coilWidth/2,_=!1;if(void 0!==d){var A,x,k=[],O=[];for(f=0,b=e.length;f<b;++f){if((A=d[f])!==x&&A!==x+1&&void 0!==x||f===b-1){var H=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(k),k.length,S,4,_);(Ce=new THREE.Mesh(H,u.matShader)).renderOrder=u.renderOrderPicking,u.mdl.add(Ce),u.prevHighlightObjects.push(Ce),H=null;var R=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(O),O.length,S,4,_);(Ce=new THREE.Mesh(R,u.matShader)).renderOrder=u.renderOrderPicking,u.mdl.add(Ce),u.prevHighlightObjects.push(Ce),R=null,k=[],O=[]}k.push(e[f]),O.push(t[f]),x=A}k=[],O=[]}else{H=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(e),e.length,S,4,_);(Ce=new THREE.Mesh(H,u.matShader)).renderOrder=u.renderOrderPicking,u.mdl.add(Ce),u.prevHighlightObjects.push(Ce),H=null;R=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(t),t.length,S,4,_);(Ce=new THREE.Mesh(R,u.matShader)).renderOrder=u.renderOrderPicking,u.mdl.add(Ce),u.prevHighlightObjects.push(Ce),R=null}}else{if(m&&u.bDoublecolor&&!u.bCalphaOnly){var E=new THREE.CatmullRomCurve3(m);new THREE.Vector3;var I,D=[],T=[],M=[],P=m.length;for(f=0;f<=P;f++)I=f/P,D[f]=E.getTangentAt(I),D[f].normalize();T[0]=p[0].normalize(),M[0]=new THREE.Vector3,M[0].crossVectors(D[0],T[0]);var F=m[P-1].clone().sub(m[0]),L=0;for(f=1;f<=P;f++)T[f]=p[f-1],M[f]=new THREE.Vector3,M[f].crossVectors(D[f],T[f]),F.dot(M[f])>0&&++L;var N=L>.5*P,$={steps:P,extrudePath:E,frames:{tangents:D,normals:T,binormals:M}},U=u.coilWidth,q=4.2*U,j=1.1*U,B=new THREE.EllipseCurve(0,0,q,j,0,2*Math.PI,!1,Math.PI),z=new THREE.Shape;z.curves.push(B);te=new THREE.ExtrudeGeometry(z,$);for(var G,V,W,Y,X=["a","b","c","d"],K=parseInt(te.vertices.length/(P+1)),Q=parseInt(K/2),J=0;J<K;J++)for(var Z=0;Z<=P;Z++){W=Z+J*(P+1),(me=Z==P?s[Z-1]:s[Z])||(me=Y);var ee=N?J>Q:J<Q;te.colors[W]=ee?me:C.parasCls.thr(8947848),Y=me}for(f=0;f<te.faces.length;f++){V=(G=te.faces[f])instanceof THREE.Face3?3:4;for(pe=0;pe<V;pe++)W=G[X[pe]],G.vertexColors[pe]=te.colors[W]}te.computeFaceNormals(),te.computeVertexNormals(!1)}else{for(var te,se,ie,ne,re,ae,le=(te=new THREE.Geometry).vertices,oe=te.faces,f=0,de=e.length;f<de;++f)le.push(ie=e[f]),le.push(ie),le.push(ne=t[f]),le.push(ne),f<de-1&&(se=t[f].clone().sub(e[f]).cross(e[f+1].clone().sub(e[f])).normalize().multiplyScalar(n)),le.push(re=e[f].clone().add(se)),le.push(re),le.push(ae=t[f].clone().add(se)),le.push(ae);var ce=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]],f=1;for(de=e.length;f<de;++f)for(var he=8*f,me=C.parasCls.thr(s[f-1]),pe=0;pe<4;++pe)oe.push(new THREE.Face3(he+ce[pe][0],he+ce[pe][1],he+ce[pe][2],void 0,me)),oe.push(new THREE.Face3(he+ce[pe][3],he+ce[pe][0],he+ce[pe][2],void 0,me));var ue=le.length-8;for(f=0;f<4;++f)le.push(le[2*f]),le.push(le[ue+2*f]);ue+=8,oe.push(new THREE.Face3(ue,ue+2,ue+6,void 0,oe[0].color)),oe.push(new THREE.Face3(ue+4,ue,ue+6,void 0,oe[0].color)),oe.push(new THREE.Face3(ue+1,ue+5,ue+7,void 0,oe[oe.length-3].color)),oe.push(new THREE.Face3(ue+3,ue+1,ue+7,void 0,oe[oe.length-3].color)),te.computeFaceNormals(),te.computeVertexNormals(!1)}var Ce;2===r?(Ce=new THREE.Mesh(te,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:u.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),u.mdl.add(Ce),u.prevHighlightObjects.push(Ce)):(Ce=new THREE.Mesh(te,new THREE.MeshPhongMaterial({specular:u.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),u.mdl.add(Ce),u.objects.push(Ce))}e=null,t=null}}setCalphaDrawnCoord(e,t,s){var i=this.icn3d;i.icn3dui;var n=0;if(void 0!==s)for(var r=0,a=e.length;r<a;r+=t){var l=s[n];i.atoms.hasOwnProperty(l)&&(i.atoms[l].coord2=e[r].clone()),++n}}}class p{constructor(e){this.icn3d=e}createCurveSub(e,t,s,i,n,r,a,l,o,d,c,h){var m=this.icn3d,p=m.icn3dui;if(!m.icn3dui.bNode&&0!==e.length){var u;if(i=i||5,a)u=e;else{var C=p.subdivideCls.subdivide(e,s,i,l,n,c,h,!0);u=C[0],s=C[2]}if(0!==u.length){if(m.stripCls.setCalphaDrawnCoord(u,i,o),1===n){var v=m.coilWidth/2;if(u.length>1)if(void 0!==d){for(var g,f,b=[],y=0,w=u.length;y<w;++y){if((g=d[y])!==f&&g!==f+1&&void 0!==f||y===w-1){var S=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(b),b.length,v,4,false);(_=new THREE.Mesh(S,m.matShader)).renderOrder=m.renderOrderPicking,m.mdl.add(_),m.prevHighlightObjects.push(_),S=null,b=[]}b.push(u[y]),f=g}b=[]}else{var _;S=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(u),u.length,v,4,false);(_=new THREE.Mesh(S,m.matShader)).renderOrder=m.renderOrderPicking,m.mdl.add(_),m.prevHighlightObjects.push(_),S=null}}else{var A=new THREE.Geometry;if(2===n&&r)for(y=0;y<u.length;++y)u[y].addScalar(.6),A.vertices.push(u[y]),A.colors.push(p.parasCls.thr(s[y]));else for(y=0;y<u.length;++y)A.vertices.push(u[y]),A.colors.push(p.parasCls.thr(s[y]));var x=new THREE.Line(A,new THREE.LineBasicMaterial({linewidth:t,vertexColors:!0}));m.mdl.add(x),2===n?m.prevHighlightObjects.push(x):m.objects.push(x)}u=null}}}}class u{constructor(e){this.icn3d=e}createCurveSubArrow(e,t,s,i,n,r,a,l,o,d,c,h,m,p,u){var C=this.icn3d;if(C.icn3dui,!C.icn3dui.bNode){var v=[],g=[];v.push(e),g.push(l),this.prepareStrand(v,g,t,s,i,void 0,n,r,a,o,d,!1,c,h,m,p,u),v=[],g=[]}}createStripArrow(e,t,s,i,n,r,a,l,o,d,c,h,m,p,u,C){var v=this.icn3d;if(v.icn3dui,!v.icn3dui.bNode){var g=[],f=[];g.push(e),g.push(t),f.push(l),f.push(o),this.prepareStrand(g,f,void 0,s,i,n,r,void 0,a,d,c,!0,h,m,p,u,C),g=[],f=[]}}prepareStrand(e,t,s,i,n,r,a,l,o,d,c,h,m,p,u,C,v){var g=this.icn3d,f=g.icn3dui;if(1!==d.length){var b=i,y=!u,w=[];w.push(i[i.length-2]),w.push(i[i.length-1]),n=n||g.axisDIV;for(var S=2/(o-1),_={},A=0,x=t.length;A<x;++A)_[A]=[];var k=f.subdivideCls.subdivide(d,i,n,void 0,void 0,C,v)[0];if(1!==k.length){var O=[];for(A=0,x=void 0===u||u?d.length-2:d.length;A<x;++A){for(var H=0,R=t.length;H<R;++H)_[H].push(e[H][A]);O.push(i[A])}if(O.push(i[A]),void 0===u||u)for(A=0,x=t.length;A<x;++A)F=S*t[A]-1,L=k.length-1-n,N=d.length-2,P=new THREE.Vector3(k[L].x+c[N].x*F,k[L].y+c[N].y*F,k[L].z+c[N].z*F),_[A].push(P);var E,I=[];for(A=0,x=t.length;A<x;++A)E=f.subdivideCls.subdivide(_[A],O,n,m,a),_[A]=E[0],i=E[2],0===A&&(I=E[1]);if(h?y?g.bDoublecolor?g.stripCls.createStrip(_[0],_[1],b,n,r,a,!0,void 0,p,I,C,v,d,c):g.stripCls.createStrip(_[0],_[1],i,n,r,a,!0,void 0,p,I,C,v,d,c):g.stripCls.createStrip(_[0],_[1],i,n,r,a,!0,void 0,p,I,C,v):g.curveCls.createCurveSub(_[0],s,i,n,a,l,!0,void 0,p,I,C,v),void 0===u||u){O=[],I=[];for(H=0,R=t.length;H<R;++H){_[H]=[];for(A=n*(d.length-2),x=n*(d.length-1);m[parseInt(A/n)]&&A<x;A+=n)for(var D=parseInt(A/n),T=0;T<n;++T){F=1.8*(F=S*t[H]-1)*(n-T)/n;var M=parseInt(A/n);(P=new THREE.Vector3(k[A+T].x+c[M].x*F,k[A+T].y+c[M].y*F,k[A+T].z+c[M].z*F)).smoothen=!0,_[H].push(P),O.push(w[0]),0===H&&I.push(D)}var P,F=0,L=k.length-1,N=d.length-1;(P=new THREE.Vector3(k[L].x+c[N].x*F,k[L].y+c[N].y*F,k[L].z+c[N].z*F)).smoothen=!0,_[H].push(P),O.push(w[1]),0===H&&I.push(L)}k=[],h?g.stripCls.createStrip(_[0],_[1],O,n,r,a,!0,void 0,void 0,I,C,v):g.curveCls.createCurveSub(_[0],s,O,n,a,l,!0,void 0,void 0,I,C,v)}for(var A in _){T=0;for(var $=_[A].length;T<$;++T)_[A][T]=null;_[A]=[]}_={}}}}}class C{constructor(e){this.icn3d=e}createRepresentationSub(e,t,s){var i=this.icn3d;if(i.icn3dui,!i.icn3dui.bNode)for(var n in e){var r=e[n];for(var a in t&&t(r),r.bonds){var l=this.icn3d.atoms[r.bonds[a]];void 0===l||l.serial<r.serial||l.chain===r.chain&&(l.resi===r.resi||"C"===r.name&&"N"===l.name||"O3'"===r.name&&"P"===l.name||"O3*"===r.name&&"P"===l.name||"SG"===r.name&&"SG"===l.name)&&s&&s(r,l)}}}}class v{constructor(e){this.icn3d=e}createBox(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!a.icn3dui.bNode){void 0===t&&(t=.8),void 0===s&&(s=!1),void 0===i&&(i=.8),r?void 0===n&&(n=this.hColor):void 0===n&&(n=e.color);var o=s?t:(l.parasCls.vdwRadii[e.elem.toUpperCase()]||t)*(i||1);this.createBox_base(e.coord,o,n,r)}}createBox_base(e,t,s,i,n,r){var a,l=this.icn3d;(l.icn3dui,l.icn3dui.bNode)||(new THREE.BoxGeometry(1,1,1),(a=i||r?new THREE.Mesh(l.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:l.frac,shininess:30,emissive:0,color:s})):new THREE.Mesh(l.boxGeometry,new THREE.MeshPhongMaterial({specular:l.frac,shininess:30,emissive:0,color:s}))).scale.x=a.scale.y=a.scale.z=t,a.position.copy(e),l.mdl.add(a),i?l.prevHighlightObjects.push(a):n?l.prevOtherMesh.push(a):l.objects.push(a))}createBoxRepresentation_P_CA(e,t,s){var i=this.icn3d;if(i.icn3dui,!i.icn3dui.bNode){var n=this;i.reprSubCls.createRepresentationSub(e,(function(e){"CA"!==e.name&&"O3'"!==e.name&&"O3*"!==e.name||n.createBox(e,void 0,void 0,t,void 0,s)}))}}}class g{constructor(e){this.icn3d=e}createTube(e,t,s,i,n,r){var a=this.icn3d;if(a.icn3dui,!a.icn3dui.bNode){var l,o,d,c,h,m=[],p=[],u=[],C=[],v=[],f=0,b=[];for(var y in e)if((c=e[y]).name===t&&!c.het){if(0==f&&(d=c),f>0&&(l!==c.chain||Math.abs(c.coord.x-h.coord.x)>6||Math.abs(c.coord.y-h.coord.y)>6||Math.abs(c.coord.z-h.coord.z)>6||o+1!==c.resi&&(Math.abs(c.coord.x-h.coord.x)>3||Math.abs(c.coord.y-h.coord.y)>3||Math.abs(c.coord.z-h.coord.z)>3))){if(2!==i){var w=d.structure+"_"+d.chain+"_"+(d.resi-1).toString();C=void 0!==(k=a.firstAtomObjCls.getAtomCoordFromResi(w,t))?[k]:[];var S=h.structure+"_"+h.chain+"_"+(h.resi+1).toString(),_=h.structure+"_"+h.chain+"_"+(h.resi+2).toString();if(a.residues.hasOwnProperty(S)){var A=a.firstAtomObjCls.getAtomFromResi(S,t);void 0!==A&&A.ssbegin&&(S=h.structure+"_"+h.chain+"_"+(h.resi+2).toString(),_=h.structure+"_"+h.chain+"_"+(h.resi+3).toString(),m.push(A.coord),n?u.push(g.getCustomtubesize(S)):u.push(this.getRadius(s,A)),p.push(A.color))}void 0!==(O=a.firstAtomObjCls.getAtomCoordFromResi(S,t))&&v.push(O),void 0!==(H=a.firstAtomObjCls.getAtomCoordFromResi(_,t))&&v.push(H),b.push({pnts:m,colors:p,radii:u,prevone:C,nexttwo:v})}m=[],p=[],u=[],C=[],v=[],d=c,f=0}if(0==m.length){w=c.structure+"_"+c.chain+"_"+(c.resi-1).toString();a.residues.hasOwnProperty(w)&&void 0!==(h=a.firstAtomObjCls.getAtomFromResi(w,t))&&h.ssend&&(m.push(h.coord),n?u.push(g.getCustomtubesize(w)):u.push(this.getRadius(s,h)),p.push(h.color))}var x;m.push(c.coord),x=n?g.getCustomtubesize(c.structure+"_"+c.chain+"_"+c.resi):this.getRadius(s,c),u.push(x),p.push(c.color),1===f&&(p[p.length-2]=c.color),l=c.chain,o=c.resi;2!==i||c.ssbegin||a.boxCls.createBox(c,void 0,void 0,1.2,void 0,i),++f,h=c}if(2!==i){if(C=[],void 0!==d){var k;w=d.structure+"_"+d.chain+"_"+(d.resi-1).toString();C=void 0!==(k=a.firstAtomObjCls.getAtomCoordFromResi(w,t))?[k]:[]}if(v=[],void 0!==c){var O;S=c.structure+"_"+c.chain+"_"+(c.resi+1).toString();void 0!==(O=a.firstAtomObjCls.getAtomCoordFromResi(S,t))&&v.push(O);var H;_=c.structure+"_"+c.chain+"_"+(c.resi+2).toString();void 0!==(H=a.firstAtomObjCls.getAtomCoordFromResi(_,t))&&v.push(H)}b.push({pnts:m,colors:p,radii:u,prevone:C,nexttwo:v})}y=0;for(var R=b.length;y<R;++y){m=b[y].pnts,p=b[y].colors,u=b[y].radii,C=b[y].prevone,v=b[y].nexttwo;this.createTubeSub(m,p,u,i,C,v,r)}b=[]}}getCustomtubesize(e){var t=this.icn3d;t.icn3dui;var s=e.lastIndexOf("_"),i=e.substr(s+1),n=e.substr(0,s);return t.queryresi2score[n]&&t.queryresi2score[n].hasOwnProperty(i)?.01*t.queryresi2score[n][i]:t.coilWidth}createTubeSub(e,t,s,i,n,r,a){var l=this.icn3d,o=l.icn3dui;if(!(l.icn3dui.bNode||e.length<2)){var d,c;if(a){var h=l.tubeDIV,m=1/h,p=1/(M=l.axisDIV),u=new THREE.Geometry,C=(T=o.subdivideCls.subdivide(e,t,M,void 0,void 0,n,r))[0];t=T[2];for(var v,g=new THREE.Vector3,f=0,b=C.length;f<b;++f){var y,w,S,_=(f-1)*p;if(0===f)B=s[0];else if(_%1==0)B=s[_];else{var A=Math.floor(_),x=_-A;B=s[A]*x+s[A+1]*(1-x)}f<b-1?(y=C[f].clone().sub(C[f+1]),w=new THREE.Vector3(0,-y.z,y.y).normalize().multiplyScalar(B),S=y.clone().cross(w).normalize().multiplyScalar(B),g.dot(w)<0&&(w.negate(),S.negate()),g=w,v=S):(w=g,S=v);for(var k=0;k<h;++k){var O=2*Math.PI*m*k;u.vertices.push(C[f].clone().add(w.clone().multiplyScalar(Math.cos(O))).add(S.clone().multiplyScalar(Math.sin(O))))}}var H=0;for(f=0,b=C.length-1;f<b;++f){var R=o.parasCls.thr(t[f]),E=0,I=u.vertices[H].clone().sub(u.vertices[H+h]).lengthSq(),D=u.vertices[H].clone().sub(u.vertices[H+h+1]).lengthSq();I>D&&(I=D,E=1);for(k=0;k<h;++k)u.faces.push(new THREE.Face3(H+k,H+(k+E)%h+h,H+(k+1)%h,void 0,R)),u.faces.push(new THREE.Face3(H+(k+1)%h,H+(k+E)%h+h,H+(k+E+1)%h+h,void 0,R));H+=h}u.computeFaceNormals(),u.computeVertexNormals(!1)}else{var T,M=l.axisDIV;e=(T=o.subdivideCls.subdivide(e,t,M,void 0,void 0,n,r))[0],t=T[2];var P=l.coilWidth;d=e.length,4;u=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(e),d,P,4,!1);for(var F,L,N,$,U,q=["a","b","c","d"],j=0;j<=d;j++)for(var B=0;B<4;B++)$=B+4*j,(F=t[j])||(F=U),u.colors[$]=F,U=F;for(f=0;f<u.faces.length;f++){N=(L=u.faces[f])instanceof THREE.Face3?3:4;for(k=0;k<N;k++)$=L[q[k]],L.vertexColors[k]=u.colors[$]}u.computeFaceNormals(),u.computeVertexNormals(!1)}2===i?(c=new THREE.Mesh(u,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:l.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),l.mdl.add(c)):1===i?((c=new THREE.Mesh(u,l.matShader)).renderOrder=l.renderOrderPicking,l.mdl.add(c)):(c=new THREE.Mesh(u,new THREE.MeshPhongMaterial({specular:l.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),l.mdl.add(c)),1===i||2===i?l.prevHighlightObjects.push(c):l.objects.push(c)}}getRadius(e,t){var s=this.icn3d;s.icn3dui;return e||(t.b>0&&t.b<=100?.01*t.b:t.b>100?1:s.coilWidth)}}class f{constructor(e){this.icn3d=e}createStrand(e,t,s,i,n,r,a,l,o){var d=this.icn3d,c=d.icn3dui;if(!d.icn3dui.bNode){var h=!!i,m={};m=d.bAllAtoms?e:this.getSSExpandedAtoms(e),2===o&&(i?(i=!1,t=null,s=null,n=null,r=null,l=void 0):(i=!0,t=2,s=void 0,n=void 0,r=void 0,l=d.ribbonthickness)),t=t||d.strandDIV,s=s||d.axisDIV,n=n||d.coilWidth,a=a||!1,r=r||d.helixSheetWidth;for(var p={},u=0;u<t;++u)p[u]=[];var C,v,g=[],f=[],b=[],y=[],w=[],S=null,_=null,A=null,x=null,k=null,O=null,H=null,R=null,E=!1,I=null,D=null,T=null,M=null,P=null,F=!1,L=!1,N={};d.bCalphaOnly=c.utilsCls.isCalphaPhosOnly(m);var $={};for(var U in m){var q;$[(q=m[U]).structure+"_"+q.chain+"_"+q.resi]=1}var j=Object.keys($).length,B=0,z=Object.keys(d.hAtoms).length==Object.keys(d.atoms).length,G=[];for(var U in m)if(("O"===(q=m[U]).name||"CA"===q.name)&&!q.het&&("CA"===q.name&&(e.hasOwnProperty(U)&&("helix"!==q.ss&&"sheet"!==q.ss||q.ssend||q.ssbegin)&&(N[U]=q),S=q.coord,A=q.color,M=q.serial,G.push(q.serial)),"O"===q.name||d.bCalphaOnly&&"CA"===q.name)){null==S&&(S=q.coord,A=q.color,M=q.serial),"O"===q.name&&(_=q.coord);var V=!0;if(C!==q.chain&&(V=!1),q.ssend&&"sheet"===q.ss?F=!0:q.ssend&&"helix"===q.ss&&(L=!0),k){1===o||2===o?w.push(d.hColor):w.push(O),v="coil"!==R&&"coil"===q.ss||E&&q.ssbegin||"coil"===R?n:r;var W=4;"O"===q.name?(le=k.clone(),null!=x?le.sub(x):(x=k.clone(),G.length>W+1?(le=x.clone(),d.atoms[G[G.length-1-W-1]].coord.clone().sub(le)):le=new THREE.Vector3(Math.random(),Math.random(),Math.random()))):d.bCalphaOnly&&"CA"===q.name&&(G.length>W+1?(le=x.clone(),d.atoms[G[G.length-1-W-1]].coord.clone().sub(le)):le=new THREE.Vector3(Math.random(),Math.random(),Math.random())),le.normalize(),le.multiplyScalar(v),null!==H&&le.dot(H)<0&&le.negate(),H=le;for(var Y=0,X=2/(t-1);Y<t;++Y){var K=X*Y-1,Q=new THREE.Vector3(x.x+H.x*K,x.y+H.y*K,x.z+H.z*K);a||"sheet"!==R||(Q.smoothen=!0),p[Y].push(Q)}g.push(x),f.push(H),e.hasOwnProperty(D)?(b.push(T),y.push(P)):(b.push(0),y.push(0)),++B}var J=x&&Math.abs(S.x-x.x)>6||x&&Math.abs(S.y-x.y)>6||x&&Math.abs(S.z-x.z)>6;if((q.ssbegin||q.ssend||B===j-1||J)&&p[0].length>0&&V){var Z="CA",ee=[],te=[],se=d.atoms[D].structure+"_"+d.atoms[D].chain+"_"+(d.atoms[D].resi-1).toString();ee=void 0!==(ce=d.firstAtomObjCls.getAtomCoordFromResi(se,Z))?[ce]:[];var ie=d.atoms[D].structure+"_"+d.atoms[D].chain+"_"+(d.atoms[D].resi+1).toString(),ne=d.firstAtomObjCls.getAtomCoordFromResi(ie,Z);void 0!==ne&&te.push(ne);var re=d.atoms[D].structure+"_"+d.atoms[D].chain+"_"+(d.atoms[D].resi+2).toString(),ae=d.firstAtomObjCls.getAtomCoordFromResi(re,Z);if(void 0!==ae&&te.push(ae),!J){1===o||2===o?w.push(d.hColor):w.push(O),v=q.ssend&&"sheet"===q.ss?0:"coil"===R&&q.ssbegin||E&&q.ssbegin||"coil"===q.ss?n:r;var le;W=4;"O"===q.name?(le=_.clone()).sub(S):d.bCalphaOnly&&"CA"===q.name&&(G.length>W?(le=S.clone(),d.atoms[G[G.length-1-W]].coord.clone().sub(le)):le=new THREE.Vector3(Math.random(),Math.random(),Math.random())),le.normalize(),le.multiplyScalar(v),null!==H&&le.dot(H)<0&&le.negate(),H=le;for(Y=0,X=2/(t-1);Y<t;++Y){K=X*Y-1,Q=new THREE.Vector3(S.x+H.x*K,S.y+H.y*K,S.z+H.z*K);a||"sheet"!==R||(Q.smoothen=!0),p[Y].push(Q)}I=q.serial,g.push(S),f.push(H),e.hasOwnProperty(I)?(b.push(q.resi),y.push(M)):(b.push(0),y.push(0))}for(Y=0;!i&&Y<t;++Y)F?d.curveStripArrowCls.createCurveSubArrow(p[Y],1,w,s,o,h,t,Y,g,f,b,y,!0,ee,te):L&&(z?d.curveCls.createCurveSub(p[Y],1,w,s,o,h,!1,b,y,void 0,ee,te):d.curveStripArrowCls.createCurveSubArrow(p[Y],1,w,s,o,h,t,Y,g,f,b,y,!1,ee,te));if(i)if(F){var oe=0,de=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],w,s,l,o,t,oe,de,g,f,b,y,!0,ee,te)}else if(L)if(z)d.stripCls.createStrip(p[0],p[t-1],w,s,l,o,!1,b,y,void 0,ee,te,g,f);else{oe=0,de=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],w,s,l,o,t,oe,de,g,f,b,y,!1,ee,te)}else 2===o&&d.stripCls.createStrip(p[0],p[t-1],w,s,l,o,!1,b,y,void 0,ee,te,g,f);for(u=0;u<t;++u)p[u]=[];w=[],g=[],f=[],b=[],y=[],F=!1,L=!1}if(C!==q.chain&&p[0].length>0){var ce;for(Z="CA",se=d.atoms[D].structure+"_"+d.atoms[D].chain+"_"+(d.atoms[D].resi-1).toString(),ee=void 0!==(ce=d.firstAtomObjCls.getAtomCoordFromResi(se,Z))?[ce]:[],te=[],Y=0;!i&&Y<t;++Y)F?d.curveStripArrowCls.createCurveSubArrow(p[Y],1,w,s,o,h,t,Y,g,f,b,y,!0,ee,te):L&&(z?d.curveCls.createCurveSub(p[Y],1,w,s,o,h,!1,b,y,void 0,ee,te):d.curveStripArrowCls.createCurveSubArrow(p[Y],1,w,s,o,h,t,Y,g,f,b,y,!1,ee,te));if(i)if(F){oe=0,de=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],w,s,l,o,t,oe,de,g,f,b,y,!0,ee,te)}else if(L)if(z)d.stripCls.createStrip(p[0],p[t-1],w,s,l,o,!1,b,y,void 0,ee,te,g,f);else{oe=0,de=t-1;d.curveStripArrowCls.createStripArrow(p[0],p[t-1],w,s,l,o,t,oe,de,g,f,b,y,!1,ee,te)}for(u=0;u<t;++u)p[u]=[];w=[],g=[],f=[],b=[],y=[],F=!1,L=!1}C=q.chain,q.resi,R=q.ss,E=q.ssend,D=q.serial,T=q.resi,P=M,x=S,k=q.coord,O=A}G=[],d.tubeCls.createTube(N,"CA",n,o),N={},p={}}}getSSExpandedAtoms(e,t){var s,i,n,r,a,l,o,d,c=this.icn3d,h=c.icn3dui,m=0,p=Object.keys(e).length,u=h.hashUtilsCls.cloneHash(e);for(var C in e){if(s=e[C].structure+"_"+e[C].chain,i=parseInt(e[C].resi),n=e[C],void 0===r&&(o=e[C]),s!==r&&void 0!==r||i!==a&&i!==a+1&&void 0!==a||m===p-1){s!==r&&void 0!==r||i!==a&&i!==a+1&&void 0!==a?d=l:m===p-1&&(d=n);var v=o.resi;if("coil"!==o.ss&&!o.ssbegin){for(var g=o.resi-1;g>0;--g){var f=o.structure+"_"+o.chain+"_"+g;if(!c.residues.hasOwnProperty(f))break;if((w=c.firstAtomObjCls.getFirstCalphaAtomObj(c.residues[f])).ss===o.ss&&w.ssbegin){v=w.resi;break}}for(g=v;g<o.resi;++g){f=o.structure+"_"+o.chain+"_"+g;u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms))}}if(3===c.pk&&1===t&&"coil"===o.ss){f=o.structure+"_"+o.chain+"_"+(o.resi-1);c.residues.hasOwnProperty(f)&&(u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms)),e=h.hashUtilsCls.unionHash(e,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms)))}var b=d.resi;if(void 0!==d.ss&&"coil"!==d.ss&&!d.ssend&&!d.notshow){var y=c.firstAtomObjCls.getLastAtomObj(c.chains[d.structure+"_"+d.chain]).resi;for(g=d.resi+1;g<=y;++g){var w;f=d.structure+"_"+d.chain+"_"+g;if(!c.residues.hasOwnProperty(f))break;if((w=c.firstAtomObjCls.getFirstCalphaAtomObj(c.residues[f])).ss===d.ss&&w.ssend){b=w.resi;break}}for(g=d.resi+1;g<=b;++g){f=d.structure+"_"+d.chain+"_"+g;u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms))}}if(3===c.pk&&1===t&&"coil"===d.ss){f=d.structure+"_"+d.chain+"_"+(d.resi+1);c.residues.hasOwnProperty(f)&&(u=h.hashUtilsCls.unionHash(u,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms)),e=h.hashUtilsCls.unionHash(e,h.hashUtilsCls.hash2Atoms(c.residues[f],c.atoms)))}d.notshow&&(d.notshow=void 0),o=n}r=s,a=i,l=n,++m}return u}}class b{constructor(e){this.icn3d=e}createBrick(e,t,s,i){var n=this.icn3d;if(n.icn3dui,!n.icn3dui.bNode){var r=new THREE.CylinderGeometry(1,1,1,4,1),a=new THREE.Mesh(r,new THREE.MeshPhongMaterial({specular:n.frac,shininess:30,emissive:0,color:i}));a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),n.mdl.add(a)}}}class y{constructor(e){this.icn3d=e}createLineRepresentation(e,t){var s=this.icn3d;if(s.icn3dui,!s.icn3dui.bNode){var i,n=new THREE.Geometry;if(s.reprSubCls.createRepresentationSub(e,void 0,(function(e,t){if(e.color===t.color)n.vertices.push(e.coord),n.vertices.push(t.coord),n.colors.push(e.color),n.colors.push(t.color);else{var s=e.coord.clone().add(t.coord).multiplyScalar(.5);n.vertices.push(e.coord),n.vertices.push(s),n.vertices.push(t.coord),n.vertices.push(s),n.colors.push(e.color),n.colors.push(e.color),n.colors.push(t.color),n.colors.push(t.color)}})),2!==t)1===t||(i=new THREE.LineSegments(n,new THREE.LineBasicMaterial({linewidth:s.linewidth,vertexColors:!0})),s.mdl.add(i)),1===t?s.prevHighlightObjects.push(i):s.objects.push(i);else 2===t&&s.boxCls.createBoxRepresentation_P_CA(e,.8,t)}}createConnCalphSidechain(e,t){var s=this.icn3d;if(s.icn3dui,!s.icn3dui.bNode){var i={};for(var n in e){if(!(o=e[n]).het&&o.style2===t)i[l=o.structure+"_"+o.chain+"_"+o.resi]=1}var r=[],a=[];for(var l in i){var o;if(void 0!==(o=s.firstAtomObjCls.getFirstAtomObjByName(s.residues[l],"CA"))){n=0;for(var d=o.bonds.length;n<d;++n){("HA"===(c=s.atoms[o.bonds[n]]).name||"C"!==c.name&&"N"!==c.name&&"H"!==c.elem&&c.resi==o.resi)&&(r.push(o.coord),r.push(c.coord),a.push(o.color),a.push(c.color))}}if(void 0!==(o=s.firstAtomObjCls.getFirstAtomObjByName(s.residues[l],"N")))for(n=0,d=o.bonds.length;n<d;++n){var c;"H"===(c=s.atoms[o.bonds[n]]).name&&(r.push(o.coord),r.push(c.coord),a.push(o.color),a.push(c.color))}}for(n=0,d=r.length;n<d;n+=2)if("ball and stick"===t||"stick"===t){var h="stick"===t?s.cylinderRadius:.5*s.cylinderRadius;s.cylinderCls.createCylinder(r[n],r[n+1],h,a[n+1])}else if("lines"===t){var m=this.createSingleLine(r[n],r[n+1],a[n+1],!1,.5);s.mdl.add(m)}}}createSingleLine(e,t,s,i,n){var r=this.icn3d;if(r.icn3dui,!r.icn3dui.bNode){var a,l=new THREE.Geometry;return a=i?new THREE.LineDashedMaterial({linewidth:1,color:s,dashSize:n,gapSize:.5*n}):new THREE.LineBasicMaterial({linewidth:1,color:s}),l.vertices.push(e),l.vertices.push(t),i&&l.computeLineDistances(),new THREE.LineSegments(l,a)}}createLines(e){var t=this.icn3d,s=t.icn3dui;if(!t.icn3dui.bNode&&void 0!==e)for(var i in e)for(var n=e[i],r=0,a=n.length;r<a;++r){var l=n[r],o=l.position1,d=l.position2,c=!!l.dashed&&l.dashed,h=t.lineRadius,m="#"+l.color.replace(/\#/g,""),p=s.parasCls.thr(m);if(c)for(var u,C,v=o.distanceTo(d),g=parseInt(v/.3),f=d.clone().sub(o).multiplyScalar(.3/v),b=0;b<g;++b)b%2==1&&(u=o.clone().add(f.clone().multiplyScalar(b)),C=o.clone().add(f.clone().multiplyScalar(b+1)),"stabilizer"==i?t.brickCls.createBrick(u,C,h,p):t.cylinderCls.createCylinder(u,C,h,p));else"stabilizer"==i?t.brickCls.createBrick(o,d,h,p):t.cylinderCls.createCylinder(o,d,h,p)}}}class w{constructor(e){this.icn3d=e}createSphere(e,t,s,i,n){var r=this.icn3d,a=r.icn3dui;if(!r.icn3dui.bNode){void 0===t&&(t=.8),void 0===s&&(s=!1);var l=a.parasCls.vdwRadii[e.elem.toUpperCase()]||t;s&&(l=t,i=1),this.createSphereBase(e.coord,e.color,l,i,n)}}createSphereBase(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!a.icn3dui.bNode){var o;if(void 0===i&&(i=1),2===n)i*=1.5,t=a.hColor,(o=new THREE.Mesh(a.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:a.frac,shininess:30,emissive:0,color:t}))).scale.x=o.scale.y=o.scale.z=s*(i||1),o.position.copy(e),a.mdl.add(o);else if(1===n)(o=new THREE.Mesh(a.sphereGeometry,a.matShader)).scale.x=o.scale.y=o.scale.z=s*(i||1),o.position.copy(e),o.renderOrder=a.renderOrderPicking,a.mdl.add(o);else if(void 0===t&&(t=l.parasCls.defaultAtomColor),(o=r?new THREE.Mesh(a.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:a.frac,shininess:30,emissive:0,color:t})):new THREE.Mesh(a.sphereGeometry,new THREE.MeshPhongMaterial({specular:a.frac,shininess:30,emissive:0,color:t}))).scale.x=o.scale.y=o.scale.z=s*(i||1),o.position.copy(e),a.bImpo&&!r){a.posArraySphere.push(e.x),a.posArraySphere.push(e.y),a.posArraySphere.push(e.z),a.colorArraySphere.push(t.r),a.colorArraySphere.push(t.g),a.colorArraySphere.push(t.b);var d=s*(i||1);a.radiusArraySphere.push(d),a.cnt<=a.maxatomcnt&&a.mdl_ghost.add(o)}else a.mdl.add(o);1===n||2===n?a.bImpo?a.cnt<=a.maxatomcnt&&a.prevHighlightObjects_ghost.push(o):a.prevHighlightObjects.push(o):a.bImpo?a.cnt<=a.maxatomcnt&&a.objects_ghost.push(o):a.objects.push(o)}}createSphereRepresentation(e,t,s,i,n){var r=this.icn3d;if(r.icn3dui,!r.icn3dui.bNode){var a=this;r.reprSubCls.createRepresentationSub(e,(function(e){a.createSphere(e,t,s,i,n)}))}}}class S{constructor(e){this.icn3d=e}createCylinder(e,t,s,i,n,r,a,l){var o,d=this.icn3d,c=d.icn3dui;d.icn3dui.bNode||(1===n?((o=new THREE.Mesh(d.cylinderGeometryOutline,d.matShader)).position.copy(e).add(t).multiplyScalar(.5),o.matrixAutoUpdate=!1,o.lookAt(t.clone().sub(e)),o.updateMatrix(),o.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),o.renderOrder=d.renderOrderPicking,d.mdl.add(o),d.prevHighlightObjects.push(o)):(2===n?(o=new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:d.frac,shininess:30,emissive:0,color:i})),s*=1.5):o=l?new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:d.frac,shininess:30,emissive:0,color:i})):new THREE.Mesh(d.cylinderGeometry,new THREE.MeshPhongMaterial({specular:d.frac,shininess:30,emissive:0,color:i})),o.position.copy(e).add(t).multiplyScalar(.5),o.matrixAutoUpdate=!1,o.lookAt(t.clone().sub(e)),o.updateMatrix(),o.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),d.bImpo&&!l?(d.posArray.push(e.x),d.posArray.push(e.y),d.posArray.push(e.z),i||(i=c.parasCls.thr(16777215)),d.colorArray.push(i.r),d.colorArray.push(i.g),d.colorArray.push(i.b),d.pos2Array.push(t.x),d.pos2Array.push(t.y),d.pos2Array.push(t.z),void 0!==r?(d.color2Array.push(r.r),d.color2Array.push(r.g),d.color2Array.push(r.b)):(d.color2Array.push(i.r),d.color2Array.push(i.g),d.color2Array.push(i.b)),d.radiusArray.push(s),d.cnt<=d.maxatomcnt&&d.mdl_ghost.add(o)):d.mdl.add(o),2===n?d.bImpo?d.cnt<=d.maxatomcnt&&d.prevHighlightObjects_ghost.push(o):d.prevHighlightObjects.push(o):d.bImpo?d.cnt<=d.maxatomcnt&&d.objects_ghost.push(o):(void 0===a||a)&&d.objects.push(o)))}createCylinder_base(e,t,s,i,n,r,a){var l=this.icn3d;if(l.icn3dui,!l.icn3dui.bNode){var o=new THREE.Mesh(l.cylinderGeometry,new THREE.MeshPhongMaterial({specular:l.frac,shininess:30,emissive:0,color:i}));return o.position.copy(e).add(t).multiplyScalar(.5),o.matrixAutoUpdate=!1,o.lookAt(t.clone().sub(e)),o.updateMatrix(),o.matrix.multiply((new THREE.Matrix4).makeScale(s,s,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),o}}createCylinderHelix(e,t,s){var i=this.icn3d;if(i.icn3dui,!i.icn3dui.bNode){var n,r,a,l=null,o={},d={};for(a in e){var c=e[a];c.het||(("helix"!==c.ss&&"sheet"!==c.ss||c.ssend||c.ssbegin)&&(o[c.serial]=c),"sheet"===c.ss&&(d[c.serial]=c),"CA"===c.name&&("helix"===c.ss&&c.ssend&&(null!==l&&n===c.chain&&r<c.resi&&(1===s||2===s?this.createCylinder(l.coord,c.coord,t,i.hColor,s):this.createCylinder(l.coord,c.coord,t,c.color)),l=null),null===l&&"helix"===c.ss&&c.ssbegin&&(l=c,n=c.chain,r=c.resi)))}1===s||2===s?(Object.keys(o).length>0&&i.tubeCls.createTube(o,"CA",i.coilWidth,s),Object.keys(d).length>0&&i.strandCls.createStrand(d,void 0,void 0,!0,0,i.helixSheetWidth,!1,2*i.ribbonthickness,s)):(Object.keys(o).length>0&&i.tubeCls.createTube(o,"CA",i.coilWidth),Object.keys(d).length>0&&i.strandCls.createStrand(d,void 0,void 0,!0,0,i.helixSheetWidth,!1,2*i.ribbonthickness))}}createCylinderCurve(e,t,s,i,n){var r=this.icn3d;if(r.icn3dui,!r.icn3dui.bNode){var a,l,o,d,c=null;for(o in e)if(!(d=e[o]).het&&-1!=t.indexOf(d.name)){if(null!==c&&a===d.chain&&l+1===d.resi&&Math.abs(c.coord.x-d.coord.x)<8&&Math.abs(c.coord.y-d.coord.y)<8&&Math.abs(c.coord.z-d.coord.z)<8){var h=c.coord.clone().add(d.coord).multiplyScalar(.5);if(n)1===n&&(this.createCylinder(c.coord,h,s,c.color,n),this.createCylinder(h,d.coord,s,d.color,n),r.sphereCls.createSphere(d,s,!0,1,n));else if(i){var m=r.lineCls.createSingleLine(c.coord,h,c.color,!1);r.mdl.add(m),r.objects.push(m),m=r.lineCls.createSingleLine(h,d.coord,d.color,!1),r.mdl.add(m),r.objects.push(m)}else this.createCylinder(c.coord,h,s,c.color),this.createCylinder(h,d.coord,s,d.color),r.sphereCls.createSphere(d,s,!0,1,n)}c=d,a=d.chain,l=d.resi,r.sphereCls.createSphere(d,s,!0,1,n),2===n&&r.boxCls.createBox(d,void 0,void 0,void 0,void 0,n)}if(null!==c&&a===d.chain&&l+1===d.resi&&Math.abs(c.coord.x-d.coord.x)<8&&Math.abs(c.coord.y-d.coord.y)<8&&Math.abs(c.coord.z-d.coord.z)<8){h=c.coord.add(d.coord).multiplyScalar(.5);if(n)1===n&&(this.createCylinder(c.coord,h,s,c.color,n),this.createCylinder(h,d.coord,s,d.color,n),r.sphereCls.createSphere(d,s,!0,1,n));else if(i){m=r.lineCls.createSingleLine(c.coord,h,c.color,!1);r.mdl.add(m),r.objects.push(m),m=r.lineCls.createSingleLine(h,d.coord,d.color,!1),r.mdl.add(m),r.objects.push(m)}else this.createCylinder(c.coord,h,s,c.color),this.createCylinder(h,d.coord,s,d.color)}}}}class _{constructor(e){this.icn3d=e}applyClbondsOptions(e){var t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),t.bCalcCrossLink||(t.clbondpnts={},t.clbondResid2serial={},this.applyClbondsOptions_base("chemical"),this.applyClbondsOptions_base("all"),t.bCalcCrossLink=!0),"yes"===e.clbonds.toLowerCase()&&"nothing"!==e.chemicals){var i=s.parasCls.thr(25600);if(t.lines.clbond=[],t.residuesHashClbonds={},t.structures)for(var n=Object.keys(t.structures),r=0,a=n.length;r<a;++r){var l=n[r];if(t.clbondpnts[l])for(var o=0,d=t.clbondpnts[l].length;o<d;o+=2){var c=t.clbondpnts[l][o],h=t.clbondpnts[l][o+1],m={color:"#006400",dashed:!1};if(m.serial1=t.clbondResid2serial[c+","+h],m.serial2=t.clbondResid2serial[h+","+c],t.dAtoms.hasOwnProperty(m.serial1)&&t.dAtoms.hasOwnProperty(m.serial2)){m.position1=t.atoms[m.serial1].coord,m.position2=t.atoms[m.serial2].coord,t.lines.clbond.push(m),t.cylinderCls.createCylinder(m.position1,m.position2,t.cylinderRadius,i);var p={};p=s.hashUtilsCls.unionHash(p,t.residues[c]),p=s.hashUtilsCls.unionHash(p,t.residues[h]);var u=s.hashUtilsCls.intHash(p,t.sidec);for(var C in u)t.atoms[C].style2="stick";t.residuesHashClbonds[c]=1,t.residuesHashClbonds[h]=1}}}}return t.residuesHashClbonds}applyClbondsOptions_base(e){var t=this.icn3d;for(var s in t.icn3dui,t.chemicals){var i=t.atoms[s],n=i.structure+"_"+i.chain+"_"+i.resi;for(var r in i.bonds){var a=t.atoms[i.bonds[r]];if(void 0!==a&&(a.chain!==i.chain||a.resi!==i.resi)){var l=a.structure+"_"+a.chain+"_"+a.resi;if("chemical"!=e||a.het){if("chemical"==e)continue;void 0===t.clbondpnts[i.structure]&&(t.clbondpnts[i.structure]=[]),t.clbondpnts[i.structure].push(n),t.clbondpnts[a.structure].push(l),t.clbondResid2serial[n+","+l]=i.serial,t.clbondResid2serial[l+","+n]=a.serial}}}}}}class A{constructor(e){this.icn3d=e}getAtomsWithinAtom(e,t,s,i,n,r){var a=this.icn3d;a.icn3dui;var l=this.getNeighboringAtoms(e,t,s);i&&(a.resid2Residhash={});var o={};for(var d in t){var c=a.atoms[d],h=void 0,m=void 0,p=c.structure+"_"+c.chain+"_"+c.resi;for(var u in a.residues[p])if("CA"===a.atoms[u].name&&"C"===a.atoms[u].elem||"O3'"===a.atoms[u].name||"O3*"===a.atoms[u].name){h=a.atoms[u];break}void 0===h&&(h=c),i&&(m=c.resn+" $"+c.structure+"."+c.chain+":"+c.resi,void 0===a.resid2Residhash[m]&&(a.resid2Residhash[m]={}));var C=c.structure+"_"+c.chain+"_"+c.resi;for(var v in l){var g=l[v];if((a.crossstrucinter||c.structure==g.structure)&&!(g.serial in t||a.bOpm&&"DUM"===g.resn)){var f=g.coord.distanceTo(c.coord);if(f<s){o[g.serial]=g;var b=void 0,y=void 0;n&&(o[c.serial]=c);var w=g.structure+"_"+g.chain+"_"+g.resi;for(var u in a.residues[w])if("CA"===a.atoms[u].name&&"C"===a.atoms[u].elem||"O3'"===a.atoms[u].name||"O3*"===a.atoms[u].name){b=a.atoms[u];break}if(void 0===b&&(b=g),n&&(a.contactpnts.push({serial:b.serial,coord:b.coord}),a.contactpnts.push({serial:h.serial,coord:h.coord})),i){var S=g.structure+"_"+g.chain+"_"+g.resi;y=g.resn+" $"+g.structure+"."+g.chain+":"+g.resi;var _=f.toFixed(1),A=b.coord.distanceTo(h.coord).toFixed(1),x=C+"_"+c.resn+","+S+"_"+g.resn,k=m+","+y;if((void 0===a.resids2interAll[x]||void 0===a.resids2interAll[x].contact||!a.resids2interAll[x].contact.hasOwnProperty(k)||void 0!==a.resids2interAll[x].hbond&&!a.resids2interAll[x].hbond.hasOwnProperty(k)||void 0!==a.resids2interAll[x].ionic&&!a.resids2interAll[x].ionic.hasOwnProperty(k)||void 0!==a.resids2interAll[x].halogen&&!a.resids2interAll[x].halogen.hasOwnProperty(k)||void 0!==a.resids2interAll[x]["pi-cation"]&&!a.resids2interAll[x]["pi-cation"].hasOwnProperty(k)||void 0!==a.resids2interAll[x]["pi-stacking"]&&!a.resids2interAll[x]["pi-stacking"].hasOwnProperty(k))&&(void 0===a.resid2Residhash[m][y]||_<a.resid2Residhash[m][y].split("_")[0])){var O=void 0===a.resid2Residhash[m][y]?1:parseInt(a.resid2Residhash[m][y].split("_")[4])+1;a.resid2Residhash[m][y]=_+"_"+A+"_"+c.name+"_"+g.name+"_"+O,r||(void 0===a.resids2inter[x]&&(a.resids2inter[x]={}),void 0===a.resids2inter[x].contact&&(a.resids2inter[x].contact={}),a.resids2inter[x].contact[m+","+y]=_+"_"+A+"_"+c.name+"_"+g.name+"_"+O),void 0===a.resids2interAll[x]&&(a.resids2interAll[x]={}),void 0===a.resids2interAll[x].contact&&(a.resids2interAll[x].contact={}),a.resids2interAll[x].contact[m+","+y]=_+"_"+A+"_"+c.name+"_"+g.name+"_"+O}}}}}}return o}getNeighboringAtoms(e,t,s){var i=this.icn3d;i.icn3dui;var n=this.getExtent(t),r=(n[2][0]-n[0][0])*(n[2][0]-n[0][0])+(n[2][1]-n[0][1])*(n[2][1]-n[0][1])+(n[2][2]-n[0][2])*(n[2][2]-n[0][2]),a=(n[2][0]-n[1][0])*(n[2][0]-n[1][0])+(n[2][1]-n[1][1])*(n[2][1]-n[1][1])+(n[2][2]-n[1][2])*(n[2][2]-n[1][2]),l=r>a?r:a,o=Math.sqrt(l),d=(o+s)*(o+s),c={};for(var h in e){var m=i.atoms[h];if(!t.hasOwnProperty(m.serial))if(!this.bOpm||"DUM"!==m.resn)if(!(m.coord.x<n[0][0]-s||m.coord.x>n[1][0]+s))if(!(m.coord.y<n[0][1]-s||m.coord.y>n[1][1]+s))if(!(m.coord.z<n[0][2]-s||m.coord.z>n[1][2]+s))(m.coord.x-n[2][0])*(m.coord.x-n[2][0])+(m.coord.y-n[2][1])*(m.coord.y-n[2][1])+(m.coord.z-n[2][2])*(m.coord.z-n[2][2])<d&&(c[m.serial]=m)}return c}getExtent(e){var t,s,i,n,r,a,l,o,d,c,h,m=this.icn3d;for(h in m.icn3dui,t=s=i=9999,n=r=a=-9999,l=o=d=c=0,e){var p=m.atoms[h];c++,l+=p.coord.x,o+=p.coord.y,d+=p.coord.z,t=t<p.coord.x?t:p.coord.x,s=s<p.coord.y?s:p.coord.y,i=i<p.coord.z?i:p.coord.z,n=n>p.coord.x?n:p.coord.x,r=r>p.coord.y?r:p.coord.y,a=a>p.coord.z?a:p.coord.z}return[[t,s,i],[n,r,a],[l/c,o/c,d/c]]}hideContact(){var e=this.icn3d;for(var t in e.icn3dui,e.opts.contact="no",void 0===e.lines&&(e.lines={}),e.lines.contact=[],e.contactpnts=[],e.atoms)e.atoms[t].style2="nothing";for(var t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(var t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class x{constructor(e){this.icn3d=e,this.ISDONE=2;this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}}x.prototype.march=function(e,t,s,i){var n=!!i.fulltable,r=i.hasOwnProperty("origin")&&i.origin.hasOwnProperty("x")?i.origin:{x:0,y:0,z:0},a=!!i.voxel,l=i.matrix,o=i.nX||0,d=i.nY||0,c=i.nZ||0,h=i.scale||1,m=null;m=i.unitCube?i.unitCube:{x:h,y:h,z:h};var p,u,C=new Int32Array(o*d*c);for(p=0,u=C.length;p<u;++p)C[p]=-1;var v=function(e,s,i,n,o,h){var p={x:0,y:0,z:0},u=o;!!!(n&1<<o)&&!!(n&1<<h)&&(u=h),1&u&&i++,2&u&&s++,4&u&&e++,l?p={x:(p=(p=new THREE.Vector3(e,s,i)).applyMatrix4(l)).x,y:p.y,z:p.z}:(p.x=r.x+m.x*e,p.y=r.y+m.y*s,p.z=r.z+m.z*i);var v=(d*e+s)*c+i;return a?(t.push(p),t.length-1):(C[v]<0&&(C[v]=t.length,t.push(p)),C[v])},g=new Int32Array(12),f=n?this.edgeTable2:this.edgeTable,b=n?this.triTable2:this.triTable;for(p=0;p<o-1;++p)for(var y=0;y<d-1;++y)for(var w=0;w<c-1;++w){for(var S=0,_=0;_<8;++_){S|=!!(e[(d*(p+((4&_)>>2))+y+((2&_)>>1))*c+w+(1&_)]&this.ISDONE)<<_}if(0!==S&&255!==S){var A=f[S];if(0!==A){var x=b[S];1&A&&(g[0]=v(p,y,w,S,0,1)),2&A&&(g[1]=v(p,y,w,S,1,3)),4&A&&(g[2]=v(p,y,w,S,3,2)),8&A&&(g[3]=v(p,y,w,S,2,0)),16&A&&(g[4]=v(p,y,w,S,4,5)),32&A&&(g[5]=v(p,y,w,S,5,7)),64&A&&(g[6]=v(p,y,w,S,7,6)),128&A&&(g[7]=v(p,y,w,S,6,4)),256&A&&(g[8]=v(p,y,w,S,0,4)),512&A&&(g[9]=v(p,y,w,S,1,5)),1024&A&&(g[10]=v(p,y,w,S,3,7)),2048&A&&(g[11]=v(p,y,w,S,2,6));for(var k=0;k<x.length;k+=3){var O=g[x[k]],H=g[x[k+1]],R=g[x[k+2]];a&&k>=3&&(t.push(t[O]),O=t.length-1,t.push(t[H]),H=t.length-1,t.push(t[R]),R=t.length-1),s.push(O),s.push(H),s.push(R)}}}}},x.prototype.laplacianSmooth=function(e,t,s){var i,n,r,a,l,o=new Array(t.length);for(i=0,n=t.length;i<n;i++)o[i]={x:0,y:0,z:0};var d,c=new Array(20);for(i=0;i<20;i++)c[i]=new Array(t.length);for(i=0,n=t.length;i<n;i++)c[0][i]=0;for(i=0,n=s.length/3;i<n;i++){var h=3*i,m=3*i+1,p=3*i+2;for(d=!0,r=0,a=c[0][s[h]];r<a;r++)if(s[m]==c[r+1][s[h]]){d=!1;break}for(d&&(c[0][s[h]]++,c[c[0][s[h]]][s[h]]=s[m]),d=!0,r=0,a=c[0][s[h]];r<a;r++)if(s[p]==c[r+1][s[h]]){d=!1;break}for(d&&(c[0][s[h]]++,c[c[0][s[h]]][s[h]]=s[p]),d=!0,r=0,a=c[0][s[m]];r<a;r++)if(s[h]==c[r+1][s[m]]){d=!1;break}for(d&&(c[0][s[m]]++,c[c[0][s[m]]][s[m]]=s[h]),d=!0,r=0,a=c[0][s[m]];r<a;r++)if(s[p]==c[r+1][s[m]]){d=!1;break}for(d&&(c[0][s[m]]++,c[c[0][s[m]]][s[m]]=s[p]),d=!0,r=0;r<c[0][s[p]];r++)if(s[h]==c[r+1][s[p]]){d=!1;break}for(d&&(c[0][s[p]]++,c[c[0][s[p]]][s[p]]=s[h]),d=!0,r=0,a=c[0][s[p]];r<a;r++)if(s[m]==c[r+1][s[p]]){d=!1;break}d&&(c[0][s[p]]++,c[c[0][s[p]]][s[p]]=s[m])}var u=.5;for(l=0;l<e;l++){for(i=0,n=t.length;i<n;i++)if(c[0][i]<3)o[i].x=t[i].x,o[i].y=t[i].y,o[i].z=t[i].z;else if(3==c[0][i]||4==c[0][i]){for(o[i].x=0,o[i].y=0,o[i].z=0,r=0,a=c[0][i];r<a;r++)o[i].x+=t[c[r+1][i]].x,o[i].y+=t[c[r+1][i]].y,o[i].z+=t[c[r+1][i]].z;o[i].x+=u*t[i].x,o[i].y+=u*t[i].y,o[i].z+=u*t[i].z,o[i].x/=u+c[0][i],o[i].y/=u+c[0][i],o[i].z/=u+c[0][i]}else{for(o[i].x=0,o[i].y=0,o[i].z=0,r=0,a=c[0][i];r<a;r++)o[i].x+=t[c[r+1][i]].x,o[i].y+=t[c[r+1][i]].y,o[i].z+=t[c[r+1][i]].z;o[i].x+=1*t[i].x,o[i].y+=1*t[i].y,o[i].z+=1*t[i].z,o[i].x/=1+c[0][i],o[i].y/=1+c[0][i],o[i].z/=1+c[0][i]}for(i=0,n=t.length;i<n;i++)t[i].x=o[i].x,t[i].y=o[i].y,t[i].z=o[i].z}};class k{constructor(e,t){this.icn3d=e,this.threshbox=t,this.dataArray={},this.header,this.data=void 0,this.matrix=void 0,this.isovalue=void 0,this.loadPhiFrom=void 0,this.vpColor=null,this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.finalScaleFactor={},this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vertnumber=0,this.facenumber=0,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.bCalcArea=!1,this.atomsToShow={},this.vdwRadii={H:1.2,LI:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.depty={},this.widxz={},this.faces=void 0,this.verts=void 0,this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],this.origextent=void 0,this.marchingCube=new x}}k.prototype.getVDWIndex=function(e){return e.elem&&void 0!==this.vdwRadii[e.elem.toUpperCase()]?e.elem:"X"},k.prototype.inOrigExtent=function(e,t,s){return!(e<this.origextent[0][0]||e>this.origextent[1][0])&&(!(t<this.origextent[0][1]||t>this.origextent[1][1])&&!(s<this.origextent[0][2]||s>this.origextent[1][2]))},k.prototype.getFacesAndVertices=function(){var e,t,s=this.verts;for(e=0,t=s.length;e<t;e++)s[e].x=s[e].x/this.scaleFactor-this.ptranx,s[e].y=s[e].y/this.scaleFactor-this.ptrany,s[e].z=s[e].z/this.scaleFactor-this.ptranz;var i=[];for(e=0,t=this.faces.length;e<t;e+=3){var n=this.faces[e],r=this.faces[e+1],a=this.faces[e+2],l=s[n].atomid,o=s[r].atomid,d=s[a].atomid;this.atomsToShow[l]&&this.atomsToShow[o]&&this.atomsToShow[d]&&(n!==r&&r!==a&&n!==a&&i.push({a:n,b:r,c:a}))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vpColor=null,{vertices:s,faces:i}},k.prototype.initparm=function(e,t,s,i,n,r,a,l,o){this.header=n,this.dataArray=r,this.matrix=a,this.isovalue=l,this.loadPhiFrom=o,this.bCalcArea=s;for(var d=0,c=i.length;d<c;d++)this.atomsToShow[i[d]]=1;var h=1/this.scaleFactor*5.5;this.origextent=e,this.pminx=e[0][0],this.pmaxx=e[1][0],this.pminy=e[0][1],this.pmaxy=e[1][1],this.pminz=e[0][2],this.pmaxz=e[1][2],t?(this.pminx-=this.probeRadius+h,this.pminy-=this.probeRadius+h,this.pminz-=this.probeRadius+h,this.pmaxx+=this.probeRadius+h,this.pmaxy+=this.probeRadius+h,this.pmaxz+=this.probeRadius+h):(this.pminx-=h,this.pminy-=h,this.pminz-=h,this.pmaxx+=h,this.pmaxy+=h,this.pmaxz+=h),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz;var m=129,p=this.pmaxx-this.pminx;this.pmaxy-this.pminy>p&&(p=this.pmaxy-this.pminy),this.pmaxz-this.pminz>p&&(p=this.pmaxz-this.pminz),this.scaleFactor=(m-1)/p,this.scaleFactor=this.defaultScaleFactor,(this.bCalcArea||this.defaultScaleFactor*p>this.threshbox)&&(m=Math.floor(this.threshbox),this.scaleFactor=(this.threshbox-1)/p),this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.finalScaleFactor.x=(this.pLength-1)/(this.pmaxx-this.pminx),this.finalScaleFactor.y=(this.pWidth-1)/(this.pmaxy-this.pminy),this.finalScaleFactor.z=(this.pHeight-1)/(this.pmaxz-this.pminz),this.boundingatom(t),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight),this.vpColor=[]},k.prototype.boundingatom=function(e){var t,s,i,n,r=[];for(var a in this.vdwRadii)if(this.vdwRadii.hasOwnProperty(a)){var l=this.vdwRadii[a];r[a]=e?(l+this.probeRadius)*this.scaleFactor+.5:l*this.scaleFactor+.5,i=r[a]*r[a],this.widxz[a]=Math.floor(r[a])+1,this.depty[a]=new Int32Array(this.widxz[a]*this.widxz[a]),n=0;for(var o=0;o<this.widxz[a];o++)for(var d=0;d<this.widxz[a];d++)(t=o*o+d*d)>i?this.depty[a][n]=-1:(s=Math.sqrt(i-t),this.depty[a][n]=Math.floor(s)),n++}},k.prototype.fillvoxels=function(e,t){var s,i,n,r;for(s=0,r=this.vpBits.length;s<r;s++)this.vpBits[s]=0,this.vpDistance[s]=-1,this.vpAtomID[s]=-1,this.vpColor[s]=new THREE.Color;for(s in t){var a=e[t[s]];void 0!==a&&"DUM"!==a.resn&&this.fillAtom(a,e)}if(this.dataArray){var l=this.header.xExtent-1,o=this.header.yExtent-1,d=this.header.zExtent-1,c=Math.floor(.5+1*(l-0))+1,h=Math.floor(.5+1*(o-0))+1,m=Math.floor(.5+1*(d-0))+1,p=h*m,u=m,C=new Float32Array(c*h*m);for(s=0;s<c;++s)for(i=0;i<h;++i)for(n=0;n<m;++n){var v,g=s*p+i*u+n;"phi"==this.header.filetype?v=n*p+i*u+s:"cube"==this.header.filetype&&(v=s*p+i*u+n),v<this.dataArray.length&&(C[g]=this.dataArray[v])}var f=this.pWidth*this.pHeight,b=this.pHeight;for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(n=0;n<this.pHeight;++n){var y=s/this.finalScaleFactor.x-this.ptranx,w=i/this.finalScaleFactor.y-this.ptrany,S=n/this.finalScaleFactor.z-this.ptranz,_=new THREE.Vector3(y,w,S);_.sub(this.header.ori).multiplyScalar(this.header.scale);var A=Math.floor(_.x),x=Math.ceil(_.x),k=Math.floor(_.y),O=Math.ceil(_.y),H=Math.floor(_.z),R=Math.ceil(_.z);x==A&&(x=A+1),O==k&&(O=k+1),R==H&&(R=H+1),x>c&&(x=c),O>h&&(O=h),R>m&&(R=m);var E,I=C[A*p+k*u+H],D=C[x*p+k*u+H],T=C[A*p+O*u+H],M=C[A*p+k*u+R],P=C[x*p+O*u+H],F=C[A*p+O*u+R],L=C[x*p+k*u+R],N=C[x*p+O*u+R],$=_.x-A,U=_.y-k,q=_.z-H,j=((I*(1-$)+D*$)*(1-U)+(T*(1-$)+P*$)*U)*(1-q)+((M*(1-$)+L*$)*(1-U)+(F*(1-$)+N*$)*U)*q;j>this.isovalue&&(j=this.isovalue),j<-this.isovalue&&(j=-this.isovalue),j>0?(j/=1*this.isovalue,E=new THREE.Color(1-j,1-j,1)):(j/=-1*this.isovalue,E=new THREE.Color(1,1-j,1-j));g=s*f+i*b+n;this.vpColor[g]=E}}for(s=0,r=this.vpBits.length;s<r;s++)this.vpBits[s]&this.INOUT&&(this.vpBits[s]|=this.ISDONE)},k.prototype.fillAtom=function(e,t){var s,i,n,r,a,l,o,d,c,h,m,p,u,C,v,g,f,b,y;s=Math.floor(.5+this.scaleFactor*(e.coord.x+this.ptranx)),i=Math.floor(.5+this.scaleFactor*(e.coord.y+this.ptrany)),n=Math.floor(.5+this.scaleFactor*(e.coord.z+this.ptranz));var w=this.getVDWIndex(e),S=0,_=this.pWidth*this.pHeight;for(h=0,y=this.widxz[w];h<y;h++)for(m=0;m<y;m++){if(-1!=this.depty[w][S])for(g=-1;g<2;g++)for(f=-1;f<2;f++)for(b=-1;b<2;b++)if(0!==g&&0!==f&&0!==b)for(o=g*h,c=b*m,p=0;p<=this.depty[w][S];p++)if(C=i+(d=p*f),v=n+c,!((u=s+o)<0||C<0||v<0||u>=this.pLength||C>=this.pWidth||v>=this.pHeight)){var A=u*_+C*this.pHeight+v;if(this.vpBits[A]&this.INOUT){var x=t[this.vpAtomID[A]];x.serial!=e.serial&&o*o+d*d+c*c<(r=s+o-Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)))*r+(a=i+d-Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)))*a+(l=n+c-Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)))*l&&(this.vpAtomID[A]=e.serial)}else this.vpBits[A]|=this.INOUT,this.vpAtomID[A]=e.serial}S++}},k.prototype.fillvoxelswaals=function(e,t){var s,i;for(s=0,i=this.vpBits.length;s<i;s++)this.vpBits[s]&=~this.ISDONE;for(s in t){var n=e[t[s]];void 0!==n&&this.fillAtomWaals(n,e)}},k.prototype.fillAtomWaals=function(e,t){var s,i,n,r,a,l,o,d,c,h,m,p,u,C,v,g,f,b,y,w=0;s=Math.floor(.5+this.scaleFactor*(e.coord.x+this.ptranx)),i=Math.floor(.5+this.scaleFactor*(e.coord.y+this.ptrany)),n=Math.floor(.5+this.scaleFactor*(e.coord.z+this.ptranz));var S=this.getVDWIndex(e),_=this.pWidth*this.pHeight;for(u=0,y=this.widxz[S];u<y;u++)for(C=0;C<y;C++){if(-1!=this.depty[S][w])for(g=-1;g<2;g++)for(f=-1;f<2;f++)for(b=-1;b<2;b++)if(0!==g&&0!==f&&0!==b)for(o=g*u,c=b*C,v=0;v<=this.depty[S][w];v++)if(m=i+(d=v*f),p=n+c,!((h=s+o)<0||m<0||p<0||h>=this.pLength||m>=this.pWidth||p>=this.pHeight)){var A=h*_+m*this.pHeight+p;if(this.vpBits[A]&this.ISDONE){var x=t[this.vpAtomID[A]];x.serial!=e.serial&&o*o+d*d+c*c<(r=s+o-Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)))*r+(a=i+d-Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)))*a+(l=n+c-Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)))*l&&(this.vpAtomID[A]=e.serial)}else this.vpBits[A]|=this.ISDONE,this.vpAtomID[A]=e.serial}w++}},k.prototype.buildboundary=function(){for(var e=this.pWidth*this.pHeight,t=0;t<this.pLength;t++)for(var s=0;s<this.pHeight;s++)for(var i=0;i<this.pWidth;i++){var n=t*e+i*this.pHeight+s;if(this.vpBits[n]&this.INOUT)for(var r=0;r<26;){var a=t+this.nb[r][0],l=s+this.nb[r][2],o=i+this.nb[r][1];if(a>-1&&a<this.pLength&&o>-1&&o<this.pWidth&&l>-1&&l<this.pHeight&&!(this.vpBits[a*e+o*this.pHeight+l]&this.INOUT)){this.vpBits[n]|=this.ISBOUND;break}r++}}},k.prototype.fastdistancemap=function(){var e,t,s,i,n,r=new function(e,t,s){var i=new Int32Array(e*t*s*3);this.set=function(e,n,r,a){var l=3*((e*t+n)*s+r);i[l]=a.ix,i[l+1]=a.iy,i[l+2]=a.iz},this.get=function(e,n,r){var a=3*((e*t+n)*s+r);return{ix:i[a],iy:i[a+1],iz:i[a+2]}}}(this.pLength,this.pWidth,this.pHeight),a=this.pWidth*this.pHeight,l=this.cutRadius*this.cutRadius,o=[],d=[];for(e=0;e<this.pLength;e++)for(t=0;t<this.pWidth;t++)for(s=0;s<this.pHeight;s++)if(n=e*a+t*this.pHeight+s,this.vpBits[n]&=~this.ISDONE,this.vpBits[n]&this.INOUT&&this.vpBits[n]&this.ISBOUND){var c={ix:e,iy:t,iz:s};r.set(e,t,s,c),o.push(c),this.vpDistance[n]=0,this.vpBits[n]|=this.ISDONE,this.vpBits[n]&=~this.ISBOUND}do{for(d=this.fastoneshell(o,r),o=[],e=0,i=d.length;e<i;e++)n=a*d[e].ix+this.pHeight*d[e].iy+d[e].iz,this.vpBits[n]&=~this.ISBOUND,this.vpDistance[n]<=1.0404*l&&o.push({ix:d[e].ix,iy:d[e].iy,iz:d[e].iz})}while(0!==o.length);o=[],d=[],r=null;var h=this.scaleFactor-.5;h<0&&(h=0);var m=l-.5/(.1+h);for(e=0;e<this.pLength;e++)for(t=0;t<this.pWidth;t++)for(s=0;s<this.pHeight;s++)n=e*a+t*this.pHeight+s,this.vpBits[n]&=~this.ISBOUND,this.vpBits[n]&this.INOUT&&(this.vpBits[n]&this.ISDONE&&!(this.vpBits[n]&this.ISDONE&&this.vpDistance[n]>=m)||(this.vpBits[n]|=this.ISBOUND))},k.prototype.fastoneshell=function(e,t){var s,i,n,r,a,l,o,d,c,h,m,p,u=[];if(0===e.length)return u;var C={ix:-1,iy:-1,iz:-1},v=this.pWidth*this.pHeight;for(o=0,c=e.length;o<c;o++)for(s=e[o].ix,i=e[o].iy,n=e[o].iz,m=t.get(s,i,n),d=0;d<6;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=n+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*v+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,n+this.nb[d][2],m),h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l)<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz}))));for(o=0,c=e.length;o<c;o++)for(s=e[o].ix,i=e[o].iy,n=e[o].iz,m=t.get(s,i,n),d=6;d<18;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=n+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*v+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,n+this.nb[d][2],m),h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l)<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz}))));for(o=0,c=e.length;o<c;o++)for(s=e[o].ix,i=e[o].iy,n=e[o].iz,m=t.get(s,i,n),d=18;d<26;d++)C.ix=s+this.nb[d][0],C.iy=i+this.nb[d][1],C.iz=n+this.nb[d][2],C.ix<this.pLength&&C.ix>-1&&C.iy<this.pWidth&&C.iy>-1&&C.iz<this.pHeight&&C.iz>-1&&(p=C.ix*v+this.pHeight*C.iy+C.iz,this.vpBits[p]&this.INOUT&&!(this.vpBits[p]&this.ISDONE)?(t.set(C.ix,C.iy,n+this.nb[d][2],m),h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l,this.vpDistance[p]=h,this.vpBits[p]|=this.ISDONE,this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz})):this.vpBits[p]&this.INOUT&&this.vpBits[p]&this.ISDONE&&(h=(r=C.ix-m.ix)*r+(a=C.iy-m.iy)*a+(l=C.iz-m.iz)*l)<this.vpDistance[p]&&(t.set(C.ix,C.iy,C.iz,m),this.vpDistance[p]=h,this.vpBits[p]&this.ISBOUND||(this.vpBits[p]|=this.ISBOUND,u.push({ix:C.ix,iy:C.iy,iz:C.iz}))));return u},k.prototype.marchingcubeinit=function(e){for(var t=0,s=this.vpBits.length;t<s;t++)1==e?this.vpBits[t]&=~this.ISBOUND:4==e?(this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.ISBOUND&&(this.vpBits[t]|=this.ISDONE),this.vpBits[t]&=~this.ISBOUND):2==e?this.vpBits[t]&this.ISBOUND&&this.vpBits[t]&this.ISDONE?this.vpBits[t]&=~this.ISBOUND:this.vpBits[t]&this.ISBOUND&&!(this.vpBits[t]&this.ISDONE)&&(this.vpBits[t]|=this.ISDONE):3==e&&(this.vpBits[t]&=~this.ISBOUND)},k.prototype.counter=function(){for(var e=Array(256),t=0;t<256;t++)e[t]=[];this.incrementUsed=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].used++},this.incrementUnused=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].unused++};this.print=function(){for(var t=this.marchingCube.triTable,s=[],i=0;i<t.length;i++){for(var n=[],r=0;r<t[i].length;r+=3){var a=r/3;void 0!==e[i][a]&&e[i][a].unused||(n.push(t[i][r]),n.push(t[i][r+1]),n.push(t[i][r+2])),void 0===e[i][a]&&console.log("undef "+i+","+a)}s.push(n)}!function(e){for(var t=0;t<e.length;t++){for(var s=0,i=e[t],n=0;n<i.length;n++)s|=1<<i[n];s.toString(16)}}(s)}},k.prototype.marchingcube=function(e){this.marchingcubeinit(e),this.verts=[],this.faces=[],this.marchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});for(var t=this.pWidth*this.pHeight,s=0,i=this.verts.length;s<i;s++)this.verts[s].atomid=this.vpAtomID[this.verts[s].x*t+this.pHeight*this.verts[s].y+this.verts[s].z],this.dataArray&&(this.verts[s].color=this.vpColor[this.verts[s].x*t+this.pHeight*this.verts[s].y+this.verts[s].z]);var n,r,a=0;if(this.bCalcArea){var l={};n={};s=0;for(var o=this.faces.length;s<o;s+=3){var d=this.faces[s],c=this.faces[s+1],h=this.faces[s+2];if(d!=c&&c!=h&&d!=h){var m=Math.min(d,c,h),p=Math.max(d,c,h),u=m+"_"+(d+c+h-m-p)+"_"+p;if(!l.hasOwnProperty(u)){l[u]=1;var C=this.verts[d].atomid,v=this.verts[c].atomid,g=this.verts[h].atomid;if(this.atomsToShow[C]&&this.atomsToShow[v]&&this.atomsToShow[g]){var f=this.verts[d],b=this.verts[c],y=this.verts[h],w=(f.x-b.x)*(f.x-b.x)+(f.y-b.y)*(f.y-b.y)+(f.z-b.z)*(f.z-b.z),S=(f.x-y.x)*(f.x-y.x)+(f.y-y.y)*(f.y-y.y)+(f.z-y.z)*(f.z-y.z),_=(y.x-b.x)*(y.x-b.x)+(y.y-b.y)*(y.y-b.y)+(y.z-b.z)*(y.z-b.z),A=Math.min(w,S,_),x=Math.max(w,S,_),k=w+S+_-A-x,O=0,H=(O=0==parseInt(100*(x-A))?.433*A:0==parseInt(100*(k-A))?.5*A:.707*A)/3;void 0===n[C]?n[C]=H:n[C]+=H,void 0===n[v]?n[v]=H:n[v]+=H,void 0===n[g]?n[g]=H:n[g]+=H,a+=O}}}}a=a/(r=Math.max(this.finalScaleFactor.x,this.finalScaleFactor.y,this.finalScaleFactor.z))/r}return this.bCalcArea||this.marchingCube.laplacianSmooth(1,this.verts,this.faces),{area:a,serial2area:n,scaleFactor:r}};class O{constructor(e){this.icn3d=e,this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.isovalue=1.5,this.dataArray={},this.matrix=void 0,this.center=void 0,this.maxdist=void 0,this.pmin=void 0,this.pmax=void 0,this.water=void 0,this.header=void 0,this.type=void 0,this.rmsd_supr=void 0,this.loadPhiFrom=void 0,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.vertnumber=0,this.facenumber=0,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=void 0,this.verts=void 0,this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],this.marchingCube=new x}}O.prototype.getFacesAndVertices=function(e,t){var s,i,n={};for(s=0,i=t.length;s<i;s++)n[t[s]]=1;var r=this.verts;for(s=0,i=r.length;s<i;s++){var a;a="phi"==this.type?new THREE.Vector3(r[s].x,r[s].y,r[s].z).multiplyScalar(1/this.header.scale).applyMatrix4(this.matrix):new THREE.Vector3(r[s].x,r[s].y,r[s].z).applyMatrix4(this.matrix),r[s].x=a.x,r[s].y=a.y,r[s].z=a.z}var l=[];for(s=0,i=this.faces.length;s<i;s+=3){var o=this.faces[s],d=this.faces[s+1],c=this.faces[s+2];o!==d&&d!==c&&o!==c&&l.push({a:o,b:d,c:c})}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:r,faces:l}},O.prototype.initparm=function(e,t,s,i,n,r,a,l,o,d,c,h,m){this.header=e,this.loadPhiFrom=h,this.header&&void 0!==this.header.max?this.isovalue=this.header.min+(this.header.max-this.header.min)*i/100:this.header&&void 0!==this.header.mean?this.isovalue=this.header.mean+this.header.sigma*i:this.isovalue=i,this.dataArray=t,this.matrix=s,this.center=n,this.maxdist=r,this.pmin=a,this.pmax=l,this.water=o,this.type=d,this.rmsd_supr=c,this.pminx=0,this.pmaxx=this.header.xExtent-1,this.pminy=0,this.pmaxy=this.header.yExtent-1,this.pminz=0,this.pmaxz=this.header.zExtent-1,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz;var p=this.pmaxx-this.pminx;this.pmaxy-this.pminy>p&&(p=this.pmaxy-this.pminy),this.pmaxz-this.pminz>p&&(p=this.pmaxz-this.pminz),this.scaleFactor=1,this.pLength=Math.floor(.5+this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.floor(.5+this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.floor(.5+this.scaleFactor*(this.pmaxz-this.pminz))+1,this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Uint8Array(this.pLength*this.pWidth*this.pHeight)},O.prototype.transformMemPro=function(e,t,s,i){var n=e.clone();n.sub(s);var r=n.x*t[0]+n.y*t[1]+n.z*t[2]+i.x,a=n.x*t[3]+n.y*t[4]+n.z*t[5]+i.y,l=n.x*t[6]+n.y*t[7]+n.z*t[8]+i.z;return n.x=r,n.y=a,n.z=l,n},O.prototype.fillvoxels=function(e,t){var s,i,n,r,a,l;for(s=0,r=this.vpBits.length;s<r;s++)this.vpBits[s]=0,this.vpAtomID[s]=0;var o=this.pWidth*this.pHeight,d=this.pHeight;if("phi"!=this.type||this.header.bSurface){var c=(new THREE.Matrix4).getInverse(this.matrix),h=[];this.maxdist=parseInt(this.maxdist);var m,p,u,C=new Array(9);if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot){m=this.rmsd_supr.rot,p=this.rmsd_supr.trans1,u=this.rmsd_supr.trans2;var v=new THREE.Matrix3,g=new THREE.Matrix3;v.set(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8]),g.getInverse(v),C[0]=g.elements[0],C[1]=g.elements[3],C[2]=g.elements[6],C[3]=g.elements[1],C[4]=g.elements[4],C[5]=g.elements[7],C[6]=g.elements[2],C[7]=g.elements[5],C[8]=g.elements[8]}if("phi"==this.type&&this.header.bSurface){var f=new Float32Array(this.pLength*this.pWidth*this.pHeight);for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(n=0;n<this.pHeight;++n){j=s*o+i*d+n;"phi"==this.header.filetype?q=n*o+i*d+s:"cube"==this.header.filetype&&(q=s*o+i*d+n),q<this.dataArray.length&&(f[j]=this.dataArray[q])}for(var b in t){if("DUM"!==(U=e[t[b]]).resn){var y=U.coord.clone();if("delphi"!=this.loadPhiFrom)if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot)y=this.transformMemPro(U.coord,C,u,p).applyMatrix4(c);else y=U.coord.clone().applyMatrix4(c);y.sub(this.header.ori).multiplyScalar(this.header.scale);var w=Math.floor(y.x),S=Math.ceil(y.x),_=Math.floor(y.y),A=Math.ceil(y.y),x=Math.floor(y.z),k=Math.ceil(y.z);S==w&&(S=w+1),A==_&&(A=_+1),k==x&&(k=x+1),S>this.pLength&&(S=this.pLength),A>this.pWidth&&(A=this.pWidth),k>this.pHeight&&(k=this.pHeight);var O,H=f[w*o+_*d+x],R=f[S*o+_*d+x],E=f[w*o+A*d+x],I=f[w*o+_*d+k],D=f[S*o+A*d+x],T=f[w*o+A*d+k],M=f[S*o+_*d+k],P=f[S*o+A*d+k],F=y.x-w,L=y.y-_,N=y.z-x,$=((H*(1-F)+R*F)*(1-L)+(E*(1-F)+D*F)*L)*(1-N)+((I*(1-F)+M*F)*(1-L)+(T*(1-F)+P*F)*L)*N;$>this.isovalue&&($=this.isovalue),$<-this.isovalue&&($=-this.isovalue),$>0?($/=1*this.isovalue,O=new THREE.Color(1-$,1-$,1)):($/=-1*this.isovalue,O=new THREE.Color(1,1-$,1-$)),this.icn3d.atoms[t[b]].color=O,this.icn3d.atomPrevColors[t[b]]=O}}}else{for(var b in t){var U;if("DUM"!==(U=e[t[b]]).resn){if(void 0!==this.rmsd_supr&&void 0!==this.rmsd_supr.rot)y=this.transformMemPro(U.coord,C,u,p).applyMatrix4(c);else y=U.coord.clone().applyMatrix4(c);for(s=Math.floor(y.x)-this.maxdist,r=Math.ceil(y.x)+this.maxdist;s<=r;++s)if(!(s<0||s>this.header.xExtent*this.scaleFactor-1))for(i=Math.floor(y.y)-this.maxdist,a=Math.ceil(y.y)+this.maxdist;i<=a;++i)if(!(i<0||i>this.header.yExtent*this.scaleFactor-1))for(n=Math.floor(y.z)-this.maxdist,l=Math.ceil(y.z)+this.maxdist;n<=l;++n)if(!(n<0||n>this.header.zExtent*this.scaleFactor-1)){j=s*o+i*d+n;h.push(j)}}}for(s=0,r=h.length;s<r;++s){j=h[s];"2fofc"==this.type?this.vpBits[j]=this.dataArray[j]>=this.isovalue?1:0:"fofc"==this.type?(this.vpBits[j]=this.dataArray[j]>=this.isovalue||this.dataArray[j]<=-this.isovalue?1:0,this.vpAtomID[j]=this.dataArray[j]>=0?1:0):"em"==this.type&&(this.vpBits[j]=this.dataArray[j]>=this.isovalue?1:0)}}}else for(s=0;s<this.pLength;++s)for(i=0;i<this.pWidth;++i)for(n=0;n<this.pHeight;++n){var q,j=s*o+i*d+n;"phi"==this.header.filetype?q=n*o+i*d+s:"cube"==this.header.filetype&&(q=s*o+i*d+n),q<this.dataArray.length&&(this.vpBits[j]=this.dataArray[q]>=this.isovalue||this.dataArray[q]<=-this.isovalue?1:0,this.vpAtomID[j]=this.dataArray[q]>=0?1:0)}for(s=0,r=this.vpBits.length;s<r;s++)this.vpBits[s]&this.INOUT&&(this.vpBits[s]|=this.ISDONE)},O.prototype.buildboundary=function(){var e,t,s,i=this.pWidth*this.pHeight;for(e=0;e<this.pLength;e++)for(t=0;t<this.pHeight;t++)for(s=0;s<this.pWidth;s++){var n=e*i+s*this.pHeight+t;if(this.vpBits[n]&this.INOUT)for(var r=0;r<26;){var a=e+this.nb[r][0],l=t+this.nb[r][2],o=s+this.nb[r][1];if(a>-1&&a<this.pLength&&o>-1&&o<this.pWidth&&l>-1&&l<this.pHeight&&!(this.vpBits[a*i+o*this.pHeight+l]&this.INOUT)){this.vpBits[n]|=this.ISBOUND;break}r++}}},O.prototype.marchingcubeinit=function(e){for(var t=0,s=this.vpBits.length;t<s;t++)1==e?this.vpBits[t]&=~this.ISBOUND:4==e?(this.vpBits[t]&=~this.ISDONE,this.vpBits[t]&this.ISBOUND&&(this.vpBits[t]|=this.ISDONE),this.vpBits[t]&=~this.ISBOUND):2==e?this.vpBits[t]&this.ISBOUND&&this.vpBits[t]&this.ISDONE?this.vpBits[t]&=~this.ISBOUND:this.vpBits[t]&this.ISBOUND&&!(this.vpBits[t]&this.ISDONE)&&(this.vpBits[t]|=this.ISDONE):this.vpBits[t]&=~this.ISBOUND},O.prototype.counter=function(){for(var e=Array(256),t=0;t<256;t++)e[t]=[];this.incrementUsed=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].used++},this.incrementUnused=function(t,s){void 0===e[t][s]&&(e[t][s]={used:0,unused:0}),e[t][s].unused++};this.print=function(){for(var t=this.marchingCube.triTable,s=[],i=0;i<t.length;i++){for(var n=[],r=0;r<t[i].length;r+=3){var a=r/3;void 0!==e[i][a]&&e[i][a].unused||(n.push(t[i][r]),n.push(t[i][r+1]),n.push(t[i][r+2])),void 0===e[i][a]&&console.log("undef "+i+","+a)}s.push(n)}!function(e){for(var t=0;t<e.length;t++){for(var s=0,i=e[t],n=0;n<i.length;n++)s|=1<<i[n];s.toString(16)}}(s)}},O.prototype.marchingcube=function(e){this.marchingcubeinit(e),this.verts=[],this.faces=[],this.marchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});for(var t=this.pWidth*this.pHeight,s=0,i=this.verts.length;s<i;s++)this.verts[s].atomid=this.vpAtomID[this.verts[s].x*t+this.pHeight*this.verts[s].y+this.verts[s].z];this.marchingCube.laplacianSmooth(1,this.verts,this.faces)};class H{constructor(e){this.icn3d=e}createSurfaceRepresentation(e,t,s,i){var n=this.icn3d,r=n.icn3dui;if(!n.icn3dui.bNode&&0!=Object.keys(e).length){var a;null==i&&(i=1),n.opacity=i;var l,o=n.contactCls.getExtent(e),d=[];if(n.bConsiderNeighbors)l=r.hashUtilsCls.unionHash(l,e),l=r.hashUtilsCls.unionHash(l,n.contactCls.getAtomsWithinAtom(n.atoms,e,5)),d=Object.keys(l);else d=Object.keys(e);var c,h=!(10==parseInt(10*i)||s||n.bInstanced&&Object.keys(n.atoms).length*n.biomtMatrices.length>n.maxatomcnt),m={allatoms:n.atoms,atomsToShow:Object.keys(e),extendedAtoms:d,water:n.water,center:n.center,maxdist:1,pmin:n.pmin,pmax:n.pmax,rmsd_supr:n.rmsd_supr};if(11==t)m.header=n.mapData.header2,m.data=n.mapData.data2,m.matrix=n.mapData.matrix2,m.isovalue=n.mapData.sigma2,m.type="2fofc",c=this.SetupMap(m);else if(12==t)m.header=n.mapData.header,m.data=n.mapData.data,m.matrix=n.mapData.matrix,m.isovalue=n.mapData.sigma,m.type="fofc",c=this.SetupMap(m);else if(13==t)m.maxdist=3,m.header=n.mapData.headerEm,m.data=n.mapData.dataEm,m.matrix=n.mapData.matrixEm,m.isovalue=n.mapData.sigmaEm,m.type="em",c=this.SetupMap(m);else if(14==t)m.header=n.mapData.headerPhi,m.data=n.mapData.dataPhi,m.matrix=n.mapData.matrixPhi,m.isovalue=n.mapData.contourPhi,m.type="phi",m.loadPhiFrom=n.loadPhiFrom,c=this.SetupMap(m);else{var p=r.hashUtilsCls.exclHash(e,n.water);d=Object.keys(p);var u=t;21==u?u=1:22==u?u=2:23==u&&(u=3),(m={extent:o,allatoms:n.atoms,atomsToShow:Object.keys(p),extendedAtoms:d,type:u,threshbox:h?60:n.threshbox,bCalcArea:n.bCalcArea}).header=n.mapData.headerPhi,m.data=n.mapData.dataPhi,m.matrix=n.mapData.matrixPhi,m.isovalue=n.mapData.contourPhi,m.loadPhiFrom=n.loadPhiFrom,c=this.SetupSurface(m)}if(n.bCalcArea){n.areavalue=c.area.toFixed(2);var C=c.serial2area,v=c.scaleFactor*c.scaleFactor;n.resid2area={};var g={},f={};for(var b in C){var y=n.atoms[b],w=y.structure+"_"+y.chain+"_"+y.resi+"_"+y.resn;g[y.structure]=1,f[y.structure+"_"+y.chain]=1,void 0===n.resid2area[w]?n.resid2area[w]=C[b]:n.resid2area[w]+=C[b]}var S='<table border="1" cellpadding="10" cellspacing="0">',_=Object.keys(g).length>1?"<th>Structure</th>":"",A=Object.keys(f).length>1?"<th>Chain</th>":"";for(var w in S+="<tr>"+_+A+"<th>Residue</th><th>Number</th><th>SASA (&#8491;<sup>2</sup>)</th><th>Percent Out</th><th>In/Out</th></tr>",n.resid2area){var x=w.lastIndexOf("_"),k=w.substr(x+1),O=r.utilsCls.getIdArray(w.substr(0,x));_=Object.keys(g).length>1?"<td>"+O[0]+"</td>":"",A=Object.keys(f).length>1?"<td>"+O[1]+"</td>":"";var H="",R="";n.resid2area[w]=(n.resid2area[w]/v).toFixed(2),r.parasCls.residueArea.hasOwnProperty(k)&&((R=parseInt(n.resid2area[w]/r.parasCls.residueArea[k]*100))>100&&(R=100),R>=50&&(H="out"),R<20&&(H="in")),S+='<tr align="center">'+_+A+"<td>"+k+'</td><td align="right">'+O[2]+'</td><td align="right">'+n.resid2area[w]+'</td><td align="right">'+R+"%</td><td>"+H+"</td></tr>"}return S+="</table>",void(n.areahtml=S)}var E,I,D,T=c.vertices,M=c.faces,P=r.parasCls.thr("#00FFFF"),F=r.parasCls.thr("#00FF00"),L=r.parasCls.thr("#ff0000"),N=r.parasCls.thr("#00FFFF"),$=r.parasCls.thr("#0000FF"),U=r.parasCls.thr("#FF0000");11!=t&&12!=t&&13!=t&&14!=t||void 0===n.rmsd_supr||void 0===n.rmsd_supr.rot||(E=n.rmsd_supr.rot,I=n.rmsd_supr.trans1,D=n.rmsd_supr.trans2);var q=(11==t||12==t||13==t||14==t&&"delphi"!=n.loadPhiFrom)&&void 0!==n.rmsd_supr&&void 0!==n.rmsd_supr.rot;if((a=new THREE.Geometry).vertices=T.map((function(e){var t=new THREE.Vector3(e.x,e.y,e.z);return q&&(t=this.transformMemPro(t,E,I,D)),t.atomid=e.atomid,t.color=e.color,t})),a.faces=M.map((function(e){var s=["a","b","c"].map((function(s){if(11==t)return P;if(12==t)return a.vertices[e[s]].atomid?F:L;if(13==t)return N;if(14==t)return a.vertices[e[s]].atomid?$:U;if(21==t||22==t||23==t)return a.vertices[e[s]].color;var i=a.vertices[e[s]].atomid;return n.atoms[i].color}));return new THREE.Face3(e.a,e.b,e.c,void 0,s)})),a.computeVertexNormals(!0),a.colorsNeedUpdate=!0,a.normalsNeedUpdate=!0,a.type="Surface",h){for(var j=JSON.parse(JSON.stringify(a)).data.normals,B={},z=(b=0,M.length);b<z;++b){var G=M[b].a,V=M[b].b,W=M[b].c;void 0===B[G]&&(B[G]=[]),B[G].push(V),B[G].push(W)}for(var G in B){this.geometry=new THREE.Geometry,this.geometry.vertices=[],this.geometry.faces=[];var Y=B[G];for(b=0,z=Y.length;b<z;b+=2){V=Y[b],W=Y[b+1];this.geometry.vertices.push(new THREE.Vector3(T[G].x,T[G].y,T[G].z)),this.geometry.vertices.push(new THREE.Vector3(T[V].x,T[V].y,T[V].z)),this.geometry.vertices.push(new THREE.Vector3(T[W].x,T[W].y,T[W].z));var X=[];X.push(n.atoms[T[G].atomid].color),X.push(n.atoms[T[V].atomid].color),X.push(n.atoms[T[W].atomid].color);var K=[];K.push(j[G]),K.push(j[V]),K.push(j[W]);var Q=b/2*3;this.geometry.faces.push(new THREE.Face3(Q,Q+1,Q+2,K,X))}this.geometry.colorsNeedUpdate=!0,this.geometry.type="Surface";var J,Z=new THREE.Mesh(this.geometry,new THREE.MeshPhongMaterial({specular:n.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:s,opacity:i,transparent:!0,side:THREE.DoubleSide})),ee=new THREE.Vector3(0,0,0);for(b=0,z=Z.geometry.vertices.length;b<z;++b)ee=ee.add(Z.geometry.vertices[b]);J=n.bControlGl&&!n.icn3dui.bNode?ee.multiplyScalar(1/Z.geometry.vertices.length).sub(n.oriCenter).applyMatrix4(window.cam.matrixWorldInverse):ee.multiplyScalar(1/Z.geometry.vertices.length).sub(n.oriCenter).applyMatrix4(n.cam.matrixWorldInverse),Z.renderOrder=n.cam_z>0?-parseInt(J.z):parseInt(J.z),Z.onBeforeRender=function(e,t,s,i,r,a){for(var l,o=new THREE.Vector3(0,0,0),d=0,c=this.geometry.vertices.length;d<c;++d)o=o.add(this.geometry.vertices[d]);l=n.bControlGl&&!n.icn3dui.bNode?o.multiplyScalar(1/this.geometry.vertices.length).sub(n.oriCenter).applyMatrix4(window.cam.matrixWorldInverse):o.multiplyScalar(1/this.geometry.vertices.length).sub(n.oriCenter).applyMatrix4(n.cam.matrixWorldInverse),this.renderOrder=n.cam_z>0?-parseInt(l.z):parseInt(l.z)},n.mdl.add(Z),11==t||12==t?n.prevMaps.push(Z):13==t?n.prevEmmaps.push(Z):14==t?n.prevPhimaps.push(Z):n.prevSurfaces.push(Z)}}else{(Z=new THREE.Mesh(a,new THREE.MeshPhongMaterial({specular:n.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:s,opacity:i,transparent:!0,side:THREE.DoubleSide}))).renderOrder=-2,n.mdl.add(Z),11==t||12==t?n.prevMaps.push(Z):13==t?n.prevEmmaps.push(Z):14==t?n.prevPhimaps.push(Z):n.prevSurfaces.push(Z)}c=null,T=null,M=null,a=null}}transformMemPro(e,t,s,i,n){this.icn3d.icn3dui;var r=e.clone();r.sub(s),n&&console.log("sub coord: "+JSON.stringify(r));var a=r.x*t[0]+r.y*t[1]+r.z*t[2]+i.x,l=r.x*t[3]+r.y*t[4]+r.z*t[5]+i.y,o=r.x*t[6]+r.y*t[7]+r.z*t[8]+i.z;return r.x=a,r.y=l,r.z=o,n&&console.log("out coord: "+JSON.stringify(r)),r}SetupSurface(e){var t=this.icn3d;t.icn3dui;var s=e.threshbox,i=new k(t,s);i.initparm(e.extent,1!==e.type,e.bCalcArea,e.atomsToShow,e.header,e.data,e.matrix,e.isovalue,e.loadPhiFrom),i.fillvoxels(e.allatoms,e.extendedAtoms),i.buildboundary(),2===e.type&&(i.fastdistancemap(),i.boundingatom(!1),i.fillvoxelswaals(e.allatoms,e.extendedAtoms));var n=i.marchingcube();i.vpBits=null,i.vpDistance=null,i.vpAtomID=null;var r=i.getFacesAndVertices(e.atomsToShow);return r.area=n.area,r.serial2area=n.serial2area,r.scaleFactor=n.scaleFactor,i.faces=null,i.verts=null,r}SetupMap(e){var t=this.icn3d;t.icn3dui;var s,i=new O(t);return i.initparm(e.header,e.data,e.matrix,e.isovalue,e.center,e.maxdist,e.pmin,e.pmax,e.water,e.type,e.rmsd_supr,e.loadPhiFrom,e.icn3d),i.fillvoxels(e.allatoms,e.extendedAtoms),e.header.bSurface||i.buildboundary(),e.header.bSurface||i.marchingcube(),i.vpBits=null,i.vpAtomID=null,e.header.bSurface||(s=i.getFacesAndVertices(e.allatoms,e.atomsToShow)),i.faces=null,i.verts=null,s}}class R{constructor(e){this.icn3d=e}shareLink(e){var t=this.icn3d;t.icn3dui;var s=this.shareLinkUrl(),i=s.length>4e3||0!==s.indexOf("http");e&&(s+="&random="+parseInt(1e3*Math.random()));var n=Object.keys(t.structures).join("_");if(e){if(t.bInputfile||i)return void t.saveFileCls.saveFile(n+"_image_icn3d_loadable.png","png")}else{if(t.bInputfile&&!t.bInputUrlfile)return void alert("Share Link does NOT work when the data is from custom files. Please save 'iCn3D PNG Image' in the File menu and open it in iCn3D.");if(i)return void alert("The url is more than 4000 characters and may not work. Please save 'iCn3D PNG Image' or 'State File' and open them in iCn3D.");t.icn3dui.htmlCls.clickMenuCls.setLogCmd("share link: "+s,!1)}$.ajax({url:"https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBxl9CgM0dY5lagHL4UOhEpLWE1fuwdnvc",type:"POST",data:{longDynamicLink:"https://icn3d.page.link/?link="+encodeURIComponent(s)},dataType:"json",success:function(i){var r="Problem in getting shortened URL";if(void 0!==i.shortLink&&(r=i.shortLink,e)){var a=r.split("/"),l=a[a.length-1];t.saveFileCls.saveFile(n+"-"+l+".png","png");var o='<div style="float:left; border: solid 1px #0000ff; padding: 5px; margin: 10px; text-align:center;">';o+='<a href="https://structure.ncbi.nlm.nih.gov/icn3d/share.html?'+l+'" target="_blank">',o+='<img style="height:300px" src ="'+n+"-"+l+'.png"><br>\n',o+="\x3c!--Start of your comments==================--\x3e\n";var d=t.yournote?": "+t.yournote.replace(/\n/g,"<br>").replace(/; /g,", "):"";o+="PDB "+n.toUpperCase()+d+"\n",o+="\x3c!--End of your comments====================--\x3e\n",o+="</a>",o+="</div>\n\n",t.saveFileCls.saveFile(n+"-"+l+".html","html",o)}e&&void 0===i.shortLink&&t.saveFileCls.saveFile(n+"_image_icn3d_loadable.png","png");var c=r.split("page.link/");2==c.length&&(r="https://structure.ncbi.nlm.nih.gov/icn3d/share.html?"+c[1]),$("#"+t.pre+"ori_url").val(s),$("#"+t.pre+"short_url").val(r),$("#"+t.pre+"short_url_title").val(r+"&t="+t.yournote),e||t.icn3dui.htmlCls.dialogCls.openDlg("dl_copyurl","Copy a Share Link URL")},error:function(i,n,r){var a="Problem in getting shortened URL";$("#"+t.pre+"ori_url").val(s),$("#"+t.pre+"short_url").val(a),$("#"+t.pre+"short_url_title").val(a+"&t="+t.yournote),e||t.icn3dui.htmlCls.dialogCls.openDlg("dl_copyurl","Copy a Share Link URL")}})}shareLinkUrl(e){var t=this.icn3d;t.icn3dui;var s=t.icn3dui.htmlCls.baseUrl+"icn3d/full.html?";(t.icn3dui.cfg.bSidebyside&&(s=t.icn3dui.htmlCls.baseUrl+"icn3d/full2.html?"),t.bInputUrlfile)&&(s=window.location.href.split("?")[0]+"?"+t.inputurl+"&");var i,n={};for(var r in t.cfg){var a=t.cfg[r];"inpara"!==r&&"command"!==r&&"usepdbnum"!==r&&"date"!==r&&"v"!==r&&void 0!==a&&("width"===r&&"100%"===a||"height"===r&&"100%"===a||"resize"===r&&!0===a||"showmenu"===r&&!0===a||"showtitle"===r&&!0===a||"showcommand"===r&&!0===a||"simplemenu"===r&&!1===a||"mobilemenu"===r&&!1===a||"closepopup"===r&&!1===a||"showanno"===r&&!1===a||"showseq"===r&&!1===a||"showalignseq"===r&&!1===a||"show2d"===r&&!1===a||"showsets"===r&&!1===a||"rotate"===r&&"right"===a||"command"!==r&&("options"===r?Object.keys(a).length>0&&(n[r]=JSON.stringify(a)):!0===a?n[r]=1:!1===a?n[r]=0:""!==a&&(n[r]=a)))}var l=-1;void 0!==t.icn3dui.cfg.inpara&&(l=t.icn3dui.cfg.inpara.indexOf("&command=")),i=-1!==l?t.icn3dui.cfg.inpara.substr(0,l):t.icn3dui.cfg.inpara;var o=!1;if(!t.bInputUrlfile){for(var d=i&&i.substr(1)?i.substr(1).split("&"):[],c=0,h=d.length;c<h;++c){var m=d[c].split("=");2==m.length&&(n[m[0]]=m[1])}for(var r in n)"v"!==r&&("date"===r&&(o=!0),s+=r+"="+n[r]+"&")}var p=new Date,u=(p.getMonth()+1).toString();p.getMonth()+1<10&&(u="0"+u);var C=p.getDate().toString();p.getDate()<10&&(C="0"+C);var v=p.getFullYear().toString()+u+C;o||(s+="date="+v+"&"),s+="v="+t.icn3dui.REVISION+"&",s+="command=";var g=0;(e||t.bInputUrlfile)&&(g=0);var f={};f.factor=t._zoomFactor,f.mouseChange=t.mouseChange,f.quaternion=t.quaternion;var b=!1,y="",w=void 0,S="toggle highlight",_=0;t.commands.length>g&&(-1!==(w=t.commands[g].split("|||")[0].trim()).indexOf(S)&&++_);var A;for(c=g+1,h=t.commands.length;c<h;++c){b=!0;var x=t.commands[c].split("|||")[0].trim();(-1!==w.indexOf("select saved atoms")||-1!==w.indexOf("select sets"))&&(0===x.indexOf("select")||0===x.indexOf("select"))&&-1===w.indexOf(" name ")||-1!==w.indexOf("pickatom")&&-1!==x.indexOf("pickatom")||"show selection"==w&&-1!=t.commands.slice(c).toString().indexOf("show selection")||(-1!==w.indexOf(S)?++_:s+=c===g+1?w:"; "+w),y+=w+"\n",w=x}return w&&(b&&(s+="; "),_>0&&_%2==0&&w!==S&&(s+=S+"; "),s+=w+"|||"+t.transformCls.getTransformationStr(f),y+=w+"|||"+t.transformCls.getTransformationStr(f)+"\n"),y=y.replace(/!/g,Object.keys(t.structures)[0]+"_"),(t.bInputfile&&!t.bInputUrlfile||s.length>4e3)&&(s=y),void 0!==t.structures&&1==Object.keys(t.structures).length&&void 0!==t.inputid&&(A=Object.keys(t.structures)[0],s=s.replace(new RegExp(A+"_","g"),"!")),void 0!==t.icn3dui.cfg.blast_rep_id&&(s=s.replace(new RegExp("blast_rep_id=!","g"),"blast_rep_id="+A+"_")),s}getPngText(){var e,t=this.icn3d;t.icn3dui;var s="";t.bInputfile?(e=this.shareLinkUrl(true),s+="\nStart of type file======\n",s+=t.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=t.InputfileData,s+="End of data file======\n",s+="Start of state file======\n",s+=e,s+="End of state file======\n"):(e=this.shareLinkUrl()).length>4e3||0!==e.indexOf("http")?(s+="\nStart of state file======\n",s+=e=this.shareLinkUrl(true),s+="End of state file======\n"):s+="\nShare Link: "+e;return s=s.replace(/!/g,Object.keys(t.structures)[0]+"_")}}class E{constructor(e){this.icn3d=e}addHlObjects(e,t,s){var i=this.icn3d,n=i.icn3dui;void 0===e&&(e=i.hColor),void 0===s&&(s=i.hAtoms),i.applyDisplayCls.applyDisplayOptions(i.opts,n.hashUtilsCls.intHash(s,i.dAtoms),i.bHighlight),(t||i.bRender)&&i.drawCls.render()}removeHlObjects(){var e=this.icn3d;for(var t in e.icn3dui,e.prevHighlightObjects)e.mdl.remove(e.prevHighlightObjects[t]);for(var t in e.prevHighlightObjects=[],e.prevHighlightObjects_ghost)e.mdl.remove(e.prevHighlightObjects_ghost[t]);e.prevHighlightObjects_ghost=[]}}class I{constructor(e){this.icn3d=e}setThichknessFor3Dprint(){var e=this.icn3d;e.icn3dui,e.lineRadius=1,e.coilWidth=1.2,e.cylinderRadius=.8,e.traceRadius=1,e.dotSphereScale=.6,e.sphereRadius=1.5,e.ribbonthickness=1,e.helixSheetWidth=2,e.nucleicAcidWidth=1.4}prepareFor3Dprint(){var e=this.icn3d;if(e.icn3dui,e.bShowHighlight=!1,e.hlObjectsCls.removeHlObjects(),e.bDashedLines=!1,e.bSetThickness||void 0!==e.icn3dui.cfg.cid||this.setThichknessFor3Dprint(),void 0!==e.lines.hbond)for(var t=0,s=e.lines.hbond.length;t<s;++t){e.lines.hbond[t].dashed=!1,e.bDashedLines=!0}if(void 0!==e.lines.distance)for(t=0,s=e.lines.distance.length;t<s;++t){e.lines.distance[t].dashed=!1,e.bDashedLines=!0}e.drawCls.draw()}resetAfter3Dprint(){var e=this.icn3d;if(e.icn3dui,void 0!==e.lines.hbond)for(var t=0,s=e.lines.hbond.length;t<s;++t){e.lines.hbond[t].dashed=!0}if(void 0!==e.lines.distance)for(t=0,s=e.lines.distance.length;t<s;++t){e.lines.distance[t].dashed=!0}e.lineRadius=.1,e.coilWidth=.3,e.cylinderRadius=.4,e.traceRadius=.4,e.dotSphereScale=.3,e.sphereRadius=1.5,e.cylinderHelixRadius=1.6,e.ribbonthickness=.2,e.helixSheetWidth=1.3,e.nucleicAcidWidth=.8}removeOneStabilizer(e){var t,s=this.icn3d;s.icn3dui;for(var i=0,n=s.pairArray.length;i<n;i+=2){var r=this.getResidueRepAtom(s.pairArray[i]),a=this.getResidueRepAtom(s.pairArray[i+1]);if(null!=e)for(var l=0,o=e.length;l<o;l+=2){var d=this.getResidueRepAtom(e[l]),c=this.getResidueRepAtom(e[l+1]);if(r.serial==d.serial&&a.serial==c.serial||r.serial==c.serial&&a.serial==d.serial){t=i;break}}if(void 0!==t)break}void 0!==t&&s.pairArray.splice(t,2)}outputSelection(){var e=this.icn3d;e.icn3dui;var t={};for(var s in e.hAtoms){t[e.atoms[s].structure+"_"+e.atoms[s].chain+"_"+e.atoms[s].resi]=1}for(var i=Object.keys(t).sort((function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var s=e.lastIndexOf("_"),i=t.lastIndexOf("_");if(e.substr(0,s)<t.substr(0,s))return-1;if(e.substr(0,s)>t.substr(0,s))return 1;if(e.substr(0,s)==t.substr(0,s)){if(parseInt(e.substr(s+1))<parseInt(t.substr(i+1)))return-1;if(parseInt(e.substr(s+1))>parseInt(t.substr(i+1)))return 1;if(parseInt(e.substr(s+1))==parseInt(t.substr(i+1)))return 0}})),n="<table><tr><th>Structure</th><th>Chain</th><th>Residue Number</th></tr>",r=(s=0,i.length);s<r;++s){var a=i[s].indexOf("_"),l=i[s].lastIndexOf("_");n+="<tr><td>"+i[s].substr(0,a)+"</td><td>"+i[s].substr(a+1,l-a-1)+"</td><td>"+i[s].substr(l+1)+"</td></tr>"}var o=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(o+"_residues.txt","html",n)}addStabilizer(){var e=this.icn3d,t=e.icn3dui,s=3.5;if(Object.keys(e.dAtoms).length>0){var i={};for(var n in e.dAtoms){var r=e.atoms[n];!e.nucleotides.hasOwnProperty(r.serial)||"N1"!==r.name&&"N2"!==r.name&&"N3"!==r.name&&"N4"!==r.name&&"N6"!==r.name&&"O2"!==r.name&&"O6"!==r.name||(i[r.structure+"_"+r.chain+"_"+r.resi+"_"+r.name]=r)}var a=(H=Object.keys(i)).length;void 0===e.pairArray&&(e.pairArray=[]);for(n=0;n<a;++n)for(var l=n+1;l<a;++l){var o=H[n],d=H[l],c=Math.abs(i[o].coord.x-i[d].coord.x);if(!(c>s)){var h=Math.abs(i[o].coord.y-i[d].coord.y);if(!(h>s)){var m=Math.abs(i[o].coord.z-i[d].coord.z);if(!(m>s)){var p=c*c+h*h+m*m;p>12.25||p<10.240000000000002||(e.pairArray.push(i[o].serial),e.pairArray.push(i[d].serial))}}}}var u={};for(var n in e.dAtoms){u[v=(r=e.atoms[n]).structure+"_"+r.chain+"_"+r.resi]=1}var C={};for(var n in e.chemicals){var v=(r=e.atoms[n]).structure+"_"+r.chain+"_"+r.resi;u.hasOwnProperty(v)&&(C[v]=1)}for(var n in e.ions){v=(r=e.atoms[n]).structure+"_"+r.chain+"_"+r.resi;u.hasOwnProperty(v)&&(C[v]=1)}for(var g=Object.keys(e.chains),f=(n=0,g.length);n<f;++n){for(var b=g[n],y=0,w=0,S=(l=0,e.chainsSeq[b].length);l<S;++l)v=b+"_"+e.chainsSeq[b][l].resi,"c"!=e.secondaries[v]&&"E"!=e.secondaries[v]&&"H"!=e.secondaries[v]||(y%3!=0&&e.chainsSeq[b][l].resi==w+1||u.hasOwnProperty(v)&&(C[v]=1),++y,w=e.chainsSeq[b][l].resi);"c"!=e.secondaries[v]&&"E"!=e.secondaries[v]&&"H"!=e.secondaries[v]||u.hasOwnProperty(v)&&(C[v]=1)}var _=Object.keys(C);void 0===e.pairArray&&(e.pairArray=[]);var A=t.hashUtilsCls.exclHash(e.dAtoms,e.water);for(n=0,f=_.length;n<f;++n){v=_[n];var x=e.secondaries[v],k=e.contactCls.getNeighboringAtoms(A,t.hashUtilsCls.hash2Atoms(e.residues[v],e.atoms),6),O=Object.keys(k).sort(),H=Object.keys(e.residues[v]).sort(),R=!1;if(e.proteins.hasOwnProperty(H[0])){H=[H[0]],R=!0;var E=parseInt(v.substr(v.lastIndexOf("_")+1)),I={};for(var D in k)if(!e.chemicals.hasOwnProperty(D)&&!e.ions.hasOwnProperty(D)){r=e.atoms[D];("c"==x&&(r.resi>E+1||r.resi<E-1)||"E"==x&&(r.resi>E+2||r.resi<E-2)||"H"==x&&(r.resi>E+4||r.resi<E-4))&&(I[D]=1)}O=Object.keys(I).sort()}if(O.length>0&&H.length>0)if(R){var T=parseInt((O.length+.5)/2);e.pairArray.push(H[0]),e.pairArray.push(O[T])}else{var M=parseInt(O.length/11);for(l=0,S=H.length;l<S;++l)if(l%10==0){var P=parseInt(l/10)*M;T=P<O.length?P:O.length-1;e.pairArray.push(H[l]),e.pairArray.push(O[T]),H.length<11&&(e.pairArray.push(H[l]),e.pairArray.push(O[O.length-1]))}}}}}hideStabilizer(){var e=this.icn3d;for(var t in e.icn3dui,e.pairArray=[],e.lines.stabilizer=[],e.stabilizerpnts=[],e.water)e.atoms[t].style=e.opts.water}getResidueRepAtom(e){var t=this.icn3d;t.icn3dui;var s,i=t.atoms[e],n=i.structure+"_"+i.chain+"_"+i.resi;if(t.proteins.hasOwnProperty(e)||t.nucleotides.hasOwnProperty(e))for(var r in t.residues[n]){var a=t.atoms[r];if("CA"===a.name||"N3"===a.name){s=t.atoms[r];break}}else s=i;return void 0===s&&(s=i),s}}class D{constructor(e){this.icn3d=e}applySurfaceOptions(e){var t,s,i=this.icn3d,n=i.icn3dui;switch(void 0===e&&(e=i.opts),e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}switch(e.opacity=parseFloat(e.opacity),t=n.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),"nothing"===e.water&&(t=n.hashUtilsCls.exclHash(t,i.water)),s=n.hashUtilsCls.hash2Atoms(t,i.atoms),e.surface.toLowerCase()){case"van der waals surface":i.surfaceCls.createSurfaceRepresentation(s,1,e.wireframe,e.opacity);break;case"solvent accessible surface":i.surfaceCls.createSurfaceRepresentation(s,3,e.wireframe,e.opacity);break;case"molecular surface":i.surfaceCls.createSurfaceRepresentation(s,2,e.wireframe,e.opacity);break;case"van der waals surface with context":i.surfaceCls.createSurfaceRepresentation(s,1,e.wireframe,e.opacity);break;case"solvent accessible surface with context":i.surfaceCls.createSurfaceRepresentation(s,3,e.wireframe,e.opacity);break;case"molecular surface with context":i.surfaceCls.createSurfaceRepresentation(s,2,e.wireframe,e.opacity);break;case"nothing":this.removeSurfaces()}}applyMapOptions(e){var t,s,i=this.icn3d,n=i.icn3dui;switch(void 0===e&&(e=i.opts),e.mapwireframe){case"yes":e.mapwireframe=!0;break;case"no":e.mapwireframe=!1}switch(t=n.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=n.hashUtilsCls.hash2Atoms(t,i.atoms),e.map.toLowerCase()){case"2fofc":i.surfaceCls.createSurfaceRepresentation(s,11,e.mapwireframe);break;case"fofc":i.surfaceCls.createSurfaceRepresentation(s,12,e.mapwireframe);break;case"nothing":this.removeMaps()}}applyEmmapOptions(e){var t,s,i=this.icn3d,n=i.icn3dui;switch(void 0===e&&(e=i.opts),e.emmapwireframe){case"yes":e.emmapwireframe=!0;break;case"no":e.emmapwireframe=!1}switch(t=n.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=n.hashUtilsCls.hash2Atoms(t,i.atoms),e.emmap.toLowerCase()){case"em":i.surfaceCls.createSurfaceRepresentation(s,13,e.emmapwireframe);break;case"nothing":this.removeEmmaps()}}applyPhimapOptions(e){var t,s,i=this.icn3d,n=i.icn3dui;switch(void 0===e&&(e=i.opts),e.phimapwireframe){case"yes":e.phimapwireframe=!0;break;case"no":e.phimapwireframe=!1}switch(t=n.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),s=n.hashUtilsCls.hash2Atoms(t,i.atoms),e.phimap.toLowerCase()){case"phi":i.surfaceCls.createSurfaceRepresentation(s,14,e.phimapwireframe);break;case"nothing":this.removePhimaps()}}applyphisurfaceOptions(e){var t,s,i=this.icn3d,n=i.icn3dui;switch(void 0===e&&(e=i.opts),i.phisurfwf){case"yes":e.phisurfwf=!0;break;case"no":e.phisurfwf=!1}switch(e.phisurfop=parseFloat(i.phisurfop),t=n.hashUtilsCls.intHash(i.dAtoms,i.hAtoms),"nothing"===e.water&&(t=n.hashUtilsCls.exclHash(t,i.water)),s=n.hashUtilsCls.hash2Atoms(t,i.atoms),e.phisurface.toLowerCase()){case"phi":i.surfaceCls.createSurfaceRepresentation(s,parseInt(i.phisurftype),e.phisurfwf,e.phisurfop);break;case"nothing":this.removeSurfaces()}}removeSurfaces(){var e=this.icn3d;e.icn3dui;for(var t=0,s=e.prevSurfaces.length;t<s;++t)e.mdl.remove(e.prevSurfaces[t]);e.prevSurfaces=[]}removeLastSurface(){var e=this.icn3d;e.icn3dui,e.prevSurfaces.length>0&&(e.mdl.remove(e.prevSurfaces[e.prevSurfaces.length-1]),e.prevSurfaces.slice(e.prevSurfaces.length-1,1))}removeMaps(){var e=this.icn3d;e.icn3dui;for(var t=0,s=e.prevMaps.length;t<s;++t)e.mdl.remove(e.prevMaps[t]);e.prevMaps=[]}removeEmmaps(){var e=this.icn3d;e.icn3dui;for(var t=0,s=e.prevEmmaps.length;t<s;++t)e.mdl.remove(e.prevEmmaps[t]);e.prevEmmaps=[]}removePhimaps(){var e=this.icn3d;e.icn3dui;for(var t=0,s=e.prevPhimaps.length;t<s;++t)e.mdl.remove(e.prevPhimaps[t]);e.prevPhimaps=[]}removeLastMap(){var e=this.icn3d;e.icn3dui,e.prevMaps.length>0&&(e.mdl.remove(e.prevMaps[e.prevMaps.length-1]),e.prevMaps.slice(e.prevMaps.length-1,1))}removeLastEmmap(){var e=this.icn3d;e.icn3dui,e.prevEmmaps.length>0&&(e.mdl.remove(e.prevEmmaps[e.prevEmmaps.length-1]),e.prevEmmaps.slice(e.prevEmmaps.length-1,1))}removeLastPhimap(){var e=this.icn3d;e.icn3dui,e.prevPhimaps.length>0&&(e.mdl.remove(e.prevPhimaps[e.prevPhimaps.length-1]),e.prevPhimaps.slice(e.prevPhimaps.length-1,1))}}class T{constructor(e){this.icn3d=e}exportStlFile(e){var t=this.icn3d;t.icn3dui,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&(t.threshbox=180/Math.pow(t.biomtMatrices.length,.33),t.applyMapCls.removeSurfaces(),t.applyMapCls.applySurfaceOptions(),t.applyMapCls.removeMaps(),t.applyMapCls.applyMapOptions(),t.applyMapCls.removeEmmaps(),t.applyMapCls.applyEmmapOptions());var s=this.saveStlFile(),i=t.inputid?t.inputid:"custom";if(t.saveFileCls.saveFile(i+e+".stl","binary",s),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length>t.maxAtoms3DMultiFile){alert(t.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var n=new THREE.Matrix4;n.identity();for(var r=1,a=0;a<t.biomtMatrices.length;a++){var l=t.biomtMatrices[a];if(void 0!==l&&!l.equals(n)){var o=100*(a+1);setTimeout(function(n,r){s=this.saveStlFile(n),t.saveFileCls.saveFile(i+e+r+".stl","binary",s),s=""}.bind(this,l,r),o),++r}}t.threshbox=180}}exportVrmlFile(e){var t=this.icn3d;t.icn3dui,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&(t.threshbox=180/Math.pow(t.biomtMatrices.length,.33),t.applyMapCls.removeSurfaces(),t.applyMapCls.applySurfaceOptions(),t.applyMapCls.removeMaps(),t.applyMapCls.applyMapOptions(),t.applyMapCls.removeEmmaps(),t.applyMapCls.applyEmmapOptions());var s=this.saveVrmlFile(),i=t.inputid?t.inputid:"custom";if(t.saveFileCls.saveFile(i+e+".vrml","text",s),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length>t.maxAtoms3DMultiFile){alert(t.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var n=new THREE.Matrix4;n.identity();for(var r=1,a=0;a<t.biomtMatrices.length;a++){var l=t.biomtMatrices[a];if(void 0!==l&&!l.equals(n)){var o=100*(a+1);setTimeout(function(n,r){s=this.saveVrmlFile(n),t.saveFileCls.saveFile(i+e+r+".vrml","text",s),s=""}.bind(this,l,r),o),++r}}t.threshbox=180}}getFaceCnt(e){this.icn3d.icn3dui;for(var t=0,s=0,i=e.children.length;s<i;++s){var n=e.children[s];if("Sprite"!==n.type){var r=n.geometry.faces;if(void 0!==r)for(var a=0,l=r.length;a<l;++a)++t}}return t}saveStlFile(e){var t=this.icn3d,s=t.icn3dui;if(Object.keys(t.dAtoms).length>7e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.threeDPrintCls.prepareFor3Dprint();var i=0;i+=this.getFaceCnt(t.mdl),i+=this.getFaceCnt(t.mdl_ghost);for(var n=[],r=new Uint8Array(84),a="STL file for the structure(s) ",l=Object.keys(t.structures),o=0,d=l.length;o<d;++o)a+=l[o],o<d-1&&(a+=", ");a.length>80&&(a=a.substr(0,80));for(o=0;o<80;++o)o<a.length?r[o]=s.convertTypeCls.passInt8([a.charCodeAt(o)])[0]:r[o]=s.convertTypeCls.passInt8([" ".charCodeAt(0)])[0];if(r=void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile?this.updateArray(r,s.convertTypeCls.passInt32([i*t.biomtMatrices.length]),80):this.updateArray(r,s.convertTypeCls.passInt32([i]),80),n.push(new Blob([r],{type:"application/octet-stream"})),n=this.processStlMeshGroup(t.mdl,n,e),n=this.processStlMeshGroup(t.mdl_ghost,n,e),void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile){var c=new THREE.Matrix4;c.identity();for(o=0;o<t.biomtMatrices.length;o++){var h=t.biomtMatrices[o];void 0!==h&&(h.equals(c)||(n=this.processStlMeshGroup(t.mdl,n,h),n=this.processStlMeshGroup(t.mdl_ghost,n,h)))}}return n}updateArray(e,t,s){this.icn3d.icn3dui;for(var i=0,n=t.length;i<n;++i)e[s+i]=t[i];return e}processStlMeshGroup(e,t,s){for(var i=this.icn3d.icn3dui,n=0,r=e.children.length;n<r;++n){var a=e.children[n];if("Sprite"!==a.type){var l=a.geometry,o=l.vertices,d=l.faces;if(void 0!==d){for(var c=a.position,h=a.scale,m=a.matrix,p=new Uint8Array(50*d.length),u=0,C=0,v=d.length;C<v;++C){var g,f,b,y=d[C].a,w=d[C].b,S=d[C].c,_=d[C].normal;"SphereGeometry"==l.type||"BoxGeometry"==l.type?(g=o[y].clone().multiply(h).add(c),f=o[w].clone().multiply(h).add(c),b=o[S].clone().multiply(h).add(c)):"CylinderGeometry"==l.type?(g=o[y].clone().applyMatrix4(m),f=o[w].clone().applyMatrix4(m),b=o[S].clone().applyMatrix4(m)):(g=o[y].clone(),f=o[w].clone(),b=o[S].clone()),void 0!==_?(void 0!==s&&_.applyMatrix4(s),p=this.updateArray(p,i.convertTypeCls.passFloat32([_.x,_.y,_.z]),u),u+=12):(p=this.updateArray(p,i.convertTypeCls.passFloat32([0,0,0]),u),u+=12),void 0!==s&&(g.applyMatrix4(s),f.applyMatrix4(s),b.applyMatrix4(s)),p=this.updateArray(p,i.convertTypeCls.passFloat32([g.x,g.y,g.z]),u),u+=12,p=this.updateArray(p,i.convertTypeCls.passFloat32([f.x,f.y,f.z]),u),u+=12,p=this.updateArray(p,i.convertTypeCls.passFloat32([b.x,b.y,b.z]),u),u+=12,g=f=b=void 0,p=this.updateArray(p,i.convertTypeCls.passInt16([0]),u),u+=2}t.push(new Blob([p],{type:"application/octet-stream"})),p=null}}}return t}saveVrmlFile(e){var t=this.icn3d;if(t.icn3dui,Object.keys(t.dAtoms).length>5e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.threeDPrintCls.prepareFor3Dprint();var s=[];s.push("#VRML V2.0 utf8\n");var i=0,n=this.processVrmlMeshGroup(t.mdl,s,i,e);if(s=n.vrmlStrArray,i=n.vertexCnt,s=(n=this.processVrmlMeshGroup(t.mdl_ghost,s,i,e)).vrmlStrArray,i=n.vertexCnt,void 0!==t.biomtMatrices&&t.biomtMatrices.length>1&&t.bAssembly&&Object.keys(t.dAtoms).length*t.biomtMatrices.length<=t.maxAtoms3DMultiFile){var r=new THREE.Matrix4;r.identity();for(var a=0;a<t.biomtMatrices.length;a++){var l=t.biomtMatrices[a];void 0!==l&&(l.equals(r)||(s=(n=this.processVrmlMeshGroup(t.mdl,s,i,l)).vrmlStrArray,i=n.vertexCnt,s=(n=this.processVrmlMeshGroup(t.mdl_ghost,s,i,l)).vrmlStrArray,i=n.vertexCnt))}}return s}processVrmlMeshGroup(e,t,s,i){for(var n=this.icn3d.icn3dui,r=0,a=e.children.length;r<a;++r){var l=e.children[r];if("Sprite"!==l.type){var o=l.geometry;l.material.type;var d="Surface"==o.type,c=o.vertices;if(void 0!==c){s+=c.length;var h=o.faces,m=l.position,p=l.scale,u=l.matrix,C=n.parasCls.thr(1,1,1);"SphereGeometry"!=o.type&&"BoxGeometry"!=o.type&&"CylinderGeometry"!=o.type||void 0!==l.material&&(C=l.material.color),t.push("Shape {\n"),t.push("geometry IndexedFaceSet {\n"),t.push("coord Coordinate { point [ ");for(var v=[],g=0,f=c.length;g<f;++g){var b;b="SphereGeometry"==o.type||"BoxGeometry"==o.type?c[g].clone().multiply(p).add(m):"CylinderGeometry"==o.type?c[g].clone().applyMatrix4(u):c[g].clone(),void 0!==i&&b.applyMatrix4(i),t.push(b.x.toPrecision(5)+" "+b.y.toPrecision(5)+" "+b.z.toPrecision(5)),b=void 0,g<f-1&&t.push(", "),v.push(n.parasCls.thr(1,1,1))}t.push(" ] }\n");var y="",w="";if(d){for(g=0,f=h.length;g<f;++g){y+=(S=h[g].a)+" "+(_=h[g].b)+" "+(A=h[g].c),g<f-1&&(y+=", -1, "),v[S]=h[g].vertexColors[0],v[_]=h[g].vertexColors[1],v[A]=h[g].vertexColors[2]}for(g=0,f=v.length;g<f;++g){w+=(x=v[g]).r.toPrecision(3)+" "+x.g.toPrecision(3)+" "+x.b.toPrecision(3),g<f-1&&(w+=", ")}t.push("coordIndex [ "+y+" ]\n"),t.push("color Color { color [ "+w+" ] } colorPerVertex TRUE\n")}else{for(g=0,f=h.length;g<f;++g){var S=h[g].a,_=h[g].b,A=h[g].c;x="SphereGeometry"==o.type||"BoxGeometry"==o.type||"CylinderGeometry"==o.type?C:h[g].color,y+=S+" "+_+" "+A,g<f-1&&(y+=", -1, "),v[S]=x,v[_]=x,v[A]=x}for(g=0,f=v.length;g<f;++g){var x;w+=(x=v[g]).r.toPrecision(3)+" "+x.g.toPrecision(3)+" "+x.b.toPrecision(3),g<f-1&&(w+=", ")}t.push("coordIndex [ "+y+" ]\n"),t.push("color Color { color [ "+w+" ] } colorPerVertex TRUE\n")}t.push("  }\n"),t.push("}\n")}}}return{vrmlStrArray:t,vertexCnt:s}}}class M{constructor(e){this.icn3d=e}setProtNuclLigInMenu(){var e=this.icn3d;if(e.icn3dui,Object.keys(e.proteins).length>0&&(e.defNames2Residues.proteins=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.proteins)),e.defNames2Descr.proteins="proteins",e.defNames2Command.proteins="select :proteins"),Object.keys(e.nucleotides).length>0&&(e.defNames2Residues.nucleotides=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.nucleotides)),e.defNames2Descr.nucleotides="nucleotides",e.defNames2Command.nucleotides="select :nucleotides"),Object.keys(e.chemicals).length>0)if(e.bOpm){var t={},s={};for(var i in e.chemicals){var n=e.atoms[i],r=n.structure+"_"+n.chain+"_"+n.resi;"DUM"===n.resn?s[r]=1:t[r]=1}Object.keys(t).length>0&&(e.defNames2Residues.chemicals=Object.keys(t),e.defNames2Descr.chemicals="chemicals",e.defNames2Command.chemicals="select :chemicals"),Object.keys(s).length>0&&(e.defNames2Residues.membrane=Object.keys(s),e.defNames2Descr.membrane="membrane",e.defNames2Command.membrane="select :membrane")}else e.defNames2Residues.chemicals=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.chemicals)),e.defNames2Descr.chemicals="chemicals",e.defNames2Command.chemicals="select :chemicals";Object.keys(e.ions).length>0&&(e.defNames2Residues.ions=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.ions)),e.defNames2Descr.ions="ions",e.defNames2Command.ions="select :ions"),Object.keys(e.water).length>0&&(e.defNames2Residues.water=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.water)),e.defNames2Descr.water="water",e.defNames2Command.water="select :water"),this.setTransmemInMenu(e.halfBilayerSize,-e.halfBilayerSize)}setPredefinedInMenu(){var e=this.icn3d,t=e.icn3dui;if(this.setChainsInMenu(),this.setProtNuclLigInMenu(),void 0!==e.icn3dui.cfg.mmdbid||void 0!==e.icn3dui.cfg.gi||void 0!==e.icn3dui.cfg.chainalign)for(var s in e.tddomains)e.selectionCls.selectResidueList(e.tddomains[s],s,s,!1,!1);if((void 0!==e.icn3dui.cfg.align||void 0!==e.icn3dui.cfg.chainalign&&2==e.chainidArray.length)&&e.bFullUi){e.selectionCls.selectResidueList(e.consHash1,e.conservedName1,e.conservedName1,!1,!1),e.selectionCls.selectResidueList(e.consHash2,e.conservedName2,e.conservedName2,!1,!1),e.selectionCls.selectResidueList(e.nconsHash1,e.nonConservedName1,e.nonConservedName1,!1,!1),e.selectionCls.selectResidueList(e.nconsHash2,e.nonConservedName2,e.nonConservedName2,!1,!1),e.selectionCls.selectResidueList(e.nalignHash1,e.notAlignedName1,e.notAlignedName1,!1,!1),e.selectionCls.selectResidueList(e.nalignHash2,e.notAlignedName2,e.notAlignedName2,!1,!1);var i={};for(var n in e.alnChains)i=t.hashUtilsCls.unionHash(i,e.alnChains[n]);var r={},a={};for(var l in i){var o=e.atoms[l],d=o.structure+"_"+o.chain;r[d+"_"+o.resi]=1,a[d]=1}var c="select "+e.resid2specCls.residueids2spec(Object.keys(r));e.selectionCls.addCustomSelection(Object.keys(r),"protein_aligned","aligned protein and nucleotides",c,!0)}}setAtomMenu(e){var t=this.icn3d;t.icn3dui;var s="",i=void 0!==t.defNames2Residues?Object.keys(t.defNames2Residues):[],n=void 0!==t.defNames2Atoms?Object.keys(t.defNames2Atoms):[],r=i.concat(n).sort(),a=[];r.forEach((e=>{-1===$.inArray(e,a)&&a.push(e)}));for(var l=0,o=a.length;l<o;++l){var d,c,h=a[l];if(void 0!==t.defNames2Atoms&&t.defNames2Atoms.hasOwnProperty(h)){var m=t.defNames2Atoms[h];m.length>0&&(d=t.atoms[m[0]])}else if(void 0!==t.defNames2Residues&&t.defNames2Residues.hasOwnProperty(h)){var p=t.defNames2Residues[h];p.length>0&&(c=t.residues[p[0]])&&(d=t.atoms[Object.keys(c)[0]])}var u=void 0===d||void 0===d.color||"FFFFFF"===d.color.getHexString().toUpperCase()?"DDDDDD":d.color.getHexString(),C=void 0!==d&&void 0!==d.color?u:"000000";-1!=e.indexOf(h)?s+="<option value='"+h+"' style='color:#"+C+"' selected='selected'>"+h+"</option>":s+="<option value='"+h+"' style='color:#"+C+"'>"+h+"</option>"}return s}setChainsInMenu(){var e=this.icn3d;for(var t in e.icn3dui,e.chains)if(e.chainsSeq[t]&&e.chainsSeq[t].length>1){e.defNames2Residues[t]=Object.keys(e.firstAtomObjCls.getResiduesFromAtoms(e.chains[t])),e.defNames2Descr[t]=t;var s=t.indexOf("_"),i=t.substr(0,s),n=t.substr(s+1);e.defNames2Command[t]="select $"+i+"."+n}if(1==Object.keys(e.structures)){i=Object.keys(e.structures)[0];e.defNames2Residues[i]=Object.keys(e.residues),e.defNames2Descr[i]=i,e.defNames2Command[i]="select $"+i}else{for(var r=Object.keys(e.residues),a={},l=0,o=r.length;l<o;++l){var d=r[l];s=d.indexOf("_");void 0===a[i=d.substr(0,s)]&&(a[i]=[]),a[i].push(d)}for(var i in a)e.defNames2Residues[i]=a[i],e.defNames2Descr[i]=i,e.defNames2Command[i]="select $"+i}}setTransmemInMenu(e,t,s){var i=this.icn3d;if(i.icn3dui,i.bOpm){var n={},r={},a={};for(var l in i.atoms){var o=i.atoms[l];if("DUM"!==o.resn){var d=o.structure+"_"+o.chain+"_"+o.resi;o.coord.z>e?r[d]=1:o.coord.z<t?a[d]=1:n[d]=1}}var c=s?"2":"";Object.keys(n).length>0&&(i.defNames2Residues["transmembrane"+c]=Object.keys(n),i.defNames2Descr["transmembrane"+c]="transmembrane"+c,i.defNames2Command["transmembrane"+c]="select :transmembrane"+c),Object.keys(r).length>0&&(i.defNames2Residues["extracellular"+c]=Object.keys(r),i.defNames2Descr["extracellular"+c]="extracellular"+c,i.defNames2Command["extracellular"+c]="select :extracellular"+c),Object.keys(a).length>0&&(i.defNames2Residues["intracellular"+c]=Object.keys(a),i.defNames2Descr["intracellular"+c]="intracellular"+c,i.defNames2Command["intracellular"+c]="select :intracellular"+c)}}showSets(){var e=this.icn3d,t=e.icn3dui;e.icn3dui.bNode||(e.icn3dui.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+e.pre+"dl_setsmenu").show(),$("#"+e.pre+"dl_setoperations").show(),$("#"+e.pre+"dl_command").hide(),$("#"+e.pre+"atomsCustom").resizable());var s=t.hashUtilsCls.cloneHash(e.hAtoms),i=t.hashUtilsCls.cloneHash(e.dAtoms);void 0!==e.bSetChainsAdvancedMenu&&e.bSetChainsAdvancedMenu||(this.setPredefinedInMenu(),e.bSetChainsAdvancedMenu=!0),e.hAtoms=t.hashUtilsCls.cloneHash(s),e.dAtoms=t.hashUtilsCls.cloneHash(i),e.hlUpdateCls.updateHlMenus()}clickCustomAtoms(){var e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"atomsCustom").change((function(e){var t=s.icn3d,i=$(this).val();if(null!==i){s.changeCustomAtoms(i,!1),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select sets "+i.join(" "+t.setOperation+" "),!0),t.bSelectResidue=!1}})),t.myEventCls.onIds("#"+e.pre+"atomsCustom","focus",(function(e){var i=s.icn3d;t.utilsCls.isMobile()&&$("#"+i.pre+"atomsCustom").val("")}))}deleteSelectedSets(){var e=this.icn3d;e.icn3dui;for(var t=$("#"+e.pre+"atomsCustom").val(),s=0;s<t.length;++s){var i=t[s];(void 0!==e.defNames2Atoms&&e.defNames2Atoms.hasOwnProperty(i)||void 0!==e.defNames2Residues&&e.defNames2Residues.hasOwnProperty(i))&&(void 0!==e.defNames2Atoms&&e.defNames2Atoms.hasOwnProperty(i)&&delete e.defNames2Atoms[i],void 0!==e.defNames2Residues&&e.defNames2Residues.hasOwnProperty(i)&&delete e.defNames2Residues[i])}e.hlUpdateCls.updateHlMenus()}changeCustomAtoms(e,t){var s=this.icn3d,i=s.icn3dui;s.hAtoms={};for(var n=0;n<e.length;++n){var r=e[n];if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(r)||void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(r)){if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(r))for(var a=0,l=(h=s.defNames2Atoms[r]).length;a<l;++a)s.hAtoms[h[a]]=1;if(void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(r)){var o=s.defNames2Residues[r],d={};for(a=0,l=o.length;a<l;++a)d=i.hashUtilsCls.unionHash(d,s.residues[o[a]]);s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,d)}}}s.hlUpdateCls.updateHlAll(e,t),s.annotationCls.showAnnoSelectedChains(),$("#"+s.pre+"command").val(""),$("#"+s.pre+"command_name").val("");n=0;for(var c=e.length;n<c;++n){var h=s.defNames2Atoms[e[n]];if(s.defNames2Residues[e[n]],s.defNames2Descr[e[n]],0===n)$("#"+s.pre+"command").val("saved atoms "+e[n]),$("#"+s.pre+"command_name").val(e[n]);else{var m=$("#"+s.pre+"command").val();$("#"+s.pre+"command").val(m+" "+s.setOperation+" "+e[n]),m=$("#"+s.pre+"command_name").val(),$("#"+s.pre+"command_name").val(m+" "+s.setOperation+" "+e[n])}}}setHAtomsFromSets(e,t){for(var s=this.icn3d,i=s.icn3dui,n=0;n<e.length;++n){var r=e[n];if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(r)||void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(r)){if(void 0!==s.defNames2Atoms&&s.defNames2Atoms.hasOwnProperty(r)){var a=s.defNames2Atoms[r];if("or"===t)for(var l=0,o=a.length;l<o;++l)s.hAtoms[a[l]]=1;else if("and"===t){var d={};for(l=0,o=a.length;l<o;++l)d[a[l]]=1;s.hAtoms=i.hashUtilsCls.intHash(s.hAtoms,d)}else if("not"===t){for(d={},l=0,o=a.length;l<o;++l)d[a[l]]=1;s.hAtoms=i.hashUtilsCls.exclHash(s.hAtoms,d)}}if(void 0!==s.defNames2Residues&&s.defNames2Residues.hasOwnProperty(r)){var c=s.defNames2Residues[r];for(d={},l=0,o=c.length;l<o;++l)d=i.hashUtilsCls.unionHash(d,s.residues[c[l]]);"or"===t?s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,d):"and"===t?s.hAtoms=i.hashUtilsCls.intHash(s.hAtoms,d):"not"===t&&(s.hAtoms=i.hashUtilsCls.exclHash(s.hAtoms,d))}}}}updateAdvancedCommands(e,t){var s=this.icn3d;s.icn3dui;for(var i=" "+t+" ",n=0,r=e.length;n<r;++n)if(0===n&&"or"==t)$("#"+s.pre+"command").val("saved atoms "+e[n]),$("#"+s.pre+"command_name").val(e[n]);else{var a=$("#"+s.pre+"command").val();$("#"+s.pre+"command").val(a+i+e[n]),a=$("#"+s.pre+"command_name").val(),$("#"+s.pre+"command_name").val(a+i+e[n])}}combineSets(e,t,s,i){var n=this.icn3d,r=n.icn3dui;if(n.hAtoms={},this.setHAtomsFromSets(e,"or"),0==Object.keys(n.hAtoms).length&&(n.hAtoms=r.hashUtilsCls.cloneHash(n.atoms)),this.setHAtomsFromSets(t,"and"),this.setHAtomsFromSets(s,"not"),n.bInitial||n.hlUpdateCls.updateHlAll(),n.annotationCls.showAnnoSelectedChains(),$("#"+n.pre+"command").val(""),$("#"+n.pre+"command_name").val(""),this.updateAdvancedCommands(e,"or"),this.updateAdvancedCommands(t,"and"),this.updateAdvancedCommands(s,"not"),void 0!==i){var a="select "+$("#"+n.pre+"command").val();$("#"+n.pre+"command_name").val(i),n.selectionCls.addCustomSelection(Object.keys(n.hAtoms),i,i,a,!1)}}commandSelect(e){var t=this.icn3d;t.icn3dui;var s=$("#"+t.pre+"command"+e).val(),i=$("#"+t.pre+"command_name"+e).val().replace(/;/g,"_").replace(/\s+/g,"_");s&&(t.selByCommCls.selectByCommand(s,i,i),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+s+" | name "+i,!0))}clickCommand_apply(){var e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"command_apply","click",(function(e){s.icn3d,e.preventDefault(),s.commandSelect("")})),t.myEventCls.onIds("#"+e.pre+"command_apply2","click",(function(e){s.icn3d,e.preventDefault(),s.commandSelect("2")}))}selectCombinedSets(e,t){this.icn3d.icn3dui;for(var s=e.split(" "),i=[],n=[],r=[],a="or",l=0,o=s.length;l<o;++l)"or"!==s[l]&&"and"!==s[l]&&"not"!==s[l]?"or"===a?i.push(s[l]):"and"===a?n.push(s[l]):"not"===a&&r.push(s[l]):a=s[l];null!==s&&this.combineSets(i,n,r,t)}clickModeswitch(){var e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"modeswitch","click",(function(t){void 0!==$("#"+e.pre+"modeswitch")[0]&&$("#"+e.pre+"modeswitch")[0].checked?s.setModeAndDisplay("selection"):s.setModeAndDisplay("all")}))}setModeAndDisplay(e){var t=this.icn3d,s=t.icn3dui;"all"===e?(this.setMode("all"),t.prevHighlightAtoms=s.hashUtilsCls.cloneHash(t.hAtoms),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set mode all",!0),t.selectionCls.selectAll(),t.drawCls.draw()):(this.setMode("selection"),void 0!==t.prevHighlightAtoms?t.hAtoms=s.hashUtilsCls.cloneHash(t.prevHighlightAtoms):t.selectionCls.selectAll(),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set mode selection",!0),t.hlUpdateCls.updateHlAll())}setMode(e){var t=this.icn3d;t.icn3dui,"all"===e?($("#"+t.pre+"modeall").show(),$("#"+t.pre+"modeselection").hide(),void 0!==$("#"+t.pre+"modeswitch")[0]&&($("#"+t.pre+"modeswitch")[0].checked=!1),$("#"+t.pre+"style").hasClass("icn3d-modeselection")&&$("#"+t.pre+"style").removeClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")&&$("#"+t.pre+"color").removeClass("icn3d-modeselection")):($("#"+t.pre+"modeall").hide(),$("#"+t.pre+"modeselection").show(),void 0!==$("#"+t.pre+"modeswitch")[0]&&($("#"+t.pre+"modeswitch")[0].checked=!0),$("#"+t.pre+"style").hasClass("icn3d-modeselection")||$("#"+t.pre+"style").addClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")||$("#"+t.pre+"color").addClass("icn3d-modeselection"))}getAtomsFromOneSet(e){var t=this.icn3d,s=t.icn3dui,i={};if(void 0===t.defNames2Residues.proteins&&this.showSets(),-1!==Object.keys(t.chains).indexOf(e))i=s.hashUtilsCls.unionHash(i,t.chains[e]);else{if(void 0!==t.defNames2Residues[e]&&t.defNames2Residues[e].length>0)for(var n=0,r=t.defNames2Residues[e].length;n<r;++n){var a=t.defNames2Residues[e][n];i=s.hashUtilsCls.unionHash(i,t.residues[a])}if(void 0!==t.defNames2Atoms[e]&&t.defNames2Atoms[e].length>0)for(n=0,r=t.defNames2Atoms[e].length;n<r;++n){i[t.defNames2Atoms[e][n]]=1}}return i}getAtomsFromNameArray(e){for(var t=this.icn3d,s=t.icn3dui,i={},n=0,r=e.length;n<r;++n)if("non-selected"===e[n]){var a={};for(var n in t.atoms)!t.hAtoms.hasOwnProperty(n)&&t.dAtoms.hasOwnProperty(n)&&(a[n]=t.atoms[n]);i=s.hashUtilsCls.unionHash(i,a)}else i="selected"===e[n]?s.hashUtilsCls.unionHash(i,s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)):s.hashUtilsCls.unionHash(i,s.hashUtilsCls.hash2Atoms(this.getAtomsFromOneSet(e[n]),t.atoms));return 0==e.length&&(i=t.atoms),i}}class P{constructor(e){this.icn3d=e}isHbondDonorAcceptor(e){var t=this.icn3d;if(t.icn3dui,"N"==e.name&&!e.het||"N"==e.elem&&"Arg"==e.resn||"N"==e.elem&&"Asn"==e.resn||"N"==e.elem&&"Gln"==e.resn||"N"==e.elem&&"Lys"==e.resn||"N"==e.elem&&"Trp"==e.resn)return"donor";if("O"==e.name&&!e.het||"S"==e.elem&&"Met"==e.resn||"O"==e.elem&&"Asn"==e.resn||"O"==e.elem&&"Asp"==e.resn||"O"==e.elem&&"Gln"==e.resn||"O"==e.elem&&"Glu"==e.resn)return"acceptor";if("S"==e.elem&&"Cys"==e.resn||"N"==e.elem&&"His"==e.resn||"O"==e.elem&&"Ser"==e.resn||"O"==e.elem&&"Thr"==e.resn||"O"==e.elem&&"Tyr"==e.resn)return"both";if("Pro"==e.resn)return"none";if("N"==e.elem){if("Asn"==e.resn||"Gln"==e.resn)return"both";for(var s=0,i=0,n=0,r=e.bonds.length;n<r;++n)"H"==t.atoms[e.bonds[n]].elem&&++s;if(2==s)return"donor";s=0;for(var a=0,l=e.bonds.length;a<l;++a){var o=t.atoms[e.bonds[a]];if("H"!=o.elem){++s;for(var d=0,c=o.bonds.length;d<c;++d)"N"==t.atoms[o.bonds[d]].elem&&++i}}return 1==s?"donor":2==s?i>1?"ring":"donor":"none"}if("O"==e.elem&&1==e.bonds.length){if("Asn"==e.resn||"Gln"==e.resn)return"both";for(n=0,r=e.bonds.length;n<r;++n)if("H"==t.atoms[e.bonds[n]].elem)return"donor";var h=t.atoms[e.bonds[0]];for(s=0,n=0,r=h.bonds.length;n<r;++n)"O"!=t.atoms[h.bonds[n]].elem&&"N"!=t.atoms[h.bonds[n]].elem&&"S"!=t.atoms[h.bonds[n]].elem||++s;return s>=2?"acceptor":"both"}if("O"==e.elem&&2==e.bonds.length){for(n=0,r=e.bonds.length;n<r;++n)if("H"==t.atoms[e.bonds[n]].elem)return"donor";return"acceptor"}return"both"}calcAngles(e,t){var s=this.icn3d;s.icn3dui;var i=[],n=new THREE.Vector3,r=new THREE.Vector3;n.subVectors(t.coord,e.coord);for(var a=0,l=e.bonds.length;a<l;++a)"H"!=s.atoms[e.bonds[a]].elem&&(r.subVectors(s.atoms[e.bonds[a]].coord,e.coord),i.push(n.angleTo(r)));return i}calcPlaneAngle(e,t){var s=this.icn3d;s.icn3dui;var i=e,n=new THREE.Vector3;n.subVectors(t.coord,e.coord);for(var r=[new THREE.Vector3,new THREE.Vector3],a=0,l=0,o=e.bonds.length;l<o&&!(a>1);++l)"H"!=s.atoms[e.bonds[l]].elem&&(i=s.atoms[e.bonds[l]],r[a++].subVectors(s.atoms[e.bonds[l]].coord,e.coord));if(1===a)for(l=0,o=i.bonds.length;l<o&&!(a>1);++l)"H"!=s.atoms[i.bonds[l]].elem&&s.atoms[i.bonds[l]].serial!=e.serial&&r[a++].subVectors(s.atoms[i.bonds[l]].coord,e.coord);if(2===a){var d=r[0].cross(r[1]);return Math.abs(Math.PI/2-d.angleTo(n))}}isValidHbond(e,t,s){var i=this.icn3d;i.icn3dui;var n,r,a=this.isHbondDonorAcceptor(e),l=this.isHbondDonorAcceptor(t),o=50*Math.PI/180,d=50*Math.PI/180,c=90*Math.PI/180,h=30*Math.PI/180;if("donor"==a&&("acceptor"==l||"both"==l||"ring"==l)||"acceptor"==l&&("donor"==a||"both"==a||"ring"==a))n=e,r=t;else if("acceptor"==a&&("donor"==l||"both"==l||"ring"==l)||"donor"==l&&("acceptor"==a||"both"==a||"ring"==a))r=e,n=t;else{if("both"!=a&&"ring"!=a||"both"!=l&&"ring"!=l)return!1;n=e,r=t,i.nucleotides.hasOwnProperty(e.serial)&&i.nucleotides.hasOwnProperty(t.serial)&&("ring"==a||"ring"==l)||(e.het||t.het)&&"ring"==a&&"ring"==l||(h=90*Math.PI/180)}for(var m=this.calcAngles(n,r),p=90*Math.PI/180,u=0,C=m.length;u<C;++u)if(Math.abs(p-m[u])>d)return!1;var v=this.calcPlaneAngle(n,r);if(void 0!==v&&v>h)return!1;var g=this.calcAngles(r,n),f=90*Math.PI/180;for(u=0,C=g.length;u<C;++u)if(Math.abs(f-g[u])>o)return!1;var b=this.calcPlaneAngle(r,n);return!(void 0!==b&&b>c)}calculateChemicalHbonds(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(0!==Object.keys(e).length&&0!==Object.keys(t).length){a.resid2Residhash={};var o,d={},c=s*s;for(var h in e){var m=e[h],p=i?"LYS"===m.resn&&"N"===m.elem&&"N"!==m.name||"ARG"===m.resn&&("NH1"===m.name||"NH2"===m.name)||("GLU"===m.resn||"ASP"===m.resn)&&"O"===m.elem&&"O"!==m.name||m.het&&("N"===m.elem||"O"===m.elem||"S"===m.elem):"N"===m.elem||"O"===m.elem||"S"===m.elem&&(m.het||"Cys"===m.resn||"Met"===m.resn);(p=a.bOpm?p&&"DUM"!==m.resn:p)&&(d[(o=m.structure+"_"+m.chain+"_"+m.resi)+"_"+m.name]=m)}var u={},C={},v=.5,g=-27.888,f={};for(var h in t){m=t[h],p=i?"LYS"===m.resn&&"N"===m.elem&&"N"!==m.name||"ARG"===m.resn&&("NH1"===m.name||"NH2"===m.name)||("GLU"===m.resn||"ASP"===m.resn)&&"O"===m.elem&&"O"!==m.name||m.het&&("N"===m.elem||"O"===m.elem||"S"===m.elem):"N"===m.elem||"O"===m.elem||"S"===m.elem&&(m.het||"Cys"===m.resn||"Met"===m.resn);if(p=a.bOpm?p&&"DUM"!==m.resn:p){(o=m.structure+"_"+m.chain+"_"+m.resi)+"_"+m.name;var b=m.resn+" $"+m.structure+"."+m.chain+":"+m.resi+"@"+m.name;for(var y in void 0===a.resid2Residhash[b]&&(a.resid2Residhash[b]={}),d)if((!i||("LYS"!==m.resn&&"ARG"!==m.resn||"LYS"!==d[y].resn&&"ARG"!==d[y].resn)&&("GLU"!==m.resn&&"ASP"!==m.resn||"GLU"!==d[y].resn&&"ASP"!==d[y].resn))&&(a.crossstrucinter||m.structure==d[y].structure)&&o!=y.substr(0,y.lastIndexOf("_"))){var w=Math.abs(m.coord.x-d[y].coord.x);if(!(w>s)){var S=Math.abs(m.coord.y-d[y].coord.y);if(!(S>s)){var _=Math.abs(m.coord.z-d[y].coord.z);if(!(_>s)){var A=w*w+S*S+_*_;if(!(A>c)){if(!a.proteins.hasOwnProperty(m.serial)||!a.proteins.hasOwnProperty(d[y].serial)||"N"!==m.name&&"O"!==m.name||"O"!==d[y].name&&"N"!==d[y].name){if(!this.isValidHbond(m,d[y],s))continue}else{if(m.name===d[y].name)continue;if(m.structure==d[y].structure&&m.chain==d[y].chain&&Math.abs(m.resi-d[y].resi)<=1)continue;var x,k="N"===m.name?m:d[y],O="O"===m.name?m:d[y];if("Pro"===k.resn)continue;if(void 0===k.hcoord){if(!this.isValidHbond(m,d[y],s))continue}else{var H,R=k.hcoord,E=k.coord,I=O.structure+"_"+O.chain+"_"+O.resi;for(var D in a.residues[I])if("C"===a.atoms[D].name){H=a.atoms[D];break}var T=H.coord,M=O.coord,P=R.distanceTo(M),F=R.distanceTo(T),L=E.distanceTo(T),N=E.distanceTo(M);if(x=P<v||F<v||L<v||N<v?-9.9:g/P-g/F+g/L-g/N,"helix"==m.ss&&"helix"==d[y].ss&&x>-.5)continue}}if(!(f[m.serial]>2||f[d[y].serial]>2)){void 0===f[m.serial]?f[m.serial]=1:++f[m.serial],void 0===f[d[y].serial]?f[d[y].serial]=1:++f[d[y].serial],"graph"!==n&&(i?(a.saltbridgepnts.push({serial:m.serial,coord:m.coord}),a.saltbridgepnts.push({serial:d[y].serial,coord:d[y].coord})):(a.hbondpnts.push({serial:m.serial,coord:m.coord}),a.hbondpnts.push({serial:d[y].serial,coord:d[y].coord})));var $=d[y].structure+"_"+d[y].chain+"_"+d[y].resi;u=l.hashUtilsCls.unionHash(u,a.residues[o]),u=l.hashUtilsCls.unionHash(u,a.residues[$]),C[o]=1,C[$]=1;var U=d[y].resn+" $"+d[y].structure+"."+d[y].chain+":"+d[y].resi+"@"+d[y].name,q=o+"_"+m.resn+","+$+"_"+d[y].resn;void 0!==a.resids2interAll[q]&&void 0!==a.resids2interAll[q].ionic&&a.resids2interAll[q].ionic.hasOwnProperty(b+","+U)||(a.resid2Residhash[b][U]=A.toFixed(1),r||(void 0===a.resids2inter[q]&&(a.resids2inter[q]={}),void 0===a.resids2inter[q].hbond&&(a.resids2inter[q].hbond={}),a.resids2inter[q].hbond[b+","+U]=A.toFixed(1)),void 0===a.resids2interAll[q]&&(a.resids2interAll[q]={}),void 0===a.resids2interAll[q].hbond&&(a.resids2interAll[q].hbond={}),a.resids2interAll[q].hbond[b+","+U]=A.toFixed(1))}}}}}}}}var j=Object.keys(C);if("graph"!==n){h=0;for(var B=j.length;h<B;++h)for(var y in a.residues[j[h]])a.atoms[y].style2="stick"}return u}}setHbondsContacts(e,t){var s=this.icn3d;s.icn3dui;var i=t,n="hbond"==t?"hbonds":t;if(s.lines[i]=[],"yes"===e[n].toLowerCase()){var r,a;"hbond"==t?(a=s.hbondpnts,r="#0F0"):"saltbridge"==t?(a=s.saltbridgepnts,r="#0FF"):"contact"==t?(a=s.contactpnts,r="#222"):"halogen"==t?(a=s.halogenpnts,r="#F0F"):"pi-cation"==t?(a=s.picationpnts,r="#F00"):"pi-stacking"==t&&(a=s.pistackingpnts,r="#00F");for(var l=0,o=Math.floor(a.length/2);l<o;l++){var d={};d.position1=a[2*l].coord,d.serial1=a[2*l].serial,d.position2=a[2*l+1].coord,d.serial2=a[2*l+1].serial,d.color=r,d.dashed=!0,(void 0===d.serial1||void 0===d.serial2||s.dAtoms.hasOwnProperty(d.serial1)||s.dAtoms.hasOwnProperty(d.serial2))&&s.lines[i].push(d)}}}hideHbonds(){var e=this.icn3d;for(var t in e.icn3dui,e.opts.hbonds="no",void 0===e.lines&&(e.lines={}),e.lines.hbond=[],e.hbondpnts=[],e.atoms)e.atoms[t].style2="nothing";for(var t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(var t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class F{constructor(e){this.icn3d=e}calculateHalogenPiInteractions(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(0!==Object.keys(e).length&&0!==Object.keys(t).length){var o={},d={},c={},h={};if("halogen"==n){for(var m in e){var p=e[m];o=l.hashUtilsCls.unionHash(o,this.getHalogenDonar(p)),c=l.hashUtilsCls.unionHash(c,this.getHalogenAcceptor(p))}for(var m in t){p=t[m];h=l.hashUtilsCls.unionHash(h,this.getHalogenDonar(p)),d=l.hashUtilsCls.unionHash(d,this.getHalogenAcceptor(p))}}else if("pi-cation"==n){for(var m in a.processedRes={},e){p=e[m];o=l.hashUtilsCls.unionHash(o,this.getPi(p,!1)),c=l.hashUtilsCls.unionHash(c,this.getCation(p))}for(var m in a.processedRes={},t){p=t[m];h=l.hashUtilsCls.unionHash(h,this.getPi(p,!1)),d=l.hashUtilsCls.unionHash(d,this.getCation(p))}}else if("pi-stacking"==n){for(var m in a.processedRes={},e){p=e[m];o=l.hashUtilsCls.unionHash(o,this.getPi(p,!0))}for(var m in a.processedRes={},t){p=t[m];d=l.hashUtilsCls.unionHash(d,this.getPi(p,!0))}}var u={},C={};a.resid2Residhash={};var v=s*s;for(var m in o){var g=(A=o[m]).resn+" $"+A.structure+"."+A.chain+":"+A.resi+"@"+A.name;for(var f in void 0===a.resid2Residhash[g]&&(a.resid2Residhash[g]={}),d){var b=d[f];if((a.crossstrucinter||A.structure==b.structure)&&m.substr(0,m.lastIndexOf("_"))!=f.substr(0,f.lastIndexOf("_"))){if("pi-cation"==n&&"ARG"===b.resn&&"NH1"===b.name){var y=b.structure+"_"+b.chain+"_"+b.resi,w=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[y],"NH2"),S=b.coord.clone().add(w.coord).multiplyScalar(.5);(b=l.hashUtilsCls.cloneHash(b)).coord=S}if("pi-stacking"==n&&void 0!==A.normal&&void 0!==b.normal){var _=Math.abs(A.normal.dot(b.normal));if(_>.5&&_<.866)continue}this.getHalogenPiInteractions(A,b,i,n,s,v,g,r)&&(u=l.hashUtilsCls.unionHash(u,a.residues[A.structure+"_"+A.chain+"_"+A.resi]),u=l.hashUtilsCls.unionHash(u,a.residues[b.structure+"_"+b.chain+"_"+b.resi]),C[A.structure+"_"+A.chain+"_"+A.resi]=1,C[b.structure+"_"+b.chain+"_"+b.resi]=1)}}}for(var m in c){var A;g=(A=c[m]).resn+" $"+A.structure+"."+A.chain+":"+A.resi+"@"+A.name;if(void 0===a.resid2Residhash[g]&&(a.resid2Residhash[g]={}),"pi-cation"==n&&"ARG"===A.resn&&"NH1"===A.name){var x=A.structure+"_"+A.chain+"_"+A.resi;w=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[x],"NH2"),S=A.coord.clone().add(w.coord).multiplyScalar(.5);(A=l.hashUtilsCls.cloneHash(A)).coord=S}for(var f in h){b=h[f];if(a.crossstrucinter||A.structure==b.structure)if(m.substr(0,m.lastIndexOf("_"))!=f.substr(0,f.lastIndexOf("_")))this.getHalogenPiInteractions(A,b,i,n,s,v,g,r)&&(u=l.hashUtilsCls.unionHash(u,a.residues[A.structure+"_"+A.chain+"_"+A.resi]),u=l.hashUtilsCls.unionHash(u,a.residues[b.structure+"_"+b.chain+"_"+b.resi]),C[A.structure+"_"+A.chain+"_"+A.resi]=1,C[b.structure+"_"+b.chain+"_"+b.resi]=1)}}var k=Object.keys(C);if("graph"!==i){m=0;for(var O=k.length;m<O;++m)for(var f in a.residues[k[m]])a.atoms[f].style2="stick",a.ions.hasOwnProperty(f)&&(a.atoms[f].style2="sphere")}return u}}getHalogenDonar(e){this.icn3d.icn3dui;var t={};"CL"!==e.elem&&"BR"!==e.elem&&"I"!==e.elem||(t[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e);return t}getHalogenAcceptor(e){var t=this.icn3d;t.icn3dui;var s={},i="N"===e.elem||"O"===e.elem||"S"===e.elem;(i=t.bOpm?i&&"DUM"!==e.resn:i)&&(s[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e);return s}getPi(e,t){var s=this.icn3d,i=s.icn3dui,n={},r=e.structure+"_"+e.chain+"_"+e.resi,a=e.het||s.nucleotides.hasOwnProperty(e.serial)||"PHE"===e.resn||"TYR"===e.resn||"TRP"===e.resn;if(t&&(a=a||"HIS"===e.resn),a&&!s.processedRes.hasOwnProperty(r)){if(e.het){var l=this.getAromaticPisLigand(r);n=i.hashUtilsCls.unionHash(n,l)}else{var o=void 0,d=void 0,c=void 0;void 0!==(c=s.nucleotides.hasOwnProperty(e.serial)?this.getAromaticRings(e.resn,r,"nucleotide"):this.getAromaticRings(e.resn,r,"protein"))&&(o=c.piPosArray,d=c.normalArray);for(var h=0,m=o.length;h<m;++h)n[r+"_pi"+h]={resn:e.resn,name:"pi"+h,coord:o[h],serial:e.serial,structure:e.structure,chain:e.chain,resi:e.resi,normal:d[h]}}s.processedRes[r]=1}return n}getCation(e){var t=this.icn3d,s=t.icn3dui,i={};if("ARG"!==e.resn||"NH2"!==e.name){var n="LYS"===e.resn&&"N"===e.elem&&"N"!==e.name||"ARG"===e.resn&&("NH1"===e.name||"NH2"===e.name)||e.het&&-1!==s.parasCls.cationsTrimArray.indexOf(e.elem)||e.het&&"N"===e.elem&&1==e.bonds.length;if(n=t.bOpm?n&&"DUM"!==e.resn:n)i[e.structure+"_"+e.chain+"_"+e.resi+"_"+e.name]=e;return i}}getHalogenPiInteractions(e,t,s,i,n,r,a,l){var o=this.icn3d;o.icn3dui;var d=Math.abs(e.coord.x-t.coord.x);if(d>n)return!1;var c=Math.abs(e.coord.y-t.coord.y);if(c>n)return!1;var h=Math.abs(e.coord.z-t.coord.z);if(h>n)return!1;var m=d*d+c*c+h*h;if(m>r)return!1;"graph"!==s&&("halogen"==i?(o.halogenpnts.push({serial:e.serial,coord:e.coord}),o.halogenpnts.push({serial:t.serial,coord:t.coord})):"pi-cation"==i?(o.picationpnts.push({serial:e.serial,coord:e.coord}),o.picationpnts.push({serial:t.serial,coord:t.coord})):"pi-stacking"==i&&(o.pistackingpnts.push({serial:e.serial,coord:e.coord}),o.pistackingpnts.push({serial:t.serial,coord:t.coord})));var p=t.resn+" $"+t.structure+"."+t.chain+":"+t.resi+"@"+t.name;o.resid2Residhash[a][p]=m.toFixed(1);var u=e.structure+"_"+e.chain+"_"+e.resi+"_"+e.resn+","+t.structure+"_"+t.chain+"_"+t.resi+"_"+t.resn;return l||(void 0===o.resids2inter[u]&&(o.resids2inter[u]={}),void 0===o.resids2inter[u][i]&&(o.resids2inter[u][i]={}),o.resids2inter[u][i][a+","+p]=m.toFixed(1)),void 0===o.resids2interAll[u]&&(o.resids2interAll[u]={}),void 0===o.resids2interAll[u][i]&&(o.resids2interAll[u][i]={}),o.resids2interAll[u][i][a+","+p]=m.toFixed(1),!0}getRingNormal(e){if(this.icn3d.icn3dui,!(e.length<3)){var t=e[0].clone().sub(e[1]),s=e[1].clone().sub(e[2]);return t.cross(s).normalize()}}getAromaticRings(e,t,s){var i=this.icn3d;i.icn3dui;var n=[],r=[],a=[],l=[];if("nucleotide"==s){var o=new THREE.Vector3,d=new THREE.Vector3;if("A"==e.trim().toUpperCase()||"DA"==e.trim().toUpperCase()||"G"==e.trim().toUpperCase()||"DG"==e.trim().toUpperCase()){for(var c in i.residues[t]){"N1"==(h=i.atoms[c]).name||"C2"==h.name||"N3"==h.name||"C6"==h.name?(o.add(h.coord),a.push(h.coord)):"C4"==h.name||"C5"==h.name?(o.add(h.coord),d.add(h.coord),a.push(h.coord),l.push(h.coord)):"N7"!=h.name&&"C8"!=h.name&&"N9"!=h.name||(d.add(h.coord),l.push(h.coord))}6==a.length&&(o.multiplyScalar(1/6),n.push(o),r.push(this.getRingNormal(a))),5==l.length&&(d.multiplyScalar(.2),n.push(d),r.push(this.getRingNormal(l)))}else if("C"==e.trim().toUpperCase()||"DC"==e.trim().toUpperCase()||"T"==e.trim().toUpperCase()||"DT"==e.trim().toUpperCase()||"U"==e.trim().toUpperCase()||"DU"==e.trim().toUpperCase()){for(var c in i.residues[t]){"N1"==(h=i.atoms[c]).name||"C2"==h.name||"N3"==h.name||"C6"==h.name?(o.add(h.coord),a.push(h.coord)):"C4"!=h.name&&"C5"!=h.name||(o.add(h.coord),a.push(h.coord))}6==a.length&&(o.multiplyScalar(1/6),n.push(o),r.push(this.getRingNormal(a)))}}else if("protein"==s){o=new THREE.Vector3,d=new THREE.Vector3;if("PHE"==e.toUpperCase()||"TYR"==e.toUpperCase()){for(var c in i.residues[t]){"CG"!=(h=i.atoms[c]).name&&"CD1"!=h.name&&"CE1"!=h.name&&"CZ"!=h.name&&"CE2"!=h.name&&"CD2"!=h.name||(o.add(h.coord),a.push(h.coord))}6==a.length&&(o.multiplyScalar(1/6),n.push(o),r.push(this.getRingNormal(a)))}else if("HIS"==e.toUpperCase()){for(var c in i.residues[t]){"CG"!=(h=i.atoms[c]).name&&"ND1"!=h.name&&"CE1"!=h.name&&"NE2"!=h.name&&"CD2"!=h.name||(o.add(h.coord),a.push(h.coord))}5==a.length&&(o.multiplyScalar(.2),n.push(o),r.push(this.getRingNormal(a)))}else if("TRP"==e.toUpperCase()){for(var c in i.residues[t]){var h;"CE2"==(h=i.atoms[c]).name||"CH2"==h.name||"CZ3"==h.name||"CE3"==h.name?(o.add(h.coord),a.push(h.coord)):"CD2"==h.name||"CE2"==h.name?(o.add(h.coord),d.add(h.coord),a.push(h.coord),l.push(h.coord)):"CG"!=h.name&&"CD1"!=h.name&&"NE1"!=h.name||(d.add(h.coord),l.push(h.coord))}6==a.length&&(o.multiplyScalar(1/6),n.push(o),r.push(this.getRingNormal(a))),5==l.length&&(d.multiplyScalar(.2),n.push(d),r.push(this.getRingNormal(l)))}}return{piPosArray:n,normalArray:r}}dfs_cycle(e,t,s){var i=this.icn3d;if(i.icn3dui,2==i.ring_color[e])return s;if(1==i.ring_color[e]){s++;var n=t;for(i.ring_mark[n]=s;n!=e;)n=i.ring_par[n],i.ring_mark[n]=s;return s}if(i.ring_par[e]=t,i.ring_color[e]=1,void 0!==i.atoms[e])for(var r=0,a=i.atoms[e].bonds.length;r<a;++r){var l=i.atoms[e].bonds[r];l!=i.ring_par[e]&&(s=this.dfs_cycle(l,e,s))}return i.ring_color[e]=2,s}getAromaticPisLigand(e){var t=this.icn3d;t.icn3dui;var s={},i=Object.keys(t.residues[e]),n=i.length;t.ring_color={},t.ring_par={},t.ring_mark={};var r=0;r=this.dfs_cycle(i[1],i[0],r);for(var a={},l=0;l<n;l++){var o=i[l];0!=t.ring_mark[o]&&(void 0===a[t.ring_mark[o]]&&(a[t.ring_mark[o]]=[]),a[t.ring_mark[o]].push(o))}for(l=1;l<=r;l++){var d=new THREE.Vector3,c=0,h=[];if(a.hasOwnProperty(l))for(var m=0,p=a[l].length;m<p;++m)o=a[l][m],d.add(t.atoms[o].coord),h.push(t.atoms[o].coord),++c;if(5==c||6==c){var u=h[0].clone().sub(h[1]).normalize(),C=h[1].clone().sub(h[2]).normalize(),v=h[2].clone().sub(h[3]).normalize(),g=u.cross(C).normalize(),f=g.dot(v);if(Math.abs(f)<.017){d.multiplyScalar(1/c);var b=t.atoms[o];s[e+"_pi"+o]={resn:b.resn,name:"pi"+o,coord:d,serial:b.serial,structure:b.structure,chain:b.chain,resi:b.resi,normal:g}}}}return s}hideHalogenPi(){var e=this.icn3d;for(var t in e.icn3dui,e.opts.halogen="no",e.opts["pi-cation"]="no",e.opts["pi-stacking"]="no",void 0===e.lines&&(e.lines={}),e.lines.halogen=[],e.lines["pi-cation"]=[],e.lines["pi-stacking"]=[],e.halogenpnts=[],e.picationpnts=[],e.pistackingpnts=[],e.atoms)e.atoms[t].style2="nothing";for(var t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(var t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class L{constructor(e){this.icn3d=e}calculateIonicInteractions(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(0!==Object.keys(e).length&&0!==Object.keys(t).length){a.resid2Residhash={};var o,d,c={},h={},m=s*s;for(var p in e){if(!("ARG"===(S=e[p]).resn&&"NH2"===S.name||"GLU"===S.resn&&"OE2"===S.name||"ASP"===S.resn&&"OD2"===S.name)){var u=("LYS"===S.resn||"HIS"===S.resn)&&"N"===S.elem&&"N"!==S.name||"ARG"===S.resn&&("NH1"===S.name||"NH2"===S.name)||S.het&&-1!==l.parasCls.cationsTrimArray.indexOf(S.elem)||S.het&&"N"===S.elem&&1==S.bonds.length,C=void 0;if(S.het&&"O"===S.elem&&1==S.bonds.length)for(var v=a.atoms[S.bonds[0]],g=0;g<v.bonds.length;++g){var f=v.bonds[g];if("O"==a.atoms[f].elem&&f!=S.serial){C=!0;break}}var b="GLU"===S.resn&&("OE1"===S.name||"OE2"===S.name)||"ASP"===S.resn&&("OD1"===S.name||"OD2"===S.name)||a.nucleotides.hasOwnProperty(S.serial)&&("OP1"===S.name||"OP2"===S.name||"O1P"===S.name||"O2P"===S.name)||S.het&&-1!==l.parasCls.anionsTrimArray.indexOf(S.elem)||C;u=a.bOpm?u&&"DUM"!==S.resn:u,b=a.bOpm?b&&"DUM"!==S.resn:b,(u||b)&&(d=(o=S.structure+"_"+S.chain+"_"+S.resi)+"_"+S.name,u&&(c[d]=S),b&&(h[d]=S))}}var y={},w={};for(var p in t){var S;if(!("ARG"===(S=t[p]).resn&&"NH2"===S.name||"GLU"===S.resn&&"OE2"===S.name||"ASP"===S.resn&&"OD2"===S.name)){u=("LYS"===S.resn||"HIS"===S.resn)&&"N"===S.elem&&"N"!==S.name||"ARG"===S.resn&&("NH1"===S.name||"NH2"===S.name)||S.het&&-1!==l.parasCls.cationsTrimArray.indexOf(S.elem),b="GLU"===S.resn&&("OE1"===S.name||"OE2"===S.name)||"ASP"===S.resn&&("OD1"===S.name||"OD2"===S.name)||a.nucleotides.hasOwnProperty(S.serial)&&("OP1"===S.name||"OP2"===S.name||"O1P"===S.name||"O2P"===S.name)||S.het&&-1!==l.parasCls.anionsTrimArray.indexOf(S.elem);if(u=a.bOpm?u&&"DUM"!==S.resn:u,b=a.bOpm?b&&"DUM"!==S.resn:b,u||b){d=(o=S.structure+"_"+S.chain+"_"+S.resi)+"_"+S.name;var _=S.resn+" $"+S.structure+"."+S.chain+":"+S.resi+"@"+S.name;void 0===a.resid2Residhash[_]&&(a.resid2Residhash[_]={});var A={};u?A=h:b&&(A=c);var x=void 0,k=S.structure+"_"+S.chain+"_"+S.resi;u&&"ARG"===S.resn&&"NH1"===S.name?x=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[k],"NH2"):b&&"GLU"===S.resn&&"OE1"===S.name?x=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[k],"OE2"):b&&"ASP"===S.resn&&"OD1"===S.name&&(x=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[k],"OD2"));var O=void 0===x?S.coord:S.coord.clone().add(x.coord).multiplyScalar(.5);for(var g in A)if(o!=g.substr(0,g.lastIndexOf("_"))&&(a.crossstrucinter||S.structure==A[g].structure)){var H=void 0,R=A[g].structure+"_"+A[g].chain+"_"+A[g].resi;b&&"ARG"===A[g].resn&&"NH1"===A[g].name?H=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[R],"NH2"):u&&"GLU"===A[g].resn&&"OE1"===A[g].name?H=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[R],"OE2"):u&&"ASP"===A[g].resn&&"OD1"===A[g].name&&(H=a.firstAtomObjCls.getFirstAtomObjByName(a.residues[R],"OD2"));var E=void 0===H?A[g].coord:A[g].coord.clone().add(H.coord).multiplyScalar(.5),I=Math.abs(O.x-E.x);if(!(I>s)){var D=Math.abs(O.y-E.y);if(!(D>s)){var T=Math.abs(O.z-E.z);if(!(T>s)){var M=I*I+D*D+T*T;if(!(M>m)){"graph"!==n&&(a.saltbridgepnts.push({serial:S.serial,coord:O}),a.saltbridgepnts.push({serial:A[g].serial,coord:E}));var P=A[g].structure+"_"+A[g].chain+"_"+A[g].resi;y=l.hashUtilsCls.unionHash(y,a.residues[o]),y=l.hashUtilsCls.unionHash(y,a.residues[P]),w[o]=1,w[P]=1;var F=A[g].resn+" $"+A[g].structure+"."+A[g].chain+":"+A[g].resi+"@"+A[g].name;a.resid2Residhash[_][F]=M.toFixed(1);var L=o+"_"+S.resn+","+P+"_"+A[g].resn;r||(void 0===a.resids2inter[L]&&(a.resids2inter[L]={}),void 0===a.resids2inter[L].ionic&&(a.resids2inter[L].ionic={}),a.resids2inter[L].ionic[_+","+F]=M.toFixed(1)),void 0===a.resids2interAll[L]&&(a.resids2interAll[L]={}),void 0===a.resids2interAll[L].ionic&&(a.resids2interAll[L].ionic={}),a.resids2interAll[L].ionic[_+","+F]=M.toFixed(1)}}}}}}}}var N=Object.keys(w);if("graph"!==n){p=0;for(var $=N.length;p<$;++p)for(var g in a.residues[N[p]])a.atoms[g].style2="stick",a.ions.hasOwnProperty(g)&&(a.atoms[g].style2="sphere")}return y}}hideSaltbridge(){var e=this.icn3d;for(var t in e.icn3dui,e.opts.saltbridge="no",void 0===e.lines&&(e.lines={}),e.lines.saltbridge=[],e.saltbridgepnts=[],e.atoms)e.atoms[t].style2="nothing";for(var t in e.sidec)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style2=e.opts.sidec);for(var t in e.water)e.hAtoms.hasOwnProperty(t)&&(e.atoms[t].style=e.opts.water)}}class N{constructor(e){this.icn3d=e}getGraphData(e,t,s,i,n,r){for(var a,l,o,d=this.icn3d,c=d.icn3dui,h=this.getNodesLinksForSet(e,r,"a"),m=this.getNodesLinksForSet(t,r,"b"),p=[],u={},C=0,v=0,g=(o=h.node.concat(m.node)).length;v<g;++v){var f=o[v],b=JSON.parse(f);if(u.hasOwnProperty(b.id))p[u[b.id]].s="ab";else p.push(b),u[b.id]=C,++C}var y=[];for(v=0,g=p.length;v<g;++v){b=p[v];y.push(JSON.stringify(b))}a=y.join(", "),l=h.link.concat(m.link).join(", ");var w=c.hashUtilsCls.unionHash(c.hashUtilsCls.cloneHash(t),e),S="",_="",A="",x="",k="",O="";for(var H in 1==s.length&&1==i.length&&s[0]==i[0]||(S+=this.getHbondLinksForSet(e,r),S+=this.getHbondLinksForSet(t,r)),1==s.length&&1==i.length&&s[0]==i[0]||(_+=this.getIonicLinksForSet(e,r),_+=this.getIonicLinksForSet(t,r)),1==s.length&&1==i.length&&s[0]==i[0]||(A+=this.getHalogenPiLinksForSet(e,r),A+=this.getHalogenPiLinksForSet(t,r)),1==s.length&&1==i.length&&s[0]==i[0]||(x+=this.getContactLinksForSet(e,r),x+=this.getContactLinksForSet(t,r)),d.ssbondpnts)for(v=0,g=d.ssbondpnts[H].length;v<g;v+=2){var R=d.ssbondpnts[H][v],E=d.ssbondpnts[H][v+1],I=d.firstAtomObjCls.getFirstAtomObj(d.residues[R]),D=d.firstAtomObjCls.getFirstAtomObj(d.residues[E]);if(w.hasOwnProperty(I.serial)&&w.hasOwnProperty(D.serial)){var T=c.utilsCls.residueName2Abbr(I.resn)+I.resi;"chain"!=r&&"structure"!=r||(T+="."+I.chain),"structure"==r&&(T+="."+I.structure);var M=c.utilsCls.residueName2Abbr(D.resn)+D.resi;"chain"!=r&&"structure"!=r||(M+="."+D.chain),"structure"==r&&(M+="."+D.structure),k+=', {"source": "'+T+'", "target": "'+M+'", "v": '+d.icn3dui.htmlCls.ssbondValue+', "c": "'+d.icn3dui.htmlCls.ssbondColor+'"}'}}for(var H in d.clbondpnts)for(v=0,g=d.clbondpnts[H].length;v<g;v+=2){R=d.clbondpnts[H][v],E=d.clbondpnts[H][v+1],I=d.firstAtomObjCls.getFirstAtomObj(d.residues[R]),D=d.firstAtomObjCls.getFirstAtomObj(d.residues[E]);if(w.hasOwnProperty(I.serial)&&w.hasOwnProperty(D.serial)){T=c.utilsCls.residueName2Abbr(I.resn)+I.resi;"chain"!=r&&"structure"!=r||(T+="."+I.chain),"structure"==r&&(T+="."+I.structure);M=c.utilsCls.residueName2Abbr(D.resn)+D.resi;"chain"!=r&&"structure"!=r||(M+="."+D.chain),"structure"==r&&(M+="."+D.structure),O+=', {"source": "'+T+'", "target": "'+M+'", "v": '+d.icn3dui.htmlCls.clbondValue+', "c": "'+d.icn3dui.htmlCls.clbondColor+'"}'}}var P='{"nodes": ['+a+'], "links": [';return P+=l+n+k+O+x+S+_+A,P+="]}"}drawResNode(e,t,s,i,n,r,a,l){var o=this.icn3d;o.icn3dui;var d,c=e.r.substr(4);d=l?n-t*(s+i):n+t*(s+i),o.firstAtomObjCls.getFirstAtomObj(o.residues[c]);var h="#"+e.c.toUpperCase();o.hColor.getHexString().toUpperCase();var m=e.id.indexOf("."),p=-1==m?e.id:e.id.substr(0,m),u="a"==a?-7:10;t%2==1&&(u="a"==a?u-7:u+7);var C="<g class='icn3d-node' resid='"+c+"' >";return C+="<title>"+e.id+"</title>",l?(C+="<circle cx='"+r+"' cy='"+d+"' r='"+s+"' fill='"+h+"' stroke-width='1' stroke='"+"#000' resid='"+c+"' />",C+="<text x='"+(r-20).toString()+"' y='"+(d+2).toString()+"' fill='"+"#000' stroke='none' style='font-size:6; text-anchor:middle' >"+p+"</text>"):(C+="<circle cx='"+d+"' cy='"+r+"' r='"+s+"' fill='"+h+"' stroke-width='1' stroke='"+"#000' resid='"+c+"' />",C+="<text x='"+(d+0).toString()+"' y='"+(r+u).toString()+"' fill='"+"#000' stroke='none' style='font-size:6; text-anchor:middle' >"+p+"</text>"),C+="</g>"}getNodeTopBottom(e,t,s){this.icn3d.icn3dui;var i=this,n=[],r=[];for(var a in e){var l=t[a];l&&("a"==l.s?n.push(l):"b"==l.s?r.push(l):"ab"==l.s&&(n.push(l),r.push(l)))}return n.sort((function(e,t){return i.compNode(e,t)})),r.sort((function(e,t){return i.compNode(e,t,s)})),{nodeArray1:n,nodeArray2:r}}updateGraphJson(e,t,s,i,n){var r=this.icn3d.icn3dui,a="";return a+='"structure'+t+'": {"id": "'+e+'", "nodes1":[',a+=r.utilsCls.getJSONFromArray(s),a+='], \n"nodes2":[',a+=r.utilsCls.getJSONFromArray(i),a+='], \n"links":[',a+=r.utilsCls.getJSONFromArray(n),a+="]}"}updateGraphColor(){var e=this.icn3d,t=e.icn3dui;if(void 0!==e.graphStr){var s=JSON.parse(e.graphStr),i={};for(var n in e.residues){var r=e.firstAtomObjCls.getFirstAtomObj(e.residues[n]);i[n]=r.color.getHexString().toUpperCase()}for(var a={},l=0,o=s.nodes.length;l<o;++l){var d=s.nodes[l],c=[];c.push(""),c.push("");var h=d.r.substr(4);n=(c=c.concat(t.utilsCls.getIdArray(h)))[2]+"_"+c[3]+"_"+c[4];d.c=i[n],a[d.id]=n}for(l=0,o=s.links.length;l<o;++l){var m=s.links[l];if(m.v==e.icn3dui.htmlCls.ssValue||m.v==e.icn3dui.htmlCls.coilValue){n=a[m.target];m.c=i[n]}}e.graphStr=JSON.stringify(s)}e.bGraph&&e.icn3dui.drawGraph(e.graphStr,e.pre+"dl_graph"),e.bLinegraph&&e.lineGraphCls.drawLineGraph(e.graphStr),e.bScatterplot&&e.lineGraphCls.drawLineGraph(e.graphStr,!0)}handleForce(){var e=this.icn3d;e.icn3dui,0==e.icn3dui.htmlCls.force&&void 0!==e.simulation?(e.simulation.stop(),e.simulation.force("charge",null),e.simulation.force("x",null),e.simulation.force("y",null),e.simulation.force("r",null),e.simulation.force("link",null)):e.icn3dui.drawGraph(e.graphStr,e.pre+"dl_graph")}getNodesLinksForSet(e,t,s){var i=this.icn3d,n=i.icn3dui,r=[],a=[],l=0,o=i.icn3dui.htmlCls.coilValue,d="",c="",h=0,m={};for(var p in e){var u=i.atoms[p];if("DUM"!=u.chain&&(u.het||"CA"==u.name&&"C"==u.elem||"O3'"==u.name||"O3*"==u.name||"P"==u.name)){var C=u.structure+"_"+u.chain+"_"+u.resi;if(m.hasOwnProperty(C))continue;m[C]=1;var v=n.utilsCls.residueName2Abbr(u.resn)+u.resi;"chain"!=t&&"structure"!=t||(v+="."+u.chain),"structure"==t&&(v+="."+u.structure);var g="1_1_"+C;r.push('{"id": "'+v+'", "r": "'+g+'", "s": "'+s+'", "x": '+u.coord.x.toFixed(0)+', "y": '+u.coord.y.toFixed(0)+', "c": "'+u.color.getHexString().toUpperCase()+'"}'),l>0&&d==u.chain&&(u.resi==h+1||u.resi==h)&&(a.push('{"source": "'+c+'", "target": "'+v+'", "v": '+o+', "c": "'+u.color.getHexString().toUpperCase()+'"}'),u.ssbegin&&(o=i.icn3dui.htmlCls.ssValue),u.ssend&&(o=i.icn3dui.htmlCls.coilValue)),d=u.chain,c=v,h=u.resi,++l}}return{node:r,link:a}}getHbondLinksForSet(e,t){var s=this.icn3d,i=s.icn3dui,n={},r=parseFloat($("#"+s.pre+"hbondthreshold").val()),a=e,l=a;if(Object.keys(l).length>0&&Object.keys(a).length>0){s.hBondCls.calculateChemicalHbonds(i.hashUtilsCls.intHash2Atoms(s.dAtoms,l,s.atoms),i.hashUtilsCls.intHash2Atoms(s.dAtoms,a,s.atoms),parseFloat(r),!1,"graph",!0),n=i.hashUtilsCls.cloneHash(s.resid2Residhash)}return this.getGraphLinks(n,n,s.icn3dui.htmlCls.hbondInsideColor,t,s.icn3dui.htmlCls.hbondValuehbondInsideValue)}getIonicLinksForSet(e,t){var s=this.icn3d,i=s.icn3dui,n={},r=parseFloat($("#"+s.pre+"saltbridgethreshold").val()),a=e,l=a;if(Object.keys(l).length>0&&Object.keys(a).length>0){s.saltbridgeCls.calculateIonicInteractions(i.hashUtilsCls.intHash2Atoms(s.dAtoms,l,s.atoms),i.hashUtilsCls.intHash2Atoms(s.dAtoms,a,s.atoms),parseFloat(r),!1,"graph",!0),n=i.hashUtilsCls.cloneHash(s.resid2Residhash)}return this.getGraphLinks(n,n,s.icn3dui.htmlCls.ionicInsideColor,t,s.icn3dui.htmlCls.ionicInsideValue)}getHalogenPiLinksForSet(e,t){var s,i=this.icn3d,n=i.icn3dui,r={},a=e,l=a,o="";return s=parseFloat($("#"+i.pre+"halogenthreshold").val()),Object.keys(l).length>0&&Object.keys(a).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(n.hashUtilsCls.intHash2Atoms(i.dAtoms,a,i.atoms),n.hashUtilsCls.intHash2Atoms(i.dAtoms,l,i.atoms),parseFloat(s),"graph","halogen",!0),r=n.hashUtilsCls.cloneHash(i.resid2Residhash)),o+=this.getGraphLinks(r,r,i.icn3dui.htmlCls.halogenInsideColor,t,i.icn3dui.htmlCls.halogenInsideValue),s=parseFloat($("#"+i.pre+"picationthreshold").val()),Object.keys(l).length>0&&Object.keys(a).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(n.hashUtilsCls.intHash2Atoms(i.dAtoms,a,i.atoms),n.hashUtilsCls.intHash2Atoms(i.dAtoms,l,i.atoms),parseFloat(s),"graph","pi-cation",!0),r=n.hashUtilsCls.cloneHash(i.resid2Residhash)),o+=this.getGraphLinks(r,r,i.icn3dui.htmlCls.picationInsideColor,t,i.icn3dui.htmlCls.picationInsideValue),s=parseFloat($("#"+i.pre+"pistackingthreshold").val()),Object.keys(l).length>0&&Object.keys(a).length>0&&(i.piHalogenCls.calculateHalogenPiInteractions(n.hashUtilsCls.intHash2Atoms(i.dAtoms,a,i.atoms),n.hashUtilsCls.intHash2Atoms(i.dAtoms,l,i.atoms),parseFloat(s),"graph","pi-stacking",!0),r=n.hashUtilsCls.cloneHash(i.resid2Residhash)),o+=this.getGraphLinks(r,r,i.icn3dui.htmlCls.pistackingInsideColor,t,i.icn3dui.htmlCls.pistackingInsideValue)}getContactLinksForSet(e,t){var s=this.icn3d;s.icn3dui;var i=[],n="",r="",a={};for(var l in e){var o=s.atoms[l];o.ss==n&&o.chain==r||(Object.keys(a).length>0&&i.push(a),a={}),a[o.serial]=1,n=o.ss,r=o.chain}Object.keys(a).length>0&&i.push(a);var d=i.length,c="";for(l=0;l<d;++l)for(var h=l+1;h<d;++h)c+=this.getContactLinks(i[l],i[h],t,!0);return c}getContactLinks(e,t,s,i){var n=this.icn3d,r=n.icn3dui,a=parseFloat($("#"+n.pre+"contactthreshold").val());n.contactCls.getAtomsWithinAtom(t,e,parseFloat(a),!0,!1,i);var l=r.hashUtilsCls.cloneHash(n.resid2Residhash);return this.getGraphLinks(l,l,n.icn3dui.htmlCls.contactInsideColor,s,n.icn3dui.htmlCls.contactInsideValue)}compNode(e,t,s){var i=this.icn3d.icn3dui,n=e.r.substr(4),r=t.r.substr(4),a=i.utilsCls.getIdArray(n),l=i.utilsCls.getIdArray(r),o=a[0]+"_"+a[1],d=l[0]+"_"+l[1],c=parseInt(a[2]),h=parseInt(l[2]);return o>d?s?-1:1:o<d?s?1:-1:o==d?c>h?1:c<h?-1:0:void 0}getGraphLinks(e,t,s,i,n){var r=this.icn3d.icn3dui,a="";n=void 0===n?1:n;var l="";for(var o in e){var d=(o=o.trim()).indexOf(" "),c=o.indexOf(":"),h=o.indexOf("@"),m=-1!==h?h:o.length,p=o.indexOf("."),u=o.indexOf("$"),C=r.utilsCls.residueName2Abbr(o.substr(0,d))+o.substr(c+1,m-c-1);for(var v in"chain"!=i&&"structure"!=i||(C+="."+o.substr(p+1,c-p-1)),"structure"==i&&(C+="."+o.substr(u+1,p-u-1)),t[o]){var g=(v=v.trim()).indexOf(" "),f=v.indexOf(":"),b=v.indexOf("@"),y=-1!==b?b:v.length,w=v.indexOf("."),S=v.indexOf("$"),_=r.utilsCls.residueName2Abbr(v.substr(0,g))+v.substr(f+1,y-f-1);v.substr(w+1,f-w-1),"chain"!=i&&"structure"!=i||(_+="."+v.substr(w+1,f-w-1)),"structure"==i&&(_+="."+v.substr(S+1,w-S-1));var A=', {"source": "'+C+'", "target": "'+_+'", "v": '+n+', "c": "'+s+'"}';A!=l&&(a+=A),l=A}}return a}convertLabel2Resid(e){this.icn3d.icn3dui,e.indexOf(" ");var t=e.indexOf("@"),s=-1!==t?t:e.length,i=e.indexOf("$"),n=e.indexOf("."),r=e.indexOf(":");return e.substr(i+1,n-i-1)+"_"+e.substr(n+1,r-n-1)+"_"+e.substr(r+1,s-r-1)}}class U{constructor(e){this.icn3d=e}drawLineGraph(e,t){for(var s,i,n,r=this.icn3d,a=r.icn3dui,l=JSON.parse(e),o=[],d={},c=0,h=l.nodes.length;c<h;++c){var m=l.nodes[c];d[m.id]=m}var p={};for(c=0,h=l.links.length;c<h;++c){(R=l.links[c]).v!=r.icn3dui.htmlCls.hbondValue&&R.v!=r.icn3dui.htmlCls.ionicValue&&R.v!=r.icn3dui.htmlCls.halogenValue&&R.v!=r.icn3dui.htmlCls.picationValue&&R.v!=r.icn3dui.htmlCls.pistackingValue&&R.v!=r.icn3dui.htmlCls.contactValue||(o.push(R),p[R.source]=1,p[R.target]=1)}var u=r.getGraphCls.getNodeTopBottom(p,d);if(i=u.nodeArray1,n=u.nodeArray2,r.lineGraphStr="{\n",Object.keys(r.structures).length>1){var C,v,g,f,b,y,w=Object.keys(r.structures)[0],S=Object.keys(r.structures)[1],_=[],A=[],x=[],k={},O={},H={};for(c=0,h=o.length;c<h;++c){var R,E=d[(R=o[c]).source],I=d[R.target];if(E&&I&&E.r&&I.r){var D=[];D.push(""),D.push("");var T=E.r.substr(4);D=D.concat(a.utilsCls.getIdArray(T));var M=[];M.push(""),M.push(""),T=I.r.substr(4),M=M.concat(a.utilsCls.getIdArray(T)),D[2]==w&&M[2]==w?(_.push(R),k[R.source]=1,k[R.target]=1):D[2]==S&&M[2]==S?(A.push(R),O[R.source]=1,O[R.target]=1):(x.push(R),H[R.source]=1,H[R.target]=1)}}var P=r.getGraphCls.getNodeTopBottom(k,d);C=P.nodeArray1,v=P.nodeArray2;var F=r.getGraphCls.getNodeTopBottom(O,d);g=F.nodeArray1,f=F.nodeArray2;var L=r.getGraphCls.getNodeTopBottom(H,d,!0);b=L.nodeArray1,y=L.nodeArray2;var N=C.length,U=v.length,q=g.length,j=f.length,B=b.length,z=y.length,G=Math.max(N,U,q,j,B,z),V=[];_.length>0&&V.push(w),A.length>0&&V.push(S),x.length>0&&V.push(w+"_"+S);var W=3*(ne=1),Y=7*ne,X=10,K=10,Q=30;t?(Z=(N+2+q+2)*(W+Y)+4*K+2*Q,ae=(Math.max(U,j)+2)*(W+Y)+2*X+Q):(Z=(re=110)*V.length,ae=G*(W+Y)+2*X),t?(r.scatterplotWidth=2*ae,te=r.scatterplotWidth,ee=r.scatterplotid):(r.linegraphWidth=2*ae,te=r.linegraphWidth,ee=r.linegraphid),s=0==V.length?"No interactions found for each structure<br><br>":"2D integration graph for structure(s) <b>"+V+"</b><br><br>",s+="<svg id='"+ee+"' viewBox='0,0,"+ae+","+Z+"' width='"+te+"px'>";var J=0;_.length>0&&(t?(J-=15,s+=this.drawScatterplot_base(C,v,_,d,J),J=15,re=(N+1)*(W+Y)+2*K):s+=this.drawLineGraph_base(C,v,_,d,J),J+=re,r.lineGraphStr+=r.getGraphCls.updateGraphJson(w,1,C,v,_)),A.length>0&&(t?(s+=this.drawScatterplot_base(g,f,A,d,J),re=(q+1)*(W+Y)+2*K):s+=this.drawLineGraph_base(g,f,A,d,J),J+=re,_.length>0&&(r.lineGraphStr+=", \n"),r.lineGraphStr+=r.getGraphCls.updateGraphJson(S,2,g,f,A)),x.length>0&&!t&&(s+=this.drawLineGraph_base(b,y,x,d,J),(_.length>0||A.length>0)&&(r.lineGraphStr+=", \n"),r.lineGraphStr+='"structure1_2": {"id1": "'+w+'", "id2": "'+S+'", "nodes1":[',r.lineGraphStr+=a.utilsCls.getJSONFromArray(b),r.lineGraphStr+='], \n"nodes2":[',r.lineGraphStr+=a.utilsCls.getJSONFromArray(y),r.lineGraphStr+='], \n"links":[',r.lineGraphStr+=a.utilsCls.getJSONFromArray(x),r.lineGraphStr+="]}"),s+="</svg>"}else if(t){var Z,ee,te;w=Object.keys(r.structures)[0];Z=((se=i.length)+2)*((W=3*(ne=1))+(Y=7*ne))+2*(K=10)+(Q=30),ae=((ie=n.length)+2)*(W+Y)+2*(X=10)+Q,r.scatterplotWidth=2*ae,te=r.scatterplotWidth,ee=r.scatterplotid,s=o.length>0?"":"No interactions found for these two sets<br><br>",s+="<svg id='"+ee+"' viewBox='0,0,"+ae+","+Z+"' width='"+te+"px'>",s+=this.drawScatterplot_base(i,n,o,d,0),r.lineGraphStr+=r.getGraphCls.updateGraphJson(w,1,i,n,o),s+="</svg>"}else{var se,ie,ne,w=Object.keys(r.structures)[0],W=3*(ne=1),Y=7*ne,re=110,ae=(se=i.length)>(ie=n.length)?se*(W+Y)+20:ie*(W+Y)+20;r.linegraphWidth=2*ae,s=o.length>0?"":"No interactions found for these two sets<br><br>",s+="<svg id='"+r.linegraphid+"' viewBox='0,0,"+ae+","+re+"' width='"+r.linegraphWidth+"px'>",s+=this.drawLineGraph_base(i,n,o,d,0),r.lineGraphStr+=r.getGraphCls.updateGraphJson(w,1,i,n,o),s+="</svg>"}return r.lineGraphStr+="}\n",r.scatterplotStr=r.lineGraphStr,t?$("#"+r.pre+"scatterplotDiv").html(s):$("#"+r.pre+"linegraphDiv").html(s),s}drawLineGraph_base(e,t,s,i,n){var r=this.icn3d;r.icn3dui;var a,l,o="",d=e.length,c=t.length;d>c?(a=10,l=10*Math.abs(d-c)*.5+10):(l=10,a=10*Math.abs(d-c)*.5+10);for(var h=30+n,m=80+n,p="",u={},C={},v=0;v<d;++v)p+=r.getGraphCls.drawResNode(e[v],v,3,7,a,h,"a"),u[e[v].id]={x:a+10*v,y:h};for(v=0;v<c;++v)p+=r.getGraphCls.drawResNode(t[v],v,3,7,l,m,"b"),C[t[v].id]={x:l+10*v,y:m};v=0;for(var g=s.length;v<g;++v){var f,b,y=s[v],w=i[y.source],S=i[y.target],_=w.r.substr(4),A=S.r.substr(4),x=u[w.id],k=C[S.id];if(void 0!==x&&void 0!==k)f=y.v==r.icn3dui.htmlCls.contactValue?1:2,y.v==r.icn3dui.htmlCls.hbondValue?b="#"+r.icn3dui.htmlCls.hbondColor:y.v==r.icn3dui.htmlCls.ionicValue?b="#"+r.icn3dui.htmlCls.ionicColor:y.v==r.icn3dui.htmlCls.halogenValue?b="#"+r.icn3dui.htmlCls.halogenColor:y.v==r.icn3dui.htmlCls.picationValue?b="#"+r.icn3dui.htmlCls.picationColor:y.v==r.icn3dui.htmlCls.pistackingValue?b="#"+r.icn3dui.htmlCls.pistackingColor:y.v==r.icn3dui.htmlCls.contactValue&&(b="#"+r.icn3dui.htmlCls.contactColor),o+="<g class='icn3d-interaction' resid1='"+_+"' resid2='"+A+"' >",o+="<title>Interaction of residue "+w.id+" with residue "+S.id+"</title>",o+="<line x1='"+x.x+"' y1='"+x.y+"' x2='"+k.x+"' y2='"+k.y+"' stroke='"+b+"' stroke-width='"+f+"' /></g>"}return o+=p}drawScatterplot_base(e,t,s,i,n){var r=this.icn3d;r.icn3dui;for(var a="",l=e.length,o=t.length,d=10*(l+1)+30+40,c=n+d-60,h="",m={},p={},u=0;u<l;++u)h+=r.getGraphCls.drawResNode(e[u],u,3,7,c,40,"a",!0),m[e[u].id]={x:40,y:c-10*u};var C=n+d-50;for(u=0;u<o;++u)h+=r.getGraphCls.drawResNode(t[u],u,3,7,50,C,"b"),p[t[u].id]={x:50+10*u,y:C};u=0;for(var v=s.length;u<v;++u){var g,f,b=s[u],y=i[b.source],w=i[b.target],S=y.r.substr(4),_=w.r.substr(4),A=m[y.id],x=p[w.id];if(void 0!==A&&void 0!==x)b.v==r.icn3dui.htmlCls.hbondValue?g="#"+r.icn3dui.htmlCls.hbondColor:b.v==r.icn3dui.htmlCls.ionicValue?g="#"+r.icn3dui.htmlCls.ionicColor:b.v==r.icn3dui.htmlCls.halogenValue?g="#"+r.icn3dui.htmlCls.halogenColor:b.v==r.icn3dui.htmlCls.picationValue?g="#"+r.icn3dui.htmlCls.picationColor:b.v==r.icn3dui.htmlCls.pistackingValue?g="#"+r.icn3dui.htmlCls.pistackingColor:b.v==r.icn3dui.htmlCls.contactValue&&(g="#"+r.icn3dui.htmlCls.contactColor),f=b.v==r.icn3dui.htmlCls.contactValue?1:2,a+="<g class='icn3d-interaction' resid1='"+S+"' resid2='"+_+"' >",a+="<title>Interaction of residue "+y.id+" with residue "+w.id+"</title>",a+="<rect x='"+(x.x-2.25).toString()+"' y='"+(A.y-2.25).toString()+"' width='4.5' height='4.5' fill='"+g+"' fill-opacity='0.6' stroke-width='"+f+"' stroke='"+g+"' />",a+="</g>"}return a+=h}copyStylesInline(e,t){this.icn3d.icn3dui;for(var s=["svg","g"],i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(-1==s.indexOf(n.tagName)){var r=t.childNodes[i].currentStyle||window.getComputedStyle(t.childNodes[i]);if("undefined"!=r&&null!=r)for(var a=0;a<r.length;a++)n.style.setProperty(r[a],r.getPropertyValue(r[a]))}else this.copyStylesInline(n,t.childNodes[i])}}}class q{constructor(e){this.icn3d=e}viewInteractionPairs(e,t,s,i,n,r,a,l,o,d){var c,h=this.icn3d,m=h.icn3dui;h.bRender=!1;var p,u,C,v={},g=m.hashUtilsCls.cloneHash(h.hAtoms);p=h.definedSetsCls.getAtomsFromNameArray(e),u=h.definedSetsCls.getAtomsFromNameArray(t);var f=0,b=0;for(var y in h.structures){for(var w=0,S=h.structures[y].length;w<S;++w){var _=h.structures[y][w];for(var A in h.chains[_])if(p.hasOwnProperty(A)||u.hasOwnProperty(A)){++f;break}}++b}C=b>1?"structure":f>1?"chain":"residue";var x=[];(n&&x.push("hbonds"),r&&x.push("salt bridge"),a&&x.push("interactions"),l&&x.push("halogen"),o&&x.push("pi-cation"),d&&x.push("pi-stacking"),s||(h.resids2inter={},h.resids2interAll={}),r)&&((k=parseFloat($("#"+h.pre+"saltbridgethreshold").val()))&&!isNaN(k)||(k=h.tsIonic),s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.showIonicInteractions(k,e,t,s,!0,i)),v=m.hashUtilsCls.unionHash(v,h.hAtoms));n&&((k=parseFloat($("#"+h.pre+"hbondthreshold").val()))&&!isNaN(k)||(k=h.tsHbond),s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.showHbonds(k,e,t,s,void 0,i)),v=m.hashUtilsCls.unionHash(v,h.hAtoms));var k,O,H,R="";(n&&(R+=this.exportHbondPairs(i,C)),r&&(R+=this.exportSaltbridgePairs(i,C)),l)&&((k=parseFloat($("#"+h.pre+"halogenthreshold").val()))&&!isNaN(k)||(k=h.tsHalogen),s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.showHalogenPi(k,e,t,s,i,"halogen")),v=m.hashUtilsCls.unionHash(v,h.hAtoms),R+=this.exportHalogenPiPairs(i,C,"halogen"));o&&((k=parseFloat($("#"+h.pre+"picationthreshold").val()))&&!isNaN(k)||(k=h.tsPication),s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.showHalogenPi(k,e,t,s,i,"pi-cation")),v=m.hashUtilsCls.unionHash(v,h.hAtoms),R+=this.exportHalogenPiPairs(i,C,"pi-cation"));d&&((k=parseFloat($("#"+h.pre+"pistackingthreshold").val()))&&!isNaN(k)||(k=h.tsPistacking),s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.showHalogenPi(k,e,t,s,i,"pi-stacking")),v=m.hashUtilsCls.unionHash(v,h.hAtoms),R+=this.exportHalogenPiPairs(i,C,"pi-stacking"));if(a)if((k=parseFloat($("#"+h.pre+"contactthreshold").val()))&&!isNaN(k)||(k=h.tsContact),1!=e.length||1!=t.length||e[0]!=t[0])s||(h.hAtoms=m.hashUtilsCls.cloneHash(g),h.showInterCls.pickCustomSphere(k,e,t,s,!0,i)),v=m.hashUtilsCls.unionHash(v,h.hAtoms),R+=this.exportSpherePairs(!0,i,C);else{if(!s){var E=[],I="",D="",T={};for(var w in p){var M=h.atoms[w];M.ss==I&&M.chain==D||(Object.keys(T).length>0&&E.push(T),T={}),T[M.serial]=1,I=M.ss,D=M.chain}Object.keys(T).length>0&&E.push(T);var P=E.length;H="interactions "+k+" | sets "+e+" "+t+" | true",h.opts.contact="yes";var F={},L={};for(w=0;w<P;++w)for(var N=w+1;N<P;++N){h.hAtoms=m.hashUtilsCls.cloneHash(g);var U=h.showInterCls.pickCustomSphere_base(k,E[w],E[N],s,!0,i,H,!0);for(var q in F=m.hashUtilsCls.unionHash(F,U.residues),U.resid2Residhash)L[q]=m.hashUtilsCls.unionHash(L[q],U.resid2Residhash[q])}h.resid2ResidhashInteractions=L;var j,B,z=Object.keys(F);h.hAtoms={};for(var G=0,V=z.length;G<V;++G){var W=z[G];for(var w in h.residues[W])h.hAtoms[w]=1}var Y=h.firstAtomObjCls.getFirstAtomObj(F);void 0!==Y&&(j="sphere."+Y.chain+":"+m.utilsCls.residueName2Abbr(Y.resn.substr(0,3)).trim()+Y.resi+"-"+radius+"A",a&&(j="interactions."+Y.chain+":"+m.utilsCls.residueName2Abbr(Y.resn.substr(0,3)).trim()+Y.resi+"-"+$("#"+h.pre+"contactthreshold").val()+"A"),B=j,h.selectionCls.addCustomSelection(z,j,B,H,!0)),h.selectionCls.saveSelectionIfSelected(),h.drawCls.draw()}v=m.hashUtilsCls.unionHash(v,h.hAtoms),R+=this.exportSpherePairs(!0,i,C)}h.hAtoms=m.hashUtilsCls.cloneHash(v),h.bRender=!0,h.drawCls.draw(),O=h.firstAtomObjCls.getResiduesFromAtoms(v),H="select "+h.resid2specCls.residueids2spec(Object.keys(O)),B=j="interface_all",h.selectionCls.addCustomSelection(Object.keys(O),j,B,H,!0);var X=m.hashUtilsCls.intHash(v,p);O=h.firstAtomObjCls.getResiduesFromAtoms(X),H="select "+h.resid2specCls.residueids2spec(Object.keys(O)),B=j="interface_1",h.selectionCls.addCustomSelection(Object.keys(O),j,B,H,!0);var K=m.hashUtilsCls.intHash(v,u);O=h.firstAtomObjCls.getResiduesFromAtoms(K),H="select "+h.resid2specCls.residueids2spec(Object.keys(O)),B=j="interface_2",h.selectionCls.addCustomSelection(Object.keys(O),j,B,H,!0);var Q='<div style="text-align:center"><b>'+x.join(", ")+" between Two Sets:</b><br>",J=h.resid2specCls.atoms2residues(Object.keys(p)),Z=h.resid2specCls.atoms2residues(Object.keys(u)),ee="select "+h.resid2specCls.residueids2spec(J),te="select "+h.resid2specCls.residueids2spec(Z);Q+="Set 1: "+e+' <button class="'+h.pre+'selset" cmd="'+ee+'">Highlight in 3D</button><br>',Q+="Set 2: "+t+' <button class="'+h.pre+'selset" cmd="'+te+'">Highlight in 3D</button><br><br></div>',Q+='<div style="text-align:center"><b>The interfaces are:</b><br>';var se=h.resid2specCls.atoms2residues(Object.keys(X)),ie=h.resid2specCls.atoms2residues(Object.keys(K)),ne="select "+h.resid2specCls.residueids2spec(se),re="select "+h.resid2specCls.residueids2spec(ie);Q+='interface_1 <button class="'+h.pre+'selset" cmd="'+ne+'">Highlight in 3D</button><br>',Q+='interface_2 <button class="'+h.pre+'selset" cmd="'+re+'">Highlight in 3D</button><br><br></div>';var ae=Q+='<div><b>Note</b>: Each checkbox below selects the corresponding residue. You can click "Save Selection" in the "Select" menu to save the selection and click on "Highlight" button to clear the checkboxes.</div><br>';if("graph"!=i&&"linegraph"!=i&&"scatterplot"!=i||(Q=""),Q+=R,"save1"==i||"save2"==i){Q=ae;var le="";"save1"==i?le="Set 1":"save2"==i&&(le="Set 2"),Q+='<div style="text-align:center"><br><b>Interactions Sorted on '+le+'</b>: <button class="'+h.pre+'showintercntonly" style="margin-left:20px">Show Count Only</button><button class="'+h.pre+'showinterdetails" style="margin-left:20px">Show Details</button></div>',Q+=this.getAllInteractionTable(i).html,c=this.getAllInteractionTable(i).bondCnt,$("#"+h.pre+"dl_interactionsorted").html(Q),h.icn3dui.htmlCls.dialogCls.openDlg("dl_interactionsorted","Show sorted interactions")}else if("view"==i)$("#"+h.pre+"dl_allinteraction").html(Q),h.icn3dui.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions");else if("linegraph"==i){h.icn3dui.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"),h.graphStr=h.getGraphCls.getGraphData(p,u,e,t,Q,C),h.bLinegraph=!0;var oe=h.lineGraphCls.drawLineGraph(h.graphStr);$("#"+h.pre+"linegraphDiv").html(oe)}else if("scatterplot"==i){h.icn3dui.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as scatterplot"),h.graphStr=h.getGraphCls.getGraphData(p,u,e,t,Q,C),h.bScatterplot=!0;oe=h.lineGraphCls.drawLineGraph(h.graphStr,!0);$("#"+h.pre+"scatterplotDiv").html(oe)}else if("graph"==i)if(h.graphStr=h.getGraphCls.getGraphData(p,u,e,t,Q,C),h.bGraph=!0,Object.keys(u).length+Object.keys(p).length>Object.keys(h.dAtoms).length&&(h.graphStr=h.getGraphCls.getGraphDataForDisplayed()),void 0===h.bD3){$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/icn3d/script/d3v4-force-all.min.js",dataType:"script",cache:!0,tryCount:0,retryLimit:1,success:function(e){h.bD3=!0,$("#"+h.icn3dui.svgid).empty(),h.icn3dui.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),h.drawGraphCls.drawGraph(h.graphStr,h.pre+"dl_graph"),void 0!==h.deferredGraphinteraction&&h.deferredGraphinteraction.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==h.deferredGraphinteraction&&h.deferredGraphinteraction.resolve()}})}else $("#"+h.icn3dui.svgid).empty(),h.icn3dui.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),h.drawGraphCls.drawGraph(h.graphStr,h.pre+"dl_graph");return{interactionTypes:x.toString(),bondCnt:c}}clearInteractions(){var e=this.icn3d;e.icn3dui,e.lines.hbond=[],e.hbondpnts=[],e.lines.saltbridge=[],e.saltbridgepnts=[],e.lines.contact=[],e.contactpnts=[],e.lines.halogen=[],e.lines["pi-cation"]=[],e.lines["pi-stacking"]=[],e.halogenpnts=[],e.picationpnts=[],e.pistackingpnts=[]}resetInteractionPairs(){var e=this.icn3d;e.icn3dui,e.bHbondCalc=!1,e.showInterCls.hideHbondsContacts(),e.hlUpdateCls.clearHighlight(),e.resids2inter={},e.resids2interAll={}}retrieveInteractionData(){var e=this.icn3d;if(e.icn3dui,!e.b2DShown)if(void 0!==e.icn3dui.cfg.align){var t=Object.keys(e.structures);e.ParserUtilsCls.set2DDiagramsForAlign(t[0].toUpperCase(),t[1].toUpperCase())}else if(void 0!==e.icn3dui.cfg.chainalign){t=Object.keys(e.structures);e.ParserUtilsCls.set2DDiagramsForChainalign(e.chainidArray)}else e.ParserUtilsCls.download2Ddgm(e.inputid.toUpperCase())}getAllInteractionTable(e){var t=this.icn3d,s=t.icn3dui,i=[],n=Object.keys(t.resids2inter);("save1"==e||"save2"==e)&&n.sort((function(t,i){return s.utilsCls.compResid(t,i,e)}));for(var r="",a="",l="",o="",d="",c="",h="",m="",p="",u=0,C=0,v=0,g=0,f=0,b=0,y=0,w=n.length;y<w;++y){var S=n[y],_=S.split(","),A="save1"==e?_[0]:_[1];"save1"==e?_[1]:_[0];var x,k,O=A.split("_");y>0&&A!=a&&(i.push({cntHbond:u,cntIonic:C,cntContact:v,cntHalegen:g,cntPication:f,cntPistacking:b}),r+=this.getInteractionPerResidue(l,o,d,c,h,m,p,u,C,v,g,f,b),o="",d="",c="",h="",m="",p="",u=0,C=0,v=0,g=0,f=0,b=0),x=t.resids2inter[S].hbond,o+=(k=this.getInteractionPairDetails(x,e,"hbond")).html,u+=k.cnt,x=t.resids2inter[S].ionic,d+=(k=this.getInteractionPairDetails(x,e,"ionic")).html,C+=k.cnt,x=t.resids2inter[S].contact,c+=(k=this.getContactPairDetails(x,e,"contact")).html,v+=k.cnt,x=t.resids2inter[S].halogen,h+=(k=this.getInteractionPairDetails(x,e,"halogen")).html,g+=k.cnt,x=t.resids2inter[S]["pi-cation"],m+=(k=this.getInteractionPairDetails(x,e,"pi-cation")).html,f+=k.cnt,x=t.resids2inter[S]["pi-stacking"],p+=(k=this.getInteractionPairDetails(x,e,"pi-stacking")).html,b+=k.cnt,a=A,l=O}i.push({cntHbond:u,cntIonic:C,cntContact:v,cntHalegen:g,cntPication:f,cntPistacking:b}),r+=this.getInteractionPerResidue(l,o,d,c,h,m,p,u,C,v,g,f,b);var H="";if(n.length>0){H+='<br><table class="icn3d-sticky" align=center border=1 cellpadding=10 cellspacing=0><thead>',H+="<tr><th rowspan=2>Residue</th><th rowspan=2># Hydrogen<br>Bond</th><th rowspan=2># Salt Bridge<br>/Ionic Interaction</th><th rowspan=2># Contact</th>",H+="<th rowspan=2># Halogen<br>Bond</th><th rowspan=2># &pi;-Cation</th><th rowspan=2># &pi;-Stacking</th>",H+="<th>Hydrogen Bond</th><th>Salt Bridge/Ionic Interaction</th><th>Contact</th>",H+="<th>Halogen Bond</th><th>&pi;-Cation</th><th>&pi;-Stacking</th></tr>",H+="<tr>";var R='<td><table width="100%" class="icn3d-border"><tr><td>Atom1</td><td>Atom2</td><td>Distance(&#8491;)</td><td>Highlight in 3D</td></tr></table></td>';H+=R,H+=R,H+='<td><table width="100%" class="icn3d-border"><tr><td>Atom1</td><td>Atom2</td><td># Contacts</td><td>Min Distance(&#8491;)</td><td>C-alpha Distance(&#8491;)</td><td>Highlight in 3D</td></tr></table></td>',H+=R,H+=R,H+=R,H+="</tr>",H+="</thead><tbody>",H+=r,H+="</tbody></table><br/>"}return{html:H,bondCnt:i}}getInteractionPerResidue(e,t,s,i,n,r,a,l,o,d,c,h,m){this.icn3d.icn3dui;var p="";p+='<tr align="center"><th>'+e[3]+e[2]+"</th><td>"+l+"</td><td>"+o+"</td><td>"+d+"</td><td>"+c+"</td><td>"+h+"</td><td>"+m+"</td>";var u=[t,s,i,n,r,a];for(var C in u){p+='<td valign="top"><table width="100%" class="icn3d-border">'+u[C]+"</table></td>"}return p+="</tr>"}getInteractionPairDetails(e,t,s){var i=this.icn3d;i.icn3dui;var n="",r=0,a=' <span style="background-color:#',l='">&nbsp;&nbsp;&nbsp;</span>';if(void 0!==e)for(var o in e){var d=o.split(","),c="save1"==t?d[0]:d[1],h="save1"==t?d[1]:d[0],m=i.getGraphCls.convertLabel2Resid(c),p=i.firstAtomObjCls.getFirstAtomObj(i.residues[m]),u=p.color?p.color.getHexString():"",C=i.getGraphCls.convertLabel2Resid(h),v=i.firstAtomObjCls.getFirstAtomObj(i.residues[C]),g=v.color?v.color.getHexString():"",f=Math.sqrt(e[o]).toFixed(1);n+='<tr><td><span style="white-space:nowrap"><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"2_"+r+'a" resid="'+c+'"/> '+c+a+u+l+'</span></td><td><span style="white-space:nowrap"><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"2_"+r+'b" resid="'+h+'"/> '+h+a+g+l+'</span></td><td align="center">'+f+"</td>",n+='<td align="center"><button class="'+i.pre+'selres" resid="'+c+"|"+h+'">Highlight</button></td>',n+="</tr>",++r}return{html:n,cnt:r}}getContactPairDetails(e,t){var s=this.icn3d;s.icn3dui;var i="",n=0,r=' <span style="background-color:#',a='">&nbsp;&nbsp;&nbsp;</span>';if(void 0!==e)for(var l in e){var o=l.split(","),d="save1"==t?o[0]:o[1],c="save1"==t?o[1]:o[0],h=s.getGraphCls.convertLabel2Resid(d),m=s.firstAtomObjCls.getFirstAtomObj(s.residues[h]),p=m.color?m.color.getHexString():"",u=s.getGraphCls.convertLabel2Resid(c),C=s.firstAtomObjCls.getFirstAtomObj(s.residues[u]),v=C.color?C.color.getHexString():"",g=e[l].split("_"),f=g[0],b=g[1],y=g[2],w=g[3],S=g[4];i+='<tr><td><span style="white-space:nowrap"><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"inter2_"+n+'a" resid="'+d+'"/> '+d+"@"+y+r+p+a+'</span></td><td><span style="white-space:nowrap"><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"inter2_"+n+'b" resid="'+c+'"/> '+c+"@"+w+r+v+a+'</span></td><td align="center">'+S+'</td><td align="center">'+f+'</td><td align="center">'+b+"</td>",i+='<td align="center"><button class="'+s.pre+'selres" resid="'+d+"|"+c+'">Highlight</button></td>',i+="</tr>",n+=parseInt(S)}return{html:i,cnt:n}}exportInteractions(){var e=this.icn3d;e.icn3dui;var t='<html><body><div style="text-align:center"><br><b>Interacting residues</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Base Chain: Residues</th><th>Interacting Chain</th></tr>';for(var s in e.chainname2residues)for(var i in e.chainname2residues[s]){var n=s.substr(0,s.indexOf("_"))+"_"+i.substr(0,i.indexOf(" "));t+="<tr><td>"+s+": ",t+=e.resid2specCls.residueids2spec(e.chainname2residues[s][i]),t+="</td><td>"+n+"</td></tr>"}t+="</table><br/></div></body></html>";var r=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(r+"_interactions.html","html",t)}exportSsbondPairs(){var e=this.icn3d;e.icn3dui;var t="",s=0;for(var i in e.structures){var n=e.ssbondpnts[i];if(void 0===n)break;for(var r=0,a=n.length;r<a;r+=2){t+="<tr><td>"+n[r]+" Cys</td><td>"+n[r+1]+" Cys</td></tr>",++s}}var l='<html><body><div style="text-align:center"><br><b>'+s+" disulfide pairs</b>:<br><br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue ID 1</th><th>Residue ID 2</th></tr>";l+=t,l+="</table><br/></div></body></html>";var o=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(o+"_disulfide_pairs.html","html",l)}exportClbondPairs(){var e=this.icn3d;e.icn3dui;var t="",s=0,i={};for(var n in e.structures){var r=e.clbondpnts[n];if(void 0===r)break;for(var a=0,l=r.length;a<l;a+=2){var o=r[a],d=r[a+1];if(!i.hasOwnProperty(o+"_"+d)){var c=e.firstAtomObjCls.getFirstAtomObj(e.residues[o]),h=e.firstAtomObjCls.getFirstAtomObj(e.residues[d]);t+="<tr><td>"+o+" "+c.resn+"</td><td>"+d+" "+h.resn+"</td></tr>",++s}i[o+"_"+d]=1,i[d+"_"+o]=1}}var m='<html><body><div style="text-align:center"><br><b>'+s+" cross-linkage pairs</b>:<br><br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue ID 1</th><th>Residue ID 2</th></tr>";m+=t,m+="</table><br/></div></body></html>";var p=e.inputid?e.inputid:"custom";e.saveFileCls.saveFile(p+"_crosslinkage_pairs.html","html",m)}exportHbondPairs(e,t){var s=this.icn3d;s.icn3dui;var i="",n=0,r=' <span style="background-color:#',a='">&nbsp;&nbsp;&nbsp;</span>';for(var l in s.resid2ResidhashHbond){var o=s.getGraphCls.convertLabel2Resid(l),d=s.firstAtomObjCls.getFirstAtomObj(s.residues[o]),c=d.color?d.color.getHexString():"";for(var h in s.resid2ResidhashHbond[l]){var m=s.getGraphCls.convertLabel2Resid(h),p=s.firstAtomObjCls.getFirstAtomObj(s.residues[m]),u=p.color?p.color.getHexString():"",C=Math.sqrt(s.resid2ResidhashHbond[l][h]).toFixed(1);i+='<tr><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"hbond_"+n+'a" resid="'+l+'"/> '+l+r+c+a+'</td><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"hbond_"+n+'b" resid="'+h+'"/> '+h+r+u+a+'</td><td align="center">'+C+"</td>","view"==e&&(i+='<td align="center"><button class="'+s.pre+'selres" resid="'+l+"|"+h+'">Highlight</button></td>'),i+="</tr>",++n}}var v='<div style="text-align:center"><br><b>'+n+" hydrogen bond pairs</b>:</div><br>";return n>0&&(v+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(v+='<th align="center">Highlight in 3D</th>'),v+="</tr>",v+=i,v+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e?s.getGraphCls.getGraphLinks(s.resid2ResidhashHbond,s.resid2ResidhashHbond,s.icn3dui.htmlCls.hbondColor,t,s.icn3dui.htmlCls.hbondValue):v}exportSaltbridgePairs(e,t){var s=this.icn3d;s.icn3dui;var i="",n=0,r=' <span style="background-color:#',a='">&nbsp;&nbsp;&nbsp;</span>';for(var l in s.resid2ResidhashSaltbridge){var o=s.getGraphCls.convertLabel2Resid(l),d=s.firstAtomObjCls.getFirstAtomObj(s.residues[o]),c=d.color?d.color.getHexString():"";for(var h in s.resid2ResidhashSaltbridge[l]){var m=s.getGraphCls.convertLabel2Resid(h),p=s.firstAtomObjCls.getFirstAtomObj(s.residues[m]),u=p.color?p.color.getHexString():"",C=Math.sqrt(s.resid2ResidhashSaltbridge[l][h]).toFixed(1);i+='<tr><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"saltb_"+n+'a" resid="'+l+'"/> '+l+r+c+a+'</td><td><input type="checkbox" class="'+s.pre+'seloneres" id="'+s.pre+"saltb_"+n+'b" resid="'+h+'"/> '+h+r+u+a+'</td><td align="center">'+C+"</td>","view"==e&&(i+='<td align="center"><button class="'+s.pre+'selres" resid="'+l+"|"+h+'">Highlight</button></td>'),i+="</tr>",++n}}var v='<div style="text-align:center"><br><b>'+n+" salt bridge/ionic interaction pairs</b>:</div><br>";return n>0&&(v+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(v+='<th align="center">Highlight in 3D</th>'),v+="</tr>",v+=i,v+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e?s.getGraphCls.getGraphLinks(s.resid2ResidhashSaltbridge,s.resid2ResidhashSaltbridge,s.icn3dui.htmlCls.ionicColor,t,s.icn3dui.htmlCls.ionicValue):v}exportHalogenPiPairs(e,t,s){var i=this.icn3d;i.icn3dui;var n,r,a,l="",o=0,d=' <span style="background-color:#',c='">&nbsp;&nbsp;&nbsp;</span>';for(var h in"halogen"==s?(n=i.resid2ResidhashHalogen,r=i.icn3dui.htmlCls.halogenColor,a=i.icn3dui.htmlCls.halogenValue):"pi-cation"==s?(n=i.resid2ResidhashPication,r=i.icn3dui.htmlCls.picationColor,a=i.icn3dui.htmlCls.picationValue):"pi-stacking"==s&&(n=i.resid2ResidhashPistacking,r=i.icn3dui.htmlCls.pistackingColor,a=i.icn3dui.htmlCls.pistackingValue),n){var m=i.getGraphCls.convertLabel2Resid(h),p=i.firstAtomObjCls.getFirstAtomObj(i.residues[m]),u=p.color?p.color.getHexString():"";for(var C in n[h]){var v=i.getGraphCls.convertLabel2Resid(C),g=i.firstAtomObjCls.getFirstAtomObj(i.residues[v]),f=g.color?g.color.getHexString():"",b=Math.sqrt(n[h][C]).toFixed(1);l+='<tr><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"_"+o+'a" resid="'+h+'"/> '+h+d+u+c+'</td><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+s+"_"+o+'b" resid="'+C+'"/> '+C+d+f+c+'</td><td align="center">'+b+"</td>","view"==e&&(l+='<td align="center"><button class="'+i.pre+'selres" resid="'+h+"|"+C+'">Highlight</button></td>'),l+="</tr>",++o}}var y='<div style="text-align:center"><br><b>'+o+" "+s+" pairs</b>:</div><br>";return o>0&&(y+="<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Atom 1</th><th>Atom 2</th><th>Distance(&#8491;)</th>","view"==e&&(y+='<th align="center">Highlight in 3D</th>'),y+="</tr>",y+=l,y+="</table><br/>"),"graph"==e||"linegraph"==e||"scatterplot"==e?i.getGraphCls.getGraphLinks(n,n,r,t,a):y}exportSpherePairs(e,t,s){var i=this.icn3d;i.icn3dui;var n="",r=0,a=e?i.resid2ResidhashInteractions:i.resid2ResidhashSphere,l=' <span style="background-color:#',o='">&nbsp;&nbsp;&nbsp;</span>';for(var d in a){var c=i.getGraphCls.convertLabel2Resid(d),h=i.firstAtomObjCls.getFirstAtomObj(i.residues[c]),m=h.color?h.color.getHexString():"";for(var p in a[d]){var u=i.getGraphCls.convertLabel2Resid(p),C=i.firstAtomObjCls.getFirstAtomObj(i.residues[u]),v=C.color?C.color.getHexString():"",g=a[d][p].split("_"),f=g[0],b=g[1];h=g[2],C=g[3];var y=g[4];e?(n+='<tr><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+"inter_"+r+'a" resid="'+d+'"/> '+d+"@"+h+l+m+o+'</td><td><input type="checkbox" class="'+i.pre+'seloneres" id="'+i.pre+"inter_"+r+'b" resid="'+p+'"/> '+p+"@"+C+l+v+o+'</td><td align="center">'+y+'</td><td align="center">'+f+'</td><td align="center">'+b+"</td>","view"==t&&(n+='<td align="center"><button class="'+i.pre+'selres" resid="'+d+"|"+p+'">Highlight</button></td>'),n+="</tr>"):n+="<tr><td>"+d+"</td><td>"+p+'</td><td align="center">'+y+'</td><td align="center">'+f+'</td><td align="center">'+b+"</td></tr>",++r}}var w='<div style="text-align:center"><br><b>'+r+" residue pairs in "+(e?"the contacts":"sphere")+"</b>:</div><br>";return r>0&&(e?(w+='<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue 1</th><th>Residue 2</th><th align="center">Num Contacts</th><th align="center">Min Distance(&#8491;)</th><th align="center">C-alpha Distance(&#8491;)</th>',"view"==t&&(w+='<th align="center">Highlight in 3D</th>'),w+="</tr>"):w+='<br><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Residue 1</th><th>Residue 2</th><th align="center">Num Contacts</th><th align="center">Min Distance(&#8491;)</th><th align="center">C-alpha Distance(&#8491;)</th></tr>',w+=n,w+="</table><br/>"),"graph"==t||"linegraph"==t||"scatterplot"==t?i.getGraphCls.getGraphLinks(a,a,i.icn3dui.htmlCls.contactColor,s,i.icn3dui.htmlCls.contactValue):w}}class j{constructor(e){this.icn3d=e}showInteractions(e){var t=this.icn3d;t.icn3dui;var s=$("#"+t.pre+"atomsCustomHbond").val(),i=$("#"+t.pre+"atomsCustomHbond2").val();if(0==i.length)alert("Please select the first set");else{t.definedSetsCls.setMode("selection");var n=$("#"+t.pre+"analysis_hbond")[0].checked,r=$("#"+t.pre+"analysis_saltbridge")[0].checked,a=$("#"+t.pre+"analysis_contact")[0].checked,l=$("#"+t.pre+"analysis_halogen")[0].checked,o=$("#"+t.pre+"analysis_pication")[0].checked,d=$("#"+t.pre+"analysis_pistacking")[0].checked,c="threshold "+$("#"+t.pre+"hbondthreshold").val()+" "+$("#"+t.pre+"saltbridgethreshold").val()+" "+$("#"+t.pre+"contactthreshold").val()+" "+$("#"+t.pre+"halogenthreshold").val()+" "+$("#"+t.pre+"picationthreshold").val()+" "+$("#"+t.pre+"pistackingthreshold").val(),h=t.viewInterPairsCls.viewInteractionPairs(i,s,t.bHbondCalc,e,n,r,a,l,o,d).interactionTypes,m=t.bHbondCalc?"true":"false",p=i+" "+s+" | "+h+" | "+m+" | "+c;if("3d"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("display interaction 3d | "+p,!0);else if("view"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("view interaction pairs | "+p,!0);else if("save1"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("save1 interaction pairs | "+p,!0);else if("save2"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("save2 interaction pairs | "+p,!0);else if("linegraph"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("line graph interaction pairs | "+p,!0);else if("scatterplot"==e)t.icn3dui.htmlCls.clickMenuCls.setLogCmd("scatterplot interaction pairs | "+p,!0);else if("graph"==e){var u=parseInt($("#"+t.pre+"dist_ss").val()),C=parseInt($("#"+t.pre+"dist_coil").val()),v=parseInt($("#"+t.pre+"dist_hbond").val()),g=parseInt($("#"+t.pre+"dist_inter").val()),f=parseInt($("#"+t.pre+"dist_ssbond").val()),b=parseInt($("#"+t.pre+"dist_ionic").val()),y=parseInt($("#"+t.pre+"dist_halogen").val()),w=parseInt($("#"+t.pre+"dist_pication").val()),S=parseInt($("#"+t.pre+"dist_pistacking").val());t.icn3dui.htmlCls.clickMenuCls.setLogCmd("graph interaction pairs | "+i+" "+s+" | "+h+" | "+m+" | "+c+" | "+u+" "+C+" "+v+" "+g+" "+f+" "+b+" "+y+" "+w+" "+S,!0)}t.bHbondCalc=!0}}showHbonds(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!i){var o,d,c,h;n?(o="saltbridge",d="salt bridge "+e+" | sets "+t+" "+s+" | "+i):(o="hbonds",d="hbonds "+e+" | sets "+t+" "+s+" | "+i),a.opts[o]="yes",a.opts.water="dot",c=a.definedSetsCls.getAtomsFromNameArray(t),h=a.definedSetsCls.getAtomsFromNameArray(s);var m=a.firstAtomObjCls.getFirstAtomObj(c);if(Object.keys(h).length>0&&Object.keys(c).length>0){var p,u=a.hBondCls.calculateChemicalHbonds(l.hashUtilsCls.intHash2Atoms(a.dAtoms,h,a.atoms),l.hashUtilsCls.intHash2Atoms(a.dAtoms,c,a.atoms),parseFloat(e),n);n?(a.resid2ResidhashSaltbridge=l.hashUtilsCls.cloneHash(a.resid2Residhash),p="all atoms that have salt bridges with the selected atoms"):(a.resid2ResidhashHbond=l.hashUtilsCls.cloneHash(a.resid2Residhash),p="all atoms that are hydrogen-bonded with the selected atoms");var C={};for(var v in u){C[a.atoms[v].structure+"_"+a.atoms[v].chain+"_"+a.atoms[v].resi]=1}for(var g in a.hAtoms={},C)for(var v in a.residues[g])a.hAtoms[v]=1,a.atoms[v].style2="stick";var f=o+"_"+m.serial;a.selectionCls.addCustomSelection(Object.keys(C),f,p,d,!0);s=[f];a.selectionCls.saveSelectionIfSelected(),a.drawCls.draw()}}}showHydrogens(){var e=this.icn3d;for(var t in e.icn3dui,e.hAtoms){var s=e.atoms[t];if("H"!==s.name){e.atoms[s.serial].bonds=e.atoms[s.serial].bonds2.concat(),e.atoms[s.serial].bondOrder=e.atoms[s.serial].bondOrder2.concat();for(var i=0,n=e.atoms[s.serial].bonds.length;i<n;++i){var r=e.atoms[s.serial].bonds[i];"H"===e.atoms[r].name&&(e.dAtoms[r]=1,e.hAtoms[r]=1)}}}}hideHydrogens(){var e=this.icn3d;for(var t in e.icn3dui,e.hAtoms){var s=e.atoms[t];if("H"===s.name){if(e.atoms[s.serial].bonds.length>0){var i=e.atoms[s.serial].bonds[0],n=e.atoms[i].bonds.indexOf(s.serial);-1!==n&&(e.atoms[i].bonds.splice(n,1),e.atoms[i].bondOrder.splice(n,1))}delete e.dAtoms[s.serial],delete e.hAtoms[s.serial]}}}hideHbondsContacts(){var e=this.icn3d;e.icn3dui;var t="set hbonds off";e.icn3dui.htmlCls.clickMenuCls.setLogCmd(t,!0),e.hBondCls.hideHbonds(),t="set salt bridge off",e.icn3dui.htmlCls.clickMenuCls.setLogCmd(t,!0),e.saltbridgeCls.hideSaltbridge(),t="set contact off",e.icn3dui.htmlCls.clickMenuCls.setLogCmd(t,!0),e.contactCls.hideContact(),t="set halogen pi off",e.icn3dui.htmlCls.clickMenuCls.setLogCmd(t,!0),e.piHalogenCls.hideHalogenPi()}showIonicInteractions(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!i){var o,d,c;"saltbridge",o="salt bridge "+e+" | sets "+t+" "+s+" | "+i,a.opts.saltbridge="yes",d=a.definedSetsCls.getAtomsFromNameArray(t),c=a.definedSetsCls.getAtomsFromNameArray(s);var h=a.firstAtomObjCls.getFirstAtomObj(d);if(Object.keys(c).length>0&&Object.keys(d).length>0){var m=a.saltbridgeCls.calculateIonicInteractions(l.hashUtilsCls.intHash2Atoms(a.dAtoms,c,a.atoms),l.hashUtilsCls.intHash2Atoms(a.dAtoms,d,a.atoms),parseFloat(e),n);a.resid2ResidhashSaltbridge=l.hashUtilsCls.cloneHash(a.resid2Residhash),"all atoms that have ionic interactions with the selected atoms";var p={};for(var u in m){p[a.atoms[u].structure+"_"+a.atoms[u].chain+"_"+a.atoms[u].resi]=1}for(var C in a.hAtoms={},p)for(var u in a.residues[C])a.hAtoms[u]=1,a.atoms[u].style2="stick",a.ions.hasOwnProperty(u)&&(a.atoms[u].style2="sphere");var v="saltbridge_"+h.serial;a.selectionCls.addCustomSelection(Object.keys(p),v,"all atoms that have ionic interactions with the selected atoms",o,!0);s=[v];a.selectionCls.saveSelectionIfSelected(),a.drawCls.draw()}}}showHalogenPi(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!i){var o,d,c=r+" "+e+" | sets "+t+" "+s+" | "+i;a.opts[r]="yes",o=a.definedSetsCls.getAtomsFromNameArray(t),d=a.definedSetsCls.getAtomsFromNameArray(s);var h=a.firstAtomObjCls.getFirstAtomObj(o);if(Object.keys(d).length>0&&Object.keys(o).length>0){var m,p=a.piHalogenCls.calculateHalogenPiInteractions(l.hashUtilsCls.intHash2Atoms(a.dAtoms,o,a.atoms),l.hashUtilsCls.intHash2Atoms(a.dAtoms,d,a.atoms),parseFloat(e),n,r);"halogen"==r?(a.resid2ResidhashHalogen=l.hashUtilsCls.cloneHash(a.resid2Residhash),m="all atoms that have halogen bonds with the selected atoms"):"pi-cation"==r?(a.resid2ResidhashPication=l.hashUtilsCls.cloneHash(a.resid2Residhash),m="all atoms that have pi-cation interactions with the selected atoms"):"pi-stacking"==r&&(a.resid2ResidhashPistacking=l.hashUtilsCls.cloneHash(a.resid2Residhash),m="all atoms that have pi-stacking with the selected atoms");var u={};for(var C in p){u[a.atoms[C].structure+"_"+a.atoms[C].chain+"_"+a.atoms[C].resi]=1}for(var v in a.hAtoms={},u)for(var C in a.residues[v])a.hAtoms[C]=1,a.atoms[C].style2="stick",a.ions.hasOwnProperty(C)&&(a.atoms[C].style2="sphere");var g=r+"_"+h.serial;a.selectionCls.addCustomSelection(Object.keys(u),g,m,c,!0);s=[g];a.selectionCls.saveSelectionIfSelected(),a.drawCls.draw()}}}showClbonds(){var e=this.icn3d,t=e.icn3dui;e.opts.clbonds="yes";var s=e.applyClbondsCls.applyClbondsOptions();for(var i in s)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[i]);if(Object.keys(s).length>0){e.selectionCls.addCustomSelection(Object.keys(s),"clbonds","all atoms that have cross-linkages","cross linkage",!0),e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw()}}showSsbonds(){var e=this.icn3d,t=e.icn3dui;e.opts.ssbonds="yes";for(var s={},i=Object.keys(e.structures),n=0,r=i.length;n<r;++n){var a=i[n];if(void 0!==e.ssbondpnts[a])for(var l=0,o=Math.floor(e.ssbondpnts[a].length/2);l<o;l++){var d=e.ssbondpnts[a][2*l],c=e.ssbondpnts[a][2*l+1];s[d]=1,s[c]=1,e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[d]),e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[c])}}if(Object.keys(s).length>0){e.selectionCls.addCustomSelection(Object.keys(s),"ssbonds","all atoms that have disulfide bonds","disulfide bonds",!0),e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw()}}pickCustomSphere(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!i){var o,d,c="select zone cutoff "+e+" | sets "+t+" "+s+" | "+i;n&&(c="interactions "+e+" | sets "+t+" "+s+" | "+i,a.opts.contact="yes"),o=a.definedSetsCls.getAtomsFromNameArray(t),d=a.definedSetsCls.getAtomsFromNameArray(s);var h,m,p=this.pickCustomSphere_base(e,o,d,i,n,r,c,!0),u=Object.keys(p.residues);a.hAtoms={};for(var C=0,v=u.length;C<v;++C){var g=u[C];for(var f in a.residues[g])a.hAtoms[f]=1}var b=a.firstAtomObjCls.getFirstAtomObj(o);void 0!==b&&(h="sphere."+b.chain+":"+l.utilsCls.residueName2Abbr(b.resn.substr(0,3)).trim()+b.resi+"-"+e+"A",n&&(h="interactions."+b.chain+":"+l.utilsCls.residueName2Abbr(b.resn.substr(0,3)).trim()+b.resi+"-"+$("#"+a.pre+"contactthreshold").val()+"A"),m=h,a.selectionCls.addCustomSelection(u,h,m,c,!0)),a.selectionCls.saveSelectionIfSelected(),a.drawCls.draw()}}pickCustomSphere_base(e,t,s,i,n,r,a,l){var o,d=this.icn3d,c=d.icn3dui;n?(o=d.contactCls.getAtomsWithinAtom(c.hashUtilsCls.intHash2Atoms(d.dAtoms,s,d.atoms),c.hashUtilsCls.intHash2Atoms(d.dAtoms,t,d.atoms),parseFloat(e),l,n),d.resid2ResidhashInteractions=c.hashUtilsCls.cloneHash(d.resid2Residhash)):(o=d.contactCls.getAtomsWithinAtom(s,t,parseFloat(e),l,n),d.resid2ResidhashSphere=c.hashUtilsCls.cloneHash(d.resid2Residhash));var h={};for(var m in o){var p=o[m];if(!d.bOpm||"DUM"!==p.resn)h[p.structure+"_"+p.chain+"_"+p.resi]=1}return{residues:h,resid2Residhash:d.resid2Residhash}}}class B{constructor(e){this.icn3d=e}setColorByOptions(e,t,s){var i=this.icn3d,n=i.icn3dui;if(void 0!==e)if(s)for(var r in t){var a=i.atoms[r];i.atomPrevColors[r]=a.color}else if(0===e.color.indexOf("#"))for(var r in t){(a=i.atoms[r]).color=n.parasCls.thr().setStyle(e.color.toLowerCase()),i.atomPrevColors[r]=a.color}else{var l,o,d,c,h;switch(e.color.toLowerCase()){case"spectrum":for(var r in l=0,o=0,t){(a=i.atoms[r]).het||++o}for(var r in d=o>1?1/(o-1):1,t){(a=i.atoms[r]).color=a.het?n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor:n.parasCls.thr().setHSL(3/4*(1-l++*d),1,.45),i.atomPrevColors[r]=a.color}break;case"chain":if(void 0!==i.chainsColor&&Object.keys(i.chainsColor).length>0)this.setMmdbChainColor();else{var m=-1,p="",u=n.parasCls.stdChainColors.length;for(var r in t){(a=i.atoms[r]).chain!=p&&(++m,m%=u),a.het?(a.color=n.parasCls.atomColors[a.elem],i.atomPrevColors[r]=a.color):(a.color=n.parasCls.stdChainColors[m],Object.keys(i.chainsColor).length>0&&this.updateChainsColor(a),i.atomPrevColors[r]=a.color),p=a.chain}}break;case"domain":l=0,o=0;var C=Object.keys(i.tddomains);d=(o=C.length)>1?1/(o-1):1;r=0;for(var v=C.length;r<v;++r){var g=n.parasCls.thr().setHSL(3/4*(1-l++*d),1,.45);for(var f in i.tddomains[C[r]])for(var b in i.residues[f]){(a=i.atoms[b]).color=g,i.atomPrevColors[b]=a.color}}break;case"secondary structure green":for(var r in i.sheetcolor="green",t){(a=i.atoms[r]).color=a.het?n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor:n.parasCls.ssColors[a.ss]||n.parasCls.thr(16711935),i.atomPrevColors[r]=a.color}break;case"secondary structure yellow":case"secondary structure":for(var r in i.sheetcolor="yellow",t){(a=i.atoms[r]).color=a.het?n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor:n.parasCls.ssColors2[a.ss]||n.parasCls.thr(16711935),i.atomPrevColors[r]=a.color}break;case"secondary structure spectrum":l=0,o=0;var y,w,S=[],_=[],A=-9999;for(var r in t)if(i.proteins.hasOwnProperty(r)){a=i.atoms[r];-9999==A&&(y=parseInt(r)),-9999!=A&&(a.ss!=w.ss||Math.abs(a.resi-w.resi)>1||a.ssbegin&&w.ssend)&&("coil"==w.ss?_.push([y,A]):S.push([y,A]),y=r),A=parseInt(r),w=a}"coil"==w.ss?_.push([y,A]):S.push([y,A]),d=(o=S.length)>1?1/(o-1):1;for(r=0,v=S.length;r<v;++r)for(g=n.parasCls.thr().setHSL(3/4*(1-l++*d),1,.45),b=S[r][0];b<=S[r][1];++b){(a=i.atoms[b]).color=g,i.atomPrevColors[b]=a.color}for(g=n.parasCls.ssColors2.coil,r=0,v=_.length;r<v;++r)for(b=_[r][0];b<=_[r][1];++b){(a=i.atoms[b]).color=g,i.atomPrevColors[b]=a.color}break;case"residue":for(var r in t){(a=i.atoms[r]).color=a.het?n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor:n.parasCls.residueColors[a.resn]||n.parasCls.defaultResidueColor,i.atomPrevColors[r]=a.color}break;case"residue custom":for(var r in t){(a=i.atoms[r]).color=a.het?n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor:i.customResidueColors[a.resn]||n.parasCls.defaultResidueColor,i.atomPrevColors[r]=a.color}break;case"align custom":for(var b in i.middB=50,i.spanBinv1=.02,i.spanBinv2=.02,t){var x=i.atoms[b].structure+"_"+i.atoms[b].chain;if(void 0!==i.queryresi2score&&i.queryresi2score.hasOwnProperty(x)){var k=i.atoms[b].resi;if(i.queryresi2score[x].hasOwnProperty(k)){(T=i.queryresi2score[x][k])>100&&(T=100);var O=(i.middB-T)*i.spanBinv1,H=(T-i.middB)*i.spanBinv2;g=T<i.middB?n.parasCls.thr().setRGB(1-O,1-O,1):n.parasCls.thr().setRGB(1,1-H,1-H)}else g=n.parasCls.defaultAtomColor;i.atoms[b].color=g,i.atomPrevColors[b]=g}}break;case"charge":for(var r in t){(a=i.atoms[r]).color=a.het?n.parasCls.defaultAtomColor:n.parasCls.chargeColors[a.resn]||n.parasCls.defaultResidueColor,i.atomPrevColors[r]=a.color}break;case"hydrophobic":for(var r in t){(a=i.atoms[r]).color=a.het?n.parasCls.defaultAtomColor:n.parasCls.hydrophobicColors[a.resn]||n.parasCls.defaultResidueColor,i.atomPrevColors[r]=a.color}break;case"atom":for(var r in t){(a=i.atoms[r]).color=n.parasCls.atomColors[a.elem]||n.parasCls.defaultAtomColor,i.atomPrevColors[r]=a.color}break;case"b factor":for(var r in i.middB=50,i.spanBinv1=.02,i.spanBinv2=.02,t){if(void 0===(a=i.atoms[r]).b||0==parseInt(1e3*a.b))a.color=n.parasCls.thr().setRGB(0,1,0);else{(T=a.b)>100&&(T=100);O=(i.middB-T)*i.spanBinv1,H=(T-i.middB)*i.spanBinv2;a.color=T<i.middB?n.parasCls.thr().setRGB(1-O,1-O,1):n.parasCls.thr().setRGB(1,1-H,1-H)}i.bOpm&&"DUM"==a.resn&&(a.color=n.parasCls.atomColors[a.elem]),i.atomPrevColors[r]=a.color}break;case"b factor percentile":if(c=1e3,h=-1e3,!i.bfactorArray){for(var r in i.bfactorArray=[],i.atoms){c>(a=i.atoms[r]).b&&(c=a.b),h<a.b&&(h=a.b),i.bfactorArray.push(a.b)}i.bfactorArray.sort((function(e,t){return e-t}))}var R=i.bfactorArray.length;for(var r in t){if(void 0===(a=i.atoms[r]).b||0==parseInt(1e3*a.b)||0==i.bfactorArray.length)a.color=n.parasCls.thr().setRGB(0,1,0);else{var E=i.bfactorArray.indexOf(a.b)/R;a.color=E<.5?n.parasCls.thr().setRGB(2*E,2*E,1):n.parasCls.thr().setRGB(1,2*(1-E),2*(1-E))}i.atomPrevColors[r]=a.color}break;case"area":if(void 0===i.resid2area){var I=n.hashUtilsCls.cloneHash(i.hAtoms);i.hAtoms=n.hashUtilsCls.cloneHash(i.atoms),i.bCalcArea=!0,i.opts.surface="solvent accessible surface",i.applyMapCls.applySurfaceOptions(),i.bCalcArea=!1,i.hAtoms=n.hashUtilsCls.cloneHash(I)}var D=void 0!==i.midpercent?i.midpercent:35;for(var r in i.spanBinv1=.02,i.spanBinv2=.02,t){var T;f=(a=i.atoms[r]).structure+"_"+a.chain+"_"+a.resi+"_"+a.resn;(T=n.parasCls.residueArea.hasOwnProperty(a.resn)?i.resid2area[f]/n.parasCls.residueArea[a.resn]*100:D)>100&&(T=100);O=(D-T)*i.spanBinv1,H=(T-D)*i.spanBinv2;a.color=T<D?n.parasCls.thr().setRGB(1-O,1-O,1):n.parasCls.thr().setRGB(1,1-H,1-H),i.bOpm&&"DUM"==a.resn&&(a.color=n.parasCls.atomColors[a.elem]),i.atomPrevColors[r]=a.color}break;case"identity":case"conserved":this.setConservationColor(t,!0);break;case"conservation":this.setConservationColor(t,!1);break;case"white":this.setAtmClr(t,16777215);break;case"grey":this.setAtmClr(t,8947848);break;case"red":this.setAtmClr(t,16711680);break;case"green":this.setAtmClr(t,65280);break;case"blue":this.setAtmClr(t,255);break;case"magenta":this.setAtmClr(t,16711935);break;case"yellow":this.setAtmClr(t,16776960);break;case"cyan":this.setAtmClr(t,65535);break;case"custom":break;default:for(var r in t){(a=i.atoms[r]).color=n.parasCls.thr().setStyle("#"+e.color.toLowerCase()),i.atomPrevColors[r]=a.color}}}}setAtmClr(e,t){var s=this.icn3d,i=s.icn3dui;for(var n in e){var r=s.atoms[n];r.color=i.parasCls.thr().setHex(t),s.atomPrevColors[n]=r.color}}updateChainsColor(e){var t=this.icn3d;t.icn3dui;var s=e.structure+"_"+e.chain;void 0!==t.chainsColor[s]&&(t.chainsColor[s]=e.color)}setMmdbChainColor(e){var t,s=this.icn3d,i=s.icn3dui,n=void 0===e?s.hAtoms:e;for(var r in this.applyOriginalColor(i.hashUtilsCls.hash2Atoms(n,s.atoms)),t=i.hashUtilsCls.unionHash(t,s.chemicals),t=i.hashUtilsCls.unionHash(t,s.ions)){var a=s.atoms[r];a.color=i.parasCls.atomColors[a.elem]||i.parasCls.defaultAtomColor,s.atomPrevColors[r]=a.color}}setConservationColor(e,t){var s=this.icn3d,i=s.icn3dui;for(var n in this.setMmdbChainColor(e),s.alnChainsSeq)for(var r=s.alnChainsSeq[n],a=0,l=r.length;a<l;++a){var o=n+"_"+r[a].resi;for(var d in s.residues[o])if(e.hasOwnProperty(d)){var c=t?i.parasCls.thr(r[a].color):i.parasCls.thr(r[a].color2);s.atoms[d].color=c,s.atomPrevColors[d]=c}}}applyOriginalColor(e){var t=this.icn3d,s=t.icn3dui;for(var i in void 0===e&&(e=t.atoms),e){var n=e[i],r=n.structure+"_"+n.chain;t.chainsColor.hasOwnProperty(r)?n.color=t.chainsColor[r]:n.color=s.parasCls.atomColors[n.elem],t.atomPrevColors[i]=n.color}}applyPrevColor(){var e=this.icn3d;for(var t in e.icn3dui,e.atoms){e.atoms[t].color=e.atomPrevColors[t]}}setOutlineColor(e){this.icn3d.icn3dui;var t={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));var s=t.outline;return new THREE.ShaderMaterial({uniforms:{offset:{type:"f",value:.5}},vertexShader:s.vertex_shader,fragmentShader:s.fragment_shader,depthTest:!1,depthWrite:!1})}}class z{constructor(e){this.icn3d=e}buildAxes(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui;if(!a.icn3dui.bNode){new THREE.Object3D;var o=0,d=0,c=0;r?(o=t.x,d=t.y,c=t.z):(o-=.3*e,d-=.3*e);var h,m,p,u,C,v,g,f,b,y=new THREE.Vector3(o,d,c),w=e/10,S=e/100;u=C=v=w,r&&(h=s.clone().sub(t),m=i.clone().sub(t),p=n.clone().sub(t),u=h.length(),C=m.length(),v=p.length(),(S=u/100)<.4&&(S=.4)),r?(g=a.cylinderCls.createCylinder_base(t,s,S,l.parasCls.thr(16711680)),f=a.cylinderCls.createCylinder_base(t,i,S,l.parasCls.thr(65280)),b=a.cylinderCls.createCylinder_base(t,n,S,l.parasCls.thr(255))):(g=a.cylinderCls.createCylinder_base(new THREE.Vector3(o,d,c),new THREE.Vector3(o+u,d,c),S,l.parasCls.thr(16711680)),f=a.cylinderCls.createCylinder_base(new THREE.Vector3(o,d,c),new THREE.Vector3(o,d+C,c),S,l.parasCls.thr(65280)),b=a.cylinderCls.createCylinder_base(new THREE.Vector3(o,d,c),new THREE.Vector3(o,d,c+v),S,l.parasCls.thr(255))),a.mdl.add(g),a.mdl.add(f),a.mdl.add(b);var _=r?h.normalize():new THREE.Vector3(1,0,0),A=r?s:new THREE.Vector3(y.x+w,y.y,y.z),x=this.createArrow(_,A,u,16711680,4*S,4*S);a.mdl.add(x);var k=r?m.normalize():new THREE.Vector3(0,1,0),O=r?i:new THREE.Vector3(y.x,y.y+w,y.z),H=this.createArrow(k,O,C,65280,4*S,4*S);a.mdl.add(H);var R=r?p.normalize():new THREE.Vector3(0,0,1),E=r?n:new THREE.Vector3(y.x,y.y,y.z+w),I=this.createArrow(R,E,v,255,4*S,4*S);a.mdl.add(I)}}buildAllAxes(e,t){var s=this.icn3d;if(s.icn3dui,!s.icn3dui.bNode&&s.pc1)for(var i=0,n=s.axes.length;i<n;++i){var r=s.axes[i][0],a=s.axes[i][1],l=s.axes[i][2],o=s.axes[i][3];this.buildAxes(e,r,a,l,o,t)}}createArrow(e,t,s,i,n,r,a){var l=this.icn3d;if(l.icn3dui,!l.icn3dui.bNode){var o,d=new THREE.CylinderBufferGeometry(0,.5,1,32,1);d.translate(0,.5,0),o=a?new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:l.frac,shininess:30,emissive:0,color:i}):new THREE.MeshPhongMaterial({specular:l.frac,shininess:30,emissive:0,side:THREE.DoubleSide,color:i});var c=new THREE.Mesh(d,o),h=new THREE.Quaternion;if(e.y>.99999)h.set(0,0,0,1);else if(e.y<-.99999)h.set(1,0,0,0);else{var m=new THREE.Vector3;m.set(e.z,0,-e.x).normalize();var p=Math.acos(e.y);h.setFromAxisAngle(m,p)}return c.applyQuaternion(h),c.scale.set(r,n,r),c.position.copy(t),c}}setPc1Axes(){var e=this.icn3d,t=e.icn3dui;if(!e.icn3dui.bNode){var s=t.hashUtilsCls.intHash(e.hAtoms,e.dAtoms),i=[],n=Object.keys(s).length<100;for(var r in s){var a=e.atoms[r],l=a.structure+"_"+a.chain+"_"+a.resi;(n||""!=l)&&i.push(a.coord.clone())}var o=t.rmsdSuprCls.getEigenForSelection(i,i.length),d=new THREE.Vector3(o.h1[0],o.h1[1],o.h1[2]);if(0==o.k&&e.bRender)alert("Can't determine the first principal component. Please select a subset and try it again.");else{var c=e.applyCenterCls.centerAtoms(s),h=c.maxD,m=c.center,p=m.clone().add(d.normalize().multiplyScalar(.4*h)),u=new THREE.Vector3(o.h2[0],o.h2[1],o.h2[2]),C=m.clone().add(u.normalize().multiplyScalar(.3*h)),v=new THREE.Vector3(o.h3[0],o.h3[1],o.h3[2]),g=m.clone().add(v.normalize().multiplyScalar(.3*h));this.buildAxes(void 0,m,p,C,g,!0);var f=[m,p,C,g];e.axes.push(f),e.drawCls.draw()}}}}class G{constructor(e){this.icn3d=e}addResidueLabels(e,t,s,i){var n=this.icn3d,r=n.icn3dui;if(!n.icn3dui.bNode){var a=r.hashUtilsCls.intHash(n.hAtoms,e);t?void 0===n.labels.schematic&&(n.labels.schematic=[]):void 0===n.labels.residue&&(n.labels.residue=[]);var l="";for(var o in a){var d=n.atoms[o],c={},h=d.structure+"_"+d.chain+"_"+d.resi;if(!d.het&&("CA"===d.name||"O3'"===d.name||"O3*"===d.name)||n.water.hasOwnProperty(d.serial)||n.ions.hasOwnProperty(d.serial)||n.chemicals.hasOwnProperty(d.serial)&&h!==l){c.position=d.coord,c.bSchematic=0,t&&(c.bSchematic=1),c.text=r.utilsCls.residueName2Abbr(d.resn),i&&(c.text+=d.resi),c.size=18;var m=d.color.getHexString().toUpperCase();c.color="CCCCCC"===m||"C8C8C8"===m?"#888888":"#"+m,c.background="#CCCCCC",t?n.labels.schematic.push(c):n.labels.residue.push(c)}l=h}n.hlObjectsCls.removeHlObjects()}}addNonCarbonAtomLabels(e){var t=this.icn3d,s=t.icn3dui;if(!t.icn3dui.bNode){var i=s.hashUtilsCls.intHash(t.hAtoms,e);for(var n in void 0===t.labels.schematic&&(t.labels.schematic=[]),i){var r=t.atoms[n];if(t.residues.hasOwnProperty(r.structure+"_"+r.chain+"_"+r.resi)&&"C"!==r.elem){var a={};a.position=r.coord,a.bSchematic=1,a.text=r.elem,a.size=18,a.color="#"+r.color.getHexString(),a.background="#FFFFFF",t.labels.schematic.push(a)}}t.hlObjectsCls.removeHlObjects()}}addAtomLabels(e){var t=this.icn3d,s=t.icn3dui;if(!t.icn3dui.bNode){var i=s.hashUtilsCls.intHash(t.hAtoms,e);for(var n in i=s.hashUtilsCls.intHash(t.dAtoms,i),void 0===t.labels.residue&&(t.labels.residue=[]),i){var r=t.atoms[n],a={};a.position=r.coord,a.bSchematic=0,a.text=r.name,a.size=18;var l=r.color.getHexString().toUpperCase();a.color="CCCCCC"===l||"C8C8C8"===l?"#888888":"#"+l,a.background="#CCCCCC",t.labels.residue.push(a)}t.hlObjectsCls.removeHlObjects()}}}class V{constructor(e){this.icn3d=e}CalcPhiUrl(e,t,s,i,n){var r=this.icn3d;r.icn3dui;var a=this,l=new XMLHttpRequest;l.open("GET",n,!0),l.responseType="text",l.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var n=l.response;a.CalcPhi(e,t,s,i,n)}else alert("The PQR file is unavailable...");else r.ParserUtilsCls.showLoading()},l.send()}CalcPhi(e,t,s,i,n){var r=this.icn3d,a=r.icn3dui,l=this;r.loadPhiFrom="delphi";var o=r.icn3dui.cfg.cid?r.icn3dui.cfg.cid:Object.keys(r.structures).toString(),d={};if(n)d={pqr2phi:n,gsize:e,salt:t,pdbid:o};else{var c={},h={},m=a.hashUtilsCls.intHash(r.dAtoms,r.hAtoms);for(var p in m)r.atoms[p],r.ions.hasOwnProperty(p)?c[p]=1:h[p]=1;var u=Object.keys(h).length;if(a.utilsCls.isCalphaPhosOnly(a.hashUtilsCls.hash2Atoms(h,r.atoms)))return void alert("The potential will not be shown because the side chains are missing in the structure...");if(u>3e4)return void alert("The maximum number of allowed atoms is 30,000. Please try it again with selected chains...");var C="";C+=r.saveFileCls.getPDBHeader(),C+=r.icn3dui.cfg.cid?r.saveFileCls.getAtomPDB(h,!0):r.saveFileCls.getAtomPDB(h),d={pdb2phi:C+=r.saveFileCls.getAtomPDB(c,!0),gsize:e,salt:t,pdbid:o}}$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/delphi/delphi.fcgi",type:"POST",data:d,dataType:"binary",responseType:"arraybuffer",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){r.ParserUtilsCls.showLoading()},complete:function(){r.ParserUtilsCls.hideLoading()},success:function(e){l.loadPhiData(e,s,i),r.bAjaxPhi=!0,i?r.setOptionCls.setOption("phisurface","phi"):r.setOptionCls.setOption("phimap","phi"),void 0!==r.deferredDelphi&&r.deferredDelphi.resolve(),void 0!==r.deferredPhi&&r.deferredPhi.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}PhiParser(e,t,s,i){var n=this.icn3d;n.icn3dui;var r=this,a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="phiurl"==t||"phiurl2"==t?"arraybuffer":"text",a.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var e=a.response;"phiurl"==t||"phiurl2"==t?r.loadPhiData(e,s,i):r.loadCubeData(e,s,i),n.bAjaxPhi=!0,i?n.setOptionCls.setOption("phisurface","phi"):n.setOptionCls.setOption("phimap","phi")}else alert("The potential file is unavailable...");void 0!==n.deferredPhi&&n.deferredPhi.resolve()}else n.ParserUtilsCls.showLoading()},a.send()}loadPhiData(e,t,s){var i=this.icn3d;i.icn3dui;var n={filetype:"phi"},r=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,a=new Float32Array(r.slice(r.byteLength-24,r.byteLength-8));n.scale=a[0];var l=a[1],o=a[2],d=a[3];n.n=new Int32Array(r.slice(r.byteLength-8,r.byteLength-4)),n.xExtent=n.yExtent=n.zExtent=n.n;var c=1/n.scale*((n.n-1)/2);n.ori=new THREE.Vector3(l-c,o-c,d-c);var h=new Float32Array(r.slice(110,r.byteLength-56));n.bSurface=s,i.mapData.headerPhi=n,i.mapData.dataPhi=h,i.mapData.contourPhi=t;var m=new THREE.Matrix4;m.identity(),m.multiply((new THREE.Matrix4).makeTranslation(n.ori.x,n.ori.y,n.ori.z)),i.mapData.matrixPhi=m}loadCubeData(e,t,s){var i=this.icn3d;i.icn3dui;var n={filetype:"cube"},r=e.split("\n"),a=[];a.push(parseFloat(r[0].substr(0,10))),a.push(parseFloat(r[0].substr(10,6))),a.push(parseFloat(r[0].substr(16,10))),a.push(parseFloat(r[0].substr(26,10))),a.push(parseFloat(r[0].substr(36,10))),n.scale=a[0];var l=a[2],o=a[3],d=a[4];n.n=a[1],n.xExtent=n.yExtent=n.zExtent=n.n;var c=1/n.scale*((n.n-1)/2);n.ori=new THREE.Vector3(l-c,o-c,d-c);for(var h=[],m=7,p=r.length;m<p;++m)for(var u=r[m].split(/\s+/),C=0,v=u.length;C<v;++C){var g=parseFloat(u[C]);isNaN(g)||h.push(g)}h.length!=n.n*n.n*n.n&&console.log("the data array size "+h.length+" didn't match the grid size "+n.n*n.n*n.n+"..."),n.bSurface=s,i.mapData.headerPhi=n,i.mapData.dataPhi=h,i.mapData.contourPhi=t;var f=new THREE.Matrix4;f.identity(),f.multiply((new THREE.Matrix4).makeTranslation(n.ori.x,n.ori.y,n.ori.z)),i.mapData.matrixPhi=f}applyCommandPhi(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredPhi=$.Deferred((function(){var t=s.icn3d,i=e.split(" | "),n=i[0].split(" "),r=i[1].split(" "),a=i[2].split(" "),l=i[3].split(" "),o=i[4].split(" "),d=n[2],c=parseFloat(r[1]),h=a[1],m=l[1],p=o[1];if(8==i.length){var u=i[5].split(" "),C=i[6].split(" "),v=i[7].split(" ");t.phisurftype=u[1],t.phisurfop=parseFloat(C[1]),t.phisurfwf=v[1],$("#"+t.pre+"delphisurftype").val(t.phisurftype),$("#"+t.pre+"delphisurfop").val(t.phisurfop),$("#"+t.pre+"delphisurfwf").val(t.phisurfwf)}var g="pqrurl2"==d||"phiurl2"==d||"cubeurl2"==d;"pqrurl"==d||"pqrurl2"==d?s.CalcPhiUrl(m,p,c,g,h):s.PhiParser(h,d,c,g)})),t.deferredPhi.promise()}applyCommandDelphi(e){var t=this;return ic.deferredDelphi=$.Deferred((function(){var s=t.icn3d,i=e.split(" | "),n=i[0].split(" "),r=i[1].split(" "),a=i[2].split(" "),l=i[3].split(" "),o=n[2],d=r[1],c=a[1],h=l[1];if($("#"+s.pre+"delphigsize").val(c),$("#"+s.pre+"delphisalt").val(h),7==i.length){var m=i[4].split(" "),p=i[5].split(" "),u=i[6].split(" ");s.phisurftype=m[1],s.phisurfop=p[1],s.phisurfwf=u[1],$("#"+s.pre+"delphisurftype").val(s.phisurftype),$("#"+s.pre+"delphisurfop").val(s.phisurfop),$("#"+s.pre+"delphisurfwf").val(s.phisurfwf)}var C="surface"==o;t.CalcPhi(c,h,d,C)})),ic.deferredDelphi.promise()}loadDelphiFile(e){var t=this.icn3d;t.icn3dui;var s=$("#"+t.pre+"delphigsize").val(),i=$("#"+t.pre+"delphisalt").val(),n="delphi2"==e?$("#"+t.pre+"delphicontour2").val():$("#"+t.pre+"delphicontour").val(),r="delphi2"==e;this.CalcPhi(s,i,n,r);var a="delphi2"==e?"surface":"map";r?t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set delphi "+a+" | contour "+n+" | gsize "+s+" | salt "+i+" | surface "+t.phisurftype+" | opacity "+t.phisurfop+" | wireframe "+t.phisurfwf,!0):t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set delphi "+a+" | contour "+n+" | gsize "+s+" | salt "+i,!0)}loadPhiFile(e){var t,s=this.icn3d,i=s.icn3dui,n=this;"pqr"==e||"phi"==e||"cube"==e?t=$("#"+s.pre+e+"file")[0].files[0]:"pqr2"==e?t=$("#"+s.pre+"pqrfile2")[0].files[0]:"phi2"==e?t=$("#"+s.pre+"phifile2")[0].files[0]:"cube2"==e&&(t=$("#"+s.pre+"cubefile2")[0].files[0]);var r="pqr"==e||"phi"==e||"cube"==e?$("#"+s.pre+"phicontour").val():$("#"+s.pre+"phicontour2").val();if(t){i.utilsCls.checkFileAPI();var a=new FileReader;a.onload=function(t){var s=n.icn3d,i=t.target.result,a=0,l=0;if("pqr"==e||"pqr2"==e){var o="pqr2"==e;a=$("#"+s.pre+e+"gsize").val(),l=$("#"+s.pre+e+"salt").val(),n.CalcPhi(a,l,r,o,i)}else if("phi"==e||"phi2"==e){o="phi2"==e;n.loadPhiData(i,r,o)}else if("cube"==e||"cube2"==e){o="cube2"==e;n.loadCubeData(i,r,o)}s.bAjaxPhi=!0,o?s.setOptionCls.setOption("phisurface","phi"):s.setOptionCls.setOption("phimap","phi"),o?s.icn3dui.htmlCls.clickMenuCls.setLogCmd("load phi "+e+" | contour "+r+" | file "+$("#"+s.pre+e+"file").val()+" | gsize "+a+" | salt "+l+" | surface "+s.phisurftype+" | opacity "+s.phisurfop+" | wireframe "+s.phisurfwf,!1):s.icn3dui.htmlCls.clickMenuCls.setLogCmd("load phi "+e+" | contour "+r+" | file "+$("#"+s.pre+e+"file").val()+" | gsize "+a+" | salt "+l,!1)},"phi"==e||"phi2"==e?a.readAsArrayBuffer(t):a.readAsText(t)}else alert("Please select a file before clicking 'Load'")}loadPhiFileUrl(e){var t,s=this.icn3d;s.icn3dui,"pqrurl"==e||"phiurl"==e||"cubeurl"==e?t=$("#"+s.pre+e+"file").val():"pqrurl2"==e?t=$("#"+s.pre+"pqrurlfile2").val():"phiurl2"==e?t=$("#"+s.pre+"phiurlfile2").val():"cubeurl2"==e&&(t=$("#"+s.pre+"cubeurlfile2").val());var i="pqrurl"==e||"phiurl"==e||"cubeurl"==e?$("#"+s.pre+"phiurlcontour").val():$("#"+s.pre+"phiurlcontour2").val();if(t){var n="pqrurl2"==e||"phiurl2"==e||"cubeurl2"==e,r=0,a=0;"pqrurl"==e||"pqrurl2"==e?(r=$("#"+s.pre+e+"gsize").val(),a=$("#"+s.pre+e+"salt").val(),this.CalcPhiUrl(r,a,i,n,t)):this.PhiParser(t,e,i,n),n?s.icn3dui.htmlCls.clickMenuCls.setLogCmd("set phi "+e+" | contour "+i+" | url "+encodeURIComponent(t)+" | gsize "+r+" | salt "+a+" | surface "+s.phisurftype+" | opacity "+s.phisurfop+" | wireframe "+s.phisurfwf,!0):s.icn3dui.htmlCls.clickMenuCls.setLogCmd("set phi "+e+" | contour "+i+" | url "+encodeURIComponent(t)+" | gsize "+r+" | salt "+a,!0)}else alert("Please input the file URL before clicking 'Load'")}}class W{constructor(e){this.icn3d=e}applyCommandScapBase(e){this.icn3d.icn3dui;var t=e.substr(e.lastIndexOf(" ")+1);0==e.indexOf("scap 3d")?this.retrieveScap(t):0==e.indexOf("scap interaction")?this.retrieveScap(t,!0):0==e.indexOf("scap pdb")&&this.retrieveScap(t,void 0,!0)}applyCommandScap(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredScap=$.Deferred((function(){s.applyCommandScapBase(e)})),t.deferredScap.promise()}adjust2DWidth(e){var t=this.icn3d;t.icn3dui;e=t.pre+e;var s=$("#"+t.pre+"dl_selectannotations").hasClass("ui-dialog-content")?$("#"+t.pre+"dl_selectannotations").dialog("option","height"):t.icn3dui.htmlCls.HEIGHT,i=$("#"+t.pre+"dl_selectannotations").hasClass("ui-dialog-content")?250:.5*t.icn3dui.htmlCls.WIDTH;$("#"+e).dialog("option","width",i),$("#"+e).dialog("option","height",s);var n={my:"left-125 top+"+t.icn3dui.htmlCls.MENU_HEIGHT,at:"right top",of:"#"+t.pre+"viewer",collision:"none"};$("#"+e).dialog("option","position",n)}retrieveScap(e,t,s){for(var i=this.icn3d,n=i.icn3dui,r=this,a="",l=e.split(","),o={},d=[],c=0,h=l.length;c<h;++c){var m=l[c].split("_"),p=m[0]+"_"+m[1]+"_"+m[2];o=n.hashUtilsCls.unionHash(o,i.residues[p]),d.push(p),a+=m[1]+"_"+m[2]+"_"+m[3],c!=h-1&&(a+=",")}var u=i.resid2specCls.residueids2spec(d),C="select "+u,v=i.showInterCls.pickCustomSphere_base(10,o,i.atoms,!1,!1,void 0,C,!1);d=Object.keys(v.residues),i.hAtoms={};for(var g=0,f=d.length;g<f;++g){var b=d[g];for(var c in i.residues[b])i.hAtoms[c]=1}i.hAtoms=n.hashUtilsCls.unionHash(i.hAtoms,o),i.hAtoms=n.hashUtilsCls.exclHash(i.hAtoms,i.chemicals);var y=i.saveFileCls.getPDBHeader()+i.saveFileCls.getAtomPDB(i.hAtoms),w=Object.keys(i.structures)[0],S={pdb:y,snp:a,pdbid:w,v:"2"};$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/scap/scap.cgi",type:"POST",data:S,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){var l=e.indexOf("\n"),o=e.substr(0,l),d=e.substr(l+1);console.log("free energy: "+o+" kcal/mol");var c=n.hashUtilsCls.cloneHash(i.hAtoms);i.hAtoms={},i.loadPDBCls.loadPDB(d,w,!1,!1,!0);var h=n.hashUtilsCls.cloneHash(i.hAtoms);for(var m in i.hAtoms=n.hashUtilsCls.unionHash(i.hAtoms,c),i.dAtoms=i.hAtoms,i.transformCls.zoominSelection(),i.setOptionCls.setStyle("proteins","stick"),i.opts.color="chain",i.setColorCls.setColorByOptions(i.opts,i.dAtoms),h){var p=i.atoms[m];if(!p.het){var C=p.structure.substr(0,4)+"_"+p.chain+"_"+p.resi,v=i.firstAtomObjCls.getFirstAtomObj(i.residues[C]);i.atoms[m].color=v.color,i.atomPrevColors[m]=v.color}}if(s){var g="";g+=i.saveFileCls.getPDBHeader(),g+=i.saveFileCls.getAtomPDB(i.hAtoms);var f=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(f+"_"+a+".pdb","text",[g]),i.drawCls.draw()}else{var b=u,y="snp_"+a;if(i.selByCommCls.selectByCommand(b,y,y),i.opts.color="atom",i.setColorCls.setColorByOptions(i.opts,i.hAtoms),i.viewInterPairsCls.clearInteractions(),t){i.viewInterPairsCls.viewInteractionPairs(["selected"],["non-selected"],!1,"linegraph",!0,!0,!0,!0,!0,!0),r.adjust2DWidth("dl_linegraph")}i.hAtoms=i.dAtoms,i.drawCls.draw(),i.alertAlt||(i.alertAlt=!0,i.bRender&&alert('Please press the letter "a" to alternate between wild type and mutant.'))}void 0!==i.deferredScap&&i.deferredScap.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):(alert("There are some problems in predicting the side chain of the mutant..."),i.ParserUtilsCls.hideLoading(),void 0!==i.deferredScap&&i.deferredScap.resolve())}})}}class Y{constructor(e){this.icn3d=e}applyCommandSymdBase(e){this.icn3d.icn3dui,this.retrieveSymd()}applyCommandSymd(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredSymd=$.Deferred((function(){s.applyCommandSymdBase(e)})),t.deferredSymd.promise()}retrieveSymd(){var e=this.icn3d,t=e.icn3dui,s=this,i=t.hashUtilsCls.intHash(e.dAtoms,e.hAtoms);i=t.hashUtilsCls.intHash(i,e.proteins);var n=Object.keys(i).length,r={};for(var a in i){var l=e.atoms[a],o=l.structure+"_"+l.chain+"_"+l.resi;r[o]=1}if(n>1e4)alert("The maximum number of allowed atoms is 10,000. Please try it again with smaller sets...");else{var d="";d+=e.saveFileCls.getPDBHeader();var c={pdb:d+=e.saveFileCls.getAtomPDB(i),pdbid:Object.keys(e.structures).toString()};$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/symd/symd.cgi",type:"POST",data:c,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){e.ParserUtilsCls.showLoading()},complete:function(){},success:function(i){var n=i.rcsb_struct_symmetry,a="none";if(void 0!==n){var l;void 0!==e.rmsd_supr&&void 0!==e.rmsd_supr.rot&&(e.rmsd_supr.rot,e.rmsd_supr.trans1,e.rmsd_supr.trans2),void 0===e.symdArray&&(e.symdArray=[]);for(var o=0,d=n.length;o<d;++o)if("C1"!=n[o].symbol){a=n[o].symbol+" ","Pseudo Symmetry"==n[o].kind?a=n[o].symbol+" (pseudo)":"Global Symmetry"==n[o].kind?a=n[o].symbol+" (global)":"Local Symmetry"==n[o].kind&&(a=n[o].symbol+" (local)");for(var c=n[o].rotation_axes,h=[],m=0,p=c.length;m<p;++m){var u=[],C=new THREE.Vector3(c[m].start[0],c[m].start[1],c[m].start[2]),v=new THREE.Vector3(c[m].end[0],c[m].end[1],c[m].end[2]);l=c[m].order,u.push(C),u.push(v);var g=s.getAxisColor(n[o].symbol,c[m].order),f=s.getPolygonColor(n[o].symbol);u.push(g),u.push(f),u.push(c[m].order),u.push("selection"),h.push(u)}var b={};b[a]=h,e.symdArray.push(b)}if(0==e.symdArray.length)$("#"+e.pre+"dl_symd").html("<br>The selected residues have no detected symmetry with a Z score of "+i.zscore+" from the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>."),e.icn3dui.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD");else{var y=i.seqalign.replace(/ /g,"").split(","),w=i.nres,S=i.shift,_=i.rmsd,A=Object.keys(r),x={},k={},O=[],H=[],R=0,E=0,I={};for(o=0,d=y[0].length;o<d;++o){var D=y[0][o],T=y[1][o];if("-"!=D){if(D==D.toUpperCase()){x[A[R]]=1;var M=t.utilsCls.getIdArray(A[R]);O.push(D+" $"+M[0]+"."+M[1]+":"+M[2]);var P=M[0]+"_"+M[1];I.hasOwnProperty(P)||(I[P]=[]),I[P].push(O.length-1)}++R}if("-"!=T){if(T==T.toUpperCase()){var F=(E+S+w)%w;k[A[F]]=1;var L=t.utilsCls.getIdArray(A[F]);H.push(T+" $"+L[0]+"."+L[1]+":"+L[2])}++E}}var N={},U={},q=[],j=[],B=!1;if(1==Object.keys(I).length){B=!0;var z=parseInt(O.length/l+.5),G=Object.keys(x),V=Object.keys(k);for(o=0;o<z;++o)N.hasOwnProperty(V[o])||(q.push(O[o]),j.push(H[o]),N[G[o]]=1,U[V[o]]=1)}else{var W,Y=0;for(var P in I)I[P].length>Y&&(Y=I[P].length,W=P);for(G=Object.keys(x),V=Object.keys(k),o=0,d=I[W].length;o<d;++o){var X=I[W][o];N.hasOwnProperty(V[X])||(q.push(O[X]),j.push(H[X]),N[G[X]]=1,U[V[X]]=1)}}var K="<br>";K+="The symmetry "+n[0].symbol+" was calculated dynamically using the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>. The Z score "+i.zscore+" is greater than the threshold Z score 8. The RMSD is "+_+' angstrom. <br><br>The following sequence alignment shows the residue mapping of the best aligned sets: "symOri" and "symPerm", which are also available in the menu "Analysis > Defined Sets".<br>',$("#"+e.pre+"symd_info").html(K),s.setSeqAlignForSymmetry(q,j,B);var Q=e.icn3dui.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(e.alnChains),void 0,void 0,!1,B);K=$("#"+e.pre+"dl_sequence2").html()+Q.sequencesHtml;$("#"+e.pre+"dl_sequence2").html(K),$("#"+e.pre+"dl_sequence2").width(e.icn3dui.htmlCls.RESIDUE_WIDTH*Q.maxSeqCnt+200),e.icn3dui.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences from SymD");var J=Object.keys(e.defNames2Residues).length+Object.keys(e.defNames2Atoms).length,Z="symOri"+J;e.selectionCls.selectResidueList(N,Z,Z),e.selectionCls.updateSelectionNameDesc(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(N))+" | name "+Z,!1),Z="symPerm"+J,e.selectionCls.selectResidueList(U,Z,Z),e.selectionCls.updateSelectionNameDesc(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(U))+" | name "+Z,!1),Z="symBoth"+J;N=t.hashUtilsCls.unionHash(N,U);e.selectionCls.selectResidueList(N,Z,Z),e.selectionCls.updateSelectionNameDesc(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+e.resid2specCls.residueids2spec(Object.keys(N))+" | name "+Z,!1)}}else $("#"+e.pre+"dl_symd").html("<br>The selected residues have no detected symmetry with a Z score of "+i.zscore+" from the program <a href='https://symd.nci.nih.gov/' target='_blank'>SymD</a>."),e.icn3dui.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD");e.symdtitle="none"===a?void 0:a,e.drawCls.draw(),void 0!==e.deferredSymd&&e.deferredSymd.resolve()},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):($("#"+e.pre+"dl_symd").html("<br>The web service can not determine the symmetry of the input set."),e.icn3dui.htmlCls.dialogCls.openDlg("dl_symd","Dynamically Calculated Symmetry Using SymD"),e.ParserUtilsCls.hideLoading(),void 0!==e.deferredSymd&&e.deferredSymd.resolve())}})}}getResObj(e){this.icn3d.icn3dui;var t=e.substr(0,e.indexOf(" ")),s=e.indexOf("$"),i=e.indexOf("."),n=e.indexOf(":"),r=e.substr(s+1,i-s-1),a=e.substr(i+1,n-i-1),l=e.substr(n+1);return{resn:t,resid:r+"_"+a+"_"+l,resi:l,aligned:!0}}setSeqAlignForSymmetry(e,t,s){var i=this.icn3d,n=i.icn3dui;i.conservedName1="symOri_cons",i.conservedName2="symPerm_cons",i.consHash1={},i.consHash2={},i.alnChainsAnTtl={},i.alnChainsAnno={},i.alnChainsSeq={},i.alnChains={},i.alnChainsSeq={};for(var r={},a=0,l=e.length;a<l;++a){var o,d=this.getResObj(e[a]),c=this.getResObj(t[a]),h=d.resid.substr(0,d.resid.lastIndexOf("_")),m=c.resid.substr(0,c.resid.lastIndexOf("_")),p=m;if(s)p=m.substr(0,m.indexOf("_"))+"2"+m.substr(m.indexOf("_"));r[d.resid]=1,r[c.resid]=1,o=d.resn==c.resn?"#FF0000":"#0000FF";var u="#"+i.showAnnoCls.getColorhexFromBlosum62(d.resn,c.resn);for(var C in d.color=o,c.color=o,d.color2=u,c.color2=u,i.residues[d.resid])i.atoms[C].color=n.parasCls.thr(o),i.atomPrevColors[C]=n.parasCls.thr(o);for(var C in i.residues[c.resid])i.atoms[C].color=n.parasCls.thr(o),i.atomPrevColors[C]=n.parasCls.thr(o);void 0===i.alnChainsAnTtl[h]&&(i.alnChainsAnTtl[h]=[]);for(C=0;C<3;++C)void 0===i.alnChainsAnTtl[h][C]&&(i.alnChainsAnTtl[h][C]=[]);for(C=0;C<3;++C)i.alnChainsAnTtl[h][C].push("");void 0===i.alnChainsSeq[h]&&(i.alnChainsSeq[h]=[]),void 0===i.alnChainsSeq[p]&&(i.alnChainsSeq[p]=[]),i.alnChainsSeq[h].push(d),i.alnChainsSeq[p].push(c),void 0===i.alnChains[h]&&(i.alnChains[h]={}),void 0===i.alnChains[p]&&(i.alnChains[p]={}),$.extend(i.alnChains[h],i.residues[h+"_"+d.resi]),$.extend(i.alnChains[p],i.residues[p+"_"+c.resi]),i.consHash1[h+"_"+d.resi]=1,i.consHash2[p+"_"+c.resi]=1,void 0===i.alnChainsAnno[h]&&(i.alnChainsAnno[h]=[]);for(C=0;C<3;++C)void 0===i.alnChainsAnno[h][C]&&(i.alnChainsAnno[h][C]=[]);var v=".";a%5==0&&(v="*"),a%10==0&&(v="|"),i.alnChainsAnno[h][0].push(v);var g="";a%10==0&&(g=a.toString()),i.alnChainsAnno[h][1].push(g)}}retrieveSymmetry(e){var t=this.icn3d;t.icn3dui;var s=this,i="https://data.rcsb.org/rest/v1/core/assembly/"+e+"/1";$.ajax({url:i,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(e){var i,n,r,a=e.rcsb_struct_symmetry;if(void 0!==a){void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot&&(i=t.rmsd_supr.rot,n=t.rmsd_supr.trans1,r=t.rmsd_supr.trans2),t.symmetryHash={};for(var l=0,o=a.length;l<o;++l)if("C1"!=a[l].symbol){var d="no title";"Pseudo Symmetry"==a[l].kind?d=a[l].symbol+" (pseudo)":"Global Symmetry"==a[l].kind?d=a[l].symbol+" (global)":"Local Symmetry"==a[l].kind&&(d=a[l].symbol+" (local)");for(var c=a[l].rotation_axes,h=[],m=0,p=c.length;m<p;++m){var u=[],C=new THREE.Vector3(c[m].start[0],c[m].start[1],c[m].start[2]),v=new THREE.Vector3(c[m].end[0],c[m].end[1],c[m].end[2]);void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot&&(C=t.surfaceCls.transformMemPro(C,i,n,r),v=t.surfaceCls.transformMemPro(v,i,n,r)),u.push(C),u.push(v);var g=s.getAxisColor(a[l].symbol,c[m].order),f=s.getPolygonColor(a[l].symbol);u.push(g),u.push(f),u.push(c[m].order),u.push(a[l].clusters[0].members[0].asym_id),h.push(u)}t.symmetryHash[d]=h}if(0==Object.keys(t.symmetryHash).length)$("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry.");else{var b="<option value='none'>None</option>",y=0;for(var d in t.symmetryHash){b+="<option value='"+d+"' "+(0==y?"selected":"")+">"+d+"</option>",++y}$("#"+t.pre+"selectSymmetry").html(b)}}else $("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry.");t.icn3dui.htmlCls.dialogCls.openDlg("dl_symmetry","Symmetry"),void 0!==t.deferredSymmetry&&t.deferredSymmetry.resolve()},error:function(e,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):($("#"+t.pre+"dl_symmetry").html("<br>This structure has no symmetry."),t.icn3dui.htmlCls.dialogCls.openDlg("dl_symmetry","Symmetry"),void 0!==t.deferredSymmetry&&t.deferredSymmetry.resolve())}})}getPolygonColor(e){var t=this.icn3d.icn3dui,s=e.substr(0,1);return"C"==s?t.parasCls.thr(16747520):"D"==s?t.parasCls.thr(65535):"T"==s?t.parasCls.thr(15631086):"O"==s?t.parasCls.thr(16753920):"I"==s?t.parasCls.thr(65280):t.parasCls.thr(11119017)}getAxisColor(e,t){var s=this.icn3d.icn3dui,i=e.substr(0,1);return"C"==i?s.parasCls.thr(16711680):"D"==i?2==t?s.parasCls.thr(65535):s.parasCls.thr(16711680):"T"==i?2==t?s.parasCls.thr(65535):s.parasCls.thr(65280):"O"==i||"I"==i?2==t?s.parasCls.thr(65535):3==t?s.parasCls.thr(65280):s.parasCls.thr(16711680):s.parasCls.thr(16711680)}}class X{constructor(e){this.icn3d=e}loadPDB(e,t,s,i,n){var r,a,l=this.icn3d,o=l.icn3dui,d=[],c=[],h=e.split("\n"),m={},p={};if(n){if(l.alertAlt){for(var u=l.oriNStru+1,C=l.structures[u-1],v=0,g=C?C.length:0;v<g;++v){for(var f in l.chains[C[v]])delete l.atoms[f],delete l.hAtoms[f],delete l.dAtoms[f];delete l.chains[C[v]]}delete l.structures[u-1]}else l.oriNStru=Object.keys(l.structures).length;a=l.oriNStru+1,r=Object.keys(l.atoms).length}else l.init(),a=1,r=0;var b,y,w,S,_,A,x=[],k=[],O=[],H=[],R=[],E=[],I="",D="",T="",M={},P={},F="stru",L=0,N="";for(var v in h){var U=h[v],q=U.substr(0,6);if("HEADER"===q)F=U.substr(62,4).trim(),l.molTitle="";else if("TITLE "===q){var j=U.substr(10);l.molTitle+=j.trim()+" "}else if("HELIX "===q){l.bSecondaryStructure=!0;var B=" "==U.substr(19,1)?"A":U.substr(19,1),z=parseInt(U.substr(21,4)),G=parseInt(U.substr(33,4));for(f=z;f<=G;++f)V=B+"_"+f,H.push(V),f===z&&R.push(V),f===G&&E.push(V);d.push({chain:B,initialResidue:z,initialInscode:U.substr(25,1),terminalResidue:G,terminalInscode:U.substr(37,1)})}else if("SHEET "===q){void 0!==s&&s||(l.bSecondaryStructure=!0);for(B=" "==U.substr(21,1)?"A":U.substr(21,1),z=parseInt(U.substr(22,4)),G=parseInt(U.substr(33,4)),f=z;f<=G;++f){var V=B+"_"+f;x.push(V),f===z&&k.push(V),f===G&&O.push(V)}c.push({chain:B,initialResidue:z,initialInscode:U.substr(26,1),terminalResidue:G,terminalInscode:U.substr(37,1)})}else if("HBOND "===q)void 0!==s&&s||(l.bSecondaryStructure=!0);else if("SSBOND"===q){l.bSsbondProvided=!0;var W=F+"_"+(" "==U.substr(15,1)?"A":U.substr(15,1))+"_"+U.substr(17,4).trim(),Y=F+"_"+(" "==U.substr(29,1)?"A":U.substr(29,1))+"_"+U.substr(31,4).trim();void 0===l.ssbondpnts[F]&&(l.ssbondpnts[F]=[]),l.ssbondpnts[F].push(W),l.ssbondpnts[F].push(Y)}else if("REMARK"===q){var X=parseInt(U.substr(7,3));if(-1!==U.indexOf("1/2 of bilayer thickness:"))l.halfBilayerSize=parseFloat(U.substr(U.indexOf(":")+1).trim());else if(350==X&&"BIOMT"==U.substr(13,5)){var K=parseInt(U[18])-1,Q=parseInt(U.substr(21,2))-1;null==l.biomtMatrices[Q]&&(l.biomtMatrices[Q]=(new THREE.Matrix4).identity()),l.biomtMatrices[Q].elements[K]=parseFloat(U.substr(24,9)),l.biomtMatrices[Q].elements[K+4]=parseFloat(U.substr(34,9)),l.biomtMatrices[Q].elements[K+8]=parseFloat(U.substr(44,9)),l.biomtMatrices[Q].elements[K+12]=parseFloat(U.substr(54,10))}else if(465==X&&" "==U.substr(18,1)&&" "==U.substr(20,1)&&"S"!=U.substr(21,1)){var J,Z=U.substr(15,3),ee=U.substr(19,1),te=parseInt(U.substr(21,5));void 0===P[J=F+"_"+ee]&&(P[J]=[]),(ge={}).resi=te,ge.name=o.utilsCls.residueName2Abbr(Z).toLowerCase(),ee!=N&&(L=0),!isNaN(te)&&(""==N||ee!=N||ee==N&&te>L)&&(P[J].push(ge),L=te,N=ee)}else 900==X&&void 0===l.emd&&"RELATED DB: EMDB"==U.substr(34).trim()&&(l.emd=U.substr(23,11).trim())}else if("SOURCE"===q&&void 0===l.organism&&"ORGANISM_COMMON"==U.substr(11,15).trim())l.organism=U.substr(28).toLowerCase().trim(),l.organism=l.organism.substr(0,l.organism.length-1);else if("ENDMDL"===q)++a,F="stru";else if("JRNL  "===q)"PMID"===U.substr(12,4)&&(l.pmid=U.substr(19).trim());else if("ATOM  "===q||"HETATM"===q){var se=F;("stru"==F||n)&&(se=1===a?F:F+a.toString());var ie=U.substr(16,1);++r,M[parseInt(U.substr(6,5))]=r;var ne=U.substr(76,2).trim();""===ne&&(ne=U.substr(12,2).trim());var re=U.substr(12,4).trim();Z=U.substr(17,3);" "===(ee=U.substr(21,1))&&(ee="A");var ae=U.substr(22,5).trim();te=parseInt(ae);if(s&&"DUM"===Z&&(ne=re,ee="MEM",te=1,ae=1),i&&"DUM"===Z)break;y=(J=se+"_"+ee)+"_"+ae,b=J+"_"+te;V=ee+"_"+te;var le=parseFloat(U.substr(30,8)),oe=parseFloat(U.substr(38,8)),de=parseFloat(U.substr(46,8)),ce=new THREE.Vector3(le,oe,de),he={het:"H"===q[0],serial:r,name:re,alt:ie,resn:Z,structure:se,chain:ee,resi:te,coord:ce,b:parseFloat(U.substr(60,8)),elem:ne,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};if(he.het||"C"!==he.name||(w=r),he.het||"O"!==he.name||(_=r),!he.het&&"N"===he.name&&void 0!==S&&void 0!==A){var me=l.atoms[S].coord.distanceTo(l.atoms[A].coord),pe=he.coord.x+(l.atoms[S].coord.x-l.atoms[A].coord.x)/me,ue=he.coord.y+(l.atoms[S].coord.y-l.atoms[A].coord.y)/me,Ce=he.coord.z+(l.atoms[S].coord.z-l.atoms[A].coord.z)/me;he.hcoord=new THREE.Vector3(pe,ue,Ce)}l.atoms[r]=he,l.dAtoms[r]=1,l.hAtoms[r]=1,-1!==$.inArray(V,x)?(l.atoms[r].ss="sheet",-1!==$.inArray(V,k)&&(l.atoms[r].ssbegin=!0),-1!==$.inArray(V,O)&&(l.atoms[r].ssend=!0)):-1!==$.inArray(V,H)&&(l.atoms[r].ss="helix",-1!==$.inArray(V,R)&&(l.atoms[r].ssbegin=!0),-1!==$.inArray(V,E)&&(l.atoms[r].ssend=!0));var ve="-";if(ve="helix"===l.atoms[r].ss?"H":"sheet"===l.atoms[r].ss?"E":!l.atoms[r].het&&o.parasCls.residueColors.hasOwnProperty(l.atoms[r].resn.toUpperCase())?"c":"o",l.secondaries[b]=ve,y!==T){var ge,fe=o.utilsCls.residueName2Abbr(Z);if(l.residueId2Name[b]=fe,1!==r&&(l.residues[D]=p),b!==D&&(p={}),J!==I)S=void 0,A=void 0,1!==r&&(void 0===l.chains[I]&&(l.chains[I]={}),l.chains[I]=o.hashUtilsCls.unionHash(l.chains[I],m)),m={},void 0===l.structures[se.toString()]&&(l.structures[se.toString()]=[]),l.structures[se.toString()].push(J),void 0===l.chainsSeq[J]&&(l.chainsSeq[J]=[]),(ge={}).resi=te,ge.name=fe,l.chainsSeq[J].push(ge);else S=w,A=_,(ge={}).resi=te,ge.name=fe,l.chainsSeq[J].push(ge)}m[r]=1,p[r]=1,I=J,D=b,T=y}else if("CONECT"===q){var be=parseInt(U.substr(6,5));for(f=0;f<4;++f){var ye=parseInt(U.substr([11,16,21,26][f],5));isNaN(ye)||void 0!==l.atoms[M[be]]&&l.atoms[M[be]].bonds.push(M[ye])}}else"TER"===q.substr(0,3)&&++r}l.residues[b]=p,void 0===l.chains[J]&&(l.chains[J]={}),l.chains[J]=o.hashUtilsCls.unionHash2Atoms(l.chains[J],m,l.atoms),n||this.adjustSeq(P);for(var we=Object.keys(l.structures),Se=0,_e=we.length;Se<_e;++Se){if((se=we[Se])!=F&&(void 0===l.ssbondpnts[se]&&(l.ssbondpnts[se]=[]),void 0!==l.ssbondpnts[F])){f=0;for(var Ae=l.ssbondpnts[F].length;f<Ae;++f){var xe=l.ssbondpnts[F][f],ke=xe.indexOf("_"),Oe=se+xe.substr(ke);l.ssbondpnts[se].push(Oe)}}}if(!l.bSsbondProvided){var He={};for(var Re in l.chainsSeq){var Ee=l.chainsSeq[Re];for(se=Re.substr(0,Re.indexOf("_")),v=0,g=Ee.length;v<g;++v)"C"==Ee[v].name&&(null==He[se]&&(He[se]=[]),He[se].push(Re+"_"+Ee[v].resi))}this.setSsbond(He)}h=null;var Ie,De,Te=[],Me=function(e){for(var t=Te.length,s=0;s<t;++s){for(var i=Te[s],n=s+1;n<t;++n){var r=Te[n];i.alt===r.alt&&o.utilsCls.hasCovalentBond(i,r)&&(i.bonds.push(r.serial),r.bonds.push(i.serial))}e&&e(i)}},Pe=new THREE.Vector3(9999,9999,9999),Fe=new THREE.Vector3(-9999,-9999,-9999),Le=new THREE.Vector3,Ne=0,$e={};for(var v in l.atoms){ce=(re=l.atoms[v]).coord;Le.add(ce),Pe.min(ce),Fe.max(ce),++Ne,re.het?re.het&&("HOH"===re.resn||"WAT"===re.resn||"SOL"===re.resn?l.water[re.serial]=1:-1!==$.inArray(re.resn,o.parasCls.ionsArray)||re.elem.trim()===re.resn.trim()?l.ions[re.serial]=1:l.chemicals[re.serial]=1,re.color=o.parasCls.atomColors[re.elem]):-1!==$.inArray(re.resn,o.parasCls.nucleotidesArray)?(l.nucleotides[re.serial]=1,"O3'"!==re.name&&"O3*"!==re.name||(l.nucleotidesO3[re.serial]=1,l.secondaries[re.structure+"_"+re.chain+"_"+re.resi]="o")):("P"===re.elem&&($e[re.structure+"_"+re.chain+"_"+re.resi]=1),l.proteins[re.serial]=1,"CA"===re.name&&(l.calphas[re.serial]=1),"N"!==re.name&&"CA"!==re.name&&"C"!==re.name&&"O"!==re.name&&(l.sidec[re.serial]=1)),Ie===re.chain&&De===re.resi||(Me((function(e){("C"===e.name&&"N"===re.name||"O3'"===e.name&&"P"===re.name)&&o.utilsCls.hasCovalentBond(e,re)&&(e.bonds.push(re.serial),re.bonds.push(e.serial))})),Ie=re.chain,De=re.resi,Te.length=0),Te.push(re)}for(Oe in $e){var Ue=l.residues[Oe];for(r in Ue){(re=l.atoms[r]).het=!0,l.chemicals[re.serial]=1,l.secondaries[Oe]="o",delete l.proteins[re.serial],"CA"===re.name&&delete l.calphas[re.serial],"N"!==re.name&&"CA"!==re.name&&"C"!==re.name&&"O"!==re.name&&delete l.sidec[re.serial]}}if(Me(),l.pmin=Pe,l.pmax=Fe,l.cnt=Ne,l.maxD=l.pmax.distanceTo(l.pmin),l.center=Le.multiplyScalar(1/l.cnt),l.maxD<5&&(l.maxD=5),l.oriMaxD=l.maxD,l.oriCenter=l.center.clone(),i)return this.getChainCalpha(l.chains,l.atoms)}adjustSeq(e){var t=this.icn3d;for(var s in t.icn3dui,t.chainsSeq)if(void 0!==e[s]){var i,n,r,a=t.chainsSeq[s],l=e[s],o=a.length,d=l.length,c=new Array(o+d);for(i=0,n=0,r=0;i<o&&n<d;)a[i].resi<=l[n].resi?(c[r]=a[i],i++):(c[r]=l[n],n++),r++;if(i<o)for(var h=i;h<o;h++)c[r]=a[h],r++;else for(h=n;h<d;h++)c[r]=l[h],r++;t.chainsSeq[s]=c}}setSsbond(e){var t=this.icn3d;t.icn3dui;for(var s in e)for(var i=e[s],n=0,r=i.length;n<r;++n)for(var a=n+1,l=i.length;a<l;++a){var o=i[n],d=i[a],c=void 0,h=void 0;for(var m in t.residues[o])if("S"==t.atoms[m].elem){c=t.atoms[m].coord;break}for(var m in t.residues[d])if("S"==t.atoms[m].elem){h=t.atoms[m].coord;break}if(void 0!==c&&void 0!==h)if(!(Math.abs(c.x-h.x)>4))if(!(Math.abs(c.y-h.y)>4))if(!(Math.abs(c.z-h.z)>4))(c.x-h.x)*(c.x-h.x)+(c.y-h.y)*(c.y-h.y)+(c.z-h.z)*(c.z-h.z)<16&&(void 0===t.ssbondpnts[s]&&(t.ssbondpnts[s]=[]),t.ssbondpnts[s].push(o),t.ssbondpnts[s].push(d))}}getChainCalpha(e,t,s,i){var n=this.icn3d,r=n.icn3dui,a={};for(var l in e)if(void 0===i||(textArray=l.split("_"),textArray[0]===i)){for(var o=Object.keys(e[l]),d=[],c=0,h=0,m=0,p=o.length;m<p;++m){var u=t[o[m]];if(n.proteins.hasOwnProperty(o[m])&&"CA"==u.name||n.nucleotides.hasOwnProperty(o[m])&&("O3'"==u.name||"O3*"==u.name)){if(u.resi==h)continue;var C=u.resn.trim().length>3?u.resn.trim().substr(0,3):u.resn.trim();if(!r.parasCls.chargeColors.hasOwnProperty(C))continue;s?u.resi_ori:u.resi,d.push(u.coord.clone()),++c,h=u.resi}}if(c>0)a[t[o[0]].chain]=d}return{chainresiCalphaHash:a,center:n.center.clone()}}}class K{constructor(e){this.icn3d=e}loadAtomDataIn(e,t,s,i,n,r,a,l){var o=this.icn3d,d=o.icn3dui;o.pmin=new THREE.Vector3(9999,9999,9999),o.pmax=new THREE.Vector3(-9999,-9999,-9999),o.psum=new THREE.Vector3;var c=e.atoms,h=void 0===n||"target"===n?0:o.lastTargetSerial,m={};void 0===n||"target"===n?(o.pmid=e.pubmedId,o.chainid2title={},o.chainid2sid={}):o.pmid2=e.pubmedId;var p={},u={};if("align"===s){o.pmid="";var C=o.icn3dui.cfg.inpara&&-1!==o.icn3dui.cfg.inpara.indexOf("atype=1")?"Invariant Core ":"";o.molTitle=C+"Structure Alignment of ";for(var v=0,g=e.alignedStructures[0].length;v<g;++v){var f=e.alignedStructures[0][v];1===v&&(o.secondId=f.pdbId);var b=f.pdbId;f.mmdbId;for(var y=f.serialInterval[0],w=f.serialInterval[1];y<=w;++y)m[y]=b.toString();for(y=0,w=f.molecules.length;y<w;++y){var S=f.molecules[y].chain,_=f.molecules[y].kind,A=f.molecules[y].name,x=f.molecules[y].sid;p[R=b+"_"+S]=_,o.chainid2title[R]=A,void 0!==x&&(o.chainid2sid[R]=x)}o.molTitle+='<a href="'+o.icn3dui.htmlCls.baseUrl+"mmdb/mmdbsrv.cgi?uid="+f.pdbId.toUpperCase()+'" target="_blank">'+f.pdbId.toUpperCase()+"</a>",void 0!==f.descr&&(o.pmid+=f.descr.pubmedid),0===v&&(o.molTitle+=" and ",void 0!==f.descr&&(o.pmid+="_"))}o.molTitle+=" from VAST+"}else if(void 0!==e.descr&&(o.molTitle+=e.descr.name),"mmdbid"===s){b=e.pdbId;var k={};"target"==n&&(o.alignmolid2color=[]);var O=1;for(var H in e.moleculeInfor)if(0!==Object.keys(e.moleculeInfor[H]).length){var R=b+"_"+(S=e.moleculeInfor[H].chain.trim());k.hasOwnProperty(S)?(++k[S],R+=k[S]):k[S]=1,void 0!==o.mmdbid_q&&o.mmdbid_q===o.mmdbid_t&&"query"===n&&(R=b+o.icn3dui.htmlCls.postfix+"_"+S);_=e.moleculeInfor[H].kind;var E=e.moleculeInfor[H].color;x=e.moleculeInfor[H].sid;if(p[R]=_,u[R]=E,"protein"==_&&(o.organism=e.moleculeInfor[H].taxonomyName.toLowerCase()),void 0!==x&&(o.chainid2sid[R]=x),void 0===o.pdbid_chain2title&&(o.pdbid_chain2title={}),o.pdbid_chain2title[R]=e.moleculeInfor[H].name,S==R.substr(R.lastIndexOf("_"))){var I={};I[H]=O.toString(),o.alignmolid2color.push(I)}++O}}var D,T,M,P,F={},L="",N="",U="",q="",j="",B="",z=0,G=0,V="",W=!0,Y=!1,X="",K=d.utilsCls.isCalphaPhosOnly(c),Q=0,J={};for(var v in c){var Z;++h,F[v]=h,(fe=c[v]).serial=h,"mmdbid"===s||"mmcifid"===s?Z=t:"align"===s&&(Z=m[h]);var ee=!1;if(void 0!==fe.chain||"mmdbid"!==s&&"align"!==s)fe.chain=""===fe.chain?"Misc":fe.chain;else if("mmdbid"===s)if(H=fe.ids.m,void 0!==o.molid2chain[H]){var te=o.molid2chain[H].indexOf("_");fe.chain=o.molid2chain[H].substr(te+1)}else{var se="Misc";("protein"===p[j]&&"nucleotide"===p[j]&&fe.resi!=G||"protein"!==p[j]&&"nucleotide"!==p[j]&&(fe.resn.substr(0,3)!=V.substr(0,3)||fe.resi!=G||"solvent"===p[j]||"HOH"===fe.resn))&&++Q,fe.resi_ori=fe.resi,fe.resi=Q,ee=!0,fe.chain=se}else if("align"===s)if(H=fe.ids.m,void 0!==o.pdbid_molid2chain[Z+"_"+H])fe.chain=o.pdbid_molid2chain[Z+"_"+H];else{se="Misc";("protein"===p[j]&&"nucleotide"===p[j]&&fe.resi!=G||"protein"!==p[j]&&"nucleotide"!==p[j]&&(fe.resn.substr(0,3)!=V.substr(0,3)||fe.resi!=G||"solvent"===p[j]||"HOH"===fe.resn))&&(++Q,fe.resi_ori=fe.resi,fe.resi=Q,ee=!0),fe.chain=se}if(fe.chain=fe.chain.trim(),"mmdbid"!==s&&"align"!==s||(fe.structure=Z,"mmdbid"===s&&void 0!==o.mmdbid_q&&o.mmdbid_q===o.mmdbid_t&&"query"===n&&(fe.structure+=o.icn3dui.htmlCls.postfix)),j=(q=fe.structure)+"_"+fe.chain,"mmdbid"===s||"align"===s)ee||(fe.resi_ori=parseInt(fe.resi),o.bUsePdbNum?(fe.resi=fe.resi_ori,o.chainid2offset[j]||(o.chainid2offset[j]=fe.resi_ori-fe.ids.r)):fe.resi=fe.ids.r),-1!==(te=fe.resn.indexOf(" "))&&0!=te&&(fe.resn=fe.resn.substr(0,te));else ee||(fe.resi=parseInt(fe.resi));if(j!==N&&(z=0),fe.resi!==z&&(j!==N?(T=void 0,P=void 0):(T=D,P=M)),"mmdbid"===s){if(fe.coord=new THREE.Vector3(fe.coord[0],fe.coord[1],fe.coord[2]),void 0!==o.q_rotation&&!o.icn3dui.cfg.resnum)if("target"===n)fe.coord.x+=o.t_trans_add[a].x,fe.coord.y+=o.t_trans_add[a].y,fe.coord.z+=o.t_trans_add[a].z;else if("query"===n){fe.coord.x-=o.q_trans_sub[a].x,fe.coord.y-=o.q_trans_sub[a].y,fe.coord.z-=o.q_trans_sub[a].z;var ie=fe.coord.x*o.q_rotation[a].x1+fe.coord.y*o.q_rotation[a].y1+fe.coord.z*o.q_rotation[a].z1,ne=fe.coord.x*o.q_rotation[a].x2+fe.coord.y*o.q_rotation[a].y2+fe.coord.z*o.q_rotation[a].z2,re=fe.coord.x*o.q_rotation[a].x3+fe.coord.y*o.q_rotation[a].y3+fe.coord.z*o.q_rotation[a].z3;fe.coord.x=ie,fe.coord.y=ne,fe.coord.z=re}}else fe.coord=new THREE.Vector3(fe.coord.x,fe.coord.y,fe.coord.z);var ae=d.utilsCls.residueName2Abbr(fe.resn.substr(0,3));"mmdbid"!==s&&"align"!==s||!o.bFullUi||(void 0===o.mmdbMolidResid2mmdbChainResi&&(o.mmdbMolidResid2mmdbChainResi={}),o.mmdbMolidResid2mmdbChainResi[Z+"_"+fe.ids.m+"_"+fe.ids.r]=Z+"_"+fe.chain+"_"+fe.resi),o.pmin.min(fe.coord),o.pmax.max(fe.coord),o.psum.add(fe.coord);var le=void 0===o.icn3dui.cfg.mmcifid&&"mmcif"!=o.InputfileType?"protein"===p[j]:"p"===fe.mt,oe=void 0===o.icn3dui.cfg.mmcifid&&"mmcif"!=o.InputfileType?"nucleotide"===p[j]:"n"===fe.mt,de=void 0===o.icn3dui.cfg.mmcifid&&"mmcif"!=o.InputfileType?"solvent"===p[j]:"s"===fe.mt,ce=void 0===o.icn3dui.cfg.mmcifid&&"mmcif"!=o.InputfileType?"ligand"===p[j]||void 0!==p[j]&&-1!==p[j].indexOf("other")||void 0===p[j]:"l"===fe.mt;if("Misc"!==fe.chain&&"other"!==p[j]||"protein"===J[j]||"nucleotide"===J[j]||("CA"===fe.name&&"C"===fe.elem?J[j]="protein":"P"===fe.name&&"P"===fe.elem?J[j]="nucleotide":J[j]="chemical"),le||oe?(le?(o.proteins[h]=1,"CA"===fe.name&&(o.calphas[h]=1),"N"!==fe.name&&"CA"!==fe.name&&"C"!==fe.name&&"O"!==fe.name&&(o.sidec[h]=1)):oe&&(o.nucleotides[h]=1,("O3'"==fe.name||"O3*"==fe.name||K&&"P"==fe.name)&&(o.nucleotidesO3[h]=1)),fe.het=!1):de?(o.water[h]=1,fe.het=!0):ce&&("HOH"===fe.resn||"O"===fe.resn?o.water[h]=1:fe.elem===fe.resn?o.ions[h]=1:o.chemicals[h]=1,fe.het=!0),"mmdbid"===s?fe.het?fe.color=d.parasCls.atomColors[fe.elem]||d.parasCls.defaultAtomColor:fe.color=void 0!==u[j]?d.parasCls.thr(u[j]):d.parasCls.chargeColors[fe.resn]:void 0!==fe.color&&(fe.color=d.parasCls.thr(fe.color))," "!==fe.resn.charAt(0)&&" "===fe.resn.charAt(1)&&(fe.resn=fe.resn.charAt(0)),fe.het||"C"!==fe.name||(D=h),fe.het||"O"!==fe.name||(M=h),!fe.het&&"N"===fe.name&&void 0!==T&&void 0!==P){var he=o.atoms[T].coord.distanceTo(o.atoms[P].coord),me=fe.coord.x+(o.atoms[T].coord.x-o.atoms[P].coord.x)/he,pe=fe.coord.y+(o.atoms[T].coord.y-o.atoms[P].coord.y)/he,ue=fe.coord.z+(o.atoms[T].coord.z-o.atoms[P].coord.z)/he;fe.hcoord=new THREE.Vector3(me,pe,ue)}"HOH"==fe.resn&&(o.water[h]=1),o.atoms[h]=fe,o.dAtoms[h]=1,o.hAtoms[h]=1;R=fe.structure+"_"+fe.chain;void 0===o.chains[R]&&(o.chains[R]={}),o.chains[R][h]=1;var Ce=R+"_"+fe.resi;void 0===o.residues[Ce]&&(o.residues[Ce]={}),o.residues[Ce][h]=1,(B=j+"_"+fe.resi)!==U&&j!==N&&(W=!0,""!==L&&(void 0===o.structures[L]&&(o.structures[L]=[]),o.structures[L].push(N))),o.residueId2Name[Ce]=ae;var ve="-";if("helix"===fe.ss?ve="H":"sheet"===fe.ss?ve="E":fe.het||oe?ve="o":(!fe.het&&d.parasCls.residueColors.hasOwnProperty(fe.resn.toUpperCase())||"coil"===fe.ss)&&(ve="c"),o.secondaries[fe.structure+"_"+fe.chain+"_"+fe.resi]=ve,(fe.resi!=z||H!=X)&&o.bFullUi)if(void 0===o.chainsSeq[R]&&(o.chainsSeq[R]=[],W=!1),W&&!Y&&void 0!==o.chainsSeq[R][fe.resi-1])o.chainsSeq[R][fe.resi-1].name=ae;else if(!W||!o.chainsSeq[R].hasOwnProperty(fe.resi-1)){var ge={};ge.resi=fe.resi,ge.name=ae,fe.resi%10==0&&fe.resi.toString(),o.chainsSeq[R].push(ge),Y=!0}z=fe.resi,G=fe.resi_ori,V=fe.resn,L=q,N=j,U=B,X=H}for(var R in o.lastTargetSerial=h,J)if(!(Object.keys(o.chains[R]).length<10)&&"chemical"!==J[R])for(var h in o.chains[R]){var fe=o.atoms[h];delete o.chemicals[h],fe.het=!1,"protein"===J[R]?(o.proteins[h]=1,"CA"===fe.name&&(o.calphas[h]=1),"N"!==fe.name&&"CA"!==fe.name&&"C"!==fe.name&&"O"!==fe.name&&(o.sidec[h]=1)):"nucleotide"===J[R]&&(o.nucleotides[h]=1,("O3'"==fe.name||"O3*"==fe.name||K&&"P"==fe.name)&&(o.nucleotidesO3[h]=1))}if(void 0===o.structures[q]&&(o.structures[q]=[]),o.structures[q].push(j),o.bFullUi)if("mmdbid"===s||"mmcifid"===s)for(var S in e.sequences){var be=e.sequences[S];R=t+"_"+S;void 0!==o.mmdbid_q&&o.mmdbid_q===o.mmdbid_t&&"query"===n&&(R=t+o.icn3dui.htmlCls.postfix+"_"+S),o.ParserUtilsCls.getMissingResidues(be,s,R)}else if("align"===s)for(var R in o.chainid2seq){be=o.chainid2seq[R];o.ParserUtilsCls.getMissingResidues(be,s,R)}if("mmcifid"!==s)for(var v in c){var ye=F[v],we=void 0===o.atoms[ye].bonds?0:o.atoms[ye].bonds.length;for(y=0;y<we;++y)o.atoms[ye].bonds[y]=F[o.atoms[ye].bonds[y]]}if(e.atoms={},o.cnt=h,(o.cnt>o.maxatomcnt||void 0!==o.biomtMatrices&&o.biomtMatrices.length*o.cnt>10*o.maxatomcnt)&&(o.opts.proteins="c alpha trace",o.opts.nucleotides="o3 trace"),o.maxD=o.pmax.distanceTo(o.pmin),o.center=o.psum.multiplyScalar(1/o.cnt),o.maxD<5&&(o.maxD=5),o.oriMaxD=o.maxD,"mmdbid"===s){if(void 0!==(Ee=e.disulfides))for(v=0,g=Ee.length;v<g;++v){var Se=Ee[v][0].ca,_e=Ee[v][1].ca,Ae=o.atoms[Se],xe=o.atoms[_e],ke=Ae.chain,Oe=xe.chain,He=Ae.structure+"_"+ke+"_"+Ae.resi,Re=xe.structure+"_"+Oe+"_"+xe.resi;void 0===o.ssbondpnts[Ae.structure]&&(o.ssbondpnts[Ae.structure]=[]),o.ssbondpnts[Ae.structure].push(He),o.ssbondpnts[Ae.structure].push(Re)}}else if("mmcifid"===s){var Ee;if(void 0!==(Ee=e.disulfides)){void 0===o.ssbondpnts[t]&&(o.ssbondpnts[t]=[]);for(v=0,g=Ee.length;v<g;++v){He=Ee[v][0],Re=Ee[v][1];o.ssbondpnts[t].push(He),o.ssbondpnts[t].push(Re)}for(var Ie=Object.keys(o.structures),De=0,Te=Ie.length;De<Te;++De){if((f=Ie[De])!=t){void 0===o.ssbondpnts[f]&&(o.ssbondpnts[f]=[]);for(y=0,w=o.ssbondpnts[t].length;y<w;++y){var Me=o.ssbondpnts[t][y],Pe=(te=Me.indexOf("_"),f+Me.substr(te));o.ssbondpnts[f].push(Pe)}}}}}else if("align"===s){var Fe={};for(var R in o.chainid2seq)if("protein"==p[R]){var Le=o.chainid2seq[R];for(f=R.substr(0,R.indexOf("_")),v=0,g=Le.length;v<g;++v)"C"==Le[v][1]&&(null==Fe[f]&&(Fe[f]=[]),Fe[f].push(R+"_"+Le[v][0]))}o.loadPDBCls.setSsbond(Fe)}("mmcifid"===s||"mmdbid"===s&&void 0===n)&&o.ParserUtilsCls.transformToOpmOri(t);var Ne={};if("align"===s&&void 0!==i&&o.bFullUi)o.setSeqAlignCls.setSeqAlign(i,e.alignedStructures);else if("mmdbid"===s&&"query"===n&&o.bFullUi&&void 0!==o.q_rotation&&!o.icn3dui.cfg.resnum){o.setSeqAlignCls.setSeqAlignChain(r,a);var $e=o.icn3dui.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(o.alnChains),void 0,void 0,!1,void 0,!1),Ue=$("#"+o.pre+"dl_sequence2").html();Ne=o.hAtoms,$("#"+o.pre+"dl_sequence2").html(Ue+$e.sequencesHtml),$("#"+o.pre+"dl_sequence2").width(o.icn3dui.htmlCls.RESIDUE_WIDTH*$e.maxSeqCnt+200)}if("mmdbid"===s&&("target"===n||"query"===n)&&void 0===o.q_rotation){if("target"===n||"query"===n)for(var v in c){var qe=c[v];qe.coord.x-=o.center.x,qe.coord.y-=o.center.y,qe.coord.z-=o.center.z}"target"===n?(o.oriMaxD=o.maxD,o.center1=o.center):"query"===n&&(o.oriMaxD<o.maxD&&(o.oriMaxD=o.maxD),o.center2=o.center,o.center=new THREE.Vector3(0,0,0))}return o.oriCenter=o.center.clone(),o.saveFileCls.showTitle(),e={},Ne}}class Q{constructor(e){this.icn3d=e}downloadCid(e){var t=this.icn3d;t.icn3dui;var s=this,i="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/record/SDF/?record_type=3d&response_type=display";t.ParserUtilsCls.setYourNote("PubChem CID "+e+" in iCn3D"),t.bCid=!0,$.ajax({url:i,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){},success:function(i){var n=s.loadSdfAtomData(i,e);void 0===t.icn3dui.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),n?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==t.icn3dui.cfg.rotate&&t.resizeCanvasCls.rotStruc(t.icn3dui.cfg.rotate,!0)):alert("The SDF of CID "+e+" has the wrong format...")},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}).fail((function(){alert("This CID may not have 3D structure...")}))}loadSdfData(e){var t=this.icn3d;t.icn3dui;var s=this.loadSdfAtomData(e);void 0===t.icn3dui.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),s?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==t.icn3dui.cfg.rotate&&t.resizeCanvasCls.rotStruc(t.icn3dui.cfg.rotate,!0)):alert("The SDF file has the wrong format...")}loadSdfAtomData(e,t){var s=this.icn3d;s.icn3dui;var i=e.split(/\r?\n|\r/);if(i.length<4)return!1;s.init();var n=t||1,r="LIG",a=n,l=n+"_A",o=l+"_1",d=parseInt(i[3].substr(0,3));if(isNaN(d)||d<=0)return!1;var c=parseInt(i[3].substr(3,3)),h=4;if(i.length<h+d+c)return!1;var m,p,u=d,C={},v={},g={},f=1;for(m=0;m<u;m++){p=i[h],h++;var b=p.substr(31,3).trim(),y=parseFloat(p.substr(0,10)),w=parseFloat(p.substr(10,10)),S=parseFloat(p.substr(20,10)),_={het:!0,serial:f,name:b,resn:r,structure:n,chain:"A",resi:1,coord:new THREE.Vector3(y,w,S),b:0,elem:b,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};s.atoms[f]=_,g[f]=1,C[m]=f,++f,"H"==b&&(v[m]=1)}s.dAtoms=g,s.hAtoms=g,s.structures[a]=[l],s.chains[l]=g,s.residues[o]=g,s.residueId2Name[o]=r,void 0===s.chainsSeq[l]&&(s.chainsSeq[l]=[]);var A={resi:1};for(A.name=r,s.chainsSeq[l].push(A),m=0;m<c;m++){p=i[h],h++;var x=parseInt(p.substr(0,3))-1+0,k=parseInt(p.substr(3,3))-1+0,O=p.substr(6,3).trim(),H=C[x],R=C[k];s.atoms[H].bonds.push(R),s.atoms[H].bondOrder.push(O),s.atoms[R].bonds.push(H),s.atoms[R].bondOrder.push(O),v.hasOwnProperty(x)||v.hasOwnProperty(k)||("2"==O?(s.doublebonds[H+"_"+R]=1,s.doublebonds[R+"_"+H]=1):"3"==O&&(s.triplebonds[H+"_"+R]=1,s.triplebonds[R+"_"+H]=1))}for(var E=!1,I=i.length;h<I;++h)if(-1!=i[h].indexOf("PARTIAL_CHARGES")){E=!0;break}if(E){++h;var D=parseInt(i[h]);for(++h,m=0;m<D;++m,++h){var T=(p=i[h]).split(" "),M=parseInt(T[0]),P=parseFloat(T[1]);s.atoms[M].crg=P}}for(m in s.atoms)"H"!==s.atoms[m].name&&(s.atoms[m].bonds2=s.atoms[m].bonds.concat(),s.atoms[m].bondOrder2=s.atoms[m].bondOrder.concat());return s.ParserUtilsCls.setMaxD(),s.saveFileCls.showTitle(),!0}}class J{constructor(e){this.icn3d=e}loadXyzData(e){var t=this.icn3d;t.icn3dui;var s=this.loadXyzAtomData(e);void 0===t.icn3dui.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),s?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==t.icn3dui.cfg.rotate&&t.resizeCanvasCls.rotStruc(t.icn3dui.cfg.rotate,!0)):alert("The XYZ file has the wrong format...")}setXyzAtomSeq(e,t,s,i){var n=this.icn3d,r=n.icn3dui;n.dAtoms=r.hashUtilsCls.unionHash(n.dAtoms,e),n.hAtoms=r.hashUtilsCls.unionHash(n.hAtoms,e),n.structures[t]=[s],n.chains[s]=e,n.residues[i]=e,n.residueId2Name[i]="LIG",void 0===n.chainsSeq[s]&&(n.chainsSeq[s]=[]);var a={resi:1,name:"LIG"};n.chainsSeq[s].push(a);for(var l=Object.keys(e),o=0,d=l.length;o<d;++o)for(var c=n.atoms[l[o]],h=o+1,m=l.length;h<m;++h){var p=n.atoms[l[h]],u=1.2*(r.parasCls.covalentRadii[c.elem.toUpperCase()]+r.parasCls.covalentRadii[p.elem.toUpperCase()]);Math.abs(c.coord.x-p.coord.x)>u||(Math.abs(c.coord.y-p.coord.y)>u||Math.abs(c.coord.z-p.coord.z)>u||r.utilsCls.hasCovalentBond(c,p)&&(n.atoms[l[o]].bonds.push(l[h]),n.atoms[l[h]].bonds.push(l[o])))}}loadXyzAtomData(e){var t=this.icn3d;t.icn3dui;var s=e.split(/\r?\n|\r/);if(s.length<3)return!1;t.init();var i,n,r,a={},l=0,o=1;t.molTitle="";for(var d=0,c=s.length;d<c;++d){var h=s[d].trim();if(""!==h&&(""===h||isNaN(h)||(0!==d&&this.setXyzAtomSeq(a,l,i,n),a={},n=(i=(r=++l)+"_A")+"_1",l>1&&(t.molTitle+="; "),t.molTitle+=s[d+1].trim(),d+=2),""!==(h=s[d].trim()))){var m=h.replace(/,/," ").replace(/\s+/g," ").split(" "),p=m[0],u=parseFloat(m[1]),C=parseFloat(m[2]),v=parseFloat(m[3]),g={het:!0,serial:o,name:p,resn:"LIG",structure:r,chain:"A",resi:1,coord:new THREE.Vector3(u,C,v),b:0,elem:p,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.atoms[o]=g,a[o]=1,++o}}return this.setXyzAtomSeq(a,l,i,n),t.ParserUtilsCls.setMaxD(),t.saveFileCls.showTitle(),!0}}class Z{constructor(e){this.icn3d=e}loadMol2Data(e){var t=this.icn3d;t.icn3dui;var s=this.loadMol2AtomData(e);void 0===t.icn3dui.cfg.align&&1==Object.keys(t.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),s?(t.setStyleCls.setAtomStyleByOptions(t.opts),t.setColorCls.setColorByOptions(t.opts,t.atoms),t.ParserUtilsCls.renderStructure(),void 0!==t.icn3dui.cfg.rotate&&t.resizeCanvasCls.rotStruc(t.icn3dui.cfg.rotate,!0)):alert("The Mol2 file has the wrong format...")}loadMol2AtomData(e){var t=this.icn3d;t.icn3dui;var s=e.split(/\r?\n|\r/);if(s.length<4)return!1;t.init();for(var i,n,r="LIG",a={},l="1_A",o=0,d=0,c=1,h=!1,m=!1,p={},u={},C=0,v=s.length;C<v;++C){var g=s[C].trim();if(""!==g&&"#"!==g.substr(0,1)){if("@<TRIPOS>MOLECULE"==g){t.molTitle=s[C+1].trim();var f=s[C+2].trim().replace(/\s+/g," ").split(" ");i=f[0],n=f[1],C+=4}else"@<TRIPOS>ATOM"==g?(c=1,h=!0,++C):"@<TRIPOS>BOND"==g?(m=!0,h=!1,++C):"@<TRIPOS>SUBSTRUCTURE"==g&&(m=!1,++C);if(""!==(g=s[C].trim())&&"#"!==g.substr(0,1)){if(h&&o<i){var b=g.replace(/\s+/g," ").split(" "),y=parseInt(b[0]);p[y]=c;var w,S=b[1],_=parseFloat(b[2]),A=parseFloat(b[3]),x=parseFloat(b[4]),k=new THREE.Vector3(_,A,x),O=b[5],H=O.indexOf(".");if("H"===(w=-1===H?O:O.substr(0,H))&&w===O)u[y]=1;else{var R={het:!0,serial:c,name:S,resn:r,structure:1,chain:"A",resi:1,coord:k,b:0,elem:w,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.atoms[c]=R,a[c]=1,++c}++o}if(m&&d<n){var E=g.replace(/\s+/g," ").split(" "),I=parseInt(E[1]),D=parseInt(E[2]),T=E[3],M=T;if("am"===T&&(M="1"),"ar"===T&&(M="1.5"),!(u.hasOwnProperty(I)||u.hasOwnProperty(D)||"1"!==M&&"2"!==M&&"3"!==M&&"1.5"!==M)){var P=M,F=p[I],L=p[D];t.atoms[F].bonds.push(L),t.atoms[F].bondOrder.push(P),t.atoms[L].bonds.push(F),t.atoms[L].bondOrder.push(P),"2"==P?(t.doublebonds[F+"_"+L]=1,t.doublebonds[L+"_"+F]=1):"3"==P?(t.triplebonds[F+"_"+L]=1,t.triplebonds[L+"_"+F]=1):"1.5"==P&&(t.aromaticbonds[F+"_"+L]=1,t.aromaticbonds[L+"_"+F]=1)}++d}}}}t.dAtoms=a,t.hAtoms=a,t.structures[1]=[l],t.chains["1_A"]=a,t.residues["1_A_1"]=a,t.residueId2Name["1_A_1"]=r,void 0===t.chainsSeq["1_A"]&&(t.chainsSeq["1_A"]=[]);var N={resi:1};return N.name=r,t.chainsSeq["1_A"].push(N),t.ParserUtilsCls.setMaxD(),t.saveFileCls.showTitle(),!0}}class ee{constructor(e){this.icn3d=e}applyDssp(e){for(var t=this.icn3d,s=t.icn3dui,i=this,n=e?"1":"0",r=Object.keys(t.structures),a=[],l=t.icn3dui.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi",o=0,d=r.length;o<d;++o){var c="";c+=t.saveFileCls.getPDBHeader(o);for(var h={},m=t.structures[r[o]],p=0,u=m.length;p<u;++p)h=s.hashUtilsCls.unionHash(h,t.chains[m[p]]);c+=t.saveFileCls.getAtomPDB(h,void 0,!0);var C=$.ajax({url:l,type:"POST",data:{dssp:"t",calphaonly:n,pdbfile:c},dataType:"jsonp",cache:!0});a.push(C)}$.when.apply(void 0,a).then((function(){i.parseDsspData(arguments,r)})).fail((function(){i.parseDsspData(arguments,r)}))}parseDsspData(e,t){var s=this.icn3d;s.icn3dui;for(var i=1==t.length?[e]:e,n=0,r=i.length;n<r;++n){var a=i[n][0];if(void 0!==a&&-1===JSON.stringify(a).indexOf("Oops there was a problem"))for(var l in s.chainsSeq){var o=l.indexOf("_");if(l.substr(0,o)==t[n])for(var d=l.substr(o+1),c=s.chainsSeq[l],h="coil",m=0,p=c.length;m<p;++m){var u,C=c[m].resi,v=d+"_"+C,g="c";a.hasOwnProperty(v)?g=a[v]:a.hasOwnProperty(" _"+C)?g=a[" _"+C]:a.hasOwnProperty("_"+C)&&(g=a["_"+C]),u="H"===g?"helix":"E"===g?"sheet":"coil";var f=l+"_"+C;s.secondaries[f]=g;var b,y,w=0;if(u!==h?"coil"===h?(b=!0,y=!1):"coil"===u?(w=2,b=!1,y=!1):("sheet"===h&&"helix"===u||"helix"===h&&"sheet"===u)&&(w=1,b=!0,y=!1):(b=!1,y=!1),1==w){var S=l+"_"+(C-1).toString();for(var _ in s.residues[S])s.atoms[_].ssbegin=!0,s.atoms[_].ssend=!1}else if(2==w){S=l+"_"+(C-1).toString();for(var _ in s.residues[S])s.atoms[_].ssbegin=!1,s.atoms[_].ssend=!0}for(var _ in s.residues[f])s.atoms[_].ss=u,s.atoms[_].ssbegin=b,s.atoms[_].ssend=y;h=u}}else console.log("DSSP calculation had a problem with this structure "+t[n]+"...")}s.pdbParserCls.loadPdbDataRender(),void 0!==s.deferredSecondary&&s.deferredSecondary.resolve()}}class te{constructor(e){this.icn3d=e}downloadPdb(e){var t,s=this.icn3d;s.icn3dui,t="https://files.rcsb.org/view/"+e+".pdb",s.bCid=void 0,s.ParserUtilsCls.setYourNote(e.toUpperCase()+"(PDB) in iCn3D"),$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){s.ParserUtilsCls.showLoading()},complete:function(){},success:function(t){return s.deferredOpm=$.Deferred((function(){s.opmParserCls.loadOpmData(t,e,void 0,"pdb")})),s.deferredOpm.promise()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}downloadUrl(e,t){var s=this.icn3d;s.icn3dui;var i=this;s.bCid=void 0,$.ajax({url:e,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){s.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){s.InputfileData=e,s.InputfileType=t,"pdb"===t?i.loadPdbData(e):"mol2"===t?s.mol2ParserCls.loadMol2Data(e):"sdf"===t?s.sdfParserCls.loadSdfData(e):"xyz"===t?s.xyzParserCls.loadXyzData(e):"mmcif"===t&&s.mmcifParserCls.loadMmcifData(e)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}loadPdbData(e,t,s){var i=this.icn3d,n=i.icn3dui;if(i.loadPDBCls.loadPDB(e,t,s),void 0===i.icn3dui.cfg.opmid&&i.ParserUtilsCls.transformToOpmOri(t),void 0!==i.biomtMatrices&&i.biomtMatrices.length>1?($("#"+i.pre+"assemblyWrapper").show(),i.asuCnt=i.biomtMatrices.length):$("#"+i.pre+"assemblyWrapper").hide(),void 0!==i.emd?($("#"+i.pre+"mapWrapper1").hide(),$("#"+i.pre+"mapWrapper2").hide(),$("#"+i.pre+"mapWrapper3").hide()):($("#"+i.pre+"emmapWrapper1").hide(),$("#"+i.pre+"emmapWrapper2").hide(),$("#"+i.pre+"emmapWrapper3").hide()),!i.bSecondaryStructure)return i.deferredSecondary=$.Deferred((function(){var e=n.utilsCls.isCalphaPhosOnly(n.hashUtilsCls.hash2Atoms(i.proteins,i.atoms));i.dsspCls.applyDssp(e)})),i.deferredSecondary.promise();this.loadPdbDataRender()}loadPdbDataRender(){var e=this.icn3d;e.icn3dui,e.pmid=e.pmid,void 0===e.icn3dui.cfg.align&&1==Object.keys(e.structures).length&&$("#"+e.pre+"alternateWrapper").hide(),e.setStyleCls.setAtomStyleByOptions(e.opts),e.setColorCls.setColorByOptions(e.opts,e.atoms),e.ParserUtilsCls.renderStructure(),e.saveFileCls.showTitle(),void 0!==e.icn3dui.cfg.rotate&&e.resizeCanvasCls.rotStruc(e.icn3dui.cfg.rotate,!0)}}class se{constructor(e){this.icn3d=e}downloadMmtf(e){var t=this.icn3d;t.icn3dui,t.ParserUtilsCls.setYourNote(e.toUpperCase()+"(MMTF) in iCn3D"),t.bCid=void 0,MMTF.fetchReduced(e,(function(s){if(10*s.numAtoms>t.maxatomcnt){return 0==Object.keys(s).length?void alert("This PDB structure is not found at RCSB..."):(t.deferredOpm=$.Deferred((function(){t.opmParserCls.loadOpmData(s,e,false,"mmtf")})),t.deferredOpm.promise())}s=null,MMTF.fetch(e,(function(s){if(0!=Object.keys(s).length)return t.deferredOpm=$.Deferred((function(){t.opmParserCls.loadOpmData(s,e,true,"mmtf")})),t.deferredOpm.promise();alert("This PDB structure is not found at RCSB...")}),(function(e){}))}),(function(e){}))}parseMmtfData(e,t,s){var i=this.icn3d,n=i.icn3dui;e.numAtoms,i.init();var r=new THREE.Vector3(9999,9999,9999),a=new THREE.Vector3(-9999,-9999,-9999),l=new THREE.Vector3,o=e.structureId;if(i.molTitle=e.title,void 0!==e.bioAssemblyList&&void 0!==e.bioAssemblyList[0]&&e.bioAssemblyList[0].transformList.length>1){i.biomtMatrices=[];for(var d=0,c=e.bioAssemblyList[0].transformList.length;d<c;++d){var h=(new THREE.Matrix4).fromArray(e.bioAssemblyList[0].transformList[d].matrix).transpose();i.biomtMatrices.push(h)}}void 0!==i.biomtMatrices&&i.biomtMatrices.length>1?($("#"+i.pre+"assemblyWrapper").show(),i.asuCnt=i.biomtMatrices.length):$("#"+i.pre+"assemblyWrapper").hide();var m,p,u,C,v,g,f,b,y,w,S,_,A,x,k,O,H,R,E,I={},D=[],T="coil",M="",P=0,F=0,L={onModel:function(e){m=0===e.modelIndex?o:o+(e.modelIndex+1).toString()},onChain:function(e){p=e.chainName;var t=m+"_"+p;void 0===i.structures[m]&&(i.structures[m]=[]),i.structures[m].push(t)},onGroup:function(e){u=e.groupName,C=e.groupId;var t=m+"_"+p+"_"+C;v=0===e.secStruct||2===e.secStruct||4===e.secStruct?"helix":3===e.secStruct?"sheet":-1===e.secStruct?"other":"coil";var s=!1;if(p!==M){if(H=void 0,E=void 0,"coil"!==v&&"other"!==v?(g=!0,f=!1):(g=!1,f=!1),"coil"!==T&&"other"!==T){var r=m+"_"+M+"_"+P.toString();for(var a in i.residues[r])i.atoms[a].ssbegin=!1,i.atoms[a].ssend=!0}}else H=O,E=R,v!==T?"coil"===T||"other"===T?(g=!0,f=!1):"coil"===v||"other"===v?(s=!0,g=!1,f=!1):("sheet"===T&&"helix"===v||"helix"===T&&"sheet"===v)&&(s=!0,g=!0,f=!1):(g=!1,f=!1);if(s){r=m+"_"+p+"_"+(C-1).toString();for(var a in i.residues[r])i.atoms[a].ssbegin=!1,i.atoms[a].ssend=!0}T=v,M=p,P=C,b=!1,y=!1,w=!1,"non-polymer"===e.chemCompType.toLowerCase()||"other"===e.chemCompType.toLowerCase()||-1!==e.chemCompType.toLowerCase().indexOf("saccharide")?b=!0:-1!==e.chemCompType.toLowerCase().indexOf("peptide")?y=!0:-1!==e.chemCompType.toLowerCase().indexOf("dna")||-1!==e.chemCompType.toLowerCase().indexOf("rna")?w=!0:y=!0;var l=m+"_"+p,o={};o.resi=C,o.name=n.utilsCls.residueName2Abbr(u),i.residueId2Name[t]=o.name,o.resi%10==0&&o.resi.toString();var d="-";"helix"===v?d="H":"sheet"===v?d="E":"coil"===v?d="c":"other"===v&&(d="o"),void 0===i.chainsSeq[l]&&(i.chainsSeq[l]=[]),i.bFullUi&&i.chainsSeq[l].push(o),i.secondaries[t]=d},onAtom:function(e){if(S=e.element,_=e.atomName,A=new THREE.Vector3(e.xCoord,e.yCoord,e.zCoord),x=e.bFactor,k=e.altLoc,"\0"===e.altLoc&&(k=""),""===k||"A"===k){++F,"SG"===_&&D.push(F),I[e.atomIndex]=F;var t={het:b,serial:F,name:_,alt:k,resn:u,structure:m,chain:p,resi:C,coord:A,b:x,elem:S,bonds:[],bondOrder:[],ss:v,ssbegin:g,ssend:f};if(t.het||"C"!==t.name||(O=F),t.het||"O"!==t.name||(R=F),!t.het&&"N"===t.name&&void 0!==H&&void 0!==E){var n=i.atoms[H].coord.distanceTo(i.atoms[E].coord),o=t.coord.x+(i.atoms[H].coord.x-i.atoms[E].coord.x)/n,d=t.coord.y+(i.atoms[H].coord.y-i.atoms[E].coord.y)/n,c=t.coord.z+(i.atoms[H].coord.z-i.atoms[E].coord.z)/n;t.hcoord=new THREE.Vector3(o,d,c)}i.atoms[F]=t,r.min(A),a.max(A),l.add(A);var h=m+"_"+p,T=h+"_"+C;void 0===i.chains[h]&&(i.chains[h]={}),i.chains[h][F]=1,void 0===i.residues[T]&&(i.residues[T]={}),i.residues[T][F]=1,y?(i.proteins[F]=1,"CA"===_&&(i.calphas[F]=1),"N"!==_&&"CA"!==_&&"C"!==_&&"O"!==_&&(i.sidec[F]=1)):w?(i.nucleotides[F]=1,(!s||"O3'"!=_&&"O3*"!=_)&&(s||"P"!=_)||(i.nucleotidesO3[F]=1)):S.toLowerCase()===u.toLowerCase()?i.ions[F]=1:"HOH"===u||"WAT"===u||"SQL"===u||"H2O"===u||"W"===u||"DOD"===u||"D3O"===u?i.water[F]=1:i.chemicals[F]=1,i.dAtoms[F]=1,i.hAtoms[F]=1}},onBond:function(e){var t=I[e.atomIndex1],s=I[e.atomIndex2];if(I.hasOwnProperty(e.atomIndex1)&&I.hasOwnProperty(e.atomIndex2)&&(i.atoms[t].bonds.push(s),i.atoms[s].bonds.push(t),b)){var n=e.bondOrder;i.atoms[t].bondOrder.push(n),i.atoms[s].bondOrder.push(n),2===n?(i.doublebonds[t+"_"+s]=1,i.doublebonds[s+"_"+t]=1):3===n&&(i.triplebonds[t+"_"+s]=1,i.triplebonds[s+"_"+t]=1)}}};MMTF.traverse(e,L);for(d=0,c=D.length;d<c;++d)for(var N=d+1;N<c;++N){var U=D[d],q=D[N],j=i.atoms[U],B=i.atoms[q];if(-1!==$.inArray(q,j.bonds)){var z=j.structure+"_"+j.chain+"_"+j.resi,G=B.structure+"_"+B.chain+"_"+B.resi;void 0===i.ssbondpnts[j.structure]&&(i.ssbondpnts[j.structure]=[]),i.ssbondpnts[j.structure].push(z),i.ssbondpnts[j.structure].push(G)}}i.cnt=F,(i.cnt>i.maxatomcnt||void 0!==i.biomtMatrices&&i.biomtMatrices.length*i.cnt>10*i.maxatomcnt)&&(i.opts.proteins="c alpha trace",i.opts.nucleotides="o3 trace"),i.pmin=r,i.pmax=a,i.maxD=a.distanceTo(r),i.center=l.multiplyScalar(1/i.cnt),i.maxD<5&&(i.maxD=5),i.oriMaxD=i.maxD,i.oriCenter=i.center.clone(),i.ParserUtilsCls.transformToOpmOri(t),void 0===i.icn3dui.cfg.align&&1==Object.keys(i.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),i.setStyleCls.setAtomStyleByOptions(i.opts),i.setColorCls.setColorByOptions(i.opts,i.atoms),i.ParserUtilsCls.renderStructure(),i.saveFileCls.showTitle(),void 0!==i.icn3dui.cfg.rotate&&i.resizeCanvasCls.rotStruc(i.icn3dui.cfg.rotate,!0)}}class ie{constructor(e){this.icn3d=e}downloadAlignment(e){var t=this.icn3d,s=t.icn3dui,i=this;t.opts.proteins="c alpha trace";var n=e.split(","),r="ids="+e,a=t.icn3dui.htmlCls.baseUrl+"vastplus/vastplus.cgi?v=3&cmd=c&b=1&s=1&w3d&"+r;void 0!==t.icn3dui.cfg.inpara&&(a+=t.icn3dui.cfg.inpara),t.bCid=void 0,t.pdbid_chain2title={},void 0===t.chainids2resids&&(t.chainids2resids={});var l=$.ajax({url:a,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}}),o={};l.then((function(e){if(void 0===(o=e.seqalign))return alert("These two MMDB IDs "+n+" do not have 3D alignment data."),!1;t.pdbid_molid2chain={},t.chainsColor={};for(var r=0,a=2;r<a;++r)for(var l=void 0!==(C=e.alignedStructures[0][r]).pdbId?C.pdbId:C.mmdbId,d={},c=0,h=C.molecules.length;c<h;++c){var m=(v=C.molecules[c]).moleculeId,p=v.chain.trim();void 0===d[p]?d[p]=1:++d[p];var u=1===d[p]?p:p+d[p].toString();t.pdbid_molid2chain[l+"_"+m]=u,"p"!==v.kind&&"n"!==v.kind||(t.chainsColor[l+"_"+u]=s.parasCls.thr(t.icn3dui.htmlCls.GREY8))}t.mmdbidArray=[];for(r=0,a=2;r<a;++r){var C;l=(C=e.alignedStructures[0][r]).pdbId;t.mmdbidArray.push(l);var v=C.molecules;for(var g in v){var f=v[g].chain;t.pdbid_chain2title[l+"_"+f]=v[g].name}}t.alignmolid2color=[],s.parasCls.stdChainColors.length;for(r=0,a=o.length;r<a;++r){var b=o[r][0].moleculeId,y=o[r][1].moleculeId,w={};w[b]=(r+1).toString(),t.alignmolid2color.push(w),(w={})[y]=(r+1).toString(),t.alignmolid2color.push(w)}var S=t.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+t.mmdbidArray[0],_=t.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+t.mmdbidArray[1],A=$.ajax({url:S,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}}),x=$.ajax({url:_,dataType:"jsonp",cache:!0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){}});$.when(A,x).then((function(s,n){var r=e,a=s[0],l=n[0];return void 0!==a.atoms&&void 0!==l.atoms?(t.deferredOpm=$.Deferred((function(){t.ParserUtilsCls.setYourNote((t.mmdbidArray[0]+","+t.mmdbidArray[1]).toUpperCase()+"(VAST+) in iCn3D");for(var e=r.transform.translate.master,s=new THREE.Vector3(e[0]/1,e[1]/1,e[2]/1),n=r.transform.translate.slave,d=new THREE.Vector3(n[0]/1,n[1]/1,n[2]/1),c=r.transform.rotate,h=[],m=0,p=c.length;m<p;++m)h.push(c[m]/1);for(var u in t.chainid2seq={},a.sequences){var C=t.mmdbidArray[0]+"_"+u;t.chainid2seq[C]=a.sequences[u]}for(var u in l.sequences){C=t.mmdbidArray[1]+"_"+u;t.chainid2seq[C]=l.sequences[u]}var v=a.atoms,g=l.atoms,f=a.atomCount,b=l.atomCount;for(m=0,p=r.alignedStructures[0].length;m<p;++m){var y=r.alignedStructures[0][m];y.serialInterval=[],0==m?(y.serialInterval.push(1),y.serialInterval.push(f)):1==m&&(y.serialInterval.push(f+1),y.serialInterval.push(f+b))}var w={};for(var m in v){(x=v[m]).coord=new THREE.Vector3(x.coord[0],x.coord[1],x.coord[2]),x.coord.add(s);var S=x.coord.x*h[0]+x.coord.y*h[1]+x.coord.z*h[2],_=x.coord.x*h[3]+x.coord.y*h[4]+x.coord.z*h[5],A=x.coord.x*h[6]+x.coord.y*h[7]+x.coord.z*h[8];x.coord.x=S,x.coord.y=_,x.coord.z=A,w[m]=x}for(var m in g){var x;(x=g[m]).coord=new THREE.Vector3(x.coord[0],x.coord[1],x.coord[2]),x.coord.add(d);for(var k=0,O=x.bonds.length;k<O;++k)x.bonds[k]+=f;w[(parseInt(m)+f).toString()]=x}var H={};H.alignedStructures=r.alignedStructures,H.alignment=r.alignment,H.atoms=w,i.loadOpmDataForAlign(H,o,t.mmdbidArray)})),t.deferredOpm.promise()):(alert("invalid atoms data."),!1)}))}))}downloadAlignmentPart2(e,t,s){var i=this.icn3d;i.icn3dui,i.loadAtomDataCls.loadAtomDataIn(e,void 0,"align",t),void 0===i.icn3dui.cfg.align&&1==Object.keys(i.structures).length&&$("#"+i.pre+"alternateWrapper").hide();var n={};for(var r in i.atoms)n[r]=1;i.dAtoms=n,i.hAtoms=n,i.setStyleCls.setAtomStyleByOptions(i.opts),i.setColorCls.setColorByOptions(i.opts,i.atoms),void 0!==s&&i.ParserUtilsCls.transformToOpmOriForAlign(i.selectedPdbid,s,!0),i.ParserUtilsCls.renderStructure(),void 0!==i.icn3dui.cfg.rotate&&i.resizeCanvasCls.rotStruc(i.icn3dui.cfg.rotate,!0),i.html2ddgm="",i.icn3dui.cfg.showalignseq&&i.icn3dui.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),i.icn3dui.cfg.show2d&&i.bFullUi&&i.ParserUtilsCls.set2DDiagramsForAlign(i.mmdbidArray[0].toUpperCase(),i.mmdbidArray[1].toUpperCase())}loadOpmDataForAlign(e,t,s){var i=this.icn3d;i.icn3dui;var n,r,a=this;n="https://opm-assets.storage.googleapis.com/pdb/"+s[0].toLowerCase()+".pdb",r="text",$.ajax({url:n,dataType:r,cache:!0,success:function(n){i.selectedPdbid=s[0],i.bOpm=!0;var r=i.loadPDBCls.loadPDB(n,s[0],i.bOpm,!0);$("#"+i.pre+"selectplane_z1").val(i.halfBilayerSize),$("#"+i.pre+"selectplane_z2").val(-i.halfBilayerSize),$("#"+i.pre+"extra_mem_z").val(i.halfBilayerSize),$("#"+i.pre+"intra_mem_z").val(-i.halfBilayerSize),i.init(),a.downloadAlignmentPart2(e,t,r),void 0!==i.deferredOpm&&i.deferredOpm.resolve()},error:function(n,l,o){var d="https://opm-assets.storage.googleapis.com/pdb/"+s[1].toLowerCase()+".pdb";$.ajax({url:d,dataType:r,cache:!0,success:function(n){i.selectedPdbid=s[1],i.bOpm=!0;var r=i.loadPDBCls.loadPDB(n,s[1],i.bOpm,!0);$("#"+i.pre+"selectplane_z1").val(i.halfBilayerSize),$("#"+i.pre+"selectplane_z2").val(-i.halfBilayerSize),$("#"+i.pre+"extra_mem_z").val(i.halfBilayerSize),$("#"+i.pre+"intra_mem_z").val(-i.halfBilayerSize),i.init(),a.downloadAlignmentPart2(e,t,r),void 0!==i.deferredOpm&&i.deferredOpm.resolve()},error:function(s,n,r){i.init(),a.downloadAlignmentPart2(e,t),void 0!==i.deferredOpm&&i.deferredOpm.resolve()}})}})}}class ne{constructor(e){this.icn3d=e}downloadOpm(e){var t,s=this.icn3d;s.icn3dui,t="https://opm-assets.storage.googleapis.com/pdb/"+e.toLowerCase()+".pdb",s.ParserUtilsCls.setYourNote(e.toUpperCase()+"(OPM) in iCn3D"),s.bCid=void 0,s.bStopRotate=!0,$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){s.ParserUtilsCls.showLoading()},complete:function(){},success:function(t){s.bOpm=!0,s.pdbParserCls.loadPdbData(t,e,s.bOpm),$("#"+s.pre+"selectplane_z1").val(s.halfBilayerSize),$("#"+s.pre+"selectplane_z2").val(-s.halfBilayerSize),$("#"+s.pre+"extra_mem_z").val(s.halfBilayerSize),$("#"+s.pre+"intra_mem_z").val(-s.halfBilayerSize)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("This is probably not a transmembrane protein. It has no data in Orientations of Proteins in Membranes(OPM) database.")}})}addOneDumAtom(e,t,s,i,n,r){var a=this.icn3d,l=a.icn3dui,o={het:!0,serial:++r,name:t,alt:void 0,resn:"DUM",structure:e,chain:"MEM",resi:1,coord:new THREE.Vector3(s,i,n),b:void 0,elem:t,bonds:[],ss:"",ssbegin:!1,ssend:!1,color:l.parasCls.atomColors[t]};return a.atoms[r]=o,a.chains[e+"_MEM"][r]=1,a.residues[e+"_MEM_1"][r]=1,a.chemicals[r]=1,a.dAtoms[r]=1,a.hAtoms[r]=1,r}addMemAtoms(e,t,s){var i=this.icn3d;i.icn3dui;t=t?t.toUpperCase():"stru",i.structures[t].push(t+"_MEM"),i.chains[t+"_MEM"]={},i.residues[t+"_MEM_1"]={},i.chainsSeq[t+"_MEM"]=[{name:"DUM",resi:1}];for(var n=Object.keys(i.atoms).length,r=0;r<1e3;++r)if(!i.atoms.hasOwnProperty(n+r)){n=n+r-1;break}for(r=0;r<81;++r)for(var a=0;a<81;++a){var l=2*r-80,o=2*a-80;if(Math.sqrt(l*l+o*o)<s){var d=-e-.4;n=this.addOneDumAtom(t,"N",l,o,d,n),d=e+.4,n=this.addOneDumAtom(t,"O",l,o,d,n)}}}loadOpmData(e,t,s,i,n){this.icn3d.icn3dui;var r,a=this;t||(t="stru"),r="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&opm&uid="+t.toLowerCase(),$.ajax({url:r,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(r){a.setOpmData(r),a.parseAtomData(e,t,s,i,n)},error:function(r,l,o){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):a.parseAtomData(e,t,s,i,n)}})}setOpmData(e){var t=this.icn3d;t.icn3dui,void 0!==e.opm&&void 0!==e.opm.rot?(t.bOpm=!0,t.halfBilayerSize=e.opm.thickness,t.rmsd_supr={},t.rmsd_supr.rot=e.opm.rot,t.rmsd_supr.trans1=new THREE.Vector3(e.opm.trans1[0],e.opm.trans1[1],e.opm.trans1[2]),t.rmsd_supr.trans2=new THREE.Vector3(e.opm.trans2[0],e.opm.trans2[1],e.opm.trans2[2]),t.rmsd_supr.rmsd=e.opm.rmsd,$("#"+t.pre+"selectplane_z1").val(t.halfBilayerSize),$("#"+t.pre+"selectplane_z2").val(-t.halfBilayerSize),$("#"+t.pre+"extra_mem_z").val(t.halfBilayerSize),$("#"+t.pre+"intra_mem_z").val(-t.halfBilayerSize)):t.bOpm=!1}parseAtomData(e,t,s,i,n){var r=this.icn3d;r.icn3dui,"mmtf"===i?(r.mmtfParserCls.parseMmtfData(e,t,s),void 0!==r.deferredOpm&&r.deferredOpm.resolve()):"mmcif"===i?(r.loadAtomDataCls.loadAtomDataIn(e,e.mmcif,"mmcifid",void 0,void 0),r.mmcifParserCls.loadMmcifOpmDataPart2(e,t),void 0!==r.deferredOpm&&r.deferredOpm.resolve()):"pdb"===i?(r.pdbParserCls.loadPdbData(e,t),void 0!==r.deferredOpm&&r.deferredOpm.resolve()):"align"===i&&(r.bOpm?(r.alignParserCls.downloadAlignmentPart2(t),void 0!==r.deferredOpm&&r.deferredOpm.resolve()):void 0!==n?this.loadOpmData(e,n,s,i):(r.alignParserCls.downloadAlignmentPart2(t),void 0!==r.deferredOpm&&r.deferredOpm.resolve()))}}class re{constructor(e){this.icn3d=e}parseMmdbDataPart1(e,t){var s=this.icn3d,i=s.icn3dui;if(void 0===e.atoms&&void 0===e.molid2rescount)return alert("invalid MMDB data."),!1;void 0!==t&&"target"!==t||(s.bStatefile||s.init(),s.chainsColor={},s.chainsGene={}),"query"===t||(s.interactionData={moleculeInfor:e.moleculeInfor,intrac:e.intrac,intracResidues:e.intracResidues}),"query"===t||(s.mmdb_data=e);var n=void 0!==e.pdbId?e.pdbId:e.mmdbId;"query"===t?s.inputid2=n:s.inputid=n;var r=e.moleculeInfor,a={},l={};for(var o in r)if(0!==Object.keys(r[o]).length){var d=void 0===r[o].color?"#CCCCCC":"#"+("000000"+r[o].color.toString(16)).slice(-6),c=void 0===r[o].chain?"":r[o].chain.trim();void 0===l[c]?l[c]=1:++l[c];var h=n+"_"+(1===l[c]?c:c+l[c].toString());a[o]=h,s.chainsColor[h]=void 0!==t?i.parasCls.thr(s.icn3dui.htmlCls.GREY8):i.parasCls.thr(d);var m=void 0===r[o].geneId?"":r[o].geneId,p=void 0===r[o].geneSymbol?"":r[o].geneSymbol,u=void 0===r[o].geneDesc?"":r[o].geneDesc;s.chainsGene[h]={geneId:m,geneSymbol:p,geneDesc:u}}s.molid2chain=a,$("#"+s.pre+"accordion5").show()}parseMmdbData(e,t,s,i,n){var r=this.icn3d;if(r.icn3dui,void 0!==t){this.parseMmdbDataPart1(e,t);l=void 0!==e.pdbId?e.pdbId:e.mmdbId;var a=r.loadAtomDataCls.loadAtomDataIn(e,l,"mmdbid",void 0,t,s,i,n);return this.loadMmdbOpmDataPart2(e,l,t),a}var l=void 0!==e.pdbId?e.pdbId:e.mmdbId;this.loadMmdbOpmData(e,l,t)}downloadMmdb(e,t){var s,i=this.icn3d,n=i.icn3dui,r=this;s=t?i.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&simple=1&gi="+e:i.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&simple=1&uid="+e,void 0!==i.icn3dui.cfg.blast_rep_id&&(s+="&buidx=0"),i.bCid=void 0,void 0!==i.icn3dui.cfg.inpara&&(s+=i.icn3dui.cfg.inpara),void 0===i.chainids2resids&&(i.chainids2resids={}),$.ajax({url:s,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(a){if(0!=Object.keys(a.atoms).length){n.utilsCls.isCalphaPhosOnly(a.atoms)||a.atomCount<=i.maxatomcnt?r.parseMmdbData(a):(a=null,$.ajax({url:s+"&complexity=2",dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){r.parseMmdbData(e)},error:function(s,n,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+i.icn3dui.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: "+i.icn3dui.htmlCls.baseUrl+"pdb/"+e)}}))}else{var l=a.pdbId;i.mmtfParserCls.downloadMmtf(l)}},error:function(s,n,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+i.icn3dui.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: "+i.icn3dui.htmlCls.baseUrl+"pdb/"+e)}})}downloadMmdbPart2(e){var t=this.icn3d;t.icn3dui,t.bAssemblyUseAsu?($("#"+t.pre+"assemblyWrapper").show(),t.bAssembly=!0):($("#"+t.pre+"assemblyWrapper").hide(),t.bAssembly=!1),void 0!==t.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),t.setStyleCls.setAtomStyleByOptions(t.opts),void 0!==t.icn3dui.cfg.blast_rep_id?t.setColorCls.setColorByOptions(t.opts,t.atoms):t.setColorCls.setColorByOptions(t.opts,t.atoms,!0),void 0===e&&(t.ParserUtilsCls.renderStructure(),void 0!==t.icn3dui.cfg.rotate&&t.resizeCanvasCls.rotStruc(t.icn3dui.cfg.rotate,!0),t.html2ddgm="",t.icn3dui.cfg.show2d&&(t.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),t.bFullUi&&t.ParserUtilsCls.download2Ddgm(t.inputid.toUpperCase()))),void 0!==t.icn3dui.cfg.align&&void 0!==t.icn3dui.cfg.chainalign||1!=Object.keys(t.structures).length||null!==$("#"+t.pre+"alternateWrapper")&&$("#"+t.pre+"alternateWrapper").hide()}downloadGi(e){var t=this.icn3d;t.icn3dui,t.bCid=void 0;this.downloadMmdb(e,!0)}downloadBlast_rep_id(e){var t=this.icn3d;t.icn3dui,t.bCid=void 0;var s=e.split(",");t.icn3dui.cfg.query_id=s[0],t.icn3dui.cfg.blast_rep_id=s[1];var i=t.icn3dui.cfg.blast_rep_id.split("_")[0];this.downloadMmdb(i)}loadMmdbOpmData(e,t,s){var i=this.icn3d;i.icn3dui,void 0!==e.opm&&void 0!==e.opm.rot?(i.bOpm=!0,i.opmParserCls.setOpmData(e),this.parseMmdbDataPart1(e,s),i.loadAtomDataCls.loadAtomDataIn(e,t,"mmdbid",void 0,s),this.loadMmdbOpmDataPart2(e,t,s)):(this.parseMmdbDataPart1(e,s),i.loadAtomDataCls.loadAtomDataIn(e,t,"mmdbid",void 0,s),this.loadMmdbOpmDataPart2(e,t,s))}loadMmdbOpmDataPart2(e,t,s){var i=this.icn3d;i.icn3dui;var n=this,r=e.pdbId;for(var a in void 0===s&&i.ParserUtilsCls.setYourNote(r.toUpperCase()+"(MMDB) in iCn3D"),e.domains)for(var l=e.domains[a].chain,o=e.domains[a].domains,d=0,c=o.length;d<c;++d){var h=r+"_"+l+"_3d_domain_"+(d+1).toString();i.tddomains[h]={};for(var m=o[d].intervals,p={},u={},C=0,v=m.length;C<v;++C){var g=Math.round(m[C][0])-1,f=Math.round(m[C][1])-1;if(!p.hasOwnProperty(g)&&!u.hasOwnProperty(f)){p[g]=1,u[f]=1;for(var b=g;b<=f;++b){var y=r+"_"+l+"_"+(b+1).toString();i.tddomains[h][y]=1}}}}i.bAssemblyUseAsu=void 0!==e.asuAtomCount,void 0!==s?(i.bAssemblyUseAsu=!1,this.downloadMmdbPart2(s)):$.when(i.mmcifParserCls.downloadMmcifSymmetry(t)).then((function(){n.downloadMmdbPart2(s)}))}}class ae{constructor(e){this.icn3d=e}realign(){var e=this.icn3d,t=e.icn3dui;e.selectionCls.saveSelectionPrep();var s="alseq_"+Object.keys(e.defNames2Atoms).length;e.selectionCls.saveSelection(s,s);var i={};e.realignResid={};var n="";for(var r in e.hAtoms){var a=e.atoms[r];if(e.proteins.hasOwnProperty(r)&&"CA"==a.name||e.nucleotides.hasOwnProperty(r)&&("O3'"==a.name||"O3*"==a.name)){if(a.structure+"_"+a.resi==n)continue;i.hasOwnProperty(a.structure)||(i[a.structure]=[]),i[a.structure].push(a.coord.clone()),e.realignResid.hasOwnProperty(a.structure)||(e.realignResid[a.structure]=[]),e.realignResid[a.structure].push({resid:a.structure+"_"+a.chain+"_"+a.resi,resn:t.utilsCls.residueName2Abbr(a.resn.substr(0,3)).substr(0,1)}),n=a.structure+"_"+a.resi}}var l=Object.keys(i),o=l[0],d=l[1],c=i[d],h=i[o];e.ParserUtilsCls.alignCoords(c,h,d,!0),e.hlUpdateCls.updateHlAll()}parseChainRealignData(e,t,s,i,n,r,a){var l=this.icn3d,o=l.icn3dui,d=2==s.length?[e]:e,c=s[0].substr(0,s[0].indexOf("_"));a||(c=c.toUpperCase());var h={};l.realignResid={},l.opts.color="grey",l.setColorCls.setColorByOptions(l.opts,l.dAtoms);for(var m=0,p=d.length;m<p;++m){var u=d[m][0],C=s[m+1].substr(0,s[m+1].indexOf("_"));a||(C=C.toUpperCase()),c==C&&(C+=l.icn3dui.htmlCls.postfix);var v,g,f=i[c],b=i[C],y=n[c],w=n[C],S=r[c],_=r[C];if(void 0!==u.data){v=u.data[0].query;var A=Object.keys(u.data[0].targets)[0];g=(g=u.data[0].targets[A]).hsps[0]}if(void 0!==v&&void 0!==g){var x=[],k=[];l.realignResid[c]=[],l.realignResid[C]=[];for(var O=g.segs,H=0,R=O.length;H<R;++H)for(var E=O[H],I="",D="",T=0;T<=E.orito-E.orifrom;++T){var M=S[T+E.orifrom].substr(0,S[T+E.orifrom].lastIndexOf("_")),P=_[T+E.from].substr(0,_[T+E.from].lastIndexOf("_"));y[T+E.orifrom]&&w[T+E.from]&&(x.push(y[T+E.orifrom]),k.push(w[T+E.from]),f[T+E.orifrom],b[T+E.from],(0==T||I==M&&D==P||I!=M&&D!=P)&&(l.realignResid[c].push({resid:S[T+E.orifrom],resn:f[T+E.orifrom]}),l.realignResid[C].push({resid:_[T+E.from],resn:b[T+E.from]})),I=M,D=P)}var F=s[0],L=s[m+1],N=l.ParserUtilsCls.alignCoords(k,x,C,void 0,F,L,m+1,!0);h=o.hashUtilsCls.unionHash(h,N)}else void 0!==C||l.icn3dui.cfg.command?(f.length<6||b.length<6)&&!l.icn3dui.cfg.command?alert("These sequences are too short for alignment"):f.length>=6&&b.length>=6&&!l.icn3dui.cfg.command&&alert("These sequences can not be aligned to each other"):alert("Please do not align residues in the same structure")}a?(l.dAtoms=h,l.hAtoms=h,l.opts.color="identity",l.setColorCls.setColorByOptions(l.opts,l.atoms),l.drawCls.draw(),l.hlUpdateCls.updateHlAll(),void 0!==l.deferredRealign&&l.deferredRealign.resolve()):l.chainalignParserCls.downloadChainalignmentPart3(t,s,h)}realignOnSeqAlign(){var e=this.icn3d;e.icn3dui;for(var t=e.firstAtomObjCls.getChainsFromAtoms(e.hAtoms),s=Object.keys(t),i=[],n="",r=0,a=s.length;r<a;++r)s[r]!=n&&i.push(s[r]),n=s[r];this.realignChainOnSeqAlign(void 0,i,!0)}realignChainOnSeqAlign(e,t,s){for(var i,n=this.icn3d,r=n.icn3dui,a=this,l={},o={},d={},c=[],h=0,m=t.length;h<m;++h){var p=t[h].indexOf("_"),u=t[h].substr(0,p);s||(u=u.toUpperCase()),0==h?i=u:i==u&&(u+=n.icn3dui.htmlCls.postfix);var C=u+t[h].substr(p);if(l.hasOwnProperty(u)||(l[u]="",o[u]=[],d[u]=[]),0==h){var v,g=n.chainsSeq[C][0].resi;if(s){var f=n.chainsSeq[C].length,b=n.chainsSeq[C][f-1].resi;v=g.toString()+"-"+b.toString()}for(var y=s?[v]:n.icn3dui.cfg.resnum.split(","),w=0,S=y.length;w<S;++w)if(-1!=y[w].indexOf("-")){for(var _=y[w].split("-"),A=parseInt(_[0]);A<=parseInt(_[1]);++A)if(n.chainsSeq[C][A-g]&&-1!=r.parasCls.b62ResArray.indexOf(n.chainsSeq[C][A-g].name)){l[u]+=n.chainsSeq[C][A-g].name;var x=!1;for(var k in n.residues[C+"_"+A]){var O=n.atoms[k];if(n.proteins.hasOwnProperty(k)&&"CA"==O.name&&"C"==O.elem||n.nucleotides.hasOwnProperty(k)&&("O3'"==O.name||"O3*"==O.name)&&"O"==O.elem){o[u].push(O.coord.clone()),x=!0;break}}x||o[u].push(void 0),d[u].push(C+"_"+A)}}else{A=parseInt(y[w]);l[u]+=n.chainsSeq[C][A-g].name;x=!1;for(var k in n.residues[C+"_"+A]){O=n.atoms[k];if(n.proteins.hasOwnProperty(k)&&"CA"==O.name&&"C"==O.elem||n.nucleotides.hasOwnProperty(k)&&("O3'"==O.name||"O3*"==O.name)&&"O"==O.elem){o[u].push(O.coord.clone()),x=!0;break}}x||o[u].push(void 0),d[u].push(C+"_"+A)}}else for(w=0,S=n.chainsSeq[C].length;w<S;++w){l[u]+=n.chainsSeq[C][w].name;var H=C+"_"+n.chainsSeq[C][w].resi;x=!1;for(var k in n.residues[H]){O=n.atoms[k];if(n.proteins.hasOwnProperty(k)&&"CA"==O.name&&"C"==O.elem||n.nucleotides.hasOwnProperty(k)&&("O3'"==O.name||"O3*"==O.name)&&"O"==O.elem){o[u].push(O.coord.clone()),x=!0;break}}x||o[u].push(void 0),d[u].push(H)}if(h>0){var R=u,E=l[i],I=l[R],D=$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=chainalign",type:"POST",data:{targets:E,queries:I},dataType:"jsonp",cache:!0});c.push(D)}}$.when.apply(void 0,c).then((function(){a.parseChainRealignData(arguments,e,t,l,o,d,s)})).fail((function(){alert("The realignment did notwork...")}))}}class le{constructor(e){this.icn3d=e}downloadChainalignmentPart2(e,t,s,i){var n=this.icn3d,r=n.icn3dui,a={};a=n.mmdbParserCls.parseMmdbData(e,"target",i[0],0);for(var l=!1,o=0,d=t.length;o<d;++o){o==t.length-1&&(l=!0);var c=n.mmdbParserCls.parseMmdbData(t[o],"query",i[o+1],o,l);a=r.hashUtilsCls.unionHash(a,c)}n.icn3dui.cfg.resnum?n.realignParserCls.realignChainOnSeqAlign(s,i):this.downloadChainalignmentPart3(s,i,a)}downloadChainalignmentPart3(e,t,s){var i=this.icn3d;i.icn3dui;var n={};for(var r in i.atoms)n[r]=1;if(i.dAtoms=n,i.hAtoms=n,i.setStyleCls.setAtomStyleByOptions(i.opts),i.opts.color="identity",i.setColorCls.setColorByOptions(i.opts,i.atoms),void 0!==e&&i.ParserUtilsCls.transformToOpmOriForAlign(i.selectedPdbid,e,!0),i.dAtoms=s,i.hAtoms=s,i.ParserUtilsCls.renderStructure(),i.chainidArray.length>2){var a={};for(var r in s){var l=i.atoms[r];a[l.structure+"_"+l.chain+"_"+l.resi]=1}var o="select "+i.resid2specCls.residueids2spec(Object.keys(a));i.selectionCls.addCustomSelection(Object.keys(a),"protein_aligned","protein aligned",o,!0)}i.hlUpdateCls.updateHlAll(),void 0!==i.icn3dui.cfg.rotate&&i.resizeCanvasCls.rotStruc(i.icn3dui.cfg.rotate,!0),i.html2ddgm="",i.icn3dui.cfg.showalignseq&&i.icn3dui.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),i.icn3dui.cfg.show2d&&i.bFullUi&&(i.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),i.bFullUi&&(i.bChainAlign?i.ParserUtilsCls.set2DDiagramsForChainalign(t):i.ParserUtilsCls.download2Ddgm(i.inputid.toUpperCase())))}downloadChainalignment(e,t){var s=this.icn3d;s.icn3dui;var i=this;s.opts.proteins="c alpha trace";for(var n=e.split(","),r=0,a=n.length;r<a;++r){var l=n[r],o=l.indexOf("_");n[r]=l.substr(0,o).toUpperCase()+l.substr(o)}s.chainidArray=n;var d=n[0].indexOf("_");s.mmdbid_t=n[0].substr(0,d).toUpperCase(),s.chain_t=n[0].substr(d+1);var c=s.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+s.mmdbid_t;void 0!==s.icn3dui.cfg.inpara&&(c+=s.icn3dui.cfg.inpara);var h=[],m=$.ajax({url:c,dataType:"jsonp",cache:!0});h.push(m),s.ParserUtilsCls.setYourNote(e.toUpperCase()+" in iCn3D"),s.bCid=void 0,s.pdbid_chain2title={},void 0===s.chainids2resids&&(s.chainids2resids={});for(var p=1,u=n.length;p<u;++p){var C=n[p].indexOf("_");s.mmdbid_q=n[p].substr(0,C).toUpperCase(),s.chain_q=n[p].substr(C+1);var v=s.mmdbid_q+"_"+s.chain_q+","+s.mmdbid_t+"_"+s.chain_t,g=s.icn3dui.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?chainpairs="+v,f=s.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+s.mmdbid_q;void 0!==s.icn3dui.cfg.inpara&&(f+=s.icn3dui.cfg.inpara);var b=$.ajax({url:f,dataType:"jsonp",cache:!0});if(h.push(b),!s.icn3dui.cfg.resnum){var y=$.ajax({url:g,dataType:"jsonp",cache:!0});h.push(y)}}$.when.apply(void 0,h).then((function(){i.parseChainAlignData(arguments,n,s.mmdbid_t,s.chain_t)})).fail((function(){i.parseChainAlignData(arguments,n,s.mmdbid_t,s.chain_t)}))}parseChainAlignData(e,t,s,i){var n=this.icn3d;n.icn3dui;var r=1==t.length?[e]:e,a=r[0][0];n.t_trans_add=[],n.q_trans_sub=[],n.q_rotation=[],n.qt_start_end=[],n.mmdbidArray=[],n.mmdbidArray.push(s);for(var l=[],o=n.icn3dui.cfg.resnum?1:2,d=1,c=r.length;d<c;d+=o){var h=r[d][0],m=parseInt(d/o),p=t[m].indexOf("_"),u=t[m].substr(0,p).toUpperCase(),C=t[m].substr(p+1);if(n.icn3dui.cfg.resnum)void 0!==h&&-1===JSON.stringify(h).indexOf("Oops there was a problem")&&(n.mmdbidArray.push(u),l.push(h));else{var v=r[d+1][0];void 0!==h&&-1===JSON.stringify(h).indexOf("Oops there was a problem")&&void 0!==v&&-1===JSON.stringify(v).indexOf("Oops there was a problem")&&(void 0!==v&&0!=v.length||u!=s||C!=i?void 0===v||0==v.length?(n.icn3dui.cfg.command||alert("These two chains "+t[m]+' can not align to each other. Please select sequences from these two chains in the "Sequences & Annotations" window, and click "Realign Selection" in the "File" menu to align your selection.'),n.icn3dui.cfg.showanno=1,n.icn3dui.cfg.showalignseq=0):(n.t_trans_add.push(v[0].t_trans_add),n.q_trans_sub.push(v[0].q_trans_sub),n.q_rotation.push(v[0].q_rotation),n.qt_start_end.push(v[0].segs)):(n.t_trans_add.push({x:0,y:0,z:0}),n.q_trans_sub.push({x:0,y:0,z:0}),n.q_rotation.push({x1:1,y1:0,z1:0,x2:0,y2:1,z2:0,x3:0,y3:0,z3:1}),n.qt_start_end.push(void 0)),n.mmdbidArray.push(u),l.push(h))}}n.mmdb_data_q=l,this.loadOpmDataForChainalign(a,l,t,n.mmdbidArray)}loadOpmDataForChainalign(e,t,s,i){var n=this.icn3d;n.icn3dui;var r=this;if(n.icn3dui.cfg.resnum)n.bCommandLoad||n.init(),this.downloadChainalignmentPart2(e,t,void 0,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve();else{var a=n.icn3dui.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?mmdbids2opm="+i.join("','");$.ajax({url:a,dataType:"jsonp",cache:!0,success:function(i){var a=i.mmdbid;if(n.selectedPdbid=a,a){var l="https://opm-assets.storage.googleapis.com/pdb/"+a.toLowerCase()+".pdb";$.ajax({url:l,dataType:"text",cache:!0,success:function(i){n.bOpm=!0;var l=n.loadPDBCls.loadPDB(i,a,n.bOpm,!0);$("#"+n.pre+"selectplane_z1").val(n.halfBilayerSize),$("#"+n.pre+"selectplane_z2").val(-n.halfBilayerSize),$("#"+n.pre+"extra_mem_z").val(n.halfBilayerSize),$("#"+n.pre+"intra_mem_z").val(-n.halfBilayerSize),n.bCommandLoad||n.init(),r.downloadChainalignmentPart2(e,t,l,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve()},error:function(i,a,l){n.bCommandLoad||n.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve()}})}else n.bCommandLoad||n.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve()},error:function(i,a,l){n.bCommandLoad||n.init(),r.downloadChainalignmentPart2(e,t,void 0,s),void 0!==n.deferredOpm&&n.deferredOpm.resolve()}})}}}class oe{constructor(e){this.icn3d=e}dsn6Parser(e,t,s){this.icn3d.icn3dui;var i="https://edmaps.rcsb.org/maps/"+e.toLowerCase()+"_"+t+".dsn6";this.dsn6ParserBase(i,t,s)}dsn6ParserBase(e,t,s){var i=this.icn3d;i.icn3dui;var n=this;if("2fofc"==t&&i.bAjax2fofc)i.mapData.sigma2=s,i.setOptionCls.setOption("map",t);else if("fofc"==t&&i.bAjaxfofc)i.mapData.sigma=s,i.setOptionCls.setOption("map",t);else{var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var e=r.response;n.loadDsn6Data(e,t,s),"2fofc"==t?i.bAjax2fofc=!0:"fofc"==t&&(i.bAjaxfofc=!0),i.setOptionCls.setOption("map",t)}else alert("RCSB server has no corresponding eletron density map for this structure.");void 0!==i.deferredMap&&i.deferredMap.resolve()}else i.ParserUtilsCls.showLoading()},r.send()}}loadDsn6Data(e,t,s){var i=this.icn3d;i.icn3dui;var n,r,a={},l=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,o=new Int16Array(l),d=new Uint8Array(l),c=String.fromCharCode.apply(null,d.subarray(0,512));if(0==c.indexOf(":-)"))a.xStart=parseInt(c.substr(10,5)),a.yStart=parseInt(c.substr(15,5)),a.zStart=parseInt(c.substr(20,5)),a.xExtent=parseInt(c.substr(32,5)),a.yExtent=parseInt(c.substr(38,5)),a.zExtent=parseInt(c.substr(42,5)),a.xRate=parseInt(c.substr(52,5)),a.yRate=parseInt(c.substr(58,5)),a.zRate=parseInt(c.substr(62,5)),a.xlen=1*parseFloat(c.substr(73,10)),a.ylen=1*parseFloat(c.substr(83,10)),a.zlen=1*parseFloat(c.substr(93,10)),a.alpha=parseFloat(c.substr(103,10)),a.beta=parseFloat(c.substr(113,10)),a.gamma=parseFloat(c.substr(123,10)),n=parseFloat(c.substr(138,12))/100,r=parseInt(c.substr(155,8)),a.sigma=100*parseFloat(c.substr(170,12));else{if(100!==o[18])for(var h=0,m=o.length;h<m;++h){var p=o[h];o[h]=(255&p)<<8|p>>8&255}a.zStart=o[2],a.xStart=o[0],a.yStart=o[1],a.xExtent=o[3],a.yExtent=o[4],a.zExtent=o[5],a.xRate=o[6],a.yRate=o[7],a.zRate=o[8];var u=1/o[17],C=1*u;a.xlen=o[9]*C,a.ylen=o[10]*C,a.zlen=o[11]*C,a.alpha=o[12]*u,a.beta=o[13]*u,a.gamma=o[14]*u,n=o[15]/o[18],r=o[16]}for(var v=new Float32Array(a.xExtent*a.yExtent*a.zExtent),g=512,f=Math.ceil(a.xExtent/8),b=Math.ceil(a.yExtent/8),y=Math.ceil(a.zExtent/8),w=0;w<y;++w)for(var S=0;S<b;++S)for(var _=0;_<f;++_)for(var A=0;A<8;++A)for(var x=8*w+A,k=0;k<8;++k){var O=8*S+k;for(h=0;h<8;++h){var H=8*_+h;if(!(H<a.xExtent&&O<a.yExtent&&x<a.zExtent)){g+=8-h;break}v[(H*a.yExtent+O)*a.zExtent+x]=(d[g]-r)/n,++g}}"2fofc"==t?(i.mapData.header2=a,i.mapData.data2=v,i.mapData.matrix2=this.getMatrix(a),i.mapData.type2=t,i.mapData.sigma2=s):(i.mapData.header=a,i.mapData.data=v,i.mapData.matrix=this.getMatrix(a),i.mapData.type=t,i.mapData.sigma=s)}getMatrix(e){this.icn3d.icn3dui;var t=e,s=[t.xlen,0,0],i=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],n=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];n[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-n[1]*n[1]);var r=[[],s,i,n],a=[0,t.xRate,t.yRate,t.zRate],l=[0,1,2,3],o=new THREE.Matrix4;return o.set(r[l[1]][0]/a[l[1]],r[l[2]][0]/a[l[2]],r[l[3]][0]/a[l[3]],0,r[l[1]][1]/a[l[1]],r[l[2]][1]/a[l[2]],r[l[3]][1]/a[l[3]],0,r[l[1]][2]/a[l[1]],r[l[2]][2]/a[l[2]],r[l[3]][2]/a[l[3]],0,0,0,0,1),o.multiply((new THREE.Matrix4).makeTranslation(t.xStart,t.yStart,t.zStart)),o}loadDsn6File(e){var t=this.icn3d,s=t.icn3dui,i=this,n=$("#"+t.pre+"dsn6file"+e)[0].files[0],r=$("#"+t.pre+"dsn6sigma"+e).val();if(n){s.utilsCls.checkFileAPI();var a=new FileReader;a.onload=function(t){var s=i.icn3d,n=t.target.result;i.loadDsn6Data(n,e,r),"2fofc"==e?s.bAjax2fofc=!0:"fofc"==e&&(s.bAjaxfofc=!0),s.setOptionCls.setOption("map",e),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("load dsn6 file "+$("#"+s.pre+"dsn6file"+e).val(),!1)},a.readAsArrayBuffer(n)}else alert("Please select a file before clicking 'Load'")}loadDsn6FileUrl(e){var t=this.icn3d;t.icn3dui;var s=$("#"+t.pre+"dsn6fileurl"+e).val(),i=$("#"+t.pre+"dsn6sigmaurl"+e).val();s?(this.dsn6ParserBase(s,e,i),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set map "+e+" sigma "+i+" | "+encodeURIComponent(s),!0)):alert("Please input the file URL before clicking 'Load'")}}class de{constructor(e){this.icn3d=e}loadScript(e,t){var s=this.icn3d;s.icn3dui,s.bCommandLoad=!0,s.bRender=!1,s.bStopRotate=!0,e=t?e.replace(/\+/g," "):e.replace(/\+/g," ").replace(/;/g,"\n");var i=[];s.commands.length>0&&(i[0]=s.commands[0]);var n=e.trim().split("\n");s.commands=n;var r=n[0].indexOf("command=");if(t&&-1!=r){var a=n[0].substr(0,r-1);s.commands.splice(0,1,a)}s.STATENUMBER=s.commands.length,s.commands=i.concat(s.commands),s.STATENUMBER=s.commands.length,s.CURRENTNUMBER=0,s.bReplay?this.replayFirstStep(s.CURRENTNUMBER):this.execCommands(s.CURRENTNUMBER,s.STATENUMBER-1,s.STATENUMBER)}execCommands(e,t,s){var i=this.icn3d;i.icn3dui,i.bRender=!1,i.reinitAfterLoad(),this.execCommandsBase(e,t,s)}execCommandsBase(e,t,s,i){var n,r=this.icn3d,a=r.icn3dui,l=this;for(n=e;n<=t;++n){i=n===s-1;if(r.commands[n]){if(-1!==r.commands[n].indexOf("load"))return 0===t&&e===t?void(r.bNotLoadStructure?(r.hAtoms=a.hashUtilsCls.cloneHash(r.atoms),1===r.commands.length&&(r.bAddCommands=!0),i&&this.renderFinalStep(s)):$.when(l.applyCommandLoad(r.commands[n])).then((function(){1===r.commands.length&&(r.bAddCommands=!0),i&&l.renderFinalStep(s)}))):void(r.bNotLoadStructure?(r.hAtoms=a.hashUtilsCls.cloneHash(r.atoms),r.backForward&&this.renderFinalStep(1),this.execCommandsBase(n+1,t,s)):$.when(l.applyCommandLoad(r.commands[n])).then((function(){r.backForward&&l.renderFinalStep(1),l.execCommandsBase(n+1,t,s)})));if(0==r.commands[n].trim().indexOf("set map")&&-1==r.commands[n].trim().indexOf("set map wireframe")){if(3==(m=(d=r.commands[n].split("|||"))[0].trim().split(" | ")[0].substr(8).split(" ")).length&&"sigma"==m[1]){m[2];var o=m[0];return void(("2fofc"!=o||void 0!==r.bAjax2fofc&&r.bAjax2fofc)&&("fofc"!=o||void 0!==r.bAjaxfofc&&r.bAjaxfofc)?(l.applyCommandMap(d[0].trim()),this.execCommandsBase(n+1,t,s)):$.when(l.applyCommandMap(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})))}}else if(0==r.commands[n].trim().indexOf("set emmap")&&-1==r.commands[n].trim().indexOf("set emmap wireframe")){if(2==(m=(d=r.commands[n].split("|||"))[0].trim().substr(10).split(" ")).length&&"percentage"==m[0])return m[1],void(void 0!==r.bAjaxEm&&r.bAjaxEm?(l.applyCommandEmmap(d[0].trim()),this.execCommandsBase(n+1,t,s)):$.when(l.applyCommandEmmap(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})))}else{if(0==r.commands[n].trim().indexOf("set phi")){var d=r.commands[n].split("|||");return void $.when(r.delphiCls.applyCommandPhi(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)}))}if(0==r.commands[n].trim().indexOf("set delphi")){d=r.commands[n].split("|||");return void $.when(r.delphiCls.applyCommandDelphi(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)}))}if(0==r.commands[n].trim().indexOf("view annotations")){d=r.commands[n].split("|||");return void(Object.keys(r.proteins).length>0&&(void 0===r.bAjaxCddSite||!r.bAjaxCddSite)?$.when(l.applyCommandAnnotationsAndCddSite(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})):(Object.keys(r.proteins).length>0&&l.applyCommandAnnotationsAndCddSiteBase(d[0].trim()),this.execCommandsBase(n+1,t,s)))}if(0==r.commands[n].trim().indexOf("set annotation clinvar")){d=r.commands[n].split("|||");return void(Object.keys(r.proteins).length>0&&(void 0===r.bAjaxClinvar||!r.bAjaxClinvar)?$.when(l.applyCommandClinvar(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})):(Object.keys(r.proteins).length>0&&l.applyCommandClinvar(d[0].trim()),this.execCommandsBase(n+1,t,s)))}if(0==r.commands[n].trim().indexOf("set annotation snp")){d=r.commands[n].split("|||");return void(Object.keys(r.proteins).length>0&&(void 0===r.bAjaxSnp||!r.bAjaxSnp)?$.when(l.applyCommandSnp(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})):(Object.keys(r.proteins).length>0&&l.applyCommandSnp(d[0].trim()),this.execCommandsBase(n+1,t,s)))}if(0==r.commands[n].trim().indexOf("set annotation 3ddomain")){d=r.commands[n].split("|||");return void(Object.keys(r.proteins).length>0&&void 0===r.mmdb_data&&(void 0===r.bAjax3ddomain||!r.bAjax3ddomain)?$.when(l.applyCommand3ddomain(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})):(Object.keys(r.proteins).length>0&&l.applyCommand3ddomain(d[0].trim()),this.execCommandsBase(n+1,t,s)))}if(0==r.commands[n].trim().indexOf("set annotation all")){d=r.commands[n].split("|||");return void(!(Object.keys(r.proteins).length>0)||void 0!==r.bAjaxClinvar&&r.bAjaxClinvar||void 0!==r.bAjaxSnp&&r.bAjaxSnp||void 0!==r.bAjax3ddomain&&r.bAjax3ddomain&&void 0!==r.mmdb_data?!(Object.keys(r.proteins).length>0)||void 0!==r.bAjaxClinvar&&r.bAjaxClinvar||void 0!==r.bAjaxSnp&&r.bAjaxSnp?!(Object.keys(r.proteins).length>0)||void 0!==r.bAjaxClinvar&&r.bAjaxClinvar||void 0!==r.bAjax3ddomain&&r.bAjax3ddomain&&void 0!==r.mmdb_data?!(Object.keys(r.proteins).length>0)||void 0!==r.bAjax3ddomain&&r.bAjax3ddomain&&void 0!==r.mmdb_data||void 0!==r.bAjaxSnp&&r.bAjaxSnp?Object.keys(r.proteins).length>0&&(void 0===r.bAjaxClinvar||!r.bAjaxClinvar)?$.when(l.applyCommandClinvar(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):Object.keys(r.proteins).length>0&&(void 0===r.bAjaxSnp||!r.bAjaxSnp)?$.when(l.applyCommandSnp(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):Object.keys(r.proteins).length>0&&(void 0===r.bAjax3ddomain||!r.bAjax3ddomain||void 0===r.mmdb_data)?$.when(l.applyCommand3ddomain(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):(Object.keys(r.proteins).length>0&&(r.bAjaxClinvar&&l.applyCommandClinvarBase(d[0].trim()),r.bAjaxSnp&&l.applyCommandSnpBase(d[0].trim()),(r.bAjax3ddomain||void 0!==r.mmdb_data)&&l.applyCommand3ddomainBase(d[0].trim())),r.annotationCls.setAnnoTabAll(),this.execCommandsBase(n+1,t,s)):$.when(l.applyCommand3ddomain(d[0].trim())).then(l.applyCommandSnp(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):$.when(l.applyCommandClinvar(d[0].trim())).then(l.applyCommand3ddomain(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):$.when(l.applyCommandClinvar(d[0].trim())).then(l.applyCommandSnp(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})):$.when(l.applyCommandClinvar(d[0].trim())).then(l.applyCommandSnp(d[0].trim())).then(l.applyCommand3ddomain(d[0].trim())).then((function(){r.annotationCls.setAnnoTabAll(),l.execCommandsBase(n+1,t,s)})))}if(0==r.commands[n].trim().indexOf("view interactions")&&void 0!==r.icn3dui.cfg.align){d=r.commands[n].split("|||");return void(void 0!==r.b2DShown&&r.b2DShown?this.execCommandsBase(n+1,t,s):$.when(l.applyCommandViewinteraction(d[0].trim())).then((function(){l.execCommandsBase(n+1,t,s)})))}if(0==r.commands[n].trim().indexOf("symmetry")){var c=(h=(d=r.commands[n].split("|||"))[0].trim()).substr(h.indexOf(" ")+1);return r.symmetrytitle="none"===c?void 0:c,void("none"!==c&&void 0===r.symmetryHash?$.when(l.applyCommandSymmetry(h)).then((function(){r.drawCls.draw(),l.execCommandsBase(n+1,t,s)})):(r.drawCls.draw(),this.execCommandsBase(n+1,t,s)))}if(0==r.commands[n].trim().indexOf("symd symmetry")){var h=(d=r.commands[n].split("|||"))[0].trim();return void $.when(r.symdCls.applyCommandSymd(h)).then((function(){r.drawCls.draw(),l.execCommandsBase(n+1,t,s)}))}if(0==r.commands[n].trim().indexOf("scap")){h=(d=r.commands[n].split("|||"))[0].trim();return void $.when(r.scapCls.applyCommandScap(h)).then((function(){l.execCommandsBase(n+1,t,s)}))}if(0==r.commands[n].trim().indexOf("realign on seq align")){var m;if(2==(m=(h=(d=r.commands[n].split("|||"))[0].trim()).split(" | ")).length){var p=m[1].split(",");r.hAtoms=r.definedSetsCls.getAtomsFromNameArray(p)}return void $.when(l.applyCommandRealign(h)).then((function(){l.execCommandsBase(n+1,t,s)}))}if(0==r.commands[n].trim().indexOf("graph interaction pairs")){h=(d=r.commands[n].split("|||"))[0].trim();return void(void 0===r.bD3?$.when(l.applyCommandGraphinteraction(h)).then((function(){l.execCommandsBase(n+1,t,s)})):(this.applyCommandGraphinteraction(h),this.execCommandsBase(n+1,t,s)))}r.applyCommandCls.applyCommand(r.commands[n])}}}(n===s||i)&&this.renderFinalStep(n)}pressCommandtext(){var e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"logtext").keypress((function(e){var i=s.icn3d;if(i.bAddLogs=!1,13==(e.keyCode?e.keyCode:e.which)){e.preventDefault();var n=$(this).val();i.bRender=!0;var r=n.split("\n"),a=r[r.length-1].substr(2).trim();if(i.logs.push(a),$("#"+i.pre+"logtext").val("> "+i.logs.join("\n> ")+"\n> ").scrollTop($("#"+i.pre+"logtext")[0].scrollHeight),""!==a){var l={};if(l.factor=i._zoomFactor,l.mouseChange=i.mouseChange,l.quaternion=i.quaternion,i.commands.push(a+"|||"+i.transformCls.getTransformationStr(l)),i.optsHistory.push(t.hashUtilsCls.cloneHash(i.opts)),i.optsHistory[i.optsHistory.length-1].hlatomcount=Object.keys(i.hAtoms).length,t.utilsCls.isSessionStorageSupported()&&i.setStyleCls.saveCommandsToSession(),i.STATENUMBER=i.commands.length,-1!==a.indexOf("load"))s.applyCommandLoad(a);else if(-1!==a.indexOf("set map")&&-1===a.indexOf("set map wireframe"))s.applyCommandMap(a);else if(-1!==a.indexOf("set emmap")&&-1===a.indexOf("set emmap wireframe"))s.applyCommandEmmap(a);else if(-1!==a.indexOf("set phi"))i.delphiCls.applyCommandPhi(a);else if(-1!==a.indexOf("set delphi"))i.delphiCls.applyCommandDelphi(a);else if(0==a.indexOf("view annotations"))s.applyCommandAnnotationsAndCddSite(a);else if(0==a.indexOf("set annotation clinvar"))s.applyCommandClinvar(a);else if(0==a.indexOf("set annotation snp"))s.applyCommandSnp(a);else if(0==a.indexOf("set annotation 3ddomain"))s.applyCommand3ddomain(a);else if(0==a.indexOf("set annotation all"))$.when(s.applyCommandClinvar(a)).then(s.applyCommandSnp(a)).then(s.applyCommand3ddomain(a)),i.annotationCls.setAnnoTabAll();else if(0==a.indexOf("view interactions")&&void 0!==i.icn3dui.cfg.align)s.applyCommandViewinteraction(a);else if(0==a.indexOf("symmetry")){var o=a.substr(a.indexOf(" ")+1);i.symmetrytitle="none"===o?void 0:o,"none"!==o&&void 0===i.symmetryHash&&s.applyCommandSymmetry(a)}else if(0==a.indexOf("symd symmetry"))i.symdCls.applyCommandSymd(a);else if(0==a.indexOf("scap "))i.scapCls.applyCommandScap(a);else if(0==a.indexOf("realign on seq align")){var d=a.split(" | ");if(2==d.length){var c=d[1].split(",");i.hAtoms=i.definedSetsCls.getAtomsFromNameArray(c)}s.applyCommandRealign(a)}else 0==a.indexOf("graph interaction pairs")?s.applyCommandGraphinteraction(a):i.applyCommandCls.applyCommand(a+"|||"+i.transformCls.getTransformationStr(l));i.selectionCls.saveSelectionIfSelected(),i.drawCls.draw()}}i.bAddLogs=!0}))}applyCommandLoad(e){var t=this.icn3d;if(t.icn3dui,!(void 0!==t.atoms&&Object.keys(t.atoms).length>0))return t.deferred2=$.Deferred((function(){t.bAddCommands=!1;var s=e.split("|||")[0].replace(/\s\s/g," ").trim();if(-1!==s.indexOf("load")){var i=s.split(" | "),n=i[0];if(i.length>1){var r=i[i.length-1].indexOf(" ");t.icn3dui.cfg.inpara=i[i.length-1].substr(r+1),"undefined"===t.icn3dui.cfg.inpara&&(t.icn3dui.cfg.inpara="")}var a=n.substr(n.lastIndexOf(" ")+1);if(t.inputid=a,-1!==s.indexOf("load mmtf"))t.icn3dui.cfg.mmtfid=a,t.mmtfParserCls.downloadMmtf(a);else if(-1!==s.indexOf("load pdb"))t.icn3dui.cfg.pdbid=a,t.pdbParserCls.downloadPdb(a);else if(-1!==s.indexOf("load opm"))t.icn3dui.cfg.opmid=a,t.opmParserCls.downloadOpm(a);else if(-1!==s.indexOf("load mmcif"))t.icn3dui.cfg.mmcifid=a,t.mmcifParserCls.downloadMmcif(a);else if(-1!==s.indexOf("load mmdb"))t.icn3dui.cfg.mmdbid=a,t.mmdbParserCls.downloadMmdb(a);else if(-1!==s.indexOf("load gi"))t.icn3dui.cfg.gi=a,t.mmdbParserCls.downloadGi(a);else if(-1!==s.indexOf("load seq_struc_ids"))t.mmdbParserCls.downloadBlast_rep_id(a);else if(-1!==s.indexOf("load cid"))t.icn3dui.cfg.cid=a,t.sdfParserCls.downloadCid(a);else if(-1!==s.indexOf("load alignment"))t.icn3dui.cfg.align=a,t.alignParserCls.downloadAlignment(a);else if(-1!==s.indexOf("load chainalignment")){var l=s.split(" | ");-1!=l[1].indexOf("resnum")&&(t.icn3dui.cfg.resnum=l[1].substr(l[1].indexOf("resnum")+7)),t.icn3dui.cfg.chainalign=a,t.chainalignParserCls.downloadChainalignment(a,t.icn3dui.cfg.resnum)}else if(-1!==s.indexOf("load url")){var o=i[1],d=void 0!==o?o.indexOf("type "):-1,c="pdb";-1!==d&&(c=o.substr(d+5)),t.icn3dui.cfg.url=a,t.pdbParserCls.downloadUrl(a,c)}}t.bAddCommands=!0})),t.deferred2.promise()}applyCommandMap(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredMap=$.Deferred((function(){var t=s.icn3d,i=e.split(" | "),n=i[0].substr(8).split(" ");if(3==n.length&&"sigma"==n[1]){var r=n[2],a=n[0];2==i.length?t.dsn6ParserCls.dsn6ParserBase(i[1],a,r):t.dsn6ParserCls.dsn6Parser(t.inputid,a,r)}})),t.deferredMap.promise()}applyCommandEmmap(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredEmmap=$.Deferred((function(){var t=s.icn3d,i=e.substr(10).split(" ");if(2==i.length&&"percentage"==i[0]){var n=i[1];t.densityCifParserCls.densityCifParser(t.inputid,"em",n,t.emd)}})),t.deferredEmmap.promise()}applyCommandSymmetryBase(e){var t=this.icn3d;t.icn3dui,t.symdCls.retrieveSymmetry(Object.keys(t.structures)[0])}applyCommandSymmetry(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredSymmetry=$.Deferred((function(){s.applyCommandSymmetryBase(e)})),t.deferredSymmetry.promise()}applyCommandRealignBase(e){var t=this.icn3d;t.icn3dui,t.realignParserCls.realignOnSeqAlign()}applyCommandRealign(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredRealign=new $.Deferred((function(){s.applyCommandRealignBase(e)})),t.deferredRealign.promise()}applyCommandGraphinteractionBase(e){var t=this.icn3d;t.icn3dui;var s=e.split(" | ");if(s.length>=3){var i,n=s[1].split(" "),r=n[0].split(","),a=n[1].split(","),l=-1!==s[2].indexOf("hbonds"),o=-1!==s[2].indexOf("salt bridge"),d=-1!==s[2].indexOf("interactions"),c=-1!==s[2].indexOf("halogen"),h=-1!==s[2].indexOf("pi-cation"),m=-1!==s[2].indexOf("pi-stacking");s.length>=4&&(i="true"==s[3]),t.applyCommandCls.setStrengthPara(s),t.viewInterPairsCls.viewInteractionPairs(r,a,i,"graph",l,o,d,c,h,m)}}applyCommandGraphinteraction(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredGraphinteraction=$.Deferred((function(){s.applyCommandGraphinteractionBase(e)})),t.deferredGraphinteraction.promise()}applyCommandAnnotationsAndCddSiteBase(e){var t=this.icn3d;t.icn3dui,"view annotations"==e&&t.showAnnoCls.showAnnotations()}applyCommandAnnotationsAndCddSite(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredAnnoCddSite=$.Deferred((function(){s.applyCommandAnnotationsAndCddSiteBase(e)})),t.deferredAnnoCddSite.promise()}applyCommandClinvarBase(e){var t=this.icn3d;t.icn3dui;var s=e.lastIndexOf(" ");e.substr(s+1),t.annotationCls.setAnnoTabClinvar()}applyCommandSnpBase(e){var t=this.icn3d;t.icn3dui;var s=e.lastIndexOf(" ");e.substr(s+1),t.annotationCls.setAnnoTabSnp()}applyCommandClinvar(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredClinvar=$.Deferred((function(){s.applyCommandClinvarBase(e)})),t.deferredClinvar.promise()}applyCommandSnp(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredSnp=$.Deferred((function(){s.applyCommandSnpBase(e)})),t.deferredSnp.promise()}applyCommand3ddomainBase(e){var t=this.icn3d;t.icn3dui;var s=e.lastIndexOf(" "),i=e.substr(s+1);"3ddomain"!=i&&"all"!=i||t.annotationCls.setAnnoTab3ddomain()}applyCommand3ddomain(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferred3ddomain=$.Deferred((function(){s.applyCommand3ddomainBase(e)})),t.deferred3ddomain.promise()}applyCommandViewinteractionBase(e){var t=this.icn3d;if(t.icn3dui,void 0!==t.icn3dui.cfg.align||void 0!==t.icn3dui.cfg.chainalign){var s=Object.keys(t.structures);t.ParserUtilsCls.set2DDiagramsForAlign(s[0].toUpperCase(),s[1].toUpperCase())}}applyCommandViewinteraction(e){var t=this.icn3d;t.icn3dui;var s=this;return t.deferredViewinteraction=$.Deferred((function(){s.applyCommandViewinteractionBase(e)})),t.deferredViewinteraction.promise()}renderFinalStep(e){var t=this.icn3d;t.icn3dui,t.bCommandLoad=!1,t.ParserUtilsCls.hideLoading(),e+1===t.commands.length&&(t.bAddCommands=!0),t.bRender=!0;var s=t.commands[e-1]?t.commands[e-1].split("|||"):[];if(2==s.length){var i=JSON.parse(s[1]);t._zoomFactor=i.factor,t.mouseChange.x=i.mouseChange.x,t.mouseChange.y=i.mouseChange.y,t.quaternion._x=i.quaternion._x,t.quaternion._y=i.quaternion._y,t.quaternion._z=i.quaternion._z,t.quaternion._w=i.quaternion._w}if(t.selectionCls.oneStructurePerWindow(),1===e||Object.keys(t.hAtoms).length===Object.keys(t.atoms).length||void 0!==t.optsHistory[e-1]&&t.optsHistory[e-1].hasOwnProperty("hlatomcount")&&t.optsHistory[e-1].hlatomcount===Object.keys(t.atoms).length)if(t.optsHistory.length>=e){var n=t.optsHistory[e-1].pk;"no"===n?t.pk=0:"atom"===n?t.pk=1:"residue"===n?t.pk=2:"strand"===n&&(t.pk=3),t.hlUpdateCls.updateHlAll(),t.drawCls.draw()}else t.hlUpdateCls.updateHlAll(),t.drawCls.draw();else t.hlUpdateCls.updateHlAll(),t.drawCls.draw();t.icn3dui.cfg.closepopup&&(setTimeout((function(){t.resizeCanvasCls.closeDialogs()}),100),t.resizeCanvasCls.resizeCanvas(t.icn3dui.htmlCls.WIDTH,t.icn3dui.htmlCls.HEIGHT,!0)),t.bTransparentSurface&&t.bRender&&t.drawCls.render(),void 0!==t.icn3dui.deferred&&t.icn3dui.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()}replayFirstStep(e){var t=this.icn3d;t.icn3dui,t.reinitAfterLoad(),this.execCommandsBase(e,e,t.STATENUMBER);var s=t.commands[e],i=t.commands[e].indexOf("|");-1!=i&&(s=t.commands[e].substr(0,i));var n=s.length>20?s.substr(0,20)+"...":s,r=t.applyCommandCls.getMenuFromCmd(s);$("#"+t.pre+"replay_cmd").html("Cmd: "+n),$("#"+t.pre+"replay_menu").html("Menu: "+r),t.bCommandLoad=!1,t.ParserUtilsCls.hideLoading(),t.bRender=!0,t.drawCls.draw()}}class ce{constructor(e){this.icn3d=e}resizeCanvas(e,t,s,i){var n=this.icn3d;if(n.icn3dui,s||n.icn3dui.cfg.resize){var r=t;$("#"+n.pre+"canvas").width(e).height(r),$("#"+n.pre+"viewer").width(e).height(t),$("#"+n.divid+" div:has(#"+n.pre+"canvas)").width(e).height(r),n.applyCenterCls.setWidthHeight(e,r),(void 0===i||i)&&n.drawCls.draw()}}windowResize(){var e=this.icn3d,t=e.icn3dui,s=this;e.icn3dui.cfg.resize&&!t.utilsCls.isMobile()&&$(window).resize((function(){var e=s.icn3d;t.utilsCls.setViewerWidthHeight(e.icn3dui);var i=e.icn3dui.htmlCls.WIDTH,n=e.icn3dui.htmlCls.HEIGHT;void 0===e||e.bFullscreen||s.resizeCanvas(i,n)}))}openFullscreen(e){var t=this.icn3d;t.icn3dui,t.icn3dui.bNode||document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen())}rotStruc(e,t){var s=this.icn3d;s.icn3dui;var i=this;if(s.bStopRotate)return!1;if(s.transformCls.rotateCount>s.transformCls.rotateCountMax)return s.transformCls.resetOrientation(),!1;if(++s.transformCls.rotateCount,t)if("left"===e)s.ROT_DIR="left";else if("right"===e)s.ROT_DIR="right";else if("up"===e)s.ROT_DIR="up";else{if("down"!==e)return!1;s.ROT_DIR="down"}if("left"===e&&"left"===s.ROT_DIR)s.transformCls.rotateLeft(1);else if("right"===e&&"right"===s.ROT_DIR)s.transformCls.rotateRight(1);else if("up"===e&&"up"===s.ROT_DIR)s.transformCls.rotateUp(1);else{if("down"!==e||"down"!==s.ROT_DIR)return!1;s.transformCls.rotateDown(1)}setTimeout((function(){i.rotStruc(e)}),100)}back(){var e=this.icn3d;e.icn3dui,e.backForward=!0,e.STATENUMBER--,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER<1?e.STATENUMBER=1:e.loadScriptCls.execCommands(0,e.STATENUMBER-1,e.STATENUMBER,!0),e.setStyleCls.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0}forward(){var e=this.icn3d;e.icn3dui,e.backForward=!0,e.STATENUMBER++,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER>e.commands.length?e.STATENUMBER=e.commands.length:e.loadScriptCls.execCommands(0,e.STATENUMBER-1,e.STATENUMBER,!0),e.setStyleCls.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0}replayon(){var e=this.icn3d;e.icn3dui,e.CURRENTNUMBER=0,e.bReplay=1,$("#"+e.pre+"replay").show(),e.commands.length>0&&e.loadScriptCls.replayFirstStep(e.CURRENTNUMBER)}replayoff(){var e=this.icn3d;e.icn3dui,e.bReplay=0,$("#"+e.pre+"replay").hide(),++e.CURRENTNUMBER,e.loadScriptCls.execCommands(e.CURRENTNUMBER,e.STATENUMBER-1,e.STATENUMBER)}closeDialogs(){var e=this.icn3d;e.icn3dui;var t=["dl_selectannotations","dl_alignment","dl_2ddgm","dl_definedsets","dl_graph","dl_linegraph","dl_scatterplot","dl_allinteraction","dl_copyurl"];for(var s in t){var i=t[s];e.icn3dui.cfg.notebook?$("#"+e.pre+i).hide():$("#"+e.pre+i).hasClass("ui-dialog-content")&&$("#"+e.pre+i).dialog("isOpen")&&$("#"+e.pre+i).dialog("close")}e.icn3dui.cfg.notebook||this.resizeCanvas(e.icn3dui.htmlCls.WIDTH,e.icn3dui.htmlCls.HEIGHT,!0)}}class he{constructor(e){this.icn3d=e}showSeq(e,t,s,i,n,r,a){var l=this.icn3d;l.icn3dui;var o,d=!1;if(void 0===l.icn3dui.cfg.mmdbid&&void 0===l.icn3dui.cfg.gi&&void 0===l.icn3dui.cfg.blast_rep_id&&void 0===l.icn3dui.cfg.align&&void 0===l.icn3dui.cfg.chainalign){d=!0,o=[];for(var c=0;c<l.giSeq[e].length;++c)o.push(l.chainsSeq[e][c])}else o=l.giSeq[e];for(var h=[],m=(c=0,o.length);c<m;++c)o[c]&&h.push(o[c]);o=h;var p=l.icn3dui.htmlCls.RESIDUE_WIDTH*l.giSeq[e].length+200,u=l.giSeq[e].length;u>l.maxAnnoLength&&(l.maxAnnoLength=u);var C=["giseq","cddsite","clinvar","snp","domain","interaction","custom","ssbond","crosslink","transmem"];for(var c in C){var v=C[c];$("#"+l.pre+v+"_"+e).length&&$("#"+l.pre+v+"_"+e).width(p)}var g,f="",b="",y="";if(f+='<div class="icn3d-dl_sequence">',y+='<div class="icn3d-dl_sequence">',l.giSeq[e].length>10){g='<div class="icn3d-residueLine" style="white-space:nowrap;">';var w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.chains[e]);void 0===l.icn3dui.cfg.mmdbid&&void 0===l.icn3dui.cfg.gi&&void 0===l.icn3dui.cfg.blast_rep_id&&void 0===l.icn3dui.cfg.align&&void 0===l.icn3dui.cfg.chainalign||void 0===w.resi_ori||w.resi_ori==w.resi||-1!=e.indexOf("Misc")?g+='<div class="icn3d-annoTitle" anno="0"></div>':g+='<div class="icn3d-annoTitle" anno="0" title="NCBI Residue Numbers">NCBI Residue Numbers</div>',y+=(g+='<span class="icn3d-residueNum"></span>')+"<br>",f+=g+'<span class="icn3d-seqLine">';var S=0,_=0,A="";for(c=0,m=o.length;c<m;++c){f+=this.insertGap(e,c,"-"),f+="<span>",(G=d?o[c].resi:c>=l.matchedPos[e]&&c-l.matchedPos[e]<l.chainsSeq[e].length?l.chainsSeq[e][c-l.matchedPos[e]].resi:l.baseResi[e]+1+c)%10==0&&(f+=G);var x=e+"_"+G,k=G%10!=0&&G%10!=1&&G%10!=9;if(l.residues.hasOwnProperty(x)){w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[x]);"H"==l.secondaries[x]&&w.ssbegin?(A='<span class="icn3d-helix-color">H'+ ++S+"</span>",k&&(f+=A,A="")):"E"==l.secondaries[x]&&w.ssbegin?(++_,"green"==l.sheetcolor?A='<span class="icn3d-sheet-color">S'+_+"</span>":"yellow"==l.sheetcolor&&(A='<span class="icn3d-sheet-colory">S'+_+"</span>"),k&&(f+=A,A="")):w.ssend&&(A=""),""!=A&&k&&(f+=A,A="")}f+="</span>"}f+='<span class="icn3d-residueNum"></span>',f+="</span>",f+="<br>",f+="</div>",y+="</div>"}g='<div class="icn3d-residueLine" style="white-space:nowrap;">',g+='<div class="icn3d-annoTitle" anno="0"></div>',y+=(g+='<span class="icn3d-residueNum"></span>')+"<br>",f+=g+'<span class="icn3d-seqLine">';for(c=0,m=o.length;c<m;++c){f+=this.insertGap(e,c,"-");x=e+"_"+(c>=l.matchedPos[e]&&c-l.matchedPos[e]<l.chainsSeq[e].length?l.chainsSeq[e][c-l.matchedPos[e]].resi:l.baseResi[e]+1+c);if(l.residues.hasOwnProperty(x))if("H"==l.secondaries[x])f+=c%2==0?'<span class="icn3d-helix">':'<span class="icn3d-helix2">',f+="&nbsp;</span>";else if("E"==l.secondaries[x]){(w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[x])).ssend?"green"==l.sheetcolor?f+='<span class="icn3d-sheet2">':"yellow"==l.sheetcolor&&(f+='<span class="icn3d-sheet2y">'):"green"==l.sheetcolor?f+='<span class="icn3d-sheet">':"yellow"==l.sheetcolor&&(f+='<span class="icn3d-sheety">'),f+="&nbsp;</span>"}else"c"==l.secondaries[x]?f+='<span class="icn3d-coil">&nbsp;</span>':"o"==l.secondaries[x]&&(f+='<span class="icn3d-other">&nbsp;</span>');else f+="<span>-</span>"}f+='<span class="icn3d-residueNum"></span>',f+="</span>",f+="<br>",f+="</div>",f+="</div>",y+="</div></div>",g=l.icn3dui.cfg.blast_rep_id===e?'<div id="'+l.pre+'giseq_sequence" class="icn3d-dl_sequence" style="border: solid 1px #000;">':'<div id="'+l.pre+'giseq_sequence" class="icn3d-dl_sequence">';var O="Protein",H="Protein";void 0!==s&&("nucleotide"==s?(O="Nucl.",H="Nucleotide"):"chemical"==s&&(O="Chem.",H="Chemical")),g+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+H+" "+e+'">'+O+" "+e+"</span></div>",y+=(g+='<span class="icn3d-residueNum" title="starting protein sequence number">'+(l.baseResi[e]+1).toString()+"</span>")+"<br>",f+=g+(q='<span class="icn3d-seqLine">'),b+=g+q;var R=0;for(c=0,m=o.length;c<m;++c){f+=this.insertGap(e,c,"-"),void 0!==l.targetGapHash&&l.targetGapHash.hasOwnProperty(c)&&(R+=l.targetGapHash[c].to-l.targetGapHash[c].from+1);var E=d?o[c].name:o[c],I=E;if(E.length>1&&(I=E[0]+".."),U=c>=l.matchedPos[e]&&c-l.matchedPos[e]<l.chainsSeq[e].length?l.chainsSeq[e][c-l.matchedPos[e]].resi:l.baseResi[e]+1+c,l.residues.hasOwnProperty(e+"_"+U)){var D="333333";if(l.icn3dui.cfg.blast_rep_id==e&&void 0!==l.fullpos2ConsTargetpos&&void 0!==l.fullpos2ConsTargetpos[c+R])D=l.fullpos2ConsTargetpos[c+R].color;else{var T=void 0===(w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[e+"_"+U])).color||"FFFFFF"===w.color.getHexString()?"DDDDDD":w.color.getHexString();D=void 0!==w.color?T:"CCCCCC"}f+='<span id="giseq_'+l.pre+e+"_"+U+'" title="'+E+U+'" class="icn3d-residue" style="color:#'+D+'">'+I+"</span>"}else f+='<span title="'+E+U+'" class="icn3d-residue">'+(I=I.toLowerCase())+"</span>"}l.icn3dui.cfg.blast_rep_id==e&&(l.opts.color="conservation",l.setColorCls.setColorByOptions(l.opts,l.atoms));D=(w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.chains[e])).color?w.color.getHexString():"CCCCCC";var M=Math.round(l.seqAnnWidth*o.length/l.maxAnnoLength);if(M<1&&(M=1),l.icn3dui.cfg.blast_rep_id!=e)b+='<div id="giseq_summary_'+l.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="display:inline-block; color:white; font-weight:bold; background-color:#'+D+"; width:"+M+'px;">'+e+"</div>";else{var P=[];(j=[]).push(0);for(c=0,m=o.length;c<m;++c)void 0!==l.targetGapHash&&l.targetGapHash.hasOwnProperty(c)&&(P.push(c-1),j.push(c));P.push(o.length-1),b+='<div id="giseq_summary_'+l.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="width:'+M+'px;">';for(c=0,m=j.length;c<m;++c)b+=this.insertGapOverview(e,j[c]),b+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+D+"; width:"+Math.round(l.seqAnnWidth*(P[c]-j[c]+1)/(l.maxAnnoLength+l.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" anno="sequence" gi chain="'+e+'" title="'+e+'">'+e+"</div>";b+="</div>"}if(g='<span class="icn3d-residueNum" title="ending protein sequence number">'+U+"</span>",g+="</span>",f+=g+="<br>",b+=g,l.icn3dui.cfg.blast_rep_id==e){if(void 0!==a&&""!==a){g='<div class="icn3d-seqTitle icn3d-link icn3d-blue" blast="" posarray="'+l.consrvResPosArray.toString()+'" title="'+n+'" setname="'+e+'_blast" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+n+'">'+n+"</span></div>",y+=(g+='<span class="icn3d-residueNum"></span>')+"<br>",f+=g+(q='<span class="icn3d-seqLine">'),b+=g+q;var F=0,L=0,N=l.queryStart;for(c=0,m=a.length;c<m;++c){if("-"==(I=a[c]))f+="<span>-</span>";else if(" "==I)f+="<span> </span>";else{var U=l.fullpos2ConsTargetpos[c].pos;if(l.residues.hasOwnProperty(e+"_"+U)){D=l.fullpos2ConsTargetpos[c].color;f+='<span id="giseq_'+l.pre+e+"_"+U+'" title="'+l.fullpos2ConsTargetpos[c].res+U+'" class="icn3d-residue" style="color:#'+D+'">'+I+"</span>"}else f+='<span class="icn3d-residue">'+(I=I.toLowerCase())+"</span>";b+=this.insertGapOverview(e,c),(z=Math.round(l.seqAnnWidth*c/(l.maxAnnoLength+l.nTotalGap)-F-L))>=0&&(b+='<div style="display:inline-block; width:'+z+'px;">&nbsp;</div>',b+='<div style="display:inline-block; background-color:#F00; width:1px;" title="'+I+U+'">&nbsp;</div>',F+=z,L+=1),++N}}g='<span class="icn3d-residueNum"></span>',g+="</span>",f+=g+="<br>",b+=g}var q;g='<div class="icn3d-annoTitle" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+i+'">'+i+"</span></div>",y+=(g+='<span class="icn3d-residueNum" title="starting protein sequence number">'+l.queryStart+"</span>")+"<br>",f+=g+(q='<span class="icn3d-seqLine" style="font-weight: bold;">'),b+=g+q;for(N=l.queryStart,c=0,m=r.length;c<m;++c){" "==(I=r[c])||"-"==I?f+="<span>-</span>":(void 0===l.fullpos2ConsTargetpos||void 0===l.fullpos2ConsTargetpos[c]||l.residues.hasOwnProperty(e+"_"+l.fullpos2ConsTargetpos[c].pos)?f+='<span title="'+I+N+'" class="icn3d-residue">'+I+"</span>":f+='<span title="'+(I=I.toLowerCase())+N+'" class="icn3d-residue">'+I+"</span>",++N)}T=void 0===(w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.chains[e])).color||"FFFFFF"===w.color.getHexString()?"DDDDDD":w.color.getHexString(),D=void 0!==w.color?T:"CCCCCC";var j=[],B=(P=[],"-");for(c=0,m=r.length;c<m;++c){"-"!=(I=r[c])&&"-"==B?j.push(c):"-"==I&&"-"!=B&&P.push(c-1),B=I}"-"!=B&&P.push(r.length-1);for(c=0,m=j.length;c<m;++c){var z;b+='<div style="display:inline-block; width:'+(z=0==c?Math.round(l.seqAnnWidth*(j[c]-l.baseResi[e]-1)/(l.maxAnnoLength+l.nTotalGap)):Math.round(l.seqAnnWidth*(j[c]-P[c-1]-1)/(l.maxAnnoLength+l.nTotalGap)))+'px;">&nbsp;</div>',b+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+D+"; width:"+Math.round(l.seqAnnWidth*(P[c]-j[c]+1)/(l.maxAnnoLength+l.nTotalGap))+'px;" anno="sequence" chain="'+e+'" title="'+i+'">'+i+"</div>"}g='<span class="icn3d-residueNum" title="ending protein sequence number">'+l.queryEnd+"</span>",g+="</span>",f+=g+="<br>",b+=g}if(f+="</div>",b+="</div>",y+="</div>",l.giSeq[e].length>10){w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.chains[e]);if((void 0!==l.icn3dui.cfg.mmdbid||void 0!==l.icn3dui.cfg.gi||void 0!==l.icn3dui.cfg.blast_rep_id||void 0!==l.icn3dui.cfg.align||void 0!==l.icn3dui.cfg.chainalign)&&void 0!==w.resi_ori&&w.resi_ori!=w.resi&&-1==e.indexOf("Misc")){g='<div class="icn3d-dl_sequence">',g+='<div class="icn3d-residueLine" style="white-space:nowrap;">',g+='<div class="icn3d-annoTitle" anno="0" title="PDB Residue Numbers">PDB Residue Numbers</div>',y+=(g+='<span class="icn3d-residueNum"></span>')+"<br>",f+=g+'<span class="icn3d-seqLine">';for(c=0,m=o.length;c<m;++c)if(f+=this.insertGap(e,c,"-"),c>=l.matchedPos[e]&&c-l.matchedPos[e]<l.chainsSeq[e].length){var G;x=e+"_"+(G=l.chainsSeq[e][c-l.matchedPos[e]].resi);if(l.residues.hasOwnProperty(x)){var V=(w=l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[x])).resi_ori;f+="<span>",V%10==0&&(f+=V+" "),f+="</span>"}else f+="<span></span>"}else f+="<span></span>";f+='<span class="icn3d-residueNum"></span>',f+="</span>",f+="<br>",f+="</div>",f+="</div>",y+="</div></div>"}}$("#"+l.pre+"dt_giseq_"+e).html(f),$("#"+l.pre+"ov_giseq_"+e).html(b),$("#"+l.pre+"tt_giseq_"+e).html(y)}insertGap(e,t,s,i){var n=this.icn3d;n.icn3dui;var r="";if(void 0!==n.targetGapHash&&n.targetGapHash.hasOwnProperty(t))for(var a=0;a<n.targetGapHash[t].to-n.targetGapHash[t].from+1;++a)r+=i?s:"<span>"+s+"</span>";return r}insertGapOverview(e,t){var s=this.icn3d;s.icn3dui;var i="";s.icn3dui.cfg.blast_rep_id==e&&void 0!==s.targetGapHash&&s.targetGapHash.hasOwnProperty(t)&&(i+='<div style="display:inline-block; background-color:#333; width:'+s.seqAnnWidth*(s.targetGapHash[t].to-s.targetGapHash[t].from+1)/(s.maxAnnoLength+s.nTotalGap)+'px; height:3px;">&nbsp;</div>');return i}setAlternativeSeq(e,t){var s=this.icn3d;s.icn3dui;var i=s.chainsSeq[e];s.giSeq[e]=[];for(var n=0,r=i.length;n<r;++n){var a=i[n].name;s.giSeq[e][n]=a}s.matchedPos[e]=0,s.baseResi[e]=s.chainsSeq[e][0].resi-s.matchedPos[e]-1}getProteinName(e){var t=this.icn3d;t.icn3dui;var s="";if(void 0===t.icn3dui.cfg.mmdbid&&void 0===t.icn3dui.cfg.gi&&void 0===t.icn3dui.cfg.blast_rep_id||void 0===t.mmdb_data)(void 0!==t.icn3dui.cfg.align||void 0!==t.icn3dui.cfg.chainalign||t.bRealign||t.bSymd)&&void 0!==t.chainid2title&&void 0!==t.chainid2title[e]&&(s=t.chainid2title[e]);else{var i=t.mmdb_data.moleculeInfor,n=e.substr(e.indexOf("_")+1);for(var r in i)if(i[r].chain==n){s=i[r].name.replace(/\'/g,"&prime;");break}}return s}}class pe{constructor(e){this.icn3d=e}clickAddTrackButton(){var e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"addtrack_button1","click",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+t.pre+"track_chainid").val(),n=$("#"+t.pre+"track_gi").val(),r=isNaN(n)?"Acc "+n:"gi "+n;$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(e){s.alignSequenceToStructure(i,e,r)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})})),t.myEventCls.onIds("#"+e.pre+"addtrack_button2","click",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+t.pre+"track_chainid").val(),n=$("#"+t.pre+"track_fasta").val(),r=$("#"+t.pre+"fasta_title").val();$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(e){s.alignSequenceToStructure(i,e,r)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})})),t.myEventCls.onIds("#"+e.pre+"addtrack_button2b","click",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+t.pre+"track_chainid").val(),n=$("#"+t.pre+"fasta_startpos").val(),r="identity"==$("#"+t.pre+"colorseqby").val()?"identity":"custom",a=$("#"+t.pre+"track_fastaalign").val().split(">"),l=a[1].indexOf("\n");a[1].substr(0,l);for(var o=a[1].substr(l+1).replace(/\n/g,""),d=[],c=[],h=2,m=a.length;h<m;++h){var p=a[h].indexOf("\n"),u=a[h].substr(0,p);d.push(u);var C=a[h].substr(p+1).replace(/\n/g,"");c.push(C)}var v=void 0;for(h=0,m=t.giSeq[i].length;h<m;++h){(p=h>=t.matchedPos[i]&&h-t.matchedPos[i]<t.chainsSeq[i].length?t.chainsSeq[i][h-t.matchedPos[i]].resi:t.baseResi[i]+1+h)==n&&(v=h)}void 0===v&&alert('Please double check the start position before clicking "Add Track"'),t.targetGapHash={};var g,f,b="-",y=0,w=0,S=0,_=!1,A=0,x=0;for(h=0,m=o.length;h<m;++h)"-"==o[h]&&o[h]!=b&&(g=w,S=0),"-"==b&&o[h]!=b&&w>0&&(f=y,t.targetGapHash[g+v]={from:g+v,to:f+S-1+v}),b=o[h],y=w,"-"!=o[h]?(++w,x=h,_||(A=h,_=!0)):++S;t.annotationCls.resetAnnoAll();var k="",O=0;for(var h in t.targetGapHash)O>0&&(k+=" "),k+=h+"_"+t.targetGapHash[h].from+"_"+t.targetGapHash[h].to,++O;t.icn3dui.htmlCls.clickMenuCls.setLogCmd("msa | "+k,!0);for(var H={},R=0,E=c.length;R<E;++R){for(var I=v+1,D="",T=0;T<v;++T){if(t.targetGapHash.hasOwnProperty(T))for(var M=0;M<t.targetGapHash[T].to-t.targetGapHash[T].from+1;++M)D+="-";D+="-"}for(T=A;T<=x;++T)0==R&&(H[I]=0),D+=c[R][T],"-"!=o[T]&&(o[T]==c[R][T]&&++H[I],++I);u=d[R].length<20?d[R]:d[R].substr(0,20)+"...";this.showNewTrack(i,u,D,void 0,void 0,r,void 0,!0),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+i+" | title "+u+" | text "+this.simplifyText(D)+" | type "+r+" | color 0 | msa 1",!0)}if(c.length>0){void 0===t.queryresi2score&&(t.queryresi2score={}),void 0===t.queryresi2score[i]&&(t.queryresi2score[i]={});var P=c.length;for(var I in H){var F=parseInt(H[I]/P*100);t.queryresi2score[i][I]=F}var L=Object.keys(H),N=Math.min.apply(null,L),U=Math.max.apply(null,L),q="";for(I=N;I<=U;++I)H.hasOwnProperty(I)?q+=Math.round(H[I]/P*9):q+="_";t.opts.color="align custom",t.setColorCls.setColorByOptions(t.opts,t.hAtoms),t.hlUpdateCls.updateHlAll(),t.drawCls.draw(),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("color align custom | "+i+" | range "+N+"_"+U+" | "+q,!0)}})),t.myEventCls.onIds("#"+e.pre+"addtrack_button3","click",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+t.pre+"track_chainid").val(),n=$("#"+t.pre+"track_bed")[0].files[0];if(n){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var r=new FileReader;r.onload=function(e){for(var s,n=e.target.result.split("\n"),r=!1,a=!1,l=0,o=n.length;l<o;++l)if("browser"!=n[l].substr(0,7))if("track"==n[l].substr(0,5)){if(-1!=n[l].toLowerCase().indexOf("itemrgb")&&(r=!0),-1!=n[l].toLowerCase().indexOf("colorbystrand=")){a=!0;var d=n[l].toLowerCase().indexOf("colorbystrand="),c=n[l].substr(d),h=c.indexOf('"');if(-1!=h){var m=c.substr(h+1),p=m.indexOf('"');if(-1!=h)s=m.substr(0,p).split(" ")}}}else{if(""==n[l])continue;var u=n[l].replace(/\s+/g," ").split(" ");(u.length>8||u.length<6)&&(a=!1),u.length<9&&(r=!1),u[0];var C,v,g=u[1],f=u[2],b=u[3];u.length>4&&u[4],u.length>5&&(C=u[5]),u.length>6&&u[6],u.length>7&&u[7],u.length>8&&(v=u[8]),u.length>9&&u[9],u.length>10&&u[10],u.length>11&&u[11];var y=b,w="51,51,51";r?w=v:a&&("+"==C&&s.length>0?w=s[0]:"-"==C&&s.length>1?w=s[1]:"."==C&&s.length>2&&(w=s[2]));for(var S="",_=[],A=0,x=f;A<x;++A)A<g?(S+="-",_.push("")):(S+=t.giSeq[i][A],_.push("rgb("+w+")"));this.showNewTrack(i,y,S,_,void 0,void 0,w),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+i+" | title "+y+" | text "+this.simplifyText(S)+" | type bed | color "+w,!0)}},r.readAsText(n)}else alert("Please select a file...")})),t.myEventCls.onIds("#"+e.pre+"addtrack_button4","click",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+t.pre+"track_chainid").val(),n=$("#"+t.pre+"track_title").val(),r=$("#"+t.pre+"track_text").val(),a=this.getFullText(r);this.showNewTrack(i,n,a.text,void 0,void 0,"custom",void 0,void 0,a.fromArray,a.toArray),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+i+" | title "+n+" | text "+r+" | type custom",!0)})),t.myEventCls.onIds("#"+e.pre+"addtrack_button5","click",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),dialog.dialog("close");for(var n=$("#"+i.pre+"track_chainid").val(),r=$("#"+i.pre+"track_selection").val(),a="",l=t.hashUtilsCls.intHash(i.hAtoms,i.chains[n]),o=i.firstAtomObjCls.getResiduesFromCalphaAtoms(l),d=[],c=0,h=i.giSeq[n].length;c<h;++c){var m=i.giSeq[n][c],p=m;m.length>1&&(p=m[0]);var u=c>=i.matchedPos[n]&&c-i.matchedPos[n]<i.chainsSeq[n].length?i.chainsSeq[n][c-i.matchedPos[n]].resi:i.baseResi[n]+1+c;if(o.hasOwnProperty(n+"_"+u)){var C=i.firstAtomObjCls.getFirstCalphaAtomObj(i.residues[n+"_"+u]),v=void 0===C.color||"FFFFFF"===C.color.getHexString().toUpperCase()?"DDDDDD":C.color.getHexString(),g=void 0!==C.color?v:"CCCCCC";a+=p,d.push("#"+g)}else a+="-",d.push("")}this.showNewTrack(n,r,a,d,void 0,"selection",void 0),i.icn3dui.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+n+" | title "+r+" | text "+this.simplifyText(a)+" | type selection",!0)}))}showNewTrack(e,t,s,i,n,r,a,l,o,d){var c=this.icn3d;c.icn3dui;var h=!1;"cannot be aligned"==s&&(h=!0);var m=s.replace(/-/g,"").length;if(!l)if(s.length>c.giSeq[e].length)s=s.substr(0,c.giSeq[e].length);else if(s.length<c.giSeq[e].length&&!h){for(var p="",u=0,C=c.giSeq[e].length-s.length;u<C;++u)p+="-";s+=p}var v=t.replace(/\s/g,"_").replace(/\./g,"dot").replace(/\W/g,"");v.length>20&&(v=v.substr(0,20));var g=c.icn3dui.htmlCls.RESIDUE_WIDTH*s.length+200;$("#"+c.pre+"dt_custom_"+e).append("<div id='"+c.pre+"dt_custom_"+e+"_"+v+"'></div>"),$("#"+c.pre+"dt_custom_"+e+"_"+v).width(g),$("#"+c.pre+"ov_custom_"+e).append("<div id='"+c.pre+"ov_custom_"+e+"_"+v+"'></div>"),$("#"+c.pre+"ov_custom_"+e+"_"+v).width(g),$("#"+c.pre+"tt_custom_"+e).append("<div id='"+c.pre+"tt_custom_"+e+"_"+v+"'></div>"),$("#"+c.pre+"tt_custom_"+e+"_"+v).width(g);var f='<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence">',b=f,y=f,w=parseInt(10*Math.random()),S='<div class="icn3d-seqTitle icn3d-link icn3d-blue" custom="'+(w+1).toString()+'" from="'+o+'" to="'+d+'" shorttitle="'+v+'" index="'+w+'" setname="'+e+"_custom_"+(w+1).toString()+'" anno="sequence" chain="'+e+'" title="'+t+'">'+v+" </div>",_='<span class="icn3d-residueNum" title="residue count">'+m.toString()+" Pos</span>";y+=S+_+"<br>";var A='<span class="icn3d-seqLine">';f+=S+_+A,b+=S+_+A;var x=e.indexOf("_"),k="cst"+e.substr(x+1),O=0,H=0,R=(void 0===r||"seq"===r||"custom"===r)&&-1==s.indexOf("cannot-be-aligned")&&-1==s.indexOf("cannot be aligned"),E="identity"===r&&-1==s.indexOf("cannot-be-aligned")&&-1==s.indexOf("cannot be aligned"),I={},D=0,T=1;S="";for(u=0,C=s.length;u<C;++u){var M=u-D;l?c.targetGapHash.hasOwnProperty(M)&&!I.hasOwnProperty(M)&&(D+=c.targetGapHash[M].to-c.targetGapHash[M].from+1,I[M]=1):f+=c.showSeqCls.insertGap(e,u,"-");var P=s.charAt(u);if(" "!=P&&"-"!=P){var F,L=c.chainsSeq[e][M]?c.chainsSeq[e][M].name:" ",N=c.showAnnoCls.getColorhexFromBlosum62(P,L),U=P==L?"FF0000":"0000FF",q=T;void 0!==n&&(q=n[u]+1),F=void 0!==i&&""!=i[u]?'style="color:'+i[u]+'"':a?'style="color:rgb('+a+')"':R?'style="color:#'+N+'"':E?'style="color:#'+U+'"':"",f+='<span id="'+k+"_"+c.pre+e+"_"+q+'" title="'+P+q+'" class="icn3d-residue" '+F+">"+P+"</span>",S+=c.showSeqCls.insertGapOverview(e,u),(W=c.icn3dui.cfg.blast_rep_id==e?Math.round(c.seqAnnWidth*u/(c.maxAnnoLength+c.nTotalGap)-O-H):Math.round(c.seqAnnWidth*u/c.maxAnnoLength-O-H))<0&&(W=0),S+='<div style="display:inline-block; width:'+W+'px;">&nbsp;</div>',S+='<div style="display:inline-block; background-color:'+(F=void 0!==i&&""!=i[u]?i[u]:a?"rgb("+a+")":R?"#"+N:"#333")+'; width:1px;" title="'+P+(u+1).toString()+'">&nbsp;</div>',O+=W,H+=1,++T}else f+=h?"<span>"+P+"</span>":"<span>-</span>"}if(void 0!==o){S="";var j=[],B=[];for(u=0,C=o.length;u<C;++u){j.push(o[u]);for(var z=o[u];z<=d[u];++z)void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(z)&&(B.push(z-1),j.push(z));B.push(d[u])}for(var u in c.nTotalGap=0,c.targetGapHash)c.nTotalGap+=c.targetGapHash[u].to-c.targetGapHash[u].from+1;var G=c.firstAtomObjCls.getFirstCalphaAtomObj(c.chains[e]),V=void 0===G.color||"FFFFFF"===G.color.getHexString()?"DDDDDD":G.color.getHexString();for(a=void 0!==G.color?V:"CCCCCC",u=0,C=j.length;u<C;++u){var W;S+=c.showSeqCls.insertGapOverview(e,j[u]),S+='<div style="display:inline-block; width:'+(W=0==u?Math.round(c.seqAnnWidth*(j[u]-c.baseResi[e]-1)/(c.maxAnnoLength+c.nTotalGap)):Math.round(c.seqAnnWidth*(j[u]-B[u-1]-1)/(c.maxAnnoLength+c.nTotalGap)))+'px;">&nbsp;</div>',S+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+a+"; width:"+Math.round(c.seqAnnWidth*(B[u]-j[u]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" custom="'+(w+1).toString()+'" from="'+j+'" to="'+B+'" shorttitle="'+v+'" index="'+w+'" setname="'+e+"_custom_"+(w+1).toString()+'" id="'+e+"_custom_"+w+'" anno="sequence" chain="'+e+'" title="'+t+'">'+t+"</div>"}}A='<span class="icn3d-residueNum" title="residue count">'+m.toString()+" Pos</span>",A+="</span>",A+="<br>",f+=A+="</div>",b+=S+A,y+="</div>",$("#"+c.pre+"dt_custom_"+e+"_"+v).html(f),$("#"+c.pre+"ov_custom_"+e+"_"+v).html(b),$("#"+c.pre+"tt_custom_"+e+"_"+v).html(y)}alignSequenceToStructure(e,t,s){var i,n,r=this.icn3d,a=r.icn3dui;void 0!==t.data&&(i=t.data[0].query,n=(n=t.data[0].targets[e]).hsps[0]);var l="";if(void 0!==i&&void 0!==n){var o=n.scores.e_value.toPrecision(2);o>1e-200&&(o=parseFloat(o).toExponential()),n.scores.bit_score;for(var d=t.targets[e].seqdata,c=i.seqdata,h=n.segs,m={},p=0,u=h.length;p<u;++p)for(var C=h[p],v=0;v<=C.orito-C.orifrom;++v)m[v+C.orifrom]=v+C.from;var g=[];for(p=0,u=d.length;p<u;++p)if(m.hasOwnProperty(p)){l+=c[m[p]];var f=r.showAnnoCls.getColorhexFromBlosum62(d[p],c[m[p]]);g.push("#"+f);var b=p+1;for(var y in r.residues[e+"_"+b]){var w=a.parasCls.thr("#"+f);r.atoms[y].color=w,r.atomPrevColors[y]=w}}else l+="-",g.push("");s+=", E: "+o}else l+="cannot be aligned";this.showNewTrack(e,s,l,g,m,"seq"),r.hlUpdateCls.updateHlAll(),r.drawCls.draw(),r.icn3dui.htmlCls.clickMenuCls.setLogCmd("add track | chainid "+e+" | title "+s+" | text "+this.simplifyText(l)+" | type seq",!0)}defineSecondary(e,t){var s=this.icn3d;s.icn3dui,$("#"+s.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+s.pre+"dl_definedsets").dialog("isOpen")||(s.icn3dui.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+s.pre+"atomsCustom").resizable());var i,n,r={},a=!1,l=!0,o=0,d=0,c=e+"_C(Nterm";s.hAtoms={};for(var h=0,m=s.chainsSeq[e].length;h<m;++h){var p=e+"_"+s.chainsSeq[e][h].resi;if(s.residues.hasOwnProperty(p)){var u=s.firstAtomObjCls.getFirstCalphaAtomObj(s.residues[p]),C=s.secondaries[p];"H"==C?(u.ssbegin&&(++o,Object.keys(r).length>0&&(n=i+"H"+o+")","coil"==t&&(s.selectionCls.selectResidueList(r,n,n,a,l),a||(a=!0)),r={})),i=e+"_H"+o,r[p]=1,u.ssend&&(c=e+"_C(H"+o,"helix"==t&&(s.selectionCls.selectResidueList(r,i,i,a,l),a||(a=!0)),r={})):"E"==C?(u.ssbegin&&(++d,Object.keys(r).length>0&&(n=i+"S"+d+")","coil"==t&&(s.selectionCls.selectResidueList(r,n,n,a,l),a||(a=!0)),r={})),i=e+"_S"+d,r[p]=1,u.ssend&&(c=e+"_C(S"+d,"sheet"==t&&(s.selectionCls.selectResidueList(r,i,i,a,l),a||(a=!0)),r={})):(i=c+"-",r[p]=1)}}Object.keys(r).length>0&&(n=i+"Cterm)","coil"==t&&s.selectionCls.selectResidueList(r,n,n,a,l))}simplifyText(e){this.icn3d.icn3dui;var t,s="",i=!1,n=-1;for(t=0,il=e.length;t<il;++t)"-"==e[t]||" "==e[t]?(i&&t!==n&&(s+=n+1==t-1?(n+1+1).toString()+" "+e.substr(n+1,t-1-n)+", ":(n+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(n+1,t-1-n)+", ",i=!1),n=t):i=!0;return i&&t==il&&(s+=n+1==t-1?(n+1+1).toString()+" "+e.substr(n+1,t-1-n)+", ":(n+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(n+1,t-1-n)+", "),s}checkGiSeq(e,t,s,i,n,r,a){var l=this.icn3d;l.icn3dui;var o=this;if(a>20)return!1;if(void 0!==l.giSeq&&void 0!==l.giSeq[e]){var d=this.getFullText(s);return s=d.text,this.showNewTrack(e,t,s,void 0,void 0,i,n,r),!1}setTimeout((function(){o.checkGiSeq(e,t,s,i,n,r,a+1)}),100)}getFullText(e){this.icn3d.icn3dui;for(var t="",s=[],i=[],n=e.split(","),r=-1,a=0,l=n.length;a<l;++a){var o=n[a].trim();if(0!=o.length){var d=o.split(" ");if(2===d.length){var c,h,m=d[1],p=d[0].split("-");if(2==p.length)c=p[0]-1,h=p[1]-1;else{if(1!=p.length)continue;h=c=p[0]-1}s.push(c),i.push(h);for(var u=0;u<c-r-1;++u)t+="-";var C=h-c+1;m.length>C?t+=m.substr(0,C):t+=m;for(u=0;u<C-m.length;++u)t+="-";r=h}}}return{text:t,fromArray:s,toArray:i}}setCustomFile(e){var t=this.icn3d,s=t.icn3dui,i=this,n=$("#"+t.pre+"customcolor_chainid").val(),r=$("#"+t.pre+"cstcolorfile")[0].files[0];if(r){s.utilsCls.checkFileAPI();var a=new FileReader;a.onload=function(t){var s=i.icn3d,r=t.target.result.split("\n");void 0===s.queryresi2score&&(s.queryresi2score={}),s.queryresi2score[n]={};for(var a=0,l=r.length;a<l;++a)if(""!==r[a].trim()){var o=r[a].split(/\s+/);s.queryresi2score[n][o[0]]=o[1]}for(var d=Object.keys(s.queryresi2score[n]),c=Math.min.apply(null,d),h=Math.max.apply(null,d),m="",p=c;p<=h;++p)s.queryresi2score[n].hasOwnProperty(p)?m+=Math.round(s.queryresi2score[n][p]/11):m+="_";"color"==e?(s.opts.color="align custom",s.setColorCls.setColorByOptions(s.opts,s.hAtoms),s.hlUpdateCls.updateHlAll(),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("color align custom | "+n+" | range "+c+"_"+h+" | "+m,!0)):"tube"==e&&(s.setOptionCls.setStyle("proteins","custom tube"),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("color tube | "+n+" | range "+c+"_"+h+" | "+m,!0)),s.drawCls.draw()},a.readAsText(r)}else alert("Please select a file before clicking 'Load'")}}class ue{constructor(e){this.icn3d=e}calculateArea(){var e=this.icn3d;e.icn3dui,e.bCalcArea=!0,e.opts.surface="solvent accessible surface",e.applyMapCls.applySurfaceOptions(),$("#"+e.pre+"areavalue").val(e.areavalue),$("#"+e.pre+"areatable").html(e.areahtml),e.icn3dui.htmlCls.dialogCls.openDlg("dl_area","Surface area calculation"),e.bCalcArea=!1}calcBuriedSurface(e,t){var s=this.icn3d,i=s.icn3dui;if(0==e.length)alert("Please select the first set");else{var n=i.hashUtilsCls.cloneHash(s.hAtoms),r=s.definedSetsCls.getAtomsFromNameArray(e),a=s.definedSetsCls.getAtomsFromNameArray(t);s.bCalcArea=!0,s.opts.surface="solvent accessible surface",s.hAtoms=i.hashUtilsCls.cloneHash(r),s.applyMapCls.applySurfaceOptions();var l=s.areavalue;s.hAtoms=i.hashUtilsCls.cloneHash(a),s.applyMapCls.applySurfaceOptions();var o=s.areavalue;s.hAtoms=i.hashUtilsCls.unionHash(s.hAtoms,r),s.applyMapCls.applySurfaceOptions();var d=s.areavalue;s.bCalcArea=!1,s.hAtoms=i.hashUtilsCls.cloneHash(n);var c=(parseFloat(o)+parseFloat(l)-parseFloat(d)).toFixed(2),h="<br>Calculate solvent accessible surface area in the interface:<br><br>";h+="Set 1: "+e+", Surface: "+l+" &#8491;<sup>2</sup><br>",h+="Set 2: "+t+", Surface: "+o+" &#8491;<sup>2</sup><br>",h+="Total Surface: "+d+" &#8491;<sup>2</sup><br>",h+="<b>Buried Surface</b>: "+c+" &#8491;<sup>2</sup><br><br>",$("#"+s.pre+"dl_buriedarea").html(h),s.icn3dui.htmlCls.dialogCls.openDlg("dl_buriedarea","Buried solvent accessible surface area in the interface"),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("buried surface "+c,!1)}}measureDistTwoSets(e,t){var s=this.icn3d,i=s.icn3dui;if(0==e.length||0==t.length)alert("Please select two sets");else{var n=i.hashUtilsCls.cloneHash(s.hAtoms),r=s.definedSetsCls.getAtomsFromNameArray(e),a=s.definedSetsCls.getAtomsFromNameArray(t),l=s.contactCls.getExtent(r),o=s.contactCls.getExtent(a),d=new THREE.Vector3(l[2][0],l[2][1],l[2][2]),c=new THREE.Vector3(o[2][0],o[2][1],o[2][2]);s.hAtoms=i.hashUtilsCls.cloneHash(n),void 0===s.distPnts&&(s.distPnts=[]),s.distPnts.push(d),s.distPnts.push(c);var h=$("#"+s.pre+"distancecolor2").val();this.addLine(d.x,d.y,d.z,c.x,c.y,c.z,h,!0,"distance");var m=d.clone().add(c).multiplyScalar(.5),p=(parseInt(10*d.distanceTo(c))/10).toString()+" A";this.addLabel(p,m.x,m.y,m.z,0,h,0,"distance"),s.drawCls.draw()}}addLine(e,t,s,i,n,r,a,l,o){var d=this.icn3d;d.icn3dui;var c={};c.position1=new THREE.Vector3(e,t,s),c.position2=new THREE.Vector3(i,n,r),c.color=a,c.dashed=l,void 0===d.lines[o]&&(d.lines[o]=[]),void 0!==o?d.lines[o].push(c):d.lines.custom.push(c),d.hlObjectsCls.removeHlObjects()}addLineFromPicking(e){var t=this.icn3d;t.icn3dui;var s=$("#"+t.pre+e+"color").val();t.pAtom.coord.x,t.pAtom2.coord.x,t.pAtom.coord.y,t.pAtom2.coord.y,t.pAtom.coord.z,t.pAtom2.coord.z;var i="stabilizer"!=e;t.icn3dui.htmlCls.clickMenuCls.setLogCmd("add line | x1 "+t.pAtom.coord.x.toPrecision(4)+" y1 "+t.pAtom.coord.y.toPrecision(4)+" z1 "+t.pAtom.coord.z.toPrecision(4)+" | x2 "+t.pAtom2.coord.x.toPrecision(4)+" y2 "+t.pAtom2.coord.y.toPrecision(4)+" z2 "+t.pAtom2.coord.z.toPrecision(4)+" | color "+s+" | dashed "+i+" | type "+e,!0),this.addLine(t.pAtom.coord.x,t.pAtom.coord.y,t.pAtom.coord.z,t.pAtom2.coord.x,t.pAtom2.coord.y,t.pAtom2.coord.z,s,i,e),t.pickpair=!1}addLabel(e,t,s,i,n,r,a,l){var o=this.icn3d;o.icn3dui;var d={};"0"!==n&&""!==n&&"undefined"!==n||(n=void 0),"0"!==r&&""!==r&&"undefined"!==r||(r=void 0),"0"!==a&&""!==a&&"undefined"!==a||(a=void 0);var c=new THREE.Vector3;c.x=t,c.y=s,c.z=i,d.position=c,d.text=e,d.size=n,d.color=r,d.background=a,void 0===o.labels[l]&&(o.labels[l]=[]),void 0!==l?o.labels[l].push(d):o.labels.custom.push(d),o.hlObjectsCls.removeHlObjects()}addChainLabels(e){var t=this.icn3d,s=t.icn3dui.hashUtilsCls.intHash(t.hAtoms,e);void 0===t.labels.chain&&(t.labels.chain=[]);var i=t.firstAtomObjCls.getChainsFromAtoms(s);for(var n in i){var r={};r.position=t.applyCenterCls.centerAtoms(t.chains[n]).center;var a=n.indexOf("_"),l=n.substr(a+1),o=t.showSeqCls.getProteinName(n);o.length>20&&(o=o.substr(0,20)+"..."),r.text="Chain "+l+": "+o,r.size=18;var d=t.firstAtomObjCls.getFirstCalphaAtomObj(t.chains[n]).color.getHexString().toUpperCase();r.color="CCCCCC"===d||"C8C8C8"===d?"#888888":"#"+d,r.background="#CCCCCC",t.labels.chain.push(r)}t.hlObjectsCls.removeHlObjects()}addTerminiLabels(e){var t,s=this.icn3d,i=s.icn3dui,n="#CCCCCC";t=i.hashUtilsCls.unionHash(t,s.proteins),t=i.hashUtilsCls.unionHash(t,s.nucleotides);var r=i.hashUtilsCls.intHash(s.dAtoms,t),a=i.hashUtilsCls.intHash(r,e);void 0===s.labels.chain&&(s.labels.chain=[]);var l=s.firstAtomObjCls.getChainsFromAtoms(a);for(var o in l){var d=i.hashUtilsCls.intHash(r,s.chains[o]),c=Object.keys(d),h=s.atoms[c[0]],m=s.atoms[c[c.length-1]],p={},u={};p.position=h.coord,u.position=m.coord,p.text="N-",u.text="C-",s.nucleotides.hasOwnProperty(h.serial)&&(p.text="5'",u.text="3'"),p.size=18,u.size=18;var C=h.color.getHexString().toUpperCase(),v=m.color.getHexString().toUpperCase();p.color="CCCCCC"===C||"C8C8C8"===C?"#888888":"#"+C,u.color="CCCCCC"===v||"C8C8C8"===v?"#888888":"#"+v,p.background=n,u.background=n,s.labels.chain.push(p),s.labels.chain.push(u)}s.hlObjectsCls.removeHlObjects()}}class Ce{constructor(e){this.icn3d=e}showCddSiteAll(){var e=this.icn3d;e.icn3dui;var t=this,s=$.map(e.protein_chainid,(function(e){return e})),i=Object.keys(e.protein_chainid),n=e.icn3dui.htmlCls.baseUrl+"cdannots/cdannots.fcgi?fmt&live=lcl&queries="+s;$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(s){for(var n={},r=0,a=s.data.length;r<a;++r){var l=s.data[r];l._id,n[F=i[r]]=1;var o='<div id="'+e.pre+F+'_cddseq_sequence" class="icn3d-cdd icn3d-dl_sequence">',d=o,c=o,h=l.doms;o=(m=t.setDomainFeature(h,F,!0,o,d,c)).html+"</div>",d=m.html2+"</div>",c=m.html3+"</div>",$("#"+e.pre+"dt_cdd_"+F).html(o),$("#"+e.pre+"ov_cdd_"+F).html(d),$("#"+e.pre+"tt_cdd_"+F).html(c),d=o='<div id="'+e.pre+F+'_siteseq_sequence" class="icn3d-dl_sequence">',c=o;var m,p=l.motifs;o=(m=t.setDomainFeature(p,F,!1,o,d,c)).html,d=m.html2,c=m.html3;for(var u=s.data[r].sites,C=void 0!==u?u.length:0,v=0;v<C;++v){u[v].srcdom,u[v].type;var g=u[v].sz,f="site: "+u[v].title;f.length>17&&(f=f.substr(0,17)+"...");for(var b,y=u[v].title,w=[],S=0,_=u[v].locs.length;S<_;++S)for(var A=0,x=(b=u[v].locs[S].coords).length;A<x;++A)w.push(t.getAdjustedResi(Math.round(b[A]),F,e.matchedPos,e.chainsSeq,e.baseResi)-1);var k='<div class="icn3d-seqTitle icn3d-link icn3d-blue" site="site" posarray="'+w.toString()+'" shorttitle="'+f+'" setname="'+F+"_site_"+v+'" anno="sequence" chain="'+F+'" title="'+y+'">'+f+" </div>",O='<span class="icn3d-residueNum" title="residue count">'+g.toString()+" Res</span>",H='<span class="icn3d-seqLine">';c+=k+O+"<br>",o+=k+O+H,d+=k+O+H;var R="site"+v.toString(),E=0,I=0;for(S=0,_=e.giSeq[F].length;S<_;++S)if(o+=e.showSeqCls.insertGap(F,S,"-"),-1!=b.indexOf(S)){var D=e.giSeq[F][S],T=D;D.length>1&&(T=D[0]+"..");var M=t.getAdjustedResi(S,F,e.matchedPos,e.chainsSeq,e.baseResi);o+='<span id="'+R+"_"+e.pre+F+"_"+M+'" title="'+T+M+'" class="icn3d-residue">'+D+"</span>",d+=e.showSeqCls.insertGapOverview(F,S);var P=e.icn3dui.cfg.blast_rep_id==F?Math.round(e.seqAnnWidth*S/(e.maxAnnoLength+e.nTotalGap)-E-I):Math.round(e.seqAnnWidth*S/e.maxAnnoLength-E-I);P>=0&&(d+='<div style="display:inline-block; width:'+P+'px;">&nbsp;</div>',d+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+T+M+'">&nbsp;</div>',E+=P,I+=1)}else o+="<span>-</span>";H='<span class="icn3d-residueNum" title="residue count">&nbsp;'+g.toString()+" Residues</span>",H+="</span>",o+=H+="<br>",d+=H}o+="</div>",d+="</div>",c+="</div>",$("#"+e.pre+"dt_site_"+F).html(o),$("#"+e.pre+"ov_site_"+F).html(d),$("#"+e.pre+"tt_site_"+F).html(c)}for(var F in e.protein_chainid)n.hasOwnProperty(F)||($("#"+e.pre+"dt_cdd_"+F).html(""),$("#"+e.pre+"ov_cdd_"+F).html(""),$("#"+e.pre+"tt_cdd_"+F).html(""),$("#"+e.pre+"dt_site_"+F).html(""),$("#"+e.pre+"ov_site_"+F).html(""),$("#"+e.pre+"tt_site_"+F).html(""));e.showAnnoCls.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()},error:function(t,i,n){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var r in console.log("No CDD data were found for the protein "+s+"..."),e.protein_chainid)$("#"+e.pre+"dt_cdd_"+r).html(""),$("#"+e.pre+"ov_cdd_"+r).html(""),$("#"+e.pre+"tt_cdd_"+r).html(""),$("#"+e.pre+"dt_site_"+r).html(""),$("#"+e.pre+"ov_site_"+r).html(""),$("#"+e.pre+"tt_site_"+r).html("");e.showAnnoCls.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()}}})}setDomainFeature(e,t,s,i,n,r){var a=this.icn3d;a.icn3dui;for(var l=this,o=void 0!==e?e.length:0,d=s?14:17,c=s?100:120,h=0;h<o;++h){var m=s?e[h].acc:e[h].srcdom,p=e[h].type;p=s?"domain":"feat";var u=s?e[h].title.split(":")[0]:e[h].title,C=s?e[h].defline:"",v=p+": "+u;v.length>d&&(v=v.substr(0,d)+"...");var g=p+": "+u,f=e[h].locs;if(f)for(var b=0,y=f.length;b<y;++b){for(var w=[],S=[],_={},A=0,x=s?f[b].segs:[f[b]],k=0,O=x.length;k<O;++k){var H=Math.round(x[k].from),R=Math.round(x[k].to);w.push(l.getAdjustedResi(H,t,a.matchedPos,a.chainsSeq,a.baseResi)-1),S.push(l.getAdjustedResi(R,t,a.matchedPos,a.chainsSeq,a.baseResi)-1);for(var E=H;E<=R;++E)_[E]=1;A+=R-H+1}var I='<div class="icn3d-seqTitle icn3d-link icn3d-blue" '+p+'="'+m+'" from="'+w+'" to="'+S+'" shorttitle="'+v+'" setname="'+t+"_"+p+"_"+h+"_"+b+'" anno="sequence" chain="'+t+'" title="'+g+'">'+v+" </div>",D='<span class="icn3d-residueNum" title="residue count">'+A.toString()+" Res</span>";r+=I+D+"<br>";var T='<span class="icn3d-seqLine">';i+=I+D+T,s&&(n+='<div style="width:20px; display:inline-block;"><span id="'+a.pre+t+"_"+m+"_"+b+'_cddseq_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+a.pre+t+"_"+m+"_"+b+'_cddseq_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>'),n+='<div style="width:'+c+'px!important;" class="icn3d-seqTitle icn3d-link icn3d-blue" '+p+'="'+m+'" from="'+w+'" to="'+S+'" shorttitle="'+v+'" index="'+h+'" setname="'+t+"_"+p+"_"+h+"_"+b+'" anno="sequence" chain="'+t+'" title="'+g+'">'+v+" </div>",n+=D+T;for(var M=p+h.toString(),P=(E=0,a.giSeq[t].length);E<P;++E)if(i+=a.showSeqCls.insertGap(t,E,"-"),_.hasOwnProperty(E)){var F=a.giSeq[t][E],L=F;F.length>1&&(L=F[0]+"..");var N=l.getAdjustedResi(E,t,a.matchedPos,a.chainsSeq,a.baseResi);i+='<span id="'+M+"_"+a.pre+t+"_"+N+'" title="'+L+N+'" class="icn3d-residue">'+F+"</span>"}else i+="<span>-</span>";var $=a.firstAtomObjCls.getFirstCalphaAtomObj(a.chains[t]),U=void 0===$.color||"FFFFFF"===$.color.getHexString()?"DDDDDD":$.color.getHexString(),q=void 0!==$.color?U:"CCCCCC";if(a.icn3dui.cfg.blast_rep_id!=t)for(E=0,P=w.length;E<P;++E){n+='<div style="display:inline-block; width:'+(0==E?Math.round(a.seqAnnWidth*(w[E]-a.baseResi[t]-1)/a.maxAnnoLength):Math.round(a.seqAnnWidth*(w[E]-S[E-1]-1)/a.maxAnnoLength))+'px;">&nbsp;</div>',n+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+q+"; width:"+Math.round(a.seqAnnWidth*(S[E]-w[E]+1)/a.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(h+1).toString()+'" from="'+w+'" to="'+S+'" shorttitle="'+v+'" index="'+h+'" setname="'+t+"_domain_"+h+"_"+b+'" id="'+t+"_domain_"+h+"_"+b+'" anno="sequence" chain="'+t+'" title="'+g+'">'+u+" </div>"}else{var j=[],B=[];for(E=0,P=w.length;E<P;++E){j.push(w[E]);for(var z=w[E];z<=S[E];++z)void 0!==a.targetGapHash&&a.targetGapHash.hasOwnProperty(z)&&(B.push(z-1),j.push(z));B.push(S[E])}for(E=0,P=j.length;E<P;++E){n+=a.showSeqCls.insertGapOverview(t,j[E]),n+='<div style="display:inline-block; width:'+(0==E?Math.round(a.seqAnnWidth*(j[E]-a.baseResi[t]-1)/(a.maxAnnoLength+a.nTotalGap)):Math.round(a.seqAnnWidth*(j[E]-B[E-1]-1)/(a.maxAnnoLength+a.nTotalGap)))+'px;">&nbsp;</div>',n+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+q+"; width:"+Math.round(a.seqAnnWidth*(B[E]-j[E]+1)/(a.maxAnnoLength+a.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(h+1).toString()+'" from="'+j+'" to="'+B+'" shorttitle="'+v+'" index="'+h+'" setname="'+t+"_domain_"+h+"_"+b+'" id="'+t+"_domain_"+h+"_"+b+'" anno="sequence" chain="'+t+'" title="'+g+'">'+u+" </div>"}}T='<span class="icn3d-residueNum" title="residue count">&nbsp;'+A.toString()+" Residues</span>",T+="</span>",i+=T+="<br>",n+=T,s&&(n+='<div id="'+a.pre+t+"_"+m+"_"+b+'_cddseq" style="display:none; white-space:normal;" class="icn3d-box">'+C+'(<a href="'+a.icn3dui.htmlCls.baseUrl+"cdd/cddsrv.cgi?uid="+m+'" target="_blank" class="icn3d-blue">open details view...</a>)</div>')}}return{html:i,html2:n,html3:r}}getAdjustedResi(e,t,s,i,n){var r=this.icn3d;return r.icn3dui,e>=s[t]&&e-s[t]<r.chainsSeq[t].length?r.chainsSeq[t][e-s[t]].resi:n[t]+1+e}showAnnoType(e,t,s,i,n,r){var a=this.icn3d;a.icn3dui;var l='<div id="'+a.pre+e+"_"+s+'seq_sequence" class="icn3d-dl_sequence">',o=l,d=l;if(0==n.length)return $("#"+a.pre+"dt_"+s+"_"+e).html(""),$("#"+a.pre+"ov_"+s+"_"+e).html(""),void $("#"+a.pre+"tt_"+s+"_"+e).html("");var c=i;i.length>17&&(i=i.substr(0,17)+"...");for(var h=[],m=0,p=n.length;m<p;++m){var u=n[m],C=Math.round(u.substr(n[m].lastIndexOf("_")+1));h.push(C)}var v=h.length,g=s,f='<div class="icn3d-seqTitle icn3d-link icn3d-blue" '+s+'="" posarray="'+h.toString()+'" shorttitle="'+i+'" setname="'+e+"_"+g+'" anno="sequence" chain="'+e+'" title="'+c+'">'+i+" </div>",b='<span class="icn3d-residueNum" title="residue count">'+v.toString()+" Res</span>";d+=f+b+"<br>";var y='<span class="icn3d-seqLine">';l+=f+b+y,o+=f+b+y;var w=s,S=0,_=0;for(m=0,p=a.giSeq[e].length;m<p;++m)if(l+=a.showSeqCls.insertGap(e,m,"-"),-1!=h.indexOf(m+1+a.baseResi[e])){var A=a.giSeq[e][m],x=A;A.length>1&&(x=A[0]+"..");var k=m>=a.matchedPos[e]&&m-a.matchedPos[e]<a.chainsSeq[e].length?a.chainsSeq[e][m-a.matchedPos[e]].resi:a.baseResi[e]+1+m;u=e+"_"+(m+1+a.baseResi[e]).toString(),i=A+(m+1+a.baseResi[e]).toString();if("ssbond"==s){if(i="Residue "+u+" has disulfide bond with",void 0!==r[u])for(var O=0,H=r[u].length;O<H;++O)i+=" residue "+r[u][O]}else if("crosslink"==s&&(i="Residue "+u+" has cross-linkage with",void 0!==r[u]))for(O=0,H=r[u].length;O<H;++O)i+=" residue "+r[u][O];l+='<span id="'+w+"_"+a.pre+e+"_"+k+'" title="'+i+'" class="icn3d-residue">'+x+"</span>",o+=a.showSeqCls.insertGapOverview(e,m);var R=a.icn3dui.cfg.blast_rep_id==e?Math.round(a.seqAnnWidth*m/(a.maxAnnoLength+a.nTotalGap)-S-_):Math.round(a.seqAnnWidth*m/a.maxAnnoLength-S-_);R>=0&&(o+='<div style="display:inline-block; width:'+R+'px;">&nbsp;</div>',o+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+i+'">&nbsp;</div>',S+=R,_+=1)}else l+="<span>-</span>";y='<span class="icn3d-residueNum" title="residue count">&nbsp;'+v.toString()+" Residues</span>",y+="</span>",l+=y+="<br>",o+=y,l+="</div>",o+="</div>",d+="</div>",$("#"+a.pre+"dt_"+s+"_"+e).html(l),$("#"+a.pre+"ov_"+s+"_"+e).html(o),$("#"+a.pre+"tt_"+s+"_"+e).html(d)}setToolTip(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").tooltip({content:function(){return $(this).prop("title")},show:null,close:function(e,t){t.tooltip.hover((function(){$(this).stop(!0).fadeTo(400,1)}),(function(){$(this).fadeOut("400",(function(){$(this).remove()}))}))}})}}class ve{constructor(e){this.icn3d=e}showSsbond(e,t){var s=this.icn3d;s.icn3dui;var i=this;void 0===s.ssbondpnts?setTimeout((function(){i.showSsbond_base(e,t)}),1e3):this.showSsbond_base(e,t)}showSsbond_base(e,t){var s=this.icn3d;s.icn3dui;var i=t,n={},r=i.substr(0,i.indexOf("_")),a=s.ssbondpnts[r];if(void 0===a)return $("#"+s.pre+"dt_ssbond_"+e).html(""),$("#"+s.pre+"ov_ssbond_"+e).html(""),void $("#"+s.pre+"tt_ssbond_"+e).html("");for(var l=0,o=a.length;l<o;l+=2){var d=a[l],c=a[l+1],h=d.substr(0,d.lastIndexOf("_")),m=c.substr(0,c.lastIndexOf("_"));i===h&&(void 0===n[d]&&(n[d]=[]),n[d].push(c)),i===m&&(void 0===n[c]&&(n[c]=[]),n[c].push(d))}var p=Object.keys(n);s.annoCddSiteCls.showAnnoType(e,t,"ssbond","Disulfide Bonds",p,n)}}class ge{constructor(e){this.icn3d=e}showPicking(e,t,s){var i=this.icn3d,n=i.icn3dui;if(void 0!==i.icn3dui.cfg.cid&&0!=i.pk&&(i.pk=1),i.highlightlevel=i.pk,this.showPickingBase(e,t,s),0!=i.pk)if(void 0!==t&&void 0!==s){null!=i.icn3dui.cfg.showmenu&&1==i.icn3dui.cfg.showmenu&&(s+=i.icn3dui.htmlCls.MENU_HEIGHT);var r=1==i.pk?e.resn+e.resi+"@"+e.name:e.resn+e.resi;void 0!==i.structures&&Object.keys(i.structures).length>1?(r=e.structure+"_"+e.chain+" "+r,$("#"+i.pre+"popup").css("width","140px")):$("#"+i.pre+"popup").css("width","80px"),$("#"+i.pre+"popup").html(r),$("#"+i.pre+"popup").css("top",s).css("left",t+20).show()}else{i.hlUpdateCls.updateHlAll();var a={};a.factor=i._zoomFactor,a.mouseChange=i.mouseChange,a.quaternion={},a.quaternion._x=parseFloat(i.quaternion._x).toPrecision(5),a.quaternion._y=parseFloat(i.quaternion._y).toPrecision(5),a.quaternion._z=parseFloat(i.quaternion._z).toPrecision(5),a.quaternion._w=parseFloat(i.quaternion._w).toPrecision(5),i.bAddCommands&&(i.commands.push("pickatom "+e.serial+"|||"+i.transformCls.getTransformationStr(a)),i.optsHistory.push(n.hashUtilsCls.cloneHash(i.opts)),i.optsHistory[i.optsHistory.length-1].hlatomcount=Object.keys(i.hAtoms).length,n.utilsCls.isSessionStorageSupported()&&i.setStyleCls.saveCommandsToSession(),i.STATENUMBER=i.commands.length),i.logs.push("pickatom "+e.serial+"(chain: "+e.structure+"_"+e.chain+", residue: "+e.resn+", number: "+e.resi+", atom: "+e.name+")"),$("#"+i.pre+"logtext").length&&$("#"+i.pre+"logtext").val("> "+i.logs.join("\n> ")+"\n> ").scrollTop($("#"+i.pre+"logtext")[0].scrollHeight),i.bSphereCalc=!1,i.bHbondCalc=!1}}showPickingBase(e,t,s){this.icn3d.icn3dui,void 0===t&&void 0===s&&this.showPickingHilight(e)}showPickingHilight(e){var t=this.icn3d,s=t.icn3dui;if(t.bShift||t.bCtrl||t.hlObjectsCls.removeHlObjects(),t.pickedAtomList={},1===t.pk)t.pickedAtomList[e.serial]=1;else if(2===t.pk){var i=e.structure+"_"+e.chain+"_"+e.resi;t.pickedAtomList=t.residues[i]}else if(3===t.pk)t.pickedAtomList=this.selectStrandHelixFromAtom(e);else if(4===t.pk)t.pickedAtomList=this.select3ddomainFromAtom(e);else if(5===t.pk){var n=e.structure+"_"+e.chain;t.pickedAtomList=t.chains[n]}0===t.pk?t.bShowHighlight=!1:t.bShowHighlight=!0;var r=Object.keys(t.hAtoms).length==Object.keys(t.atoms).length?{}:s.hashUtilsCls.intHash(t.hAtoms,t.pickedAtomList),a=Object.keys(r).length;if(t.bShift||t.bCtrl)if(t.bShift){if(void 0===t.prevPickedAtomList)t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList);else{var l=t.firstAtomObjCls.getFirstAtomObj(t.prevPickedAtomList),o=t.firstAtomObjCls.getFirstAtomObj(t.pickedAtomList);if(l.structure+"_"+l.chain!=o.structure+"_"+o.chain)t.hAtoms=s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList);else{var d;d=s.hashUtilsCls.unionHash(d,t.prevPickedAtomList),d=s.hashUtilsCls.unionHash(d,t.pickedAtomList);for(var c=t.firstAtomObjCls.getFirstAtomObj(d),h=t.firstAtomObjCls.getLastAtomObj(d),m=c.serial;m<=h.serial;++m)t.hAtoms[m]=1}}t.prevPickedAtomList=s.hashUtilsCls.cloneHash(t.pickedAtomList)}else t.bCtrl&&(t.hAtoms=a>0?s.hashUtilsCls.exclHash(t.hAtoms,t.pickedAtomList):s.hashUtilsCls.unionHash(t.hAtoms,t.pickedAtomList));else t.hAtoms=s.hashUtilsCls.cloneHash(t.pickedAtomList);t.hlObjectsCls.removeHlObjects(),t.hlObjectsCls.addHlObjects()}select3ddomainFromAtom(e){var t,s=this.icn3d,i=s.icn3dui,n=e.structure+"_"+e.chain,r=n+"_"+e.resi;for(var a in s.tddomains){var l=a.indexOf("_3d_domain");if(a.substr(0,l)==n&&-1!==Object.keys(s.tddomains[a]).indexOf(r)){t=a;break}}var o={};for(var r in s.tddomains[t])o=i.hashUtilsCls.unionHash(o,s.residues[r]);return o}selectStrandHelixFromAtom(e){var t=this.icn3d,s=t.icn3dui,i=e,n=e,r={},a=i.resi;if(!i.ssbegin){for(var l=i.resi-1;l>0;--l){var o=i.structure+"_"+i.chain+"_"+l;if(!t.residues.hasOwnProperty(o))break;if(a=(e=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[o])).resi,"coil"!==i.ss&&e.ss===i.ss&&e.ssbegin||"coil"===i.ss&&e.ss!==i.ss){"coil"===i.ss&&e.ss!==i.ss&&(a=e.resi+1);break}}for(l=a;l<=i.resi;++l){o=i.structure+"_"+i.chain+"_"+l;r=s.hashUtilsCls.unionHash(r,s.hashUtilsCls.hash2Atoms(t.residues[o],t.atoms))}}var d=n.resi,c=t.firstAtomObjCls.getLastAtomObj(t.chains[n.structure+"_"+n.chain]).resi;for(l=n.resi+1;l<=c;++l){o=n.structure+"_"+n.chain+"_"+l;if(!t.residues.hasOwnProperty(o))break;if(d=(e=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[o])).resi,"coil"!==n.ss&&e.ss===n.ss&&e.ssend||"coil"===n.ss&&e.ss!==n.ss){"coil"===n.ss&&e.ss!==n.ss&&(d=e.resi-1);break}}for(l=n.resi+1;l<=d;++l){o=n.structure+"_"+n.chain+"_"+l;r=s.hashUtilsCls.unionHash(r,s.hashUtilsCls.hash2Atoms(t.residues[o],t.atoms))}return r}}class fe{constructor(e){this.icn3d=e}applyCommand(e){var t=this.icn3d,s=t.icn3dui;t.bAddCommands=!1;var i=e.split("|||")[0].replace(/\s+/g," ").trim(),n=i.toLowerCase();if("share link"==n)t.shareLinkCls.shareLink();else if("export state file"==n);else if(0==n.indexOf("export canvas"))setTimeout((function(){var e=n.substr(13).trim();t.scaleFactor=""===e?1:parseInt(e),t.shareLinkCls.shareLink(!0)}),500);else if("export interactions"==n)t.viewInterPairsCls.exportInteractions();else if("export stl file"==n)setTimeout((function(){t.export3DCls.exportStlFile("")}),500);else if("export vrml file"==n)setTimeout((function(){t.export3DCls.exportVrmlFile("")}),500);else if("export stl stabilizer file"==n)setTimeout((function(){t.threeDPrintCls.hideStabilizer(),t.threeDPrintCls.resetAfter3Dprint(),t.threeDPrintCls.addStabilizer(),t.export3DCls.exportStlFile("_stab")}),500);else if("export vrml stabilizer file"==n)setTimeout((function(){t.threeDPrintCls.hideStabilizer(),t.threeDPrintCls.resetAfter3Dprint(),t.threeDPrintCls.addStabilizer(),t.export3DCls.exportVrmlFile("_stab")}),500);else if("export pdb"==n)t.icn3dui.htmlCls.setHtmlCls.exportPdb();else if("select all"==n)t.selectionCls.selectAll();else if("show all"==n)t.selectionCls.showAll();else if("select complement"==n)t.resid2specCls.selectComplement();else if("set pk atom"==n)t.pk=1,t.opts.pk="atom";else if("set pk off"==n)t.pk=0,t.opts.pk="no",t.drawCls.draw(),t.hlObjectsCls.removeHlObjects();else if("set pk residue"==n)t.pk=2,t.opts.pk="residue";else if("set pk strand"==n)t.pk=3,t.opts.pk="strand";else if("set pk domain"==n)t.pk=4,t.opts.pk="domain";else if("set pk chain"==n)t.pk=5,t.opts.pk="chain";else if("set surface wireframe on"==n)t.opts.wireframe="yes",t.applyMapCls.applySurfaceOptions();else if("set surface wireframe off"==n)t.opts.wireframe="no",t.applyMapCls.applySurfaceOptions();else if("set map wireframe on"==n)t.opts.mapwireframe="yes",t.applyMapCls.applyMapOptions();else if("set map wireframe off"==n)t.opts.mapwireframe="no",t.applyMapCls.applyMapOptions();else if("set emmap wireframe on"==n)t.opts.emmapwireframe="yes",t.applyMapCls.applyEmmapOptions();else if("set emmap wireframe off"==n)t.opts.emmapwireframe="no",t.applyMapCls.applyEmmapOptions();else if("set surface neighbors on"==n)t.bConsiderNeighbors=!0,t.applyMapCls.applySurfaceOptions();else if("set surface neighbors off"==n)t.bConsiderNeighbors=!1,t.applyMapCls.applySurfaceOptions();else if("set axis on"==n)t.opts.axis="yes";else if("set pc1 axis"==n)t.pc1=!0,t.axesCls.setPc1Axes();else if("set axis off"==n)t.opts.axis="no",t.pc1=!1;else if("set fog on"==n)t.opts.fog="yes",t.fogCls.setFog(!0);else if("set fog off"==n)t.opts.fog="no",t.fogCls.setFog(!0);else if("set slab on"==n)t.opts.slab="yes";else if("set slab off"==n)t.opts.slab="no";else if("set assembly on"==n)t.bAssembly=!0;else if("set assembly off"==n)t.bAssembly=!1;else if("set chemicalbinding show"==n)t.setOptionCls.setOption("chemicalbinding","show");else if("set chemicalbinding hide"==n)t.setOptionCls.setOption("chemicalbinding","hide");else if("set hbonds off"==n)t.hBondCls.hideHbonds(),t.drawCls.draw();else if("set salt bridge off"==n)t.saltbridgeCls.hideSaltbridge(),t.drawCls.draw();else if("set contact off"==n)t.contactCls.hideContact(),t.drawCls.draw();else if("set halogen pi off"==n)t.piHalogenCls.hideHalogenPi(),t.drawCls.draw();else if("hydrogens"==n)t.showInterCls.showHydrogens(),t.drawCls.draw();else if("set hydrogens off"==n)t.showInterCls.hideHydrogens(),t.drawCls.draw();else if("close popup"==n)t.resizeCanvasCls.closeDialogs();else if("set stabilizer off"==n)t.threeDPrintCls.hideStabilizer(),t.drawCls.draw();else if("set disulfide bonds off"==n)t.opts.ssbonds="no",t.drawCls.draw();else if("set cross linkage off"==n)t.opts.clbonds="no",t.drawCls.draw();else if("set lines off"==n)t.labels.distance=[],t.lines.distance=[],t.drawCls.draw();else if("set labels off"==n){for(var r in t.labels)t.labels[r]=[];t.drawCls.draw()}else if("set mode all"==n)t.definedSetsCls.setModeAndDisplay("all");else if("set mode selection"==n)t.definedSetsCls.setModeAndDisplay("selection");else if("set view detailed view"==n)t.annotationCls.setAnnoViewAndDisplay("detailed view");else if("set view overview"==n)t.annotationCls.setAnnoViewAndDisplay("overview");else if("set annotation custom"==n)t.annotationCls.setAnnoTabCustom();else if("set annotation interaction"==n)t.annotationCls.setAnnoTabInteraction();else if("set annotation cdd"==n)t.annotationCls.setAnnoTabCdd();else if("set annotation site"==n)t.annotationCls.setAnnoTabSite();else if("set annotation ssbond"==n)t.annotationCls.setAnnoTabSsbond();else if("set annotation crosslink"==n)t.annotationCls.setAnnoTabCrosslink();else if("set annotation transmembrane"==n)t.annotationCls.setAnnoTabTransmem();else if("highlight level up"==n)t.resid2specCls.switchHighlightLevelUp();else if("highlight level down"==n)t.resid2specCls.switchHighlightLevelDown();else if(0==n.indexOf("hide annotation")){var a=n.lastIndexOf(" ");"all"==(x=n.substr(a+1))?t.annotationCls.hideAnnoTabAll():"custom"==x?t.annotationCls.hideAnnoTabCustom():"clinvar"==x?t.annotationCls.hideAnnoTabClinvar():"snp"==x?t.annotationCls.hideAnnoTabSnp():"cdd"==x?t.annotationCls.hideAnnoTabCdd():"3ddomain"==x?t.annotationCls.hideAnnoTab3ddomain():"site"==x?t.annotationCls.hideAnnoTabSite():"interaction"==x?t.annotationCls.hideAnnoTabInteraction():"ssbond"==x?t.annotationCls.hideAnnoTabSsbond():"crosslink"==x?t.annotationCls.hideAnnoTabCrosslink():"transmembrane"==x&&t.annotationCls.hideAnnoTabTransmem()}else if("add residue labels"==n)t.residueLabelsCls.addResidueLabels(t.hAtoms),t.drawCls.draw();else if("add residue number labels"==n)t.residueLabelsCls.addResidueLabels(t.hAtoms,void 0,void 0,!0),t.drawCls.draw();else if("add atom labels"==n)t.residueLabelsCls.addAtomLabels(t.hAtoms),t.drawCls.draw();else if("add chain labels"==n)t.analysisCls.addChainLabels(t.hAtoms),t.drawCls.draw();else if("add terminal labels"==n)t.analysisCls.addTerminiLabels(t.hAtoms),t.drawCls.draw();else if("rotate left"==n)t.bStopRotate=!1,t.ROT_DIR="left",t.resizeCanvasCls.rotStruc("left");else if("rotate right"==n)t.bStopRotate=!1,t.ROT_DIR="right",t.resizeCanvasCls.rotStruc("right");else if("rotate up"==n)t.bStopRotate=!1,t.ROT_DIR="up",t.resizeCanvasCls.rotStruc("up");else if("rotate down"==n)t.bStopRotate=!1,t.ROT_DIR="down",t.resizeCanvasCls.rotStruc("down");else if("rotate x"==n){var l=new THREE.Vector3(1,0,0),o=.5*Math.PI;t.transformCls.setRotation(l,o)}else if("rotate y"==n){l=new THREE.Vector3(0,1,0),o=.5*Math.PI;t.transformCls.setRotation(l,o)}else if("rotate z"==n){l=new THREE.Vector3(0,0,1),o=.5*Math.PI;t.transformCls.setRotation(l,o)}else if("reset"===n)t.selectionCls.resetAll();else if("reset orientation"===n)t.transformCls.resetOrientation(),t.drawCls.draw();else if("reset thickness"==n)t.threeDPrintCls.resetAfter3Dprint(),t.drawCls.draw();else if("clear selection"==n)t.hlObjectsCls.removeHlObjects(),t.hlUpdateCls.removeHl2D(),t.bShowHighlight=!1,t.bSelectResidue=!1;else if("zoom selection"==n)t.transformCls.zoominSelection(),t.drawCls.draw();else if("center selection"==n)t.applyCenterCls.centerSelection(),t.drawCls.draw();else if("show selection"==n)t.selectionCls.showSelection();else if("hide selection"==n)t.selectionCls.hideSelection();else if("output selection"==n)t.threeDPrintCls.outputSelection();else if("toggle selection"==n)t.selectionCls.toggleSelection();else if("toggle highlight"==n)t.hlUpdateCls.toggleHighlight();else if("stabilizer"==n)t.threeDPrintCls.addStabilizer(),t.threeDPrintCls.prepareFor3Dprint();else if("disulfide bonds"==n)t.annoSsbondCls.showSsbonds();else if("cross linkage"==n)t.showInterCls.showClbonds();else if("back"==n)t.resizeCanvasCls.back();else if("forward"==n)t.resizeCanvasCls.forward();else if("clear all"==n)t.selectionCls.selectAll();else if("defined sets"==n)t.definedSetsCls.showSets();else if("delete selected sets"==n)t.definedSetsCls.deleteSelectedSets();else if("view interactions"==n)void 0===t.icn3dui.cfg.mmdbid&&void 0===t.icn3dui.cfg.gi||t.ParserUtilsCls.set2DDiagrams(t.inputid);else if("show annotations all chains"==n)t.annotationCls.showAnnoAllChains();else if("save color"==n)t.setOptionCls.saveColor();else if("apply saved color"==n)t.setOptionCls.applySavedColor();else if("save style"==n)t.setOptionCls.saveStyle();else if("apply saved style"==n)t.setOptionCls.applySavedStyle();else if("select main chains"==n)t.selectionCls.selectMainChains();else if("select side chains"==n)t.selectionCls.selectSideChains();else if("select main side chains"==n)t.selectionCls.selectMainSideChains();else if("realign"==n)t.realignParserCls.realign();else if("area"==n)t.analysisCls.calculateArea();else if("table inter count only"==n)$(".icn3d-border").hide();else if("table inter details"==n)$(".icn3d-border").show();else if("setoption map nothing"==n)t.setOptionCls.setOption("map","nothing");else if("setoption emmap nothing"==n)t.setOptionCls.setOption("emmap","nothing");else if("setoption phimap nothing"==n)t.setOptionCls.setOption("phimap","nothing");else if("setoption phisurface nothing"==n)t.setOptionCls.setOption("phisurface","nothing");else if("clear symd symmetry"==n)t.symdArray=[];else if(0==i.indexOf("define helix sets")){var d=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(d,"helix")}else if(0==i.indexOf("define sheet sets")){d=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(d,"sheet")}else if(0==i.indexOf("define coil sets")){d=i.split(" | ")[1].split(" ")[1];t.addTrackCls.defineSecondary(d,"coil")}else if(0==i.indexOf("select interaction")){if(null!==(v=i.substr(i.lastIndexOf(" ")+1).split(","))){var c=v[0].split("_")[0];t.b2DShown||t.ParserUtilsCls.download2Ddgm(c.toUpperCase()),t.diagram2dCls.selectInteraction(v[0],v[1])}}else if(0==i.indexOf("select saved atoms")||0==i.indexOf("select sets")){var h=(b=(i=i.replace(/aligned_protein/g,"protein_aligned")).split(" | "))[0].replace(/,/g," or ");a=19;0==i.indexOf("select sets")&&(a=12);var m=h.substr(a),p=m;2==b.length&&(p=b[1].substr(5)),t.definedSetsCls.selectCombinedSets(m,p)}else if(-1!==i.indexOf("select chain"))for(var u=0,C=(v=i.substr(i.lastIndexOf(" ")+1).split(",")).length;u<C;++u)t.selectionCls.selectAChain(v[u],v[u],!1);else if(-1!==i.indexOf("select alignChain")){var v;for(u=0,C=(v=i.substr(i.lastIndexOf(" ")+1).split(",")).length;u<C;++u)t.selectionCls.selectAChain(v[u],"align_"+v[u],!0)}else if(0==i.indexOf("select zone cutoff")){var g=this.getThresholdNameArrays(i);t.showInterCls.pickCustomSphere(g.threshold,g.nameArray2,g.nameArray,g.bHbondCalc),t.bSphereCalc=!0}else if(0==n.indexOf("set surface opacity")){var f=n.substr(n.lastIndexOf(" ")+1);t.opts.opacity=parseFloat(f),t.applyMapCls.applySurfaceOptions(),parseInt(100*f)<100&&(t.bTransparentSurface=!0)}else if(0==n.indexOf("set label scale")){f=n.substr(n.lastIndexOf(" ")+1);t.labelScale=parseFloat(f)}else if(0==n.indexOf("set surface")){f=n.substr(12);t.opts.surface=f,t.applyMapCls.applySurfaceOptions()}else if(0==n.indexOf("set camera")){f=n.substr(n.lastIndexOf(" ")+1);t.opts.camera=f}else if(0==n.indexOf("set background")){f=n.substr(n.lastIndexOf(" ")+1);t.opts.background=f,"white"==f||"grey"==f?($("#"+t.pre+"title").css("color","black"),$("#"+t.pre+"titlelink").css("color","black")):($("#"+t.pre+"title").css("color",t.icn3dui.htmlCls.GREYD),$("#"+t.pre+"titlelink").css("color",t.icn3dui.htmlCls.GREYD))}else if(0==i.indexOf("set thickness")){var b=n.split(" | ");t.bSetThickness=!0;for(u=1,C=b.length;u<C;++u){var y=(w=b[u].split(" "))[0];f=parseFloat(w[1]);"linerad"==y&&(t.lineRadius=f),"coilrad"==y&&(t.coilWidth=f),"stickrad"==y&&(t.cylinderRadius=f),"tracerad"==y&&(t.traceRadius=f),"ballscale"==y&&(t.dotSphereScale=f),"ribbonthick"==y&&(t.ribbonthickness=f),"proteinwidth"==y&&(t.helixSheetWidth=f),"nucleotidewidth"==y&&(t.nucleicAcidWidth=f),t.drawCls.draw()}}else if(0==n.indexOf("set highlight color")){"yellow"===(_=n.substr(20))?(t.hColor=s.parasCls.thr(16776960),t.matShader=t.setColorCls.setOutlineColor("yellow")):"green"===_?(t.hColor=s.parasCls.thr(65280),t.matShader=t.setColorCls.setOutlineColor("green")):"red"===_&&(t.hColor=s.parasCls.thr(16711680),t.matShader=t.setColorCls.setOutlineColor("red")),t.drawCls.draw()}else if(0==n.indexOf("set highlight style")){"outline"===(he=n.substr(20))?t.bHighlight=1:"3d"===he&&(t.bHighlight=2),t.drawCls.draw()}else if(0==n.indexOf("add line")){var w=(b=n.split(" | "))[1].split(" "),S=b[2].split(" "),_=b[3].substr(b[3].lastIndexOf(" ")+1),A="true"===b[4].substr(b[4].lastIndexOf(" ")+1),x=b[5].substr(b[5].lastIndexOf(" ")+1);t.analysisCls.addLine(parseFloat(w[1]),parseFloat(w[3]),parseFloat(w[5]),parseFloat(S[1]),parseFloat(S[3]),parseFloat(S[5]),_,A,x),t.drawCls.draw()}else if(0==i.indexOf("add label")){var k,O,H,R,E,I=(b=i.split(" | "))[0].substr("add label".length+1),D=!1;for(u=1,C=b.length;u<C;++u){var T=b[u].split(" ");"x"==T[0]?(D=!0,k=T[1],O=T[3],H=T[5]):"size"==T[0]?R=b[u].substr(b[u].lastIndexOf(" ")+1):"color"==T[0]?_=b[u].substr(b[u].lastIndexOf(" ")+1):"background"==T[0]?E=b[u].substr(b[u].lastIndexOf(" ")+1):"type"==T[0]&&(x=b[u].substr(b[u].lastIndexOf(" ")+1))}if(!D){var M=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms));k=M.center.x,O=M.center.y,H=M.center.z}t.analysisCls.addLabel(I,k,O,H,R,_,E,x),t.drawCls.draw()}else if(0==i.indexOf("msa")){var P=(b=i.split(" | "))[1].split(" ");t.targetGapHash={};for(u=0,C=P.length;u<C;++u){var F=P[u].split("_");t.targetGapHash[parseInt(F[0])]={from:parseInt(F[1]),to:parseInt(F[2])}}t.annotationCls.resetAnnoAll()}else if(0==i.indexOf("add track")){d=(b=i.split(" | "))[1].substr(8);var L,N=b[2].substr(6);I=b[3].substr(5);b.length>=5&&(x=b[4].substr(5)),b.length>=6&&(_=b[5].substr(6)),b.length>=7&&(L=b[6].substr(4)),$("#"+t.pre+"anno_custom")[0].checked=!0,$("[id^="+t.pre+"custom]").show(),"0"==_&&(_=void 0),t.addTrackCls.checkGiSeq(d,N,I,x,_,L,0)}else if(0==n.indexOf("remove one stabilizer")){w=(b=n.split(" | "))[1].split(" ");var U=[];U.push(parseInt(w[0])),U.push(parseInt(w[1])),t.threeDPrintCls.removeOneStabilizer(U),t.drawCls.draw()}else if(0==n.indexOf("add one stabilizer")){w=(b=n.split(" | "))[1].split(" ");void 0===t.pairArray&&(t.pairArray=[]),t.pairArray.push(parseInt(w[0])),t.pairArray.push(parseInt(w[1])),t.drawCls.draw()}else if(0==n.indexOf("select planes z-axis")){if(5==(b=n.split(" ")).length){var q=parseFloat(b[3]),j=parseFloat(b[4]);t.selectionCls.selectBtwPlanes(q,j)}}else if(0==n.indexOf("adjust membrane z-axis")){if(5==(b=n.split(" ")).length){q=parseFloat(b[3]),j=parseFloat(b[4]);t.selectionCls.adjustMembrane(q,j)}}else if(0==n.indexOf("toggle membrane"))t.selectionCls.toggleMembrane();else if(0==i.indexOf("calc buried surface")){if(2==(b=i.split(" | ")).length)if(2==(Z=b[1].split(" ")).length){var B=Z[0].split(","),z=Z[1].split(",");t.analysisCls.calcBuriedSurface(B,z)}}else if(0==i.indexOf("dist")){if(2==(b=i.split(" | ")).length)if(2==(Z=b[1].split(" ")).length){z=Z[0].split(","),B=Z[1].split(",");t.analysisCls.measureDistTwoSets(z,B)}}else if(0==i.indexOf("display interaction 3d")||0==i.indexOf("view interaction pairs")||0==i.indexOf("save1 interaction pairs")||0==i.indexOf("save2 interaction pairs")||0==i.indexOf("line graph interaction pairs")||0==i.indexOf("scatterplot interaction pairs")){if((b=i.split(" | ")).length>=3)if(2==(Z=b[1].split(" ")).length){B=Z[0].split(","),z=Z[1].split(",");var G,V=-1!==b[2].indexOf("hbonds"),W=-1!==b[2].indexOf("salt bridge"),Y=-1!==b[2].indexOf("interactions"),X=-1!==b[2].indexOf("halogen"),K=-1!==b[2].indexOf("pi-cation"),Q=-1!==b[2].indexOf("pi-stacking");if(b.length>=4&&(G="true"==b[3]),b.length>=5){var J=b[4].split(" ");J.length>=4&&($("#"+t.pre+"hbondthreshold").val(J[1]),$("#"+t.pre+"saltbridgethreshold").val(J[2]),$("#"+t.pre+"contactthreshold").val(J[3]),7==J.length&&($("#"+t.pre+"halogenthreshold").val(J[4]),$("#"+t.pre+"picationthreshold").val(J[5]),$("#"+t.pre+"pistackingthreshold").val(J[6])))}0==i.indexOf("display interaction 3d")?x="3d":0==i.indexOf("view interaction pairs")?x="view":0==i.indexOf("save1 interaction pairs")?x="save1":0==i.indexOf("save2 interaction pairs")?x="save2":0==i.indexOf("line graph interaction pairs")?x="linegraph":0==i.indexOf("scatterplot interaction pairs")&&(x="scatterplot"),t.viewInterPairsCls.viewInteractionPairs(B,z,G,x,V,W,Y,X,K,Q)}}else if(0==i.indexOf("export pairs")){var Z;if(3==(b=i.split(" | ")).length)if(2==(Z=b[1].split(" ")).length){B=Z[0].split(","),z=Z[1].split(",");var ee=b[2].split(" ")[1];t.showInterCls.pickCustomSphere(ee,B,z,t.bSphereCalc),t.bSphereCalc=!0;I=t.viewInterPairsCls.exportSpherePairs();var te=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(te+"_sphere_pairs.html","html",I)}}else if(0==i.indexOf("export pqr"))t.icn3dui.htmlCls.setHtmlCls.exportPqr();else if(0==n.indexOf("graph label")){a=n.lastIndexOf(" ");var se=n.substr(a+1);$("#"+t.icn3dui.svgid+"_label").val(se),$("#"+t.icn3dui.svgid+" text").removeClass(),$("#"+t.icn3dui.svgid+" text").addClass(se)}else if(0==n.indexOf("line graph scale")){a=n.lastIndexOf(" ");var ie=n.substr(a+1);$("#"+t.linegraphid+"_label").val(ie),$("#"+t.linegraphid).attr("width",(t.linegraphWidth*parseFloat(ie)).toString()+"px")}else if(0==n.indexOf("scatterplot scale")){a=n.lastIndexOf(" "),ie=n.substr(a+1);$("#"+t.scatterplotid+"_label").val(ie),$("#"+t.scatterplot).attr("width",(t.scatterplotWidth*parseFloat(ie)).toString()+"px")}else if(0==n.indexOf("graph force")){a=n.lastIndexOf(" ");t.icn3dui.htmlCls.force=parseInt(n.substr(a+1)),$("#"+t.icn3dui.svgid+"_force").val(t.icn3dui.htmlCls.force),t.getGraphCls.handleForce()}else if(0==n.indexOf("hide edges")){a=n.lastIndexOf(" ");t.icn3dui.htmlCls.hideedges=parseInt(n.substr(a+1)),$("#"+t.icn3dui.svgid+"_hideedges").val(t.icn3dui.htmlCls.hideedges),t.icn3dui.htmlCls.hideedges?(t.icn3dui.htmlCls.contactInsideColor="FFF",t.icn3dui.htmlCls.hbondInsideColor="FFF",t.icn3dui.htmlCls.ionicInsideColor="FFF"):(t.icn3dui.htmlCls.contactInsideColor="DDD",t.icn3dui.htmlCls.hbondInsideColor="AFA",t.icn3dui.htmlCls.ionicInsideColor="8FF"),void 0!==t.graphStr&&t.bRender&&t.icn3dui.htmlCls.force&&t.icn3dui.drawGraph(t.graphStr)}else if(0==n.indexOf("reset interaction pairs"))t.viewInterPairsCls.resetInteractionPairs();else if(0==n.indexOf("side by side")){var ne=(b=n.split(" | "))[1];window.open(ne,"_blank")}else if(0==i.indexOf("your note")){b=i.split(" | ");t.yournote=b[1],$("#"+t.pre+"yournote").val(t.yournote),document.title=t.yournote}else if(0==n.indexOf("cross structure interaction"))t.crossstrucinter=parseInt(n.substr(n.lastIndexOf(" ")+1)),$("#"+t.pre+"crossstrucinter").val(t.crossstrucinter);else if("replay on"==n)t.resizeCanvasCls.replayon();else if("replay off"==n)t.resizeCanvasCls.replayoff();else if(0==n.indexOf("pickatom")){var re=parseInt(n.substr(n.lastIndexOf(" ")+1));t.pAtom=t.atoms[re],t.pickingCls.showPicking(t.pAtom)}else if(0==i.indexOf("color")){_=(de=i.split(" | "))[0].substr(de[0].indexOf(" ")+1);if(t.opts.color=_,"residue custom"==_&&2==de.length)for(var ae in t.customResidueColors=JSON.parse(de[1]),t.customResidueColors)t.customResidueColors[ae.toUpperCase()]=s.parasCls.thr("#"+t.customResidueColors[ae]);else if("align custom"==_&&3==de.length){d=de[1];var le=de[2].split(", ");t.queryresi2score={},t.queryresi2score[d]={};for(u=0,C=le.length;u<C;++u){var oe=le[u].split(" ");t.queryresi2score[d][oe[0]]=oe[1]}}else"align custom"==_&&4==de.length?this.setQueryresi2score(de):"area"==_&&2==de.length&&(t.midpercent=de[1],$("#"+t.pre+"midpercent").val(t.midpercent));t.setColorCls.setColorByOptions(t.opts,t.hAtoms),t.hlUpdateCls.updateHlAll(),t.getGraphCls.updateGraphColor()}else if(0==i.indexOf("custom tube")){var de=i.split(" | ");this.setQueryresi2score(de),t.setOptionCls.setStyle("proteins","custom tube")}else if(0==n.indexOf("style")){var ce=(me=n.substr(n.indexOf(" ")+1)).substr(0,me.indexOf(" ")),he=me.substr(me.indexOf(" ")+1);t.setOptionCls.setStyle(ce,he)}else if(0==n.indexOf("window")){var me;"aligned sequences"==(me=n.substr(n.indexOf(" ")+1))?t.icn3dui.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"):"interaction table"==me?t.icn3dui.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions"):"interaction graph"==me?t.icn3dui.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"):"interaction scatterplot"==me?t.icn3dui.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as scatterplot"):"force-directed graph"==me&&t.icn3dui.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph")}else if(0==n.indexOf("set theme")){_=n.substr(n.lastIndexOf(" ")+1);t.icn3dui.htmlCls.setMenuCls.setTheme(_)}else if(0==n.indexOf("set double color")){"on"==(f=n.substr(n.lastIndexOf(" ")+1))?(t.bDoublecolor=!0,t.setOptionCls.setStyle("proteins","ribbon")):"off"==f&&(t.bDoublecolor=!1)}else if(0==n.indexOf("adjust dialog")){var pe=n.substr(n.lastIndexOf(" ")+1);t.scapCls.adjust2DWidth(pe)}else if(0==n.indexOf("glycans cartoon")){f=n.substr(n.lastIndexOf(" ")+1);t.bGlycansCartoon="yes"==f}else if(-1!==n.indexOf("select displayed set"))t.hAtoms=s.hashUtilsCls.cloneHash(t.dAtoms),t.hlUpdateCls.updateHlAll();else if(-1!==n.indexOf("select prop")){var ue,Ce,ve=(b=i.split(" | "))[0].substr("select prop".length+1);if(2==b.length){var ge=b[1].split("_");ue=ge[0],Ce=ge[1]}t.resid2specCls.selectProperty(ve,ue,Ce)}else if(0==n.indexOf("select")&&-1!==n.indexOf("name")){h="",p="";var fe="";for(u=0,C=(b=i.split(" | ")).length;u<C;++u){-1!==(y=b[u]).indexOf("select")?h=y.substr(y.indexOf(" ")+1):-1!==y.indexOf("name")&&(p=y.substr(y.indexOf(" ")+1))}fe=p,t.selByCommCls.selectByCommand(h,p,fe)}else if(-1!==n.indexOf("select $")||-1!==n.indexOf("select .")||-1!==n.indexOf("select :")||-1!==n.indexOf("select @")){h=(b=i.split(" | "))[0].substr(b[0].indexOf(" ")+1),p="",fe="";b.length>1&&(p=b[1].substr(b[1].indexOf(" ")+1)),b.length>2&&(fe=b[2].substr(b[2].indexOf(" ")+1)),-1!==h.indexOf(" or ")?t.selByCommCls.selectByCommand(h,p,fe):t.selByCommCls.selectBySpec(h,p,fe)}t.icn3dui.htmlCls.clickMenuCls.setLogCmd(i,!1),t.bAddCommands=!0}setStrengthPara(e){var t=this.icn3d;if(t.icn3dui,e.length>=5){var s=e[4].split(" ");s.length>=4&&($("#"+t.pre+"hbondthreshold").val(s[1]),$("#"+t.pre+"saltbridgethreshold").val(s[2]),$("#"+t.pre+"contactthreshold").val(s[3]),s.length>=7&&($("#"+t.pre+"halogenthreshold").val(s[4]),$("#"+t.pre+"picationthreshold").val(s[5]),$("#"+t.pre+"pistackingthreshold").val(s[6])))}if(6==e.length){var i=e[5].split(" ");i.length>=6&&($("#"+t.pre+"dist_ss").val(i[0]),$("#"+t.pre+"dist_coil").val(i[1]),$("#"+t.pre+"dist_hbond").val(i[2]),$("#"+t.pre+"dist_inter").val(i[3]),$("#"+t.pre+"dist_ssbond").val(i[4]),$("#"+t.pre+"dist_ionic").val(i[5]),9==i.length&&($("#"+t.pre+"dist_halogen").val(i[6]),$("#"+t.pre+"dist_pication").val(i[7]),$("#"+t.pre+"dist_pistacking").val(i[8])))}}getThresholdNameArrays(e){var t=this.icn3d,s=t.icn3dui;if(void 0===t.bSetChainsAdvancedMenu||!t.bSetChainsAdvancedMenu){var i=s.hashUtilsCls.cloneHash(t.hAtoms);t.definedSetsCls.setPredefinedInMenu(),t.bSetChainsAdvancedMenu=!0,t.hAtoms=s.hashUtilsCls.cloneHash(i)}var n,r=e.split(" | "),a=parseFloat(r[0].substr(r[0].lastIndexOf(" ")+1)),l=[],o=[];if(r.length>=2&&r[1].length>4){var d=r[1].split(" ");d.length>1&&(o=d[1].split(",")),d.length>2&&(l=d[2].split(","))}else o=["selected"],l=["non-selected"];return 3==r.length&&(n="true"==r[2]),{threshold:a,nameArray2:o,nameArray:l,bHbondCalc:n}}setQueryresi2score(e){var t=this.icn3d;t.icn3dui;var s=e[1],i=e[2].split(" ")[1].split("_"),n=e[3];void 0===t.queryresi2score&&(t.queryresi2score={}),t.queryresi2score[s]={};for(var r=parseInt(i[0]),a=0;r<=parseInt(i[1]);++r,++a)"_"!=n[a]&&(t.queryresi2score[s][r]=11.11111111111111*parseInt(n[a]))}getMenuFromCmd(e){this.icn3d.icn3dui;var t="Windows > View Sequences & Annotations",s="Analysis > H-Bonds & Interactions",i=s+" > 2D Graph(Force-Directed)",n="View > Rotate > Auto Rotation > Rotate ",r="View > Rotate > Rotate 90 deg > ",a="Select > Select on 3D > ",l="Analysis > Label > ",o="File > 3D Printing > ";return 0==(e=e.trim()).indexOf("load")?"File > Retrieve by ID, Align":0==e.indexOf("set map")&&-1==e.indexOf("set map wireframe")?"Style > Electron Density":0==e.indexOf("set emmap")&&-1==e.indexOf("set emmap wireframe")?"Style > EM Density Map":0==e.indexOf("set phi")?"Analysis > Load Potential > URL(Same Host) Phi/Cube":0==e.indexOf("set delphi")?"Analysis > DelPhi Potential":0==e.indexOf("setoption map")?"Style > Remove Map":0==e.indexOf("setoption emmap")?"Style > Remove EM Map":0==e.indexOf("view annotations")?t:0==e.indexOf("set annotation all")?t+': "All" checkbox':0==e.indexOf("set annotation clinvar")?t+': "ClinVar" checkbox':0==e.indexOf("set annotation snp")?t+': "SNP" checkbox':0==e.indexOf("set annotation 3ddomain")?t+': "3D Domains" checkbox':0==e.indexOf("view interactions")?"Windows > View 2D Diagram":0==e.indexOf("symmetry")?"Analysis > Symmetry":0==e.indexOf("realign on seq align")?"File > Realign Selection > on Sequence Alignment":0==e.indexOf("realign")?"File > Realign Selection > Residue by Residue":0==e.indexOf("graph interaction pairs")?s+" > 2D Graph(Force-Directed)":0==e.indexOf("export canvas")?"File > Save Files > iCn3D PNG Image":"export stl file"==e?o+"STL":"export vrml file"==e?o+"VRML(Color)":"export stl stabilizer file"==e?o+"STL W/ Stabilizers":"export vrml stabilizer file"==e?o+"VRML(Color, W/ Stabilizers)":"select all"==e?'Select > All; or Toggle to "All"(next to "Help")':"show all"==e?"View > View Full Structure":"select complement"==e?"Select > Inverse":"set pk atom"==e?a+"Atom":"set pk residue"==e?a+"Residue":"set pk strand"==e?a+"Strand/Helix":"set pk domain"==e?a+"3D Domain":"set pk chain"==e?a+"Chain":"set surface wireframe on"==e?"Style > Surface Wireframe > Yes":"set surface wireframe off"==e?"Style > Surface Wireframe > No":"set map wireframe on"==e?"Style > Map Wireframe > Yes":"set map wireframe off"==e?"Style > Map Wireframe > No":"set emmap wireframe on"==e?"Style > EM Map Wireframe > Yes":"set emmap wireframe off"==e?"Style > EM Map Wireframe > No":"set surface neighbors on"==e?"Style > Surface Type > ... with Context":"set axis on"==e?"View > XYZ-axes > Show":"set axis off"==e?"View > XYZ-axes > Hide":"set fog on"==e?"View > Fog for Selection > On":"set fog off"==e?"View > Fog for Selection > Off":"set slab on"==e?"View > Slab for Selection > On":"set slab off"==e?"View > Slab for Selection > Off":"set assembly on"==e?"Analysis > Assembly > Biological Assembly":"set assembly off"==e?"Analysis > Assembly > Asymmetric Unit":"set chemicalbinding show"==e?"Analysis > Chem. Binding > Show":"set chemicalbinding hide"==e?"Analysis > Chem. Binding > Hide":"set hbonds off"==e||"set salt bridge off"==e||"set contact off"==e||"set halogen pi off"==e?s+" > Reset":"hydrogens"==e?"Style > Hydrogens > Show":"set hydrogens off"==e?"Style > Hydrogens > Hide":"set stabilizer off"==e?"File > 3D Printing > Remove All Stabilizers":"set disulfide bonds off"==e?"Analysis > Disulfide Bonds > Hide":"set cross linkage off"==e?"Analysis > Cross-Linkages > Hide":"set lines off"==e?"Analysis > Distance > Hide":"set labels off"==e?"Analysis > Label > Remove":"set mode all"==e?'Toggle to "All"(next to "Help")':"set mode selection"==e?'Toggle to "Selection"(next to "Help")':"set view detailed view"==e?t+': "Details" tab':"set view overview"==e?t+': "Summary" tab':"set annotation custom"==e?t+': "Custom" checkbox':"set annotation interaction"==e?t+': "Interactions" checkbox':"set annotation cdd"==e?t+': "Conserved Domains" checkbox':"set annotation site"==e?t+': "Functional Sites" checkbox':"set annotation ssbond"==e?t+': "Disulfide Bonds" checkbox':"set annotation crosslink"==e?t+': "Cross-Linkages" checkbox':"set annotation transmembrane"==e?t+': "Transmembrane" checkbox':"highlight level up"==e?"Keyboard Arrow Up":"highlight level down"==e?"Keyboard Arrow Down":0==e.indexOf("hide annotation")?t+": checkboxes off":"add residue labels"==e?l+"per Residue":"add residue number labels"==e?l+"per Residue & Number":"add atom labels"==e?l+"per Atom":"add chain labels"==e?l+"per Chain":"add terminal labels"==e?l+"N- & C- Termini":"rotate left"==e?n+"Left; or Key l":"rotate right"==e?n+"Right; or Key j":"rotate up"==e?n+"Up; or Key i":"rotate down"==e?n+"Down; or Key m":"rotate x"==e?r+"X-axis":"rotate y"==e?r+"Y-axis":"rotate z"==e?r+"Z-axis":"reset"==e?"View > Reset > All":"reset orientation"==e?"View > Reset > Orientation":"reset thickness"==e?"File > 3D Printing > Reset Thickness":"clear selection"==e?"Select > Clear Selection":"zoom selection"==e?"Select > Zoom in Selection":"center selection"==e?"Select > Center Selection":"show selection"==e?"Select > View Only Selection":"hide selection"==e?"Select > Hide Selection":"output selection"==e?"Select > Clear Selection":"toggle highlight"==e?"Select > Toggle Highlight":"stabilizer"==e?"File > 3D Printing > Add all Stabilizers":"disulfide bonds"==e?"Analysis > Disulfide Bonds > Show":"cross linkage"==e?"Analysis > Cross-Linkages > Show":"back"==e?"View > Undo":"forward"==e?"View > Redo":"clear all"==e?"Select > Clear Selection":"defined sets"==e?"Windows > Defined Sets":"delete selected sets"==e?'Windows > Defined Sets: "Delete Selected Sets" button':"view interactions"==e?"Windows > View Interactions":"show annotations all chains"==e?t+': "Show All Chains" button':"save color"==e?"Color > Save Color":"apply saved color"==e?"Color > Apply Saved Color":"save style"==e?"Style > Save Style":"apply saved style"==e?"Style > Apply Saved Style":"select main chains"==e?"Select > Main Chains":"select side chains"==e?"Select > Side Chains":"select main side chains"==e?"Select > Main & Side Chains":"area"==e?"View > Surface Area":"table inter count only"==e?s+': "Set 1" button: "Show Count Only" button':"table inter details"==e?s+': "Set 1" button: "Show Details" button':0==e.indexOf("define helix sets")?t+': "Helix Sets" button':0==e.indexOf("define sheet sets")?t+': "Sheet Sets" button':0==e.indexOf("define coil sets")?t+': "Coil Sets" button':0==e.indexOf("select interaction")?"Windows > View 2D Diagram: click on edges":0==e.indexOf("select saved atoms")||0==e.indexOf("select sets")?"Windows > Defined Sets: select in menu":-1!==e.indexOf("select chain")?t+": click on chain names":-1!==e.indexOf("select alignChain")?"Windows > View Aligned Sequences: click on chain names":0==e.indexOf("select zone cutoff")?"Select > by Distance":0==e.indexOf("set surface opacity")?"Style > Surface Opacity":0==e.indexOf("set label scale")?"View > Label Scale":0==e.indexOf("set surface")?"Style > Surface Type":0==e.indexOf("set camera")?"View > Camera":0==e.indexOf("set background")?"Style > Background":0==e.indexOf("set thickness")?"File > 3D Printing > Set Thickness":0==e.indexOf("set highlight color")?"Select > Highlight Color":0==e.indexOf("set highlight style")?"Select > Highlight Style":0==e.indexOf("add line")||0==e.indexOf("add label")?"Analysis > Distance > between Two Atoms":0==e.indexOf("dist")?"Analysis > Distance > between Two Sets":0==e.indexOf("msa")?t+': "Add Track" button: "FASTA Alignment" button':0==e.indexOf("add track")?t+': "Add Track" button':0==e.indexOf("remove one stabilizer")?"File > 3D Printing > Remove One Stablizer":0==e.indexOf("add one stabilizer")?"File > 3D Printing > Add One Stablizer":0==e.indexOf("select planes z-axis")?"View > Select between Two X-Y Planes":0==e.indexOf("adjust membrane z-axis")?"View > Adjust Membrane":0==e.indexOf("toggle membrane")?"View > Toggle Membrane":0==e.indexOf("calc buried surface")?s+': "Buried Surface Area" button':0==e.indexOf("display interaction 3d")?s+': "3D Display Interactions" button':0==e.indexOf("view interaction pairs")?s+': "Highlight Interactions in Table" button':0==e.indexOf("save1 interaction pairs")?s+': "Set 1" button':0==e.indexOf("save2 interaction pairs")?s+': "Set 2" button':0==e.indexOf("line graph interaction pairs")?s+': "2D Interaction Network" button':0==e.indexOf("scatterplot interaction pairs")?s+': "2D Interaction Map" button':0==e.indexOf("graph label")?i+': "Label Size" menu':0==e.indexOf("graph force")?i+': "Force on Nodes" menu':0==e.indexOf("hide edges")?i+': "Internal Edges" menu':0==e.indexOf("reset interaction pairs")?s+" > Reset":0==e.indexOf("side by side")?"View > Side by Side":0==e.indexOf("your note")?"Windows > Your Notes / Window Title":0==e.indexOf("pickatom")?"Hold Alt key and click on 3D structure":0==e.indexOf("color")?"Color menu":0==e.indexOf("custom tube")?t+': "Custom Color/Tube" button: "Custom Tube" button':0==e.indexOf("style")?"Style menu":-1!==e.indexOf("select displayed set")?"Select > Displayed Set":-1!==e.indexOf("select prop")?"Select > by Property":0==e.indexOf("select")&&-1!==e.indexOf("name")?t+": drag on residues to select":-1!==e.indexOf("select $")||-1!==e.indexOf("select .")||-1!==e.indexOf("select :")||-1!==e.indexOf("select @")?"Select > Advanced; or other selection":-1!==e.indexOf("replay on")?"File > Replay Each Step > On":-1!==e.indexOf("replay off")?"File > Replay Each Step > Off":-1!==e.indexOf("set theme")?"Style > Theme Color":-1!==e.indexOf("set double color")?"Style > Two-color Helix":""}}class be{constructor(e){this.icn3d=e}selectByCommand(e,t,s){var i=this.icn3d,n=i.icn3dui;if(0===e.indexOf("saved atoms")){var r=12,a=e.substr(r);i.definedSetsCls.selectCombinedSets(a,t)}else{for(var l=e.replace(/ AND /g," and ").replace(/ OR /g," or ").replace(/ or and /g," and ").replace(/ and /g," or and ").replace(/ or not /g," not ").replace(/ not /g," or not "),o=("select"===l.trim().substr(0,6)?l.trim().substr(7):l.trim()).split(" or "),d={},c=0,h=o.length;c<h;++c){var m=o[c].trim().replace(/\s+/g," ");r=m.indexOf(" ");i.hAtoms={},"and"===m.substr(0,r).toLowerCase()?(i.applyCommandCls.applyCommand("select "+m.substr(r+1)),d=n.hashUtilsCls.intHash(d,i.hAtoms)):"not"===m.substr(0,r).toLowerCase()?(i.applyCommandCls.applyCommand("select "+m.substr(r+1)),d=n.hashUtilsCls.exclHash(d,i.hAtoms)):(i.applyCommandCls.applyCommand("select "+m),d=n.hashUtilsCls.unionHash(d,i.hAtoms))}i.hAtoms=n.hashUtilsCls.cloneHash(d);var p=Object.keys(i.hAtoms);if(""!==t){i.selectionCls.addCustomSelection(p,t,s,e,!1);var u=[t];i.definedSetsCls.changeCustomAtoms(u)}}}selectBySpec(e,t,s,i){var n=this.icn3d,r=n.icn3dui;e="select"===e.trim().substr(0,6)?e.trim().substr(7):e.trim(),n.hAtoms={};for(var a,l=e.replace(/\s+/g," ").replace(/ AND /g," and ").split(" and "),o={},d={},c=!0,h=0,m=l.length;h<m;++h){var p,u,C,v,g=l[h].indexOf("$"),f=l[h].indexOf("."),b=l[h].indexOf(":"),y=l[h].indexOf("@"),w=l[h];-1===y?v=["*"]:(v=w.substr(y+1).split(","),w=w.substr(0,y)),-1===b?C="*":(C=w.substr(b+1),w=w.substr(0,b)),-1===f?u="*":(u=w.substr(f+1),w=w.substr(0,f)),-1===g?p="*":(p=w.substr(g+1).toUpperCase(),w=w.substr(0,g)),1==v.length&&"*"!==v[0]&&(c=!1);var S,_,A,x,k=[],O=[];if(k="*"===p?Object.keys(n.structures):p.split(","),"*"===u)for(var H=Object.keys(n.chains),R=0,E=H.length;R<E;++R){S=(_=H[R]).substr(0,_.indexOf("_")),-1!==k.map((function(e){return e.toLowerCase()})).indexOf(S.toLowerCase())&&O.push(_)}else for(R=0,E=k.length;R<E;++R){S=k[R];var I=u.split(",");for(var D in I)O.push(S+"_"+I[D])}var T=C.split(",");for(R=0,E=T.length;R<E;++R){var M=!1,P=T[R].lastIndexOf("-"),F=void 0,L=void 0,N=!1,$=!1,U=!1;if(-1!==P)A=T[R].substr(0,P),x=T[R].substr(P+1),M=!0;else if(""===T[R]||isNaN(T[R])){if("*"===T[R])N=!0;else if("3"===T[R][0]&&(T[R].length-1)%3==0){L=T[R].toUpperCase().substr(1),U=!0}else if("proteins"!==T[R]&&"nucleotides"!==T[R]&&"chemicals"!==T[R]&&"ions"!==T[R]&&"water"!==T[R]){F=T[R].toUpperCase(),$=!0}}else x=A=T[R],M=!0;for(var q=0,j=O.length;q<j;++q)if(_=O[q],M)for(D=parseInt(A);D<=parseInt(x);++D){var B=_+"_"+D;for(var z in 0===h?o[B]=1:o.hasOwnProperty(B)||delete o[B],n.residues[B])for(var G=0,V=v.length;G<V;++G){"*"!==(de=v[G])&&de!==n.atoms[z].name||(0===h?d[z]=1:d.hasOwnProperty(z)||delete d[z])}}else if(_ in n.chains){var W=n.chains[_];for(var z in W){n.atoms[z].resn.substr(0,3).toUpperCase();if(N||"proteins"===T[R]&&z in n.proteins||"nucleotides"===T[R]&&z in n.nucleotides||"chemicals"===T[R]&&z in n.chemicals||"ions"===T[R]&&z in n.ions||"water"===T[R]&&z in n.water){if(0===h)o[_+"_"+n.atoms[z].resi]=1;else{var Y=_+"_"+n.atoms[z].resi;o.hasOwnProperty(Y)||delete o[Y]}for(G=0,V=v.length;G<V;++G){"*"!==(de=v[G])&&de!==n.atoms[z].name||(0===h?d[z]=1:d.hasOwnProperty(z)||delete d[z])}}}if($||U){G=$?1:3;for(var X=$?F:L,K="",Q=[],J=0,Z=n.chainsSeq[_].length;J<Z;++J){if($)K+=1==n.chainsSeq[_][J].name.length?n.chainsSeq[_][J].name:" ";else if(U){var ee=r.utilsCls.residueAbbr2Name(n.chainsSeq[_][J].name);K+=3==ee.length?ee:"   "}Q.push(n.chainsSeq[_][J].resi)}K=K.toUpperCase();for(var te=X.replace(/x/gi,"."),se=[],ie=new RegExp(te,"i"),ne=K,re=(ae=ne.search(ie))/G;-1!==ae;)se.push(re),re+=(ae=(ne=ne.substr(ae+G)).search(ie))/G+1;for(J=0,Z=se.length;J<Z;++J)for(var ae=se[J],le=0,oe=X.length/G;le<oe;le+=G){B=_+"_"+Q[le/G+ae];for(var z in 0===h?o[B]=1:o.hasOwnProperty(B)||delete o[B],n.residues[B])for(G=0,V=v.length;G<V;++G){var de;"*"!==(de=v[G])&&de!==n.atoms[z].name||(0===h?d[z]=1:d.hasOwnProperty(z)||delete d[z])}}}}}}if(n.hAtoms=r.hashUtilsCls.cloneHash(d),0==Object.keys(n.hAtoms).length&&console.log("No residues were selected. Please try another search."),(void 0===i||i)&&n.hlUpdateCls.updateHlAll(),a=c?Object.keys(o):Object.keys(d),""!=t){n.selectionCls.addCustomSelection(a,t,s,e,c);var ce=[t];n.definedSetsCls.changeCustomAtoms(ce)}}}class ye{constructor(e){this.icn3d=e}residueids2spec(e){var t=this.icn3d;t.icn3dui;var s="";if(void 0!==e){for(var i,n,r,a,l,o,d,c=e.sort((function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var s=e.lastIndexOf("_"),i=t.lastIndexOf("_");if(e.substr(0,s)<t.substr(0,i))return-1;if(e.substr(0,s)>t.substr(0,i))return 1;if(e.substr(0,s)==t.substr(0,i)){if(parseInt(e.substr(s+1))<parseInt(t.substr(i+1)))return-1;if(parseInt(e.substr(s+1))>parseInt(t.substr(i+1)))return 1;if(parseInt(e.substr(s+1))==parseInt(t.substr(i+1)))return 0}})),h="",m=0,p=1!=Object.keys(t.structures).length,u=0,C=c.length;u<C;++u){var v=c[u];r=v.lastIndexOf("_"),i=v.substr(0,r),n=parseInt(v.substr(r+1)),a=h.indexOf("_"),l=h.substr(0,a),o=h.substr(a+1),h!==i?(u>0&&(s+=m===d?p?"$"+l+"."+o+":"+d+" or ":"."+o+":"+d+" or ":p?"$"+l+"."+o+":"+d+"-"+m+" or ":"."+o+":"+d+"-"+m+" or "),d=n):h===i&&n!==m+1&&(s+=m===d?p?"$"+l+"."+o+":"+d+" or ":"."+o+":"+d+" or ":p?"$"+l+"."+o+":"+d+"-"+m+" or ":"."+o+":"+d+"-"+m+" or ",d=n),h=i,m=n}a=h.indexOf("_"),l=h.substr(0,a),o=h.substr(a+1),s+=m===d?p?"$"+l+"."+o+":"+d:"."+o+":"+d:p?"$"+l+"."+o+":"+d+"-"+m:"."+o+":"+d+"-"+m}return s}atoms2spec(e){var t=this.icn3d;t.icn3dui;var s="",i=0,n={},r={},a={};for(var l in e){var o=t.atoms[l];i>0&&(s+=" or "),s+="$"+o.structure+"."+o.chain+":"+o.resi+"@"+o.name,n[o.structure]=1,r[o.structure+"_"+o.chain]=1,a[o.structure+"_"+o.chain+"_"+o.resi]=1,++i}if(1==Object.keys(a).length){var d="\\$"+o.structure+"\\."+o.chain+":"+o.resi;s=s.replace(new RegExp(d,"g"),"")}else if(1==Object.keys(r).length){d="\\$"+o.structure+"\\."+o.chain;s=s.replace(new RegExp(d,"g"),"")}else if(1==Object.keys(n).length){d="\\$"+o.structure;s=s.replace(new RegExp(d,"g"),"")}return s}atoms2residues(e){var t=this.icn3d;t.icn3dui;for(var s={},i=0,n=e.length;i<n;++i)s[e[i]]=1;var r=t.firstAtomObjCls.getResiduesFromAtoms(s);return Object.keys(r)}selectProperty(e,t,s){var i=this.icn3d,n=i.icn3dui,r=n.hashUtilsCls.cloneHash(i.hAtoms);if("positive"==e){var a=":r,k,h";i.hAtoms={},i.selByCommCls.selectBySpec(a,a,a)}else if("negative"==e){a=":d,e";i.hAtoms={},i.selByCommCls.selectBySpec(a,a,a)}else if("hydrophobic"==e){a=":w,f,y,l,i,c,m";i.hAtoms={},i.selByCommCls.selectBySpec(a,a,a)}else if("polar"==e){a=":g,v,s,t,a,n,p,q";i.hAtoms={},i.selByCommCls.selectBySpec(a,a,a)}else if("b factor"==e){var l=n.hashUtilsCls.cloneHash(i.calphas);for(var o in l=n.hashUtilsCls.unionHash(l,i.nucleotidesO3),l=n.hashUtilsCls.unionHash(l,i.chemicals),l=n.hashUtilsCls.unionHash(l,i.ions),l=n.hashUtilsCls.unionHash(l,i.water),i.hAtoms={},l){var d=i.atoms[o];d.b>=t&&d.b<=s&&(i.hAtoms=n.hashUtilsCls.unionHash(i.hAtoms,i.residues[d.structure+"_"+d.chain+"_"+d.resi]))}}else if("percent out"==e)for(var c in i.bCalcArea=!0,i.opts.surface="solvent accessible surface",i.applyMapCls.applySurfaceOptions(),i.bCalcArea=!1,i.hAtoms={},i.resid2area){var h=c.lastIndexOf("_"),m=c.substr(h+1);if(n.parasCls.residueArea.hasOwnProperty(m)){var p=parseInt(i.resid2area[c]/n.parasCls.residueArea[m]*100);if(p>=t&&p<=s){var u=c.substr(0,h);i.hAtoms=n.hashUtilsCls.unionHash(i.hAtoms,i.residues[u])}}}i.hAtoms=n.hashUtilsCls.intHash(i.hAtoms,r),i.drawCls.draw(),i.hlUpdateCls.updateHlAll()}selectComplement(){var e=this.icn3d,t=e.icn3dui,s={};for(var i in e.atoms)e.hAtoms.hasOwnProperty(i)||(s[i]=1);e.hAtoms=t.hashUtilsCls.cloneHash(s),e.hlUpdateCls.updateHlAll()}switchHighlightLevel(){var e=this.icn3d,t=e.icn3dui;if(!e.icn3dui.bNode){var s=this;document.addEventListener("keydown",(function(e){var i=s.icn3d;38===e.keyCode?(e.preventDefault(),0!=Object.keys(i.pickedAtomList).length&&i.hAtoms.hasOwnProperty(i.firstAtomObjCls.getFirstAtomObj(i.pickedAtomList).serial)||(i.pickedAtomList=t.hashUtilsCls.cloneHash(i.hAtoms)),s.switchHighlightLevelUp(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd("highlight level up",!0)):40===e.keyCode&&(e.preventDefault(),0!=Object.keys(i.pickedAtomList).length&&i.hAtoms.hasOwnProperty(i.firstAtomObjCls.getFirstAtomObj(i.pickedAtomList).serial)||(i.pickedAtomList=t.hashUtilsCls.cloneHash(i.hAtoms)),s.switchHighlightLevelDown(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd("highlight level down",!0))}))}}switchHighlightLevelUp(){var e=this.icn3d,t=e.icn3dui;if(!e.icn3dui.bNode){if(e.bShift||e.bCtrl||e.hlObjectsCls.removeHlObjects(),void 0!==e.pickedAtomList&&0!==Object.keys(e.pickedAtomList).length||(e.pickedAtomList=t.hashUtilsCls.cloneHash(e.hAtoms)),0===Object.keys(e.pickedAtomList).length&&(e.pickedAtomList=e.dAtoms),1===e.highlightlevel){e.highlightlevel=2;var s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[s.structure+"_"+s.chain+"_"+s.resi]):e.hAtoms=t.hashUtilsCls.cloneHash(e.residues[s.structure+"_"+s.chain+"_"+s.resi])}else if(2===e.highlightlevel){e.highlightlevel=3;s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(s)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(s))}else if(3===e.highlightlevel){var i;if(void 0!==e.icn3dui.cfg.mmdbid||void 0!==e.icn3dui.cfg.gi){e.highlightlevel=4;s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);i=e.pickingCls.select3ddomainFromAtom(s),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,i):e.hAtoms=t.hashUtilsCls.cloneHash(i)}if(void 0===e.icn3dui.cfg.mmdbid&&void 0===e.icn3dui.cfg.gi||0==Object.keys(i).length){e.highlightlevel=5;s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s.structure+"_"+s.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[s.structure+"_"+s.chain])}}else if(4===e.highlightlevel){e.highlightlevel=5;s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s.structure+"_"+s.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[s.structure+"_"+s.chain])}else if(5===e.highlightlevel||6===e.highlightlevel){e.highlightlevel=6;s=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl||(e.hAtoms={});for(var n=e.structures[s.structure],r=0,a=n.length;r<a;++r)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[n[r]])}e.hlObjectsCls.addHlObjects(),e.hlUpdateCls.updateHlAll()}}switchHighlightLevelDown(){var e=this.icn3d,t=e.icn3dui;if(!e.icn3dui.bNode){if(e.hlObjectsCls.removeHlObjects(),void 0!==e.pickedAtomList&&0!==Object.keys(e.pickedAtomList).length||(e.pickedAtomList=t.hashUtilsCls.cloneHash(e.hAtoms)),2!==e.highlightlevel&&1!==e.highlightlevel||1!==Object.keys(e.pickedAtomList).length){if(3===e.highlightlevel){var s={};for(var i in e.pickedAtomList)residueid=e.atoms[i].structure+"_"+e.atoms[i].chain+"_"+e.atoms[i].resi,s[residueid]=1;if(1===Object.keys(s).length){e.highlightlevel=2;var n=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[n.structure+"_"+n.chain+"_"+n.resi]):e.hAtoms=t.hashUtilsCls.cloneHash(e.residues[n.structure+"_"+n.chain+"_"+n.resi])}}else if(4===e.highlightlevel){e.highlightlevel=3;n=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(n)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(n))}else if(5===e.highlightlevel){var r;if(void 0!==e.icn3dui.cfg.mmdbid||void 0!==e.icn3dui.cfg.gi){e.highlightlevel=4;n=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);r=e.pickingCls.select3ddomainFromAtom(n),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,r):e.hAtoms=t.hashUtilsCls.cloneHash(r)}if(void 0===e.icn3dui.cfg.mmdbid&&void 0===e.icn3dui.cfg.gi||0==Object.keys(r).length){e.highlightlevel=3;n=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickingCls.selectStrandHelixFromAtom(n)):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickingCls.selectStrandHelixFromAtom(n))}}else if(6===e.highlightlevel){e.highlightlevel=5;n=e.firstAtomObjCls.getFirstAtomObj(e.pickedAtomList);e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[n.structure+"_"+n.chain]):e.hAtoms=t.hashUtilsCls.cloneHash(e.chains[n.structure+"_"+n.chain])}}else e.highlightlevel=1,e.hAtoms=t.hashUtilsCls.cloneHash(e.pickedAtomList),e.bShift||e.bCtrl?e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.pickedAtomList):e.hAtoms=t.hashUtilsCls.cloneHash(e.pickedAtomList);e.hlObjectsCls.addHlObjects(),e.hlUpdateCls.updateHlAll()}}}class we{constructor(e){this.icn3d=e}setSeqAlign(e,t){var s=this.icn3d;s.icn3dui;var i=t[0][0].pdbId,n=t[0][1].pdbId;s.conservedName1=i+"_cons",s.nonConservedName1=i+"_ncons",s.notAlignedName1=i+"_nalign",s.conservedName2=n+"_cons",s.nonConservedName2=n+"_ncons",s.notAlignedName2=n+"_nalign",s.consHash1={},s.nconsHash1={},s.nalignHash1={},s.consHash2={},s.nconsHash2={},s.nalignHash2={};for(var r=0,a=e.length;r<a;++r){for(var l=e[r][0],o=l.moleculeId,d=s.pdbid_molid2chain[i+"_"+o],c=i+"_"+d,h={},m=l.sequence.length,p=-1,u=!1,C=0,v=l.sequence.length;C<v;++C){var g=s.chainid2offset[c]?s.chainid2offset[c]:0,f=s.bUsePdbNum?l.sequence[C][0]+g:l.sequence[C][0];O=" "===(O="~"===l.sequence[C][2]?"-":l.sequence[C][2])||""===O?"X":O,1==(_=l.sequence[C][3]?1:0)&&(C<m&&!u&&(m=C,u=!0),C>p&&(p=C)),h[C]={resi:f,resn:O,aligned:_}}var b=(l=e[r][1]).moleculeId,y=s.pdbid_molid2chain[n+"_"+b],w=n+"_"+y;void 0===s.alnChainsAnTtl[c]&&(s.alnChainsAnTtl[c]=[]),void 0===s.alnChainsAnTtl[c][0]&&(s.alnChainsAnTtl[c][0]=[]),void 0===s.alnChainsAnTtl[c][1]&&(s.alnChainsAnTtl[c][1]=[]),void 0===s.alnChainsAnTtl[c][2]&&(s.alnChainsAnTtl[c][2]=[]),void 0===s.alnChainsAnTtl[c][3]&&(s.alnChainsAnTtl[c][3]=[]),void 0===s.alnChainsAnTtl[c][4]&&(s.alnChainsAnTtl[c][4]=[]),void 0===s.alnChainsAnTtl[c][5]&&(s.alnChainsAnTtl[c][5]=[]),void 0===s.alnChainsAnTtl[c][6]&&(s.alnChainsAnTtl[c][6]=[]),s.alnChainsAnTtl[c][0].push(w),s.alnChainsAnTtl[c][1].push(c),s.alnChainsAnTtl[c][2].push(""),s.alnChainsAnTtl[c][3].push(""),s.alnChainsAnTtl[c][4].push(w),s.alnChainsAnTtl[c][5].push(c),s.alnChainsAnTtl[c][6].push("");var S=1;for(C=m;C<=p;++C){g=s.chainid2offset[w]?s.chainid2offset[w]:0,f=s.bUsePdbNum?l.sequence[C][0]+g:l.sequence[C][0];var _,A,x,k,O="~"===l.sequence[C][2]?"-":l.sequence[C][2],H=l.sequence[C][3]?1:0;2===(_=h[C].aligned+H)?(h[C].resn===O?(A="#FF0000",k="icn3d-cons",s.consHash1[c+"_"+h[C].resi]=1,s.consHash2[w+"_"+f]=1):(A="#0000FF",k="icn3d-ncons",s.nconsHash1[c+"_"+h[C].resi]=1,s.nconsHash2[w+"_"+f]=1),x="#"+s.showAnnoCls.getColorhexFromBlosum62(h[C].resn,O)):(A=s.icn3dui.htmlCls.GREY8,k="icn3d-nalign",s.nalignHash1[c+"_"+h[C].resi]=1,s.nalignHash2[w+"_"+f]=1),void 0===s.alnChainsSeq[c]&&(s.alnChainsSeq[c]=[]);var R={};R.mmdbid=i,R.chain=d,R.resi=h[C].resi,R.resn=""===R.resi||"icn3d-nalign"===k?h[C].resn.toLowerCase():h[C].resn,R.aligned=_,R.color=""===R.resi?s.icn3dui.htmlCls.GREYC:A,R.color2=""===R.resi?s.icn3dui.htmlCls.GREYC:x,R.class=k,s.alnChainsSeq[c].push(R),""!==h[C].resi&&(void 0===s.alnChains[c]&&(s.alnChains[c]={}),$.extend(s.alnChains[c],s.residues[c+"_"+h[C].resi])),void 0===s.alnChainsSeq[w]&&(s.alnChainsSeq[w]=[]),(R={}).mmdbid=n,R.chain=y,R.resi=f,R.resn=""===R.resi||"icn3d-nalign"===k?O.toLowerCase():O,R.aligned=_,R.color=""===R.resi?s.icn3dui.htmlCls.GREYC:A,R.color2=""===R.resi?s.icn3dui.htmlCls.GREYC:x,R.class=k,s.alnChainsSeq[w].push(R),""!==R.resi&&(void 0===s.alnChains[w]&&(s.alnChains[w]={}),$.extend(s.alnChains[w],s.residues[w+"_"+f])),void 0===s.alnChainsAnno[c]&&(s.alnChainsAnno[c]=[]),void 0===s.alnChainsAnno[c][0]&&(s.alnChainsAnno[c][0]=[]),void 0===s.alnChainsAnno[c][1]&&(s.alnChainsAnno[c][1]=[]),void 0===s.alnChainsAnno[c][2]&&(s.alnChainsAnno[c][2]=[]),void 0===s.alnChainsAnno[c][3]&&(s.alnChainsAnno[c][3]=[]),C===m&&(void 0===s.alnChainsAnno[c][4]&&(s.alnChainsAnno[c][4]=[]),void 0===s.alnChainsAnno[c][5]&&(s.alnChainsAnno[c][5]=[]),void 0===s.alnChainsAnno[c][6]&&(s.alnChainsAnno[c][6]=[]),s.alnChainsAnno[c][4].push(s.pdbid_chain2title[w]),s.alnChainsAnno[c][5].push(s.pdbid_chain2title[c]),s.alnChainsAnno[c][6].push(""));var E=c+"_"+h[C].resi,I=w+"_"+f,D=s.secondaries[E],T=s.secondaries[I];void 0!==T?s.alnChainsAnno[c][0].push(T):s.alnChainsAnno[c][0].push("-"),void 0!==D?s.alnChainsAnno[c][1].push(D):s.alnChainsAnno[c][1].push("-");var M=".";S%5==0&&(M="*"),S%10==0&&(M="|"),s.alnChainsAnno[c][2].push(M);var P="";S%10==0&&(P=S.toString()),s.alnChainsAnno[c][3].push(P),++S}}e={}}setSeqAlignChain(e,t){var s=this.icn3d;s.icn3dui;var i=s.chainidArray[0].indexOf("_"),n=e.indexOf("_"),r=s.mmdbid_t,a=e.substr(0,n).toUpperCase(),l=s.chainidArray[0].substr(i+1),o=e.substr(n+1);if(r==a&&l==o){var d=s.chainsSeq[s.mmdbid_q+"_"+s.chain_q].length;s.qt_start_end[t]={q_start:1,q_end:d,t_start:1,t_end:d}}var c,h,m,p,u,C=r+"_"+l,v=a+"_"+o;void 0!==a&&a===s.mmdbid_t&&(v=a+s.icn3dui.htmlCls.postfix+"_"+o),s.conservedName1=C+"_cons",s.nonConservedName1=C+"_ncons",s.notAlignedName1=C+"_nalign",s.conservedName2=v+"_cons",s.nonConservedName2=v+"_ncons",s.notAlignedName2=v+"_nalign",s.consHash1={},s.nconsHash1={},s.nalignHash1={},s.consHash2={},s.nconsHash2={},s.nalignHash2={},s.alnChains={},s.alnChainsSeq[C]=[],s.alnChains[C]={},s.alnChainsAnno[C]=[],s.alnChainsAnTtl[C]=[],void 0===s.alnChainsAnTtl[C]&&(s.alnChainsAnTtl[C]=[]);for(var g=0;g<7;++g)void 0===s.alnChainsAnTtl[C][g]&&(s.alnChainsAnTtl[C][g]=[]);if(s.alnChainsAnTtl[C][0].push(v),s.alnChainsAnTtl[C][1].push(C),s.alnChainsAnTtl[C][2].push(""),s.alnChainsAnTtl[C][3].push(""),s.alnChainsAnTtl[C][4].push(v),s.alnChainsAnTtl[C][5].push(C),s.alnChainsAnTtl[C][6].push(""),void 0!==s.qt_start_end[t])for(var f=1,b=(g=0,s.qt_start_end[t].length);g<b;++g){var y=s.qt_start_end[t][g].t_start-1,w=s.qt_start_end[t][g].q_start-1,S=s.qt_start_end[t][g].t_end-1,_=s.qt_start_end[t][g].q_end-1;if(g>0){for(var A=f,x=p+1,k=y;x<k&&void 0!==s.chainsSeq[C];++x){var O=s.chainsSeq[C][x].resi,H=s.chainsSeq[C][x].name.toLowerCase();c=s.icn3dui.htmlCls.GREY8,m="icn3d-nalign",s.nalignHash1[C+"_"+O]=1,this.setSeqPerResi(C,C,v,O,H,!1,c,void 0,m,!0,!1,A),++A}var R=f;for(x=u+1,k=w;x<k&&void 0!==s.chainsSeq[v];++x){O=s.chainsSeq[v][x].resi,H=s.chainsSeq[v][x].name.toLowerCase();c=s.icn3dui.htmlCls.GREY8,m="icn3d-nalign",s.nalignHash2[v+"_"+O]=1,this.setSeqPerResi(v,C,v,O,H,!1,c,void 0,m,!1,!1,R),++R}if(A<R){f=R;for(x=0;x<R-A;++x){O="",H="-";c=s.icn3dui.htmlCls.GREY8,m="icn3d-nalign",this.setSeqPerResi(C,C,v,O,H,!1,c,void 0,m,!0,!1,A+x)}}else{f=A;for(x=0;x<A-R;++x){O="",H="-";c=s.icn3dui.htmlCls.GREY8,m="icn3d-nalign",this.setSeqPerResi(v,C,v,O,H,!1,c,void 0,m,!1,!1,R+x)}}}for(x=0;x<=S-y&&(void 0!==s.chainsSeq[C]&&void 0!==s.chainsSeq[v]);++x)if(void 0!==s.chainsSeq[C][x+y]&&void 0!==s.chainsSeq[v][x+w]){var E=s.chainsSeq[C][x+y].resi,I=s.chainsSeq[v][x+w].resi,D=s.chainsSeq[C][x+y].name.toUpperCase(),T=s.chainsSeq[v][x+w].name.toUpperCase();D===T?(c="#FF0000",m="icn3d-cons",s.consHash1[C+"_"+E]=1,s.consHash2[v+"_"+I]=1):(c="#0000FF",m="icn3d-ncons",s.nconsHash1[C+"_"+E]=1,s.nconsHash2[v+"_"+I]=1),h="#"+s.showAnnoCls.getColorhexFromBlosum62(D,T);var M=0===g&&0===x;this.setSeqPerResi(C,C,v,E,D,!0,c,h,m,!0,M,f),this.setSeqPerResi(v,C,v,I,T,!0,c,h,m,!1,M,f),++f}p=S,u=_}}setSeqAlignForRealign(e,t,s){var i=this.icn3d,n=i.icn3dui,r=e.substr(0,e.indexOf("_")),a=t.substr(0,t.indexOf("_"));r==a&&(a+=i.icn3dui.htmlCls.postfix),i.conservedName1=r+"_cons",i.conservedName2=a+"_cons",i.consHash1={},i.consHash2={},i.alnChainsAnTtl={},i.alnChainsAnno={},void 0===i.alnChainsSeq&&(i.alnChainsSeq={}),i.alnChains={},i.alnChainsSeq[e]=[],i.alnChains[e]={},i.alnChainsAnno[e]=[],i.alnChainsAnTtl[e]=[];for(var l={},o=0,d=i.realignResid[r].length;o<d;++o){var c=i.realignResid[r][o],h=c.resid.lastIndexOf("_"),m=c.resid.substr(0,h),p=c.resid.substr(h+1);c.resi=p,c.aligned=!0;var u,C=i.realignResid[a][o],v=C.resid.lastIndexOf("_"),g=C.resid.substr(0,v),f=C.resid.substr(v+1);C.resi=f,C.aligned=!0,l[c.resid]=1,l[C.resid]=1,u=c.resn==C.resn?"#FF0000":"#0000FF";var b="#"+i.showAnnoCls.getColorhexFromBlosum62(c.resn,C.resn);for(var y in c.color=u,C.color=u,c.color2=b,C.color2=b,i.residues[c.resid])i.atoms[y].color=n.parasCls.thr(u);for(var y in i.residues[C.resid])i.atoms[y].color=n.parasCls.thr(u);void 0===i.alnChainsAnTtl[m]&&(i.alnChainsAnTtl[m]=[]);for(y=0;y<3;++y)void 0===i.alnChainsAnTtl[m][y]&&(i.alnChainsAnTtl[m][y]=[]);for(y=0;y<3;++y)i.alnChainsAnTtl[m][y].push("");void 0===i.alnChainsSeq[m]&&(i.alnChainsSeq[m]=[]),void 0===i.alnChainsSeq[g]&&(i.alnChainsSeq[g]=[]),i.alnChainsSeq[m].push(c),i.alnChainsSeq[g].push(C),void 0===i.alnChains[m]&&(i.alnChains[m]={}),void 0===i.alnChains[g]&&(i.alnChains[g]={}),$.extend(i.alnChains[m],i.residues[m+"_"+c.resi]),$.extend(i.alnChains[g],i.residues[g+"_"+C.resi]),i.consHash1[m+"_"+c.resi]=1,i.consHash2[g+"_"+C.resi]=1,void 0===i.alnChainsAnno[m]&&(i.alnChainsAnno[m]=[]);for(y=0;y<3;++y)void 0===i.alnChainsAnno[m][y]&&(i.alnChainsAnno[m][y]=[]);var w=".";o%5==0&&(w="*"),o%10==0&&(w="|"),i.alnChainsAnno[m][0].push(w);var S="";o%10==0&&(S=o.toString()),i.alnChainsAnno[m][1].push(S)}var _="select "+i.resid2specCls.residueids2spec(Object.keys(l));i.selectionCls.addCustomSelection(Object.keys(l),"protein_aligned","protein aligned",_,!0)}setSeqPerResi(e,t,s,i,n,r,a,l,o,d,c,h){var m=this.icn3d;m.icn3dui,void 0===m.alnChainsSeq[e]&&(m.alnChainsSeq[e]=[]);var p={},u=e.indexOf("_");if(p.mmdbid=e.substr(0,u),p.chain=e.substr(u+1),p.resi=i,p.resn=""===p.resi||"icn3d-nalign"===o?n.toLowerCase():n,p.aligned=r,p.color=""===p.resi?m.icn3dui.htmlCls.GREYC:a,p.color2=""===p.resi?m.icn3dui.htmlCls.GREYC:l,p.class=o,m.alnChainsSeq[e].push(p),""!==p.resi&&(void 0===m.alnChains[e]&&(m.alnChains[e]={}),$.extend(m.alnChains[e],m.residues[e+"_"+p.resi])),d){if(void 0===m.alnChainsAnno[e]&&(m.alnChainsAnno[e]=[]),void 0===m.alnChainsAnno[e][0]&&(m.alnChainsAnno[e][0]=[]),void 0===m.alnChainsAnno[e][1]&&(m.alnChainsAnno[e][1]=[]),void 0===m.alnChainsAnno[e][2]&&(m.alnChainsAnno[e][2]=[]),void 0===m.alnChainsAnno[e][3]&&(m.alnChainsAnno[e][3]=[]),c){void 0===m.alnChainsAnno[e][4]&&(m.alnChainsAnno[e][4]=[]),void 0===m.alnChainsAnno[e][5]&&(m.alnChainsAnno[e][5]=[]),void 0===m.alnChainsAnno[e][6]&&(m.alnChainsAnno[e][6]=[]);var C=m.pdbid_chain2title&&m.pdbid_chain2title.hasOwnProperty(s)?m.pdbid_chain2title[s]:"",v=m.pdbid_chain2title&&m.pdbid_chain2title.hasOwnProperty(e)?m.pdbid_chain2title[e]:"";m.alnChainsAnno[e][4].push(C),m.alnChainsAnno[e][5].push(v),m.alnChainsAnno[e][6].push("")}var g=".";h%5==0&&(g="*"),h%10==0&&(g="|"),m.alnChainsAnno[e][2].push(g);var f="";h%10==0&&(f=h.toString()),m.alnChainsAnno[e][3].push(f);var b=e+"_"+i;void 0!==(y=m.secondaries[b])?m.alnChainsAnno[e][1].push(y):m.alnChainsAnno[e][1].push("-")}else{b=e+"_"+i;var y=m.secondaries[b];m.alnChainsAnno.hasOwnProperty(t)&&m.alnChainsAnno[t].length>0?void 0!==y?m.alnChainsAnno[t][0].push(y):m.alnChainsAnno[t][0].push("-"):console.log("Error: ic.alnChainsAnno[chainid1] is undefined")}}}class Se{constructor(e){this.icn3d=e}alignCoords(e,t,s,i,n,r,a,l){var o=this.icn3d,d=o.icn3dui,c=e.length<t.length?e.length:t.length,h={};if(c<4&&alert("Please select at least four residues in each structure..."),c>=4&&(o.rmsd_suprTmp=d.rmsdSuprCls.getRmsdSuprCls(e,t,c),void 0!==o.rmsd_suprTmp.rot)){var m=o.rmsd_suprTmp.rot;null===m[0]&&alert("Please select more residues in each structure...");var p=o.rmsd_suprTmp.trans1,u=o.rmsd_suprTmp.trans2,C=o.rmsd_suprTmp.rmsd;C&&(o.icn3dui.htmlCls.clickMenuCls.setLogCmd("realignment RMSD: "+C.toPrecision(4),!1),$("#"+o.pre+"realignrmsd").val(C.toPrecision(4)),o.icn3dui.cfg.bSidebyside||o.icn3dui.htmlCls.dialogCls.openDlg("dl_rmsd","Realignment RMSD"));for(var v=0,g=o.structures[s].length;v<g;++v){var f=o.structures[s][v];for(var b in o.chains[f]){var y=o.atoms[b];y.coord=o.surfaceCls.transformMemPro(y.coord,m,p,u)}}o.bRealign=!0,i||o.setSeqAlignCls.setSeqAlignForRealign(n,r,a);var w=o.icn3dui.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(o.alnChains),void 0,void 0,!1),S=1===a?"":$("#"+o.pre+"dl_sequence2").html();$("#"+o.pre+"dl_sequence2").html(S+w.sequencesHtml),$("#"+o.pre+"dl_sequence2").width(o.icn3dui.htmlCls.RESIDUE_WIDTH*w.maxSeqCnt+200),o.icn3dui.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),l||(o.opts.color="identity",o.setColorCls.setColorByOptions(o.opts,o.hAtoms)),h=o.hAtoms}return h}getMissingResidues(e,t,s){var i=this.icn3d,n=i.icn3dui,r=-9999;i.chainsSeq[s]=[];for(var a=0,l=e.length;a<l;++a){var o,d;"mmdbid"===t?(o=e[a][1],d=0):"mmcifid"===t?(o=e[a][1],o=n.utilsCls.residueName2Abbr(o),d=0):"align"===t&&(o=e[a][1],d=0),""===o&&(o="x");var c={};if(i.bUsePdbNum){var h=i.chainid2offset[s]?i.chainid2offset[s]:0;c.resi="0"==e[a][d]?a+1+h:e[a][d]}else c.resi=a+1;var m=parseInt(e[a][d]),p=a==l-1?9999:parseInt(e[a+1][d]);c.name=0!==m||0===m&&(-1===r||1==p)?o.toUpperCase():o.toLowerCase(),i.chainsSeq[s].push(c),r=m}}set2DDiagramsForAlign(e,t){var s=this.icn3d;s.icn3dui,s.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),e=e.substr(0,4),t=t.substr(0,4);var i=s.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+e+"&intrac=1",n=s.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+t+"&intrac=1";void 0!==s.icn3dui.cfg.inpara&&(i+=s.icn3dui.cfg.inpara,n+=s.icn3dui.cfg.inpara),$.ajax({url:i,dataType:"jsonp",cache:!0}).then((function(t){return s.interactionData1=t,s.html2ddgm="",s.diagram2dCls.draw2Ddgm(t,e,0),s.icn3dui.cfg.show2d&&s.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),$.ajax({url:n,dataType:"jsonp",cache:!0})})).done((function(e){s.interactionData2=e,s.diagram2dCls.draw2Ddgm(e,t,1),s.html2ddgm+="<br>"+s.diagram2dCls.set2DdgmNote(!0),$("#"+s.pre+"dl_2ddgm").html(s.html2ddgm),s.b2DShown=!0,void 0!==s.deferredViewinteraction&&s.deferredViewinteraction.resolve()}))}set2DDiagramsForChainalign(e){var t=this.icn3d;t.icn3dui;var s=this;t.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions");for(var i=[],n=0,r=e.length;n<r;++n){var a=e[n].indexOf("_"),l=e[n].substr(0,a).toUpperCase(),o=t.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+l+"&intrac=1";void 0!==t.icn3dui.cfg.inpara&&(o+=t.icn3dui.cfg.inpara);var d=$.ajax({url:o,dataType:"jsonp",cache:!0});i.push(d)}$.when.apply(void 0,i).then((function(){s.parse2DDiagramsData(arguments,e)})).fail((function(){s.parse2DDiagramsData(arguments,e)}))}parse2DDiagramsData(e,t){var s=this.icn3d;s.icn3dui;var i=1==t.length?[e]:e;s.html2ddgm="";for(var n=0,r=t.length;n<r;++n){var a=i[n][0],l=t[n].substr(0,t[n].indexOf("_"));s.diagram2dCls.draw2Ddgm(a,l,0)}s.html2ddgm+="<br>"+s.diagram2dCls.set2DdgmNote(!0),s.b2DShown=!0,$("#"+s.pre+"dl_2ddgm").html(s.html2ddgm),s.icn3dui.cfg.show2d&&s.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),void 0!==s.deferredViewinteraction&&s.deferredViewinteraction.resolve()}download2Ddgm(e,t){this.set2DDiagrams(e)}set2DDiagrams(e){var t=this.icn3d;t.icn3dui,t.icn3dui.htmlCls.dialogCls.openDlg("dl_2ddgm","Interactions"),void 0!==t.b2DShown&&t.b2DShown||(t.html2ddgm="",t.diagram2dCls.draw2Ddgm(t.interactionData,e),t.html2ddgm+="<br>"+t.diagram2dCls.set2DdgmNote(),$("#"+t.pre+"dl_2ddgm").html(t.html2ddgm)),t.b2DShown=!0}showLoading(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()}hideLoading(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()}setYourNote(e){var t=this.icn3d;t.icn3dui,t.yournote=e,$("#"+t.pre+"yournote").val(t.yournote),t.icn3dui.cfg.shownote&&(document.title=t.yournote)}transformToOpmOri(e){var t=this.icn3d;if(t.icn3dui,void 0!==t.rmsd_supr&&void 0!==t.rmsd_supr.rot){var s=t.rmsd_supr.rot,i=t.rmsd_supr.trans1,n=t.rmsd_supr.trans2;t.rmsd_supr.rmsd;var r=0;for(var a in t.atoms){var l=t.atoms[a];l.coord=t.surfaceCls.transformMemPro(l.coord,s,i,n);var o=l.coord.x*l.coord.x+l.coord.y*l.coord.y;Math.abs(l.coord.z)<=25&&o>r&&(r=o)}this.addMemAtoms(t.halfBilayerSize,e,Math.sqrt(r)),t.bStopRotate=!0,t.bOpm=!0,$("#"+t.pre+"togglememli").show(),$("#"+t.pre+"adjustmemli").show(),$("#"+t.pre+"selectplaneli").show(),$("#"+t.pre+"anno_transmemli").show()}else t.bOpm=!1}transformToOpmOriForAlign(e,t,s){var i=this.icn3d,n=i.icn3dui;if(void 0!==t){var r=i.loadPDBCls.getChainCalpha(i.chains,i.atoms,s,e),a=1==Object.keys(r.chainresiCalphaHash).length||1==Object.keys(t.chainresiCalphaHash).length,l=[],o=[];for(var d in r.chainresiCalphaHash)if(t.chainresiCalphaHash.hasOwnProperty(d)){var c=r.chainresiCalphaHash[d],h=t.chainresiCalphaHash[d];if((c.length==h.length||a)&&(l=l.concat(c),o=o.concat(h)),l.length>500)break}var m=l.length<o.length?l.length:o.length;if(m>=4)if(i.rmsd_supr=n.rmsdSuprCls.getRmsdSuprCls(l,o,m),void 0!==i.rmsd_supr.rot&&i.rmsd_supr.rmsd<.1){var p=i.rmsd_supr.rot,u=i.rmsd_supr.trans1,C=i.rmsd_supr.trans2,v=i.rmsd_supr.rmsd;i.icn3dui.htmlCls.clickMenuCls.setLogCmd("RMSD of alignment to OPM: "+v.toPrecision(4),!1),$("#"+i.pre+"realignrmsd").val(v.toPrecision(4)),i.icn3dui.cfg.bSidebyside||i.icn3dui.htmlCls.dialogCls.openDlg("dl_rmsd","RMSD of alignment to OPM");var g=0;for(var f in i.atoms){var b=i.atoms[f];b.coord=i.surfaceCls.transformMemPro(b.coord,p,u,C);var y=b.coord.x*b.coord.x+b.coord.y*b.coord.y;Math.abs(b.coord.z)<=25&&y>g&&(g=y)}i.center=t.center,i.oriCenter=i.center.clone(),this.addMemAtoms(i.halfBilayerSize,e,Math.sqrt(g)),i.bStopRotate=!0,i.bOpm=!0,$("#"+i.pre+"togglememli").show(),$("#"+i.pre+"adjustmemli").show(),$("#"+i.pre+"selectplaneli").show(),$("#"+i.pre+"anno_transmemli").show()}else i.bOpm=!1;else i.bOpm=!1}}setMaxD(){var e=this.icn3d;e.icn3dui;var t=new THREE.Vector3(9999,9999,9999),s=new THREE.Vector3(-9999,-9999,-9999),i=new THREE.Vector3,n=0;for(var r in e.atoms){var a=e.atoms[r],l=a.coord;i.add(l),t.min(l),s.max(l),++n,a.het&&(0==a.bonds.length?e.ions[a.serial]=1:e.chemicals[a.serial]=1)}e.pmin=t,e.pmax=s,e.cnt=n,e.maxD=e.pmax.distanceTo(e.pmin),e.center=i.multiplyScalar(1/e.cnt),e.maxD<5&&(e.maxD=5),e.oriMaxD=e.maxD,e.oriCenter=e.center.clone()}renderStructure(){var e=this.icn3d,t=e.icn3dui;if(e.bInitial){if(e.bOpm&&(void 0!==e.icn3dui.cfg.align||void 0!==e.icn3dui.cfg.chainalign)){var s=e.selectedPdbid+"_MEM_1";for(var i in e.residues[s]){var n=e.atoms[i];n.style="stick",n.color=t.parasCls.atomColors[n.name],e.atomPrevColors[i]=n.color,e.dAtoms[i]=1}}if(void 0!==e.icn3dui.cfg.command&&""!==e.icn3dui.cfg.command?(e.bRender=!1,e.drawCls.draw()):(e.selectionCls.oneStructurePerWindow(),e.drawCls.draw()),e.bOpm){var r=new THREE.Vector3(1,0,0),a=-.5*Math.PI;e.transformCls.setRotation(r,a)}Object.keys(e.structures).length>1?$("#"+e.pre+"alternate").show():$("#"+e.pre+"alternate").hide()}else e.selectionCls.saveSelectionIfSelected(),e.drawCls.draw();if(e.bInitial&&void 0!==e.icn3dui.cfg.command&&""!==e.icn3dui.cfg.command){if(1==Object.keys(e.structures).length){var l=Object.keys(e.structures)[0];e.icn3dui.cfg.command=e.icn3dui.cfg.command.replace(new RegExp("!","g"),l+"_")}e.loadScriptCls.loadScript(e.icn3dui.cfg.command)}else void 0!==e.icn3dui.deferred&&e.icn3dui.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve();Object.keys(e.structures).length>=2?($("#"+e.pre+"mn2_alternateWrap").show(),$("#"+e.pre+"mn2_realignWrap").show()):($("#"+e.pre+"mn2_alternateWrap").hide(),$("#"+e.pre+"mn2_realignWrap").hide()),setTimeout((function(){if(e.bInitial){if(e.icn3dui.cfg.showsets&&e.definedSetsCls.showSets(),void 0!==e.icn3dui.cfg.align||void 0!==e.icn3dui.cfg.chainalign){var t=e.pre+"selection";if($("#"+t).show(),$("#"+t+"_expand").hide(),$("#"+t+"_shrink").show(),void 0!==e.icn3dui.cfg.align){var s=e.icn3dui.htmlCls.alignSeqCls.getAlignSequencesAnnotations(Object.keys(e.alnChains),void 0,void 0,!1);$("#"+e.pre+"dl_sequence2").html(s.sequencesHtml),$("#"+e.pre+"dl_sequence2").width(e.icn3dui.htmlCls.RESIDUE_WIDTH*s.maxSeqCnt+200)}}if(e.icn3dui.cfg.showanno){e.icn3dui.htmlCls.clickMenuCls.setLogCmd("view annotations",!0),e.showAnnoCls.showAnnotations()}e.icn3dui.cfg.closepopup&&e.resizeCanvasCls.closeDialogs()}else e.hlUpdateCls.updateHlAll();$("#"+e.pre+"atomsCustom").length>0&&$("#"+e.pre+"atomsCustom")[0].blur(),e.bInitial=!1}),0)}}class _e{constructor(e){this.icn3d=e}downloadMmcif(e){var t=this.icn3d;t.icn3dui;var s,i=this;s="https://files.rcsb.org/view/"+e+".cif",t.bCid=void 0,t.ParserUtilsCls.setYourNote(e.toUpperCase()+"(MMCIF) in iCn3D"),$.ajax({url:s,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){},success:function(n){s=t.icn3dui.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi",$.ajax({url:s,type:"POST",data:{mmciffile:n},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){},success:function(t){i.loadMmcifData(t,e)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}downloadMmcifSymmetry(e,t){var s=this.icn3d;s.icn3dui;var i=this;return s.deferredSymmetry=$.Deferred((function(){i.downloadMmcifSymmetryBase(e,t)})),s.deferredSymmetry.promise()}downloadMmcifSymmetryBase(e,t){var s,i=this.icn3d,n=i.icn3dui,r=this;s=n.utilsCls.isMac()?"https://files.rcsb.org/view/"+e+".cif":"https://files.rcsb.org/header/"+e+".cif",i.bCid=void 0,$.ajax({url:s,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(a){if(i.icn3dui.cfg.notebook){var l=a.split("\n"),o=!1,d=!1,c=!1,h=!1,m=0,p="",u="",C=!1,v=!1,g="",f="";for(var b in l){var y=l[b];if("EMDB  EMD-"==y.substr(0,10))i.emd=y.substr(6).trim();else if("_entity_src_nat.common_name"==y.substr(0,27))i.organism=y.substr(27).trim(),i.organism&&(o=!0),d=!0;else if(d&&!o&&"_entity_src_nat.details"==f.substr(0,23)){var w=y.split(/\s+/);i.organism=w.length>5?w[5]:"",o=!0}else if("_pdbx_struct_oper_list.vector"==f.substr(0,29)&&y.split(/\s+/).length>2){h=!0,++m;var S=y.indexOf(" "),_=y.indexOf("' ");u+=y.substr(0,S)+y.substr(_+1),p+="["}else if(h&&"#"==y.trim())"["!=p&&(p=p.substr(0,p.length-1)),p+="]",c=!0,h=!1;else if(h&&!c)if(++m%2==0){if("X0"!=(w=(u+=y).split(/\s+/))[0]&&"P"!=w[0]&&w.length>14){var A=w[3],x=w[4],k=w[5],O=w[6],H=w[7],R=w[8],E=w[9],I=w[10];p+="["+A+","+H+","+w[11]+", 0, "+x+","+R+","+w[12]+", 0, "+k+","+E+","+w[13]+", 0, "+O+","+I+","+w[14]+", 1],"}u=""}else{S=y.indexOf(" "),_=y.indexOf("' ");u+=y.substr(0,S)+y.substr(_+1)}else if(v&&"#"==y.trim())"["!=g&&(g=g.substr(0,g.length-1)),g+="]",C=!0,v=!1;else if("_pdbx_poly_seq_scheic.hetero"==f.trim()||v&&!C){"_pdbx_poly_seq_scheic.hetero"==f.trim()&&(v=!0,g+="[");var D=(w=y.split(/\s+/))[3],T=w[9],M=w[5];"?"==w[6]&&(g+='{"resn": "'+D+'", "chain": "'+T+'", "resi": '+M+"},")}if(o&&c&&C)break;f=y}i.bAssemblyUseAsu&&r.loadMmcifSymmetry(JSON.parse(p));var P=JSON.parse(g);if("mmtfid"===t&&void 0!==P){for(var F=0,L="",N={},U=(b=0,P.length);b<U;++b){D=P[b].resn,T=P[b].chain,M=P[b].resi;var q=e+"_"+T;void 0===N[q]&&(N[q]=[]);var j={};j.resi=M,j.name=n.utilsCls.residueName2Abbr(D).toLowerCase(),T!=L&&(F=0),!isNaN(M)&&(""==L||T!=L||T==L&&M>F)&&(N[q].push(j),F=M,L=T)}i.loadPDBCls.adjustSeq(N)}void 0!==i.deferredSymmetry&&i.deferredSymmetry.resolve()}else s=i.icn3dui.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi",$.ajax({url:s,type:"POST",data:{mmcifheader:a},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(s){if(void 0!==s.emd&&(i.emd=s.emd),void 0!==s.organism&&(i.organism=s.organism),i.bAssemblyUseAsu&&r.loadMmcifSymmetry(s.assembly),"mmtfid"===t&&void 0!==s.missingseq){for(var a=0,l="",o={},d=0,c=s.missingseq.length;d<c;++d){var h=s.missingseq[d].resn,m=s.missingseq[d].chain,p=s.missingseq[d].resi,u=e+"_"+m;void 0===o[u]&&(o[u]=[]);var C={};C.resi=p,C.name=n.utilsCls.residueName2Abbr(h).toLowerCase(),m!=l&&(a=0),!isNaN(p)&&(""==l||m!=l||m==l&&p>a)&&(o[u].push(C),a=p,l=m)}i.loadPDBCls.adjustSeq(o)}void 0!==i.deferredSymmetry&&i.deferredSymmetry.resolve()},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==i.deferredSymmetry&&i.deferredSymmetry.resolve()}})},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==i.deferredSymmetry&&i.deferredSymmetry.resolve()}})}loadMmcifData(e,t){var s=this.icn3d;return s.icn3dui,t||(t=e.mmcif),t||(t="stru"),void 0!==e.atoms?(s.init(),void 0!==e.emd&&(s.emd=e.emd),void 0!==e.organism&&(s.organism=e.organism),void 0!==s.emd?($("#"+s.pre+"mapWrapper1").hide(),$("#"+s.pre+"mapWrapper2").hide(),$("#"+s.pre+"mapWrapper3").hide()):($("#"+s.pre+"emmapWrapper1").hide(),$("#"+s.pre+"emmapWrapper2").hide(),$("#"+s.pre+"emmapWrapper3").hide()),s.deferredOpm=$.Deferred((function(){s.opmParserCls.loadOpmData(e,t,void 0,"mmcif")})),s.deferredOpm.promise()):(alert("invalid atoms data."),!1)}loadMmcifSymmetry(e){var t=this.icn3d;t.icn3dui;for(var s=0,i=e.length;s<i;++s){var n=new THREE.Matrix4;n.fromArray(e[s]),t.biomtMatrices[s]=n}t.asuCnt=t.biomtMatrices.length}loadMmcifOpmDataPart2(e,t){var s=this.icn3d;s.icn3dui,1==Object.keys(s.structures).length&&$("#"+s.pre+"alternateWrapper").hide();for(var i=void 0!==e.assembly?e.assembly:[],n=0,r=i.length;n<r;++n){null==s.biomtMatrices[n]&&(s.biomtMatrices[n]=(new THREE.Matrix4).identity());for(var a=0,l=i[n].length;a<l;++a)s.biomtMatrices[n].elements[a]=i[n][a]}void 0!==s.biomtMatrices&&s.biomtMatrices.length>1?($("#"+s.pre+"assemblyWrapper").show(),s.asuCnt=s.biomtMatrices.length):$("#"+s.pre+"assemblyWrapper").hide(),s.setStyleCls.setAtomStyleByOptions(s.opts),s.setColorCls.setColorByOptions(s.opts,s.atoms),s.ParserUtilsCls.renderStructure(),void 0!==s.icn3dui.cfg.rotate&&s.resizeCanvasCls.rotStruc(s.icn3dui.cfg.rotate,!0)}}class Ae{constructor(e){this.icn3d=e}selectSequenceNonMobile(){var e=this.icn3d;if(e.icn3dui,!e.icn3dui.bNode){var t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"dt_giseq]").add("[id^="+e.pre+"dt_custom]").add("[id^="+e.pre+"dt_site]").add("[id^="+e.pre+"dt_snp]").add("[id^="+e.pre+"dt_clinvar]").add("[id^="+e.pre+"dt_cdd]").add("[id^="+e.pre+"dt_domain]").add("[id^="+e.pre+"dt_interaction]").add("[id^="+e.pre+"dt_ssbond]").add("[id^="+e.pre+"dt_crosslink]").add("[id^="+e.pre+"dt_transmem]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_custom]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").add("[id^="+e.pre+"tt_crosslink]").add("[id^="+e.pre+"tt_transmem]").selectable({stop:function(){var e=t.icn3d;$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),!1!==e.bSelectResidue||e.bShift||e.bCtrl||e.selectionCls.removeSelection(),$("span.ui-selected",this).each((function(){var e=$(this).attr("id");void 0!==e&&t.selectResidues(e,this)})),e.hlObjectsCls.addHlObjects();var s={};for(var i in e.selectedResidues){var n=i.lastIndexOf("_");s[i.substr(0,n)]=1}var r=Object.keys(s);e.hlUpdateCls.updateHl2D(r),$("div.ui-selected",this).each((function(){void 0!==$(this).attr("chain")&&t.selectTitle(this)}))}}),$("[id^="+e.pre+"ov_giseq]").add("[id^="+e.pre+"ov_custom]").add("[id^="+e.pre+"ov_site]").add("[id^="+e.pre+"ov_snp]").add("[id^="+e.pre+"ov_clinvar]").add("[id^="+e.pre+"ov_cdd]").add("[id^="+e.pre+"ov_domain]").add("[id^="+e.pre+"ov_interaction]").add("[id^="+e.pre+"ov_ssbond]").add("[id^="+e.pre+"ov_crosslink]").add("[id^="+e.pre+"ov_transmem]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_custom]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").add("[id^="+e.pre+"tt_crosslink]").add("[id^="+e.pre+"tt_transmem]").on("click",".icn3d-seqTitle",(function(e){var s=t.icn3d;e.stopImmediatePropagation(),s.bAlignSeq=!1,s.bAnnotations=!0,t.selectTitle(this),s.hlUpdateCls.hlSummaryDomain3ddomain(this),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}))}}selectSequenceMobile(){var e=this.icn3d;if(e.icn3dui,!e.icn3dui.bNode){var t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"custom]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").add("[id^="+e.pre+"transmem]").on("click",".icn3d-residue",(function(e){var s=t.icn3d;e.stopImmediatePropagation(),$(this).attr("id")===s.pre+"dl_sequence2"?(s.bAlignSeq=!0,s.bAnnotations=!1):(s.bAlignSeq=!1,s.bAnnotations=!0);var i=$(this).attr("id");void 0!==i&&t.selectResidues(i,this),s.hlObjectsCls.addHlObjects();var n={};for(var r in s.selectedResidues){var a=r.lastIndexOf("_");n[r.substr(0,a)]=1}s.hlUpdateCls.removeHl2D();var l=Object.keys(n);s.hlUpdateCls.updateHl2D(l)}))}}selectChainMobile(){var e=this.icn3d;if(e.icn3dui,!e.icn3dui.bNode){var t=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"custom]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"feat]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").add("[id^="+e.pre+"crosslink]").add("[id^="+e.pre+"transmem]").on("click",".icn3d-seqTitle",(function(e){var s=t.icn3d;e.stopImmediatePropagation(),$(this).attr("id")===s.pre+"dl_sequence2"?(s.bAlignSeq=!0,s.bAnnotations=!1):(s.bAlignSeq=!1,s.bAnnotations=!0),t.selectTitle(this),s.hlUpdateCls.hlSummaryDomain3ddomain(this)}))}}selectTitle(e){var t=this.icn3d,s=t.icn3dui;if(!t.icn3dui.bNode&&$(e).hasClass("icn3d-seqTitle")){var i,n,r,a=$(e).attr("chain");if(t.bAlignSeq?t.bSelectAlignResidue=!1:t.bSelectResidue=!1,t.bAnnotations||t.hlUpdateCls.removeSeqChainBkgd(a),t.bCtrl||t.bShift||(t.hlUpdateCls.removeSeqResidueBkgd(),t.hlUpdateCls.removeSeqChainBkgd(),t.currSelectedSets=[]),$(e).toggleClass("icn3d-highlightSeq"),t.bAnnotations?(i=$(e).attr("setname"),n=$(e).attr("title")):i=t.bAlignSeq?"align_"+a:a,$(e).hasClass("icn3d-highlightSeq"))if(t.bAnnotations){if($(e).hasClass("icn3d-highlightSeq"))if(t.hlUpdateCls.removeHl2D(),void 0!==$(e).attr("gi")){t.bCtrl||t.bShift?(t.currSelectedSets.push(a),t.selectionCls.selectAChain(a,a,!1,!0)):(t.currSelectedSets=[a],t.selectionCls.selectAChain(a,a,!1)),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select chain "+a,!0);b=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select sets "+b,!0)}else{var l={};if(void 0!==$(e).attr("domain")||void 0!==$(e).attr("feat")||void 0!==$(e).attr("3ddomain")||void 0!==$(e).attr("custom")){t.hlUpdateCls.hlSummaryDomain3ddomain(e);for(var o=$(e).attr("from").split(","),d=$(e).attr("to").split(","),c=0,h=o.length;c<h;++c)for(var m=parseInt(o[c]),p=parseInt(d[c]),u=m;u<=p;++u)l[C=a+"_"+(u+1).toString()]=1;t.bCtrl||t.bShift?t.selectionCls.selectResidueList(l,i,n,!0):t.selectionCls.selectResidueList(l,i,n,!1),C=a+"_"+parseInt((m+p)/2).toString(),r=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.residues[C],t.atoms))}else if(void 0!==$(e).attr("posarray")){var C,v=$(e).attr("posarray").split(",");for(c=0,h=v.length;c<h;++c)l[C=void 0!==$(e).attr("site")?a+"_"+(parseInt(v[c])+1).toString():a+"_"+v[c]]=1;t.bCtrl||t.bShift?t.selectionCls.selectResidueList(l,i,n,!0):t.selectionCls.selectResidueList(l,i,n,!1),C=a+"_"+v[parseInt((0+v.length)/2)].toString(),r=t.applyCenterCls.centerAtoms(s.hashUtilsCls.hash2Atoms(t.residues[C],t.atoms))}for(var g in t.labels)"schematic"!==g&&"distance"!==g&&(t.labels[g]=[]);var f=t.LABELSIZE;void 0!==r&&t.analysisCls.addLabel(n,r.center.x,r.center.y,r.center.z,f,"FFFF00",void 0,"custom"),t.drawCls.draw(),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+t.resid2specCls.residueids2spec(Object.keys(l))+" | name "+i,!0),t.bCtrl||t.bShift?t.currSelectedSets.push(i):t.currSelectedSets=[i];b=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select sets "+b,!0)}}else{t.bCtrl||t.bShift?(t.currSelectedSets.push(i),t.selectionCls.selectAChain(a,i,!0,!0)):(t.currSelectedSets=[i],t.selectionCls.selectAChain(a,i,!0)),t.bAlignSeq?t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select alignChain "+a,!0):t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select chain "+a,!0);var b=t.currSelectedSets.join(" or ");t.currSelectedSets.length>1&&t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select sets "+b,!0)}else t.hlObjectsCls.removeHlObjects(),t.hlUpdateCls.removeHl2D(),$("#"+t.pre+"atomsCustom").val("")}}selectResidues(e,t){var s=this.icn3d,i=s.icn3dui;if(!s.icn3dui.bNode&&void 0!==e&&""!==e){e=e.substr(e.indexOf("_")+1),s.bSelectResidue=!0,$(t).toggleClass("icn3d-highlightSeq");var n=e.substr(e.indexOf("_")+1);if(s.residues.hasOwnProperty(n))if($(t).hasClass("icn3d-highlightSeq")){for(var r in s.residues[n])s.hAtoms[r]=1;if(s.selectedResidues[n]=1,s.bAnnotations&&void 0!==$(t).attr("disease")){var a=$(t).attr("disease"),l=s.applyCenterCls.centerAtoms(i.hashUtilsCls.hash2Atoms(s.residues[n],s.atoms));a.length>15&&(a=a.substr(0,15)+"...");var o=s.LABELSIZE,d=s.icn3dui.htmlCls.GREYD;s.analysisCls.addLabel(a,l.center.x,l.center.y,l.center.z,o,d,void 0,"custom")}}else{for(var c in s.residues[n])delete s.hAtoms[c];delete s.selectedResidues[n],s.hlObjectsCls.removeHlObjects()}}}}class xe{constructor(e){this.icn3d=e}showAnnotations(){var e=this.icn3d;e.icn3dui;var t=this;if(e.icn3dui.htmlCls.dialogCls.openDlg("dl_selectannotations","Sequences and Annotations"),(void 0===e.bAssemblyNote||!e.bAssemblyNote)&&void 0!==e.asuCnt){var s="     <br><div id='"+e.pre+"assembly_note' style='margin-left:5px;'><span class='icn3d-annoLargeTitle'>Assembly Tips:</span> Only the asymmetric unit is shown in the sequence window.<br>Click \"Assembly\" in the menu \"View\" to switch between asymmetric unit and biological assembly(<b>"+e.asuCnt+"</b> asymmetric unit).</div>";$("#"+e.pre+"dl_annotations_tabs").append(s),e.bAssemblyNote=!0}if(void 0===e.bAnnoShown||!e.bAnnoShown){var i=Object.keys(e.chains);void 0===e.giSeq&&(e.giSeq={}),void 0===e.currClin&&(e.currClin={}),void 0===e.resi2disease_nonempty&&(e.resi2disease_nonempty={}),void 0===e.baseResi&&(e.baseResi={}),void 0===e.matchedPos&&(e.matchedPos={});var n=e.icn3dui.cfg.notebook?e.icn3dui.htmlCls.WIDTH/2:$("#"+e.pre+"dl_selectannotations").dialog("option","width");for(var r in e.seqAnnWidth=n-120-60-50,e.maxAnnoLength=1,e.chainsSeq)e.chainsSeq[r].length>e.maxAnnoLength&&(e.maxAnnoLength=e.chainsSeq[r].length);var a={},l={},o={};e.protein_chainid={};for(var d=0,c=i.length;d<c;++d){if(Math.round(i[d].indexOf("_")),void 0===(f=e.firstAtomObjCls.getFirstCalphaAtomObj(e.chains[i[d]]))&&(f=e.firstAtomObjCls.getFirstAtomObj(e.chains[i[d]])),void 0!==f){var h,m=i[d].substr(i[d].indexOf("_")+1);if(-1!==m.indexOf("_")?(m=m.substr(0,m.indexOf("_")),h=i[d].substr(0,i[d].indexOf("_"))+"_"+m):h=i[d],e.proteins.hasOwnProperty(f.serial)&&e.chainsSeq[i[d]].length>1)e.protein_chainid[i[d]]=h;else if(e.nucleotides.hasOwnProperty(f.serial)&&e.chainsSeq[i[d]].length>1)a[i[d]]=h;else if(e.chainsSeq[i[d]].length>1)l[i[d]]=h;else{var p=e.chainsSeq[i[d]][0].name,u=i[d]+"_"+e.chainsSeq[i[d]][0].resi;void 0===o[p]&&(o[p]=[]),o[p].push(u)}if((void 0!==e.icn3dui.cfg.pdbid||void 0!==e.icn3dui.cfg.opmid||void 0!==e.icn3dui.cfg.mmcifid||void 0!==e.icn3dui.cfg.mmtfid)&&(e.proteins.hasOwnProperty(f.serial)||e.nucleotides.hasOwnProperty(f.serial)))for(var C=0,v=e.chainsSeq[i[d]].length;C<v;++C){var g=e.chainsSeq[i[d]][C];if(""!==g.name&&"-"!==g.name&&g.name==g.name.toUpperCase()){var f;u=i[d]+"_"+g.resi;if(void 0===(f=e.firstAtomObjCls.getFirstCalphaAtomObj(e.residues[u]))&&(f=e.firstAtomObjCls.getFirstAtomObj(e.chains[i[d]])),e.proteins.hasOwnProperty(f.serial)||e.nucleotides.hasOwnProperty(f.serial))continue;p=g.name.trim();void 0===o[p]&&(o[p]=[]),o[p].push(u)}}}}if(void 0===e.icn3dui.cfg.blast_rep_id){if(e.bFullUi)if(void 0!==e.icn3dui.cfg.mmtfid){var b=i[0].substr(0,i[0].indexOf("_"));$.when(e.mmcifParserCls.downloadMmcifSymmetry(b,"mmtfid")).then((function(){this.showAnnoSeqData(a,l,o)}))}else this.showAnnoSeqData(a,l,o)}else if(void 0!==e.icn3dui.cfg.blast_rep_id){var y=e.icn3dui.htmlCls.baseUrl+"pwaln/pwaln.fcgi?from=querytarget",w={targets:e.icn3dui.cfg.blast_rep_id,queries:e.icn3dui.cfg.query_id};if(void 0!==e.icn3dui.cfg.query_from_to){var S=e.icn3dui.cfg.query_from_to.split(":");for(d=0,c=S.length;d<c;++d)S[d]=parseInt(S[d])-1;w.queries=e.icn3dui.cfg.query_id+":"+S.join(":")}if(void 0!==e.icn3dui.cfg.target_from_to){var _=e.icn3dui.cfg.target_from_to.split(":");for(d=0,c=_.length;d<c;++d)_[d]=parseInt(_[d])-1;w.targets=e.icn3dui.cfg.blast_rep_id+":"+_.join(":")}$.ajax({url:y,type:"POST",data:w,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(s){e.seqStructAlignData=s,t.showAnnoSeqData(a,l,o)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}e.bAnnoShown=!0}showAnnoSeqData(e,t,s){var i=this.icn3d,n=i.icn3dui;this.getAnnotationData();var r=0;for(var a in e)this.getSequenceData(a,e[a],"nucleotide",r),++r;for(var a in i.interactChainbase=n.hashUtilsCls.unionHash(i.interactChainbase,i.protein_chainid),i.interactChainbase=n.hashUtilsCls.unionHash(i.interactChainbase,e),r=0,t)this.getSequenceData(a,t[a],"chemical",r),++r;for(var l in i.interactChainbase=n.hashUtilsCls.unionHash(i.interactChainbase,t),i.ssbondChainbase=n.hashUtilsCls.unionHash(i.ssbondChainbase,i.protein_chainid),i.ssbondChainbase=n.hashUtilsCls.unionHash(i.ssbondChainbase,t),i.crosslinkChainbase=n.hashUtilsCls.unionHash(i.crosslinkChainbase,i.protein_chainid),i.crosslinkChainbase=n.hashUtilsCls.unionHash(i.crosslinkChainbase,e),i.crosslinkChainbase=n.hashUtilsCls.unionHash(i.crosslinkChainbase,t),s)this.getCombinedSequenceData(l,s[l],r),++r;this.enableHlSeq(),setTimeout((function(){i.annotationCls.hideAllAnno(),i.annotationCls.clickCdd()}),0)}getAnnotationData(){var e=this.icn3d,t=e.icn3dui,s=this,i=$.map(e.protein_chainid,(function(e){return e})),n=0;for(var r in e.protein_chainid){var a=t.utilsCls.isMobile()?"none":"button",l=e.showSeqCls.getProteinName(r),o=l,d=0==n?"<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"",c=e.chainsGene[r]&&e.chainsGene[r].geneId?"(Gene: <a href='https://www.ncbi.nlm.nih.gov/gene/"+e.chainsGene[r].geneId+"' target='_blank' title='"+e.chainsGene[r].geneDesc+"'>"+e.chainsGene[r].geneSymbol+"</a>)":"",h="<div id='"+e.pre+"anno_"+r+"' class='icn3d-annotation'>"+d+"<span style='font-weight:bold;'>Annotations of "+r+"</span>: <a class='icn3d-blue' href='https://www.ncbi.nlm.nih.gov/protein?term="+r+"' target='_blank' title='"+l+"'>"+o+"</a>"+c+"&nbsp;&nbsp;&nbsp;"+this.addButton(r,"icn3d-addtrack","Add Track","Add a custom track",60,a)+"&nbsp;&nbsp;&nbsp;";h+=this.addButton(r,"icn3d-customcolor","Custom Color/Tube","Use a custom file to define the colors or tubes in 3D structure",110,a)+"&nbsp;&nbsp;&nbsp;",h+=this.addButton(r,"icn3d-helixsets","Helix Sets",'Define sets for each helix in this chain and add them to the menu of "Defined Sets"',60,a)+"&nbsp;"+this.addButton(r,"icn3d-sheetsets","Sheet Sets",'Define sets for each sheet in this chain and add them to the menu of "Defined Sets"',60,a)+"&nbsp;"+this.addButton(r,"icn3d-coilsets","Coil Sets",'Define sets for each coil in this chain and add them to the menu of "Defined Sets"',60,a),$("#"+e.pre+"dl_annotations").append(h);var m=["giseq","cdd","clinvar","snp","domain","site","interaction","custom","ssbond","crosslink","transmem"];for(var p in m){var u=m[p];$("#"+e.pre+"anno_"+r).append(this.getAnDiv(r,u))}$("#"+e.pre+"anno_"+r).append("<br><hr><br>"),++n}e.annoCddSiteCls.setToolTip();var C=e.icn3dui.htmlCls.baseUrl+"/vastdyn/vastdyn.cgi?chainlist="+i;void 0!==e.chainid_seq?this.processSeqData(e.chainid_seq):$.ajax({url:C,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:0,success:function(t){e.chainid_seq=t,s.processSeqData(e.chainid_seq)},error:function(t,s,n){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var r in this.enableHlSeq(),console.log("No data were found for the protein "+i+"..."),e.protein_chainid){var a=e.protein_chainid[r];e.showSeqCls.setAlternativeSeq(r,a),e.showSeqCls.showSeq(r,a)}e.annoCddSiteCls.showCddSiteAll()}}})}getSequenceData(e,t,s,i){var n=this.icn3d;n.icn3dui;var r=n.showSeqCls.getProteinName(e),a=r;a.length>40&&(a=a.substr(0,40)+"...");var l="";0==i&&("protein"==s?l="<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"nucleotide"==s?l="<span class='icn3d-annoLargeTitle'><b>Nucleotides</b>: </span><br><br>":"chemical"==s&&(l="<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>")),$("#"+n.pre+"dl_annotations").append("<div id='"+n.pre+"anno_"+e+"' class='icn3d-annotation'>"+l+"<b>"+e+"</b>: <span title='"+r+"'>"+a+"</span> </div>"),$("#"+n.pre+"anno_"+e).append(this.getAnDiv(e,"giseq")),$("#"+n.pre+"anno_"+e).append(this.getAnDiv(e,"interaction")),$("#"+n.pre+"anno_"+e).append("<br><hr><br>"),n.giSeq[e]=[];for(var o=0;o<n.chainsSeq[e].length;++o){var d=n.chainsSeq[e][o].name;n.giSeq[e][o]=d}n.matchedPos[e]=0,n.baseResi[e]=n.chainsSeq[e][0].resi-n.matchedPos[e]-1,n.showSeqCls.showSeq(e,t,s)}getCombinedSequenceData(e,t,s){var i=this.icn3d;i.icn3dui;var n,r=0==s?"<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>":"",a=t[0].lastIndexOf("_"),l=t[0].substr(0,a),o=void 0!==i.icn3dui.cfg.mmdbid&&void 0!==i.chainid2sid?i.chainid2sid[l]:void 0;n=void 0!==o?"<b><a class='icn3d-blue' href='https://pubchem.ncbi.nlm.nih.gov/substance/"+o+"#section=2D-Structure' target='_blank'>"+e+" <img src='https://pubchem.ncbi.nlm.nih.gov/image/imgsrv.fcgi?sid="+o+"'></a></b>":"<b>"+e+"</b>",$("#"+i.pre+"dl_annotations").append("<div id='"+i.pre+"anno_"+e+"' class='icn3d-annotation'>"+r+n+"</div>"),$("#"+i.pre+"anno_"+e).append("<div id='"+i.pre+"giseq_"+e+"'><div id='"+i.pre+"dt_giseq_"+e+"' style='display:none'></div><div id='"+i.pre+"ov_giseq_"+e+"'></div></div>"),$("#"+i.pre+"anno_"+e).append("<br><hr><br>");var d='<div id="'+i.pre+'giseq_sequence" class="icn3d-dl_sequence">';d+='<div class="icn3d-seqTitle2" anno="sequence"><span style="white-space:nowrap;" title="Chemical '+e+'">Chem. '+e+"</span></div>",d+='<span class="icn3d-residueNum" style="width:60px!important;" title="starting protein sequence number">Count: '+t.length+"</span>";for(var c=d+='<span class="icn3d-seqLine">',h=d,m=0,p=t.length;m<p;++m){var u=e,C=u;u.length>3&&(C=u.substr(0,3)),m<t.length-1&&(C+=",");var v=t[m],g=v.substr(v.lastIndexOf("_")+1);c+='<span id="giseq_'+i.pre+v+'" title="'+u+g+'" class="icn3d-residue icn3d-chemical">'+C+"</span>"}var f=i.icn3dui.htmlCls.GREY8,b=Math.round(i.seqAnnWidth*t.length/i.maxAnnoLength);b<1&&(b=1),h+='<div class="icn3d-seqTitle" style="display:inline-block; color:white; font-weight:bold; background-color:'+f+"; width:"+b+'px;">&nbsp;</div>',d="</span>",d+="<br>",c+=d+="</div>",h+=d,$("#"+i.pre+"dt_giseq_"+e).html(c),$("#"+i.pre+"ov_giseq_"+e).html(h)}processSeqData(e){var t=this.icn3d,s=t.icn3dui;for(var i in t.protein_chainid){var n=t.protein_chainid[i];if(e.hasOwnProperty(n)){var r=e[n];t.giSeq[i]=r;for(var a="",l=0;l<10&&l<t.chainsSeq[i].length;++l)a+=t.chainsSeq[i][l].name.substr(0,1);-1==(k=r.toLowerCase().indexOf(a.toLowerCase()))?(console.log("The gi sequence didn't match the protein sequence. The start of 3D protein sequence: "+a+". The gi sequence: "+r.substr(0,10)+"."),t.showSeqCls.setAlternativeSeq(i,n)):(t.matchedPos[i]=k,t.baseResi[i]=t.chainsSeq[i][0].resi-t.matchedPos[i]-1)}else console.log("No data were found for the protein "+i+"..."),t.showSeqCls.setAlternativeSeq(i,n);if(t.icn3dui.cfg.blast_rep_id!=i)t.showSeqCls.showSeq(i,n);else if(t.icn3dui.cfg.blast_rep_id==i&&void 0===t.seqStructAlignData.data){d=t.icn3dui.cfg.query_id.length>14?"Query: "+t.icn3dui.cfg.query_id.substr(0,6)+"...":isNaN(t.icn3dui.cfg.query_id)?"Query: "+t.icn3dui.cfg.query_id:"Query: gi "+t.icn3dui.cfg.query_id,H=void 0,u=void 0;var o="cannot be aligned";t.queryStart="",t.queryEnd="",alert("The sequence can NOT be aligned to the structure"),t.showSeqCls.showSeq(i,n,void 0,d,H,o,u)}else if(t.icn3dui.cfg.blast_rep_id==i&&void 0!==t.seqStructAlignData.data){var d;d=t.icn3dui.cfg.query_id.length>14?"Query: "+t.icn3dui.cfg.query_id.substr(0,6)+"...":isNaN(t.icn3dui.cfg.query_id)?"Query: "+t.icn3dui.cfg.query_id:"Query: gi "+t.icn3dui.cfg.query_id;var c,h,m=t.seqStructAlignData;void 0!==m.data&&(c=m.data[0].query,h=void 0!==(h=m.data[0].targets[i])&&h.hsps.length>0?h.hsps[0]:void 0);o="";var p,u="";if(t.queryStart="",t.queryEnd="",void 0!==c&&void 0!==h){(p=h.scores.e_value.toPrecision(2))>1e-200&&(p=parseFloat(p).toExponential()),h.scores.bit_score;var C=m.targets[i].seqdata,v=c.seqdata,g=h.segs,f={};void 0===t.targetGapHash&&(t.targetGapHash={}),t.fullpos2ConsTargetpos={},t.consrvResPosArray=[];var b=0,y=0;t.nTotalGap=0,t.queryStart=g[0].from+1,t.queryEnd=g[g.length-1].to+1;l=0;for(var w=g.length;l<w;++l){var S=g[l];if(l>0)if(S.orifrom-b<S.from-y)t.targetGapHash[S.orifrom]={from:y+1,to:S.from-1},t.nTotalGap+=t.targetGapHash[S.orifrom].to-t.targetGapHash[S.orifrom].from+1;else if(S.orifrom-b>S.from-y)for(var _=b+1;_<S.orifrom;++_)f[_]=-1;for(_=0;_<=S.orito-S.orifrom;++_)f[_+S.orifrom]=_+S.from;b=S.orito,y=S.to}var A=0;t.alnChainsSeq[i]=[];var x=t.chainid2offset[i]?t.chainid2offset[i]:0;for(l=0,w=C.length;l<w;++l){if(t.targetGapHash.hasOwnProperty(l))for(_=t.targetGapHash[l].from;_<=t.targetGapHash[l].to;++_)o+=v[_];u+=t.showSeqCls.insertGap(i,l,"-",!0),t.targetGapHash.hasOwnProperty(l)&&(A+=t.targetGapHash[l].to-t.targetGapHash[l].from+1);var k=t.bUsePdbNum?l+1+x:l+1;if(f.hasOwnProperty(l)&&-1!==f[l]){o+=v[f[l]];var O=this.getColorhexFromBlosum62(C[l],v[f[l]]);C[l]==v[f[l]]?(u+=C[l],t.fullpos2ConsTargetpos[l+A]={same:1,pos:k,res:C[l],color:O},t.consrvResPosArray.push(k),t.alnChainsSeq[i].push({resi:k,color:"#FF0000",color2:"#"+O})):this.conservativeReplacement(C[l],v[f[l]])?(u+="+",t.fullpos2ConsTargetpos[l+A]={same:0,pos:k,res:C[l],color:O},t.consrvResPosArray.push(k),t.alnChainsSeq[i].push({resi:k,color:"#0000FF",color2:"#"+O})):(u+=" ",t.fullpos2ConsTargetpos[l+A]={same:-1,pos:k,res:C[l],color:O},t.alnChainsSeq[i].push({resi:k,color:t.icn3dui.htmlCls.GREYC,color2:"#"+O}))}else o+="-",u+=" "}}else o+="cannot be aligned",alert("The sequence can NOT be aligned to the structure");var H="BLAST, E: "+p;t.showSeqCls.showSeq(i,n,void 0,d,H,o,u);var R={};if(void 0!==t.consrvResPosArray)for(l=0,w=t.consrvResPosArray.length;l<w;++l)R[n+"_"+t.consrvResPosArray[l]]=1;var E=s.hashUtilsCls.cloneHash(t.hAtoms);t.selectionCls.selectResidueList(R,"protein_aligned",H,!1),t.hAtoms=s.hashUtilsCls.cloneHash(E)}}this.enableHlSeq(),t.annoCddSiteCls.showCddSiteAll()}enableHlSeq(){var e=this.icn3d;e.icn3dui.utilsCls.isMobile()?(e.hlSeqCls.selectSequenceMobile(),e.hlSeqCls.selectChainMobile()):e.hlSeqCls.selectSequenceNonMobile(),Object.keys(e.hAtoms).length<Object.keys(e.dAtoms).length&&e.hlUpdateCls.updateHlSeq()}getAnDiv(e,t){var s=this.icn3d;s.icn3dui;var i="Loading "+t+"...";return"custom"==t?i="":"domain"==t&&(i="Loading 3D "+t+"..."),"<div id='"+s.pre+t+"_"+e+"'><div id='"+s.pre+"tt_"+t+"_"+e+"' class='icn3d-fixed-pos' style='display:none!important'></div><div id='"+s.pre+"dt_"+t+"_"+e+"' style='display:none'>"+i+"</div><div id='"+s.pre+"ov_"+t+"_"+e+"'>"+i+"</div></div>"}addButton(e,t,s,i,n,r){return this.icn3d.icn3dui,"<div class='"+t+"' chainid='"+e+"' style='display:inline-block; font-size:11px; font-weight:bold; width:"+n+"px!important;'><button style='-webkit-appearance:"+r+"; height:18px; width:"+n+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+i+"'>"+s+"</span></button></div>"}addSnpButton(e,t,s,i,n,r){var a=this.icn3d;return a.icn3dui,"<div class='"+a.pre+t+"' snp='"+e+"' style='margin:3px 0 3px 0; display:inline-block; font-size:11px; font-weight:bold; width:"+n+"px!important;'><button style='-webkit-appearance:"+r+"; height:18px; width:"+n+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+i+"'>"+s+"</span></button></div>"}conservativeReplacement(e,t){var s=this.icn3d.icn3dui,i=-1!==s.parasCls.b62ResArray.indexOf(e)?s.parasCls.b62ResArray.indexOf(e):s.parasCls.b62ResArray.length-1,n=-1!==s.parasCls.b62ResArray.indexOf(t)?s.parasCls.b62ResArray.indexOf(t):s.parasCls.b62ResArray.length-1;return s.parasCls.b62Matrix[i][n]>0}getColorhexFromBlosum62(e,t){var s=this.icn3d.icn3dui,i=-1!==s.parasCls.b62ResArray.indexOf(e)?s.parasCls.b62ResArray.indexOf(e):s.parasCls.b62ResArray.length-1,n=-1!==s.parasCls.b62ResArray.indexOf(t)?s.parasCls.b62ResArray.indexOf(t):s.parasCls.b62ResArray.length-1,r=s.parasCls.b62Matrix[i][n];if(void 0===r)return"333333";var a,l,o="333333";r>0?o="DD"+(l=(a=221-parseInt(r/11*221))<10?"0"+a.toString(16):a.toString(16))+l:o=(l=(a=221-parseInt(-1*r/4*221))<10?"0"+a.toString(16):a.toString(16))+l+"DD";return o}}class ke{constructor(e){this.icn3d=e}showInteraction(e,t){var s=this.icn3d;s.icn3dui;var i=this;void 0!==s.chainname2residues||void 0===s.icn3dui.cfg.mmdbid&&void 0===s.icn3dui.cfg.gi&&void 0===s.icn3dui.cfg.blast_rep_id&&void 0===s.icn3dui.cfg.align&&void 0===s.icn3dui.cfg.chainalign?this.showInteraction_base(e,t):setTimeout((function(){i.showInteraction_base(e,t)}),1e3)}showInteraction_base(e,t){var s=this.icn3d,i=s.icn3dui;void 0===s.chainname2residues&&(s.chainname2residues={});var n=Object.keys(s.chains),r=e;if(!((q=Math.round(r.indexOf("_")))>4)){var a=s.firstAtomObjCls.getFirstCalphaAtomObj(s.chains[r]);if(void 0===s.chainname2residues[r]){s.chainname2residues[r]={};var l=n.length;if(l>100&&void 0===s.icn3dui.cfg.mmdbid&&void 0===s.icn3dui.cfg.gi&&void 0===s.icn3dui.cfg.blast_rep_id&&void 0===s.icn3dui.cfg.align&&void 0===s.icn3dui.cfg.chainalign)return $("#"+s.pre+"dt_interaction_"+e).html(""),void $("#"+s.pre+"ov_interaction_"+e).html("");for(var o=0;o<l;++o){var d=n[o];if(d!==r&&(d.substr(0,d.indexOf("_"))===r.substr(0,r.indexOf("_"))&&!((q=Math.round(r.indexOf("_")))>4))){var c,h=s.firstAtomObjCls.getFirstCalphaAtomObj(s.chains[d]);s.chemicals.hasOwnProperty(h.serial)?c="chemical":s.nucleotides.hasOwnProperty(h.serial)?c="nucleotide":s.ions.hasOwnProperty(h.serial)?c="ion":s.proteins.hasOwnProperty(h.serial)?c="protein":s.water.hasOwnProperty(h.serial)&&(c="water");var m=s.contactCls.getAtomsWithinAtom(i.hashUtilsCls.hash2Atoms(s.chains[r],s.atoms),i.hashUtilsCls.hash2Atoms(s.chains[d],s.atoms),4);if(0!=Object.keys(m).length){var p={};for(var u in m){p[(a=s.atoms[u]).structure+"_"+a.chain+"_"+a.resi]=1}var C=d.substr(d.indexOf("_")+1)+"("+c+")";s.chainname2residues[r][C]=Object.keys(p)}}}}var v='<div id="'+s.pre+e+'_interseq_sequence" class="icn3d-dl_sequence">',g=v,f=v,b=0;for(var y in s.chainname2residues[e]){var w=s.chainname2residues[e][y],S="Interact ."+y;S.length>17&&(S=S.substr(0,17)+"...");for(var _="Interact ."+y,A=[],x=0,k=w.length;x<k;++x){var O=w[x],H=Math.round(O.substr(w[x].lastIndexOf("_")+1)),R=Object.keys(s.residues[O])[0];(s.proteins.hasOwnProperty(R)||s.nucleotides.hasOwnProperty(R))&&A.push(H)}var E=A.length;if(0!=E){var I=y.replace(/\s/g,""),D='<div class="icn3d-seqTitle icn3d-link icn3d-blue" interaction="'+(b+1).toString()+'" posarray="'+A.toString()+'" shorttitle="'+S+'" setname="'+e+"_"+I+'" anno="sequence" chain="'+e+'" title="'+_+'">'+S+" </div>",T='<span class="icn3d-residueNum" title="residue count">'+E.toString()+" Res</span>";f+=D+T+"<br>";var M='<span class="icn3d-seqLine">';v+=D+T+M,g+=D+T+M;var P="inter"+b.toString(),F=0,L=0;for(x=0,k=s.giSeq[e].length;x<k;++x)if(v+=s.showSeqCls.insertGap(e,x,"-"),-1!=A.indexOf(x+1+s.baseResi[e])){var N=s.giSeq[e][x],U=N;N.length>1&&(U=N[0]+"..");var q=x>=s.matchedPos[e]&&x-s.matchedPos[e]<s.chainsSeq[e].length?s.chainsSeq[e][x-s.matchedPos[e]].resi:s.baseResi[e]+1+x;v+='<span id="'+P+"_"+s.pre+e+"_"+q+'" title="'+N+q+'" class="icn3d-residue">'+U+"</span>",g+=s.showSeqCls.insertGapOverview(e,x);var j=s.icn3dui.cfg.blast_rep_id==e?Math.round(s.seqAnnWidth*x/(s.maxAnnoLength+s.nTotalGap)-F-L):Math.round(s.seqAnnWidth*x/s.maxAnnoLength-F-L);j>=0&&(g+='<div style="display:inline-block; width:'+j+'px;">&nbsp;</div>',g+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+U+q+'">&nbsp;</div>',F+=j,L+=1)}else v+="<span>-</span>";M='<span class="icn3d-residueNum" title="residue count">&nbsp;'+E.toString()+" Residues</span>",M+="</span>",v+=M+="<br>",g+=M,++b}}v+="</div>",g+="</div>",f+="</div>",$("#"+s.pre+"dt_interaction_"+e).html(v),$("#"+s.pre+"ov_interaction_"+e).html(g),$("#"+s.pre+"tt_interaction_"+e).html(f),i.utilsCls.isMobile()?(s.hlSeqCls.selectSequenceMobile(),s.hlSeqCls.selectChainMobile()):s.hlSeqCls.selectSequenceNonMobile()}}}class Oe{constructor(e){this.icn3d=e}showCrosslink(e,t){var s=this.icn3d;s.icn3dui;var i=this;void 0===s.clbondpnts?setTimeout((function(){i.showCrosslink_base(e,t)}),1e3):this.showCrosslink_base(e,t)}showCrosslink_base(e,t){var s=this.icn3d;s.icn3dui;var i=t,n={},r=i.substr(0,i.indexOf("_")),a=s.clbondpnts[r];if(void 0===a)return $("#"+s.pre+"dt_crosslink_"+e).html(""),$("#"+s.pre+"ov_crosslink_"+e).html(""),void $("#"+s.pre+"tt_crosslink_"+e).html("");for(var l=0,o=a.length;l<o;l+=2){var d=a[l],c=a[l+1];d.substr(0,d.lastIndexOf("_")),i===c.substr(0,c.lastIndexOf("_"))&&(void 0===n[c]&&(n[c]=[]),n[c].push(d))}var h=Object.keys(n);s.annoCddSiteCls.showAnnoType(e,t,"crosslink","Cross-Linkages",h,n)}}class He{constructor(e){this.icn3d=e}showDomainPerStructure(e){var t=this.icn3d;t.icn3dui;var s=this,i=Object.keys(t.structures),n=i[e],r=t.icn3dui.htmlCls.baseUrl+"mmdb/mmdb_strview.cgi?v=2&program=icn3d&domain&molinfor&uid="+n;if(0==e&&void 0!==t.mmdb_data)for(var a in t.protein_chainid)-1!==a.indexOf(n)&&this.showDomainWithData(a,t.mmdb_data);else if(void 0!==t.mmdb_dataArray[e])for(var a in t.protein_chainid)-1!==a.indexOf(n)&&this.showDomainWithData(a,t.mmdb_dataArray[e]);else $.ajax({url:r,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(r){for(var a in t.mmdb_dataArray[e]=r,t.protein_chainid)-1!==a.indexOf(n)&&s.showDomainWithData(a,t.mmdb_dataArray[e]);if(t.showAnnoCls.enableHlSeq(),t.bAjax3ddomain=!0,t.bAjaxDoneArray[e]=!0,void 0!==t.deferred3ddomain)if(void 0===t.icn3dui.cfg.align||void 0===t.icn3dui.cfg.chainalign||t.bRealign)t.deferred3ddomain.resolve();else{for(var l=!0,o=0,d=i.length;o<d;++o)l=l&&t.bAjaxDoneArray[o];l&&t.deferred3ddomain.resolve()}},error:function(e,s,r){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var a in console.log("No 3D domain data were found for the protein "+n+"..."),t.protein_chainid)-1!==a.indexOf(n)&&($("#"+t.pre+"dt_domain_"+a).html(""),$("#"+t.pre+"ov_domain_"+a).html(""),$("#"+t.pre+"tt_domain_"+a).html(""));if(t.showAnnoCls.enableHlSeq(),t.bAjax3ddomain=!0,bAjaxDone1=!0,void 0!==t.deferred3ddomain)if(void 0===t.icn3dui.cfg.align||void 0===t.icn3dui.cfg.chainalign)t.deferred3ddomain.resolve();else{for(var l=!0,o=0,d=i.length;o<d;++o)l=l&&t.bAjaxDoneArray[o];l&&t.deferred3ddomain.resolve()}}}})}showDomainAll(){var e=this.icn3d;e.icn3dui;var t=Object.keys(e.structures);e.mmdb_dataArray=[],e.bAjaxDoneArray=[];for(var s=0,i=t.length;s<i;++s)e.bAjaxDoneArray[s]=!1;for(s=0,i=t.length;s<i;++s)this.showDomainPerStructure(s)}showDomainWithData(e,t){var s=this.icn3d;s.icn3dui;var i,n,r,a='<div id="'+s.pre+e+'_domainseq_sequence" class="icn3d-dl_sequence">',l=a,o=a,d=e.indexOf("_"),c=e.substr(d+1),h=t.moleculeInfor;for(var m in h)if(h[m].chain===c){r=m,n=h[m].name;break}void 0!==r&&void 0!==t.domains[r]&&(i=t.domains[r].domains),void 0===i&&(i=[]);for(var p=0,u=i.length;p<u;++p){for(var C="3D domain "+(p+1).toString()+" of "+n,v=C.length>17?C.substr(0,17)+"...":C,g=i[p].intervals,f={},b={},y=[],w=[],S={},_=0,A=0,x=g.length;A<x;++A){var k=Math.round(g[A][0])-1,O=Math.round(g[A][1])-1;if(!f.hasOwnProperty(k)&&!b.hasOwnProperty(O)){f[k]=1,b[O]=1,y.push(k+s.baseResi[e]),w.push(O+s.baseResi[e]),_+=O-k+1;for(var H=k;H<=O;++H)S[H+1]=1}}var R='<div class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+y+'" to="'+w+'" shorttitle="'+v+'" index="'+p+'" setname="'+e+"_3d_domain_"+(p+1).toString()+'" anno="sequence" chain="'+e+'" title="'+C+'">'+v+" </div>",E='<span class="icn3d-residueNum" title="residue count">'+_.toString()+" Res</span>";o+=R+E+"<br>";var I='<span class="icn3d-seqLine">';a+=R+E+I,l+=R+E+I;var D="domain3d"+p.toString();for(A=0,x=s.giSeq[e].length;A<x;++A)if(a+=s.showSeqCls.insertGap(e,A,"-"),S.hasOwnProperty(A+1)){var T=s.giSeq[e][A],M=T;T.length>1&&(M=T[0]+"..");d=A>=s.matchedPos[e]&&A-s.matchedPos[e]<s.chainsSeq[e].length?s.chainsSeq[e][A-s.matchedPos[e]].resi:s.baseResi[e]+1+A;a+='<span id="'+D+"_"+s.pre+e+"_"+d+'" title="'+M+d+'" class="icn3d-residue">'+T+"</span>"}else a+="<span>-</span>";var P=s.firstAtomObjCls.getFirstCalphaAtomObj(s.chains[e]),F=void 0===P.color||"FFFFFF"===P.color.getHexString()?"DDDDDD":P.color.getHexString(),L=void 0!==P.color?F:"CCCCCC";if(s.icn3dui.cfg.blast_rep_id!=e)for(A=0,x=y.length;A<x;++A){l+='<div style="display:inline-block; width:'+(0==A?Math.round(s.seqAnnWidth*(y[A]-s.baseResi[e]-1)/s.maxAnnoLength):Math.round(s.seqAnnWidth*(y[A]-w[A-1]-1)/s.maxAnnoLength))+'px;">&nbsp;</div>',l+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+L+"; width:"+Math.round(s.seqAnnWidth*(w[A]-y[A]+1)/s.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+y+'" to="'+w+'" shorttitle="'+v+'" index="'+p+'" setname="'+e+"_3d_domain_"+(p+1).toString()+'" id="'+e+"_3d_domain_"+p+'" anno="sequence" chain="'+e+'" title="'+C+'">3D domain '+(p+1).toString()+"</div>"}else{var N=[],U=[];for(A=0,x=y.length;A<x;++A){N.push(y[A]);for(H=y[A];H<=w[A];++H)void 0!==s.targetGapHash&&s.targetGapHash.hasOwnProperty(H)&&(U.push(H-1),N.push(H));U.push(w[A])}for(A=0,x=N.length;A<x;++A){l+=s.showSeqCls.insertGapOverview(e,N[A]),l+='<div style="display:inline-block; width:'+(0==A?Math.round(s.seqAnnWidth*(N[A]-s.baseResi[e]-1)/(s.maxAnnoLength+s.nTotalGap)):Math.round(s.seqAnnWidth*(N[A]-U[A-1]-1)/(s.maxAnnoLength+s.nTotalGap)))+'px;">&nbsp;</div>',l+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+L+"; width:"+Math.round(s.seqAnnWidth*(U[A]-N[A]+1)/(s.maxAnnoLength+s.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+N+'" to="'+U+'" shorttitle="'+v+'" index="'+p+'" setname="'+e+"_3d_domain_"+(p+1).toString()+'" id="'+e+"_3d_domain_"+p+'" anno="sequence" chain="'+e+'" title="'+C+'">3D domain '+(p+1).toString()+"</div>"}}I='<span class="icn3d-residueNum" title="residue count">&nbsp;'+_.toString()+" Residues</span>",I+="</span>",a+=I+="<br>",l+=I}a+="</div>",l+="</div>",o+="</div>",$("#"+s.pre+"dt_domain_"+e).html(a),$("#"+s.pre+"ov_domain_"+e).html(l),$("#"+s.pre+"tt_domain_"+e).html(o)}}class Re{constructor(e){this.icn3d=e}navClinVar(e){var t=this.icn3d,s=t.icn3dui,i=this;t.currClin[e]=-1,s.myEventCls.onIds("#"+t.pre+e+"_prevclin","click",(function(t){var s=i.icn3d;t.stopImmediatePropagation();var n=void 0!==s.resi2disease_nonempty[e]?Object.keys(s.resi2disease_nonempty[e]).length:0;--s.currClin[e],s.currClin[e]<0&&(s.currClin[e]=n-1),i.showClinVarLabelOn3D(e)})),s.myEventCls.onIds("#"+t.pre+e+"_nextclin","click",(function(t){var s=i.icn3d;t.stopImmediatePropagation();var n=void 0!==s.resi2disease_nonempty[e]?Object.keys(s.resi2disease_nonempty[e]).length:0;++s.currClin[e],s.currClin[e]>n-1&&(s.currClin[e]=0),i.showClinVarLabelOn3D(e)}))}showClinVarLabelOn3D(e){var t,s=this.icn3d,i=s.icn3dui,n=Object.keys(s.resi2disease_nonempty[e]);t=e+"_"+n[s.currClin[e]];for(var r="",a=s.resi2disease_nonempty[e][n[s.currClin[e]]],l=0,o=a.length;l<o;++l)if(""!=a[l]&&"not specified"!=a[l]&&"not provided"!=a[l]){r=a[l];break}var d=s.applyCenterCls.centerAtoms(i.hashUtilsCls.hash2Atoms(s.residues[t],s.atoms));r.length>30&&(r=r.substr(0,30)+"..."),s.selectionCls.removeSelection(),null==s.labels&&(s.labels={}),s.labels.clinvar=[];var c=s.LABELSIZE;for(var h in s.analysisCls.addLabel(r,d.center.x+1,d.center.y+1,d.center.z+1,c,"#FFFF00",void 0,"clinvar"),s.hAtoms={},s.residues[t])s.hAtoms[h]=1;$("#clinvar_"+s.pre+t).addClass("icn3d-highlightSeq"),void 0===$("#"+s.pre+"modeswitch")[0]||$("#"+s.pre+"modeswitch")[0].checked||s.definedSetsCls.setMode("selection"),s.drawCls.draw()}getSnpLine(e,t,s,i,n,r,a,l,o,d,c,h,m,p,u,C){var v=this.icn3d,g=v.icn3dui,f="",b=p?"clinvar":"snp",y=!1;for(var w in i){for(var S=0,_=i[w].length;S<_;++S)if(0==i[w][S]){y=!0;break}if(y)break}if(c){var A="ClinVar",x="SNP",k="",O="";y||void 0===v.organism||"human"===v.organism||"homo sapiens"===v.organism||(k=" <span style='color:#FFA500'>(from human)</span>",O=" <span style='color:#FFA500'>(based on human sequences and mapped to this structure by sequence similarity)</span>"),f+=p?'<div class="icn3d-seqTitle icn3d-link icn3d-blue icn3d-clinvar-path" clinvar="clinvar" posarray="'+d+'" shorttitle="'+'ClinVar" setname="'+h+"_"+'ClinVar" anno="sequence" chain="'+h+'" title="'+A+O+'">'+A+k+"</div>":'<div class="icn3d-seqTitle icn3d-link icn3d-blue" clinvar="clinvar" posarray="'+o+'" shorttitle="'+'SNP" setname="'+h+"_"+'SNP" anno="sequence" chain="'+h+'" title="'+x+O+'">'+x+k+"</div>"}else if(2==e&&p){var H=g.utilsCls.isMobile()?"none":"button";f+='<div id="'+v.pre+h+'_prevclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+H+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the previous ClinVar on structure">&lt; ClinVar</span></button></div>',f+='<div id="'+v.pre+h+'_nextclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+H+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the next ClinVar on structure">ClinVar &gt;</span></button></div>'}else f+='<div class="icn3d-seqTitle"></div>';var R=b,E=0,I=0,D={},T={};for(S=1,_=v.giSeq[h].length;S<=_;++S)if(void 0!==a[S]){++E;for(var M="",P=0,F=s[S].length;P<F&&!C;++P){for(var L=r[S][P].split("; "),N=l[S][P].split("; "),U="",q=0,j=L.length;q<j;++q)""!=L[q]&&"not specified"!=L[q]&&"not provided"!=L[q]&&(U+=L[q]+"("+N[q]+"); ");""!=U&&(D[S]="icn3d-clinvar",P==e-2&&(T[S]="icn3d-clinvar",-1!=U.indexOf("Pathogenic")&&(T[S]="icn3d-clinvar-path"))),M+=U+" | "}-1!=M.indexOf("Pathogenic")&&(D[S]="icn3d-clinvar-path"),"icn3d-clinvar"!=D[S]&&"icn3d-clinvar-path"!=D[S]||++I}if(0==E&&!p)return $("#"+v.pre+"dt_clinvar_"+h).html(""),$("#"+v.pre+"ov_clinvar_"+h).html(""),$("#"+v.pre+"tt_clinvar_"+h).html(""),$("#"+v.pre+"dt_snp_"+h).html(""),$("#"+v.pre+"ov_snp_"+h).html(""),$("#"+v.pre+"tt_snp_"+h).html(""),"";if(0==I&&p)return $("#"+v.pre+"dt_clinvar_"+h).html(""),$("#"+v.pre+"ov_clinvar_"+h).html(""),$("#"+v.pre+"tt_clinvar_"+h).html(""),"";var B=p?I:E;if(f+=1==e?'<span class="icn3d-residueNum" title="residue count">'+B+" Res</span>":'<span class="icn3d-residueNum"></span>',u)return f+"<br>";f+='<span class="icn3d-seqLine">';var z="",G=0,V=0;for(S=1,_=v.giSeq[h].length;S<=_;++S)if(m){if(void 0!==a[S]){var W=K=v.giSeq[h][S-1];K.length>1&&(W=K[0]+"..");var Y=(J=S>=v.matchedPos[h]&&S-1-v.matchedPos[h]<v.chainsSeq[h].length?v.chainsSeq[h][S-1-v.matchedPos[h]].resi:v.baseResi[h]+1+S-1)+W+">";for(M="",P=0,F=s[S].length;P<F;++P)if(Y+=s[S][P],!C){for(L=r[S][P].split("; "),N=l[S][P].split("; "),U="",q=0,j=L.length;q<j;++q)""!=L[q]&&"not specified"!=L[q]&&"not provided"!=L[q]&&(U+=L[q]+"("+N[q]+"); ");M+=U+" | "}f+=v.showSeqCls.insertGapOverview(h,S-1);var X=v.icn3dui.cfg.blast_rep_id==h?Math.round(v.seqAnnWidth*(S-1)/(v.maxAnnoLength+v.nTotalGap)-G-V):Math.round(v.seqAnnWidth*(S-1)/v.maxAnnoLength-G-V);p?"icn3d-clinvar"!=D[S]&&"icn3d-clinvar-path"!=D[S]||X>=0&&(f+='<div style="display:inline-block; width:'+X+'px;">&nbsp;</div>',f+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+Y+'">&nbsp;</div>',G+=X,V+=1):X>0&&(f+='<div style="display:inline-block; width:'+X+'px;">&nbsp;</div>',f+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+Y+'">&nbsp;</div>',G+=X,V+=1)}}else if(f+=v.showSeqCls.insertGap(h,S-1,"-"),void 0!==a[S])if(p||1!=e){var K;W=K=v.giSeq[h][S-1];K.length>1&&(W=K[0]+"..");var Q,J=S>=v.matchedPos[h]&&S-1-v.matchedPos[h]<v.chainsSeq[h].length?v.chainsSeq[h][S-1-v.matchedPos[h]].resi:v.baseResi[h]+1+S-1,Z="",ee=(Y="<div class='snptip'>",F=s[S].length,0),te=0;if(2==e&&(ee=0,te=F),p){Q=1;var se=0;for(P=ee;P<F&&P<te;++P){ie=h+"_"+J+"_"+s[S][P],H=g.utilsCls.isMobile()?"none":"button",ne=!0;v.residues.hasOwnProperty(h+"_"+J)||(ne=!1);for(L=r[S][P].split("; "),N=l[S][P].split("; "),U="",re=0,q=0,j=L.length;q<j;++q)""!=L[q]&&"not specified"!=L[q]&&"not provided"!=L[q]&&(re>0?U+="; ":0!==P&&1!==P||(z='disease="'+L[q]+'"'),U+=L[q]+"("+N[q]+")",++re);""!=U&&(se<Q&&(Z+=s[S][P]),Y+=J+W+">"+s[S][P],Y+=": "+U,ne&&(Y+="<br>"+v.showAnnoCls.addSnpButton(ie,"snpin3d","3D with scap","SNP in 3D with scap",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snpinter","Interactions","SNP Interactions in 3D",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snppdb","PDB","Download SNP PDB",35,H)),Y+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+n[S][P]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[S][P]+"' target='_blank'>dbSNP(rs"+i[S][P]+")</a>",P<F-1&&(Y+="<br><br>"),++se)}se>Q&&2==e&&(Z+="..")}else{Q=1;for(var P=ee;P<F&&P<te;++P){var ie=h+"_"+J+"_"+s[S][P],H=g.utilsCls.isMobile()?"none":"button",ne=!0;if(v.residues.hasOwnProperty(h+"_"+J)||(ne=!1),P<Q&&(Z+=s[S][P]),Y+=J+W+">"+s[S][P],C)ne&&(Y+="<br>"+v.showAnnoCls.addSnpButton(ie,"snpin3d","3D with scap","SNP in 3D with scap",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snpinter","Interactions","SNP Interactions in 3D",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snppdb","PDB","Download SNP PDB",35,H)),0!=i[S][P]&&(Y+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[S][P]+"' target='_blank'>dbSNP(rs"+i[S][P]+")</a>"),P<F-1&&(Y+="<br><br>");else{for(var L=r[S][P].split("; "),N=l[S][P].split("; "),U="",re=0,q=0,j=L.length;q<j;++q)""!=L[q]&&"not specified"!=L[q]&&"not provided"!=L[q]&&(re>0?U+="; ":0!==P&&1!==P||(z='disease="'+L[q]+'"'),U+=L[q]+"("+N[q]+")",++re);""!=U?(Y+=": "+U,ne&&(Y+="<br>"+v.showAnnoCls.addSnpButton(ie,"snpin3d","3D with scap","SNP in 3D with scap",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snpinter","Interactions","SNP Interactions in 3D",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snppdb","PDB","Download SNP PDB",35,H)),Y+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+n[S][P]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[S][P]+"' target='_blank'>dbSNP(rs"+i[S][P]+")</a>"):(ne&&(Y+="<br>"+v.showAnnoCls.addSnpButton(ie,"snpin3d","3D with scap","SNP in 3D with scap",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snpinter","Interactions","SNP Interactions in 3D",70,H)+"&nbsp;&nbsp;",Y+=v.showAnnoCls.addSnpButton(ie,"snppdb","PDB","Download SNP PDB",35,H)),Y+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+i[S][P]+"' target='_blank'>dbSNP(rs"+i[S][P]+")</a>"),P<F-1&&(Y+="<br><br>")}}F>Q&&2==e&&(Z+="..")}Y+="</div>",p?"icn3d-clinvar"==D[S]||"icn3d-clinvar-path"==D[S]?f+=1==e?"<span>&dArr;</span>":""==Z||" "==Z?"<span>-</span>":'<span id="'+R+"_"+v.pre+h+"_"+J+'" label title="'+Y+'" '+z+' class="icn3d-tooltip icn3d-residue '+T[S]+'">'+Z+"</span>":f+="<span>-</span>":f+=""==Z||" "==Z?"<span>-</span>":C?'<span id="'+R+"_"+v.pre+h+"_"+J+'" label title="'+Y+'" class="icn3d-tooltip icn3d-residue '+T[S]+'">'+Z+"</span>":'<span id="'+R+"_"+v.pre+h+"_"+J+'" label title="'+Y+'" '+z+' class="icn3d-tooltip icn3d-residue '+T[S]+'">'+Z+"</span>"}else f+="<span>&dArr;</span>";else f+="<span>-</span>";return f+=1==e?'<span class="icn3d-residueNum" title="residue count">&nbsp;'+B+" Residues</span>":'<span class="icn3d-residueNum"></span>',f+="</span>",f+="<br>"}processSnpClinvar(e,t,s,i,n){var r=this.icn3d;r.icn3dui;var a='<div id="'+r.pre+t+'_snpseq_sequence" class="icn3d-dl_sequence">',l=a,o=a,d='<div id="'+r.pre+t+'_clinvarseq_sequence" class="icn3d-dl_sequence">',c=d,h=d,m=!i||n?e.data:e.split("\n"),p={},u={},C={};void 0===r.resi2disease_nonempty[t]&&(r.resi2disease_nonempty[t]={});for(var v={},g={},f={},b={},y={},w="",S=0,_=m.length;S<_;++S)if(""!=m[S]){var A=!i||n?m[S]:m[S].split("\t"),x=A[3];if(x==w)continue;w=x;var k=x.substr(0,x.length-3),O=Math.round(k);x.substr(x.length-3,1);var H=x.substr(x.length-1,1),R=A[4],E=i?"":A[5],I=i?"":A[6],D=i?"":A[7];b[O+r.baseResi[t]]=1,""!=I&&(y[O+r.baseResi[t]]=1),u[O]=S+1,void 0===p[O]&&(p[O]=[]),p[O].push(H),void 0===g[O]&&(g[O]=[]),g[O].push(R),void 0===f[O]&&(f[O]=[]),f[O].push(E),void 0===C[O]&&(C[O]=[]),C[O].push(I),""!=I&&(void 0===r.resi2disease_nonempty[t][O]&&(r.resi2disease_nonempty[t][O]=[]),r.resi2disease_nonempty[t][O].push(I)),void 0===v[O]&&(v[O]=[]),v[O].push(D)}var T=Object.keys(b),M=Object.keys(y);if(i){var P=!1;a+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!1,P,void 0,i),a+=this.getSnpLine(2,2,p,g,f,C,u,v,T,M,0,t,!1,P,void 0,i),o+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!1,P,!0,i),o+=this.getSnpLine(2,2,p,g,f,C,u,v,T,M,0,t,!1,P,!0,i),l+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!0,P,void 0,i),a+="</div>",l+="</div>",o+="</div>",$("#"+r.pre+"dt_snp_"+t).html(a),$("#"+r.pre+"ov_snp_"+t).html(l),$("#"+r.pre+"tt_snp_"+t).html(o)}else P=!0,d+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!1,P,void 0,i),d+=this.getSnpLine(2,2,p,g,f,C,u,v,T,M,0,t,!1,P,void 0,i),h+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!1,P,!0,i),h+=this.getSnpLine(2,2,p,g,f,C,u,v,T,M,0,t,!1,P,!0,i),c+=this.getSnpLine(1,2,p,g,f,C,u,v,T,M,1,t,!0,P,void 0,i),d+="</div>",c+="</div>",h+="</div>",$("#"+r.pre+"dt_clinvar_"+t).html(d),$("#"+r.pre+"ov_clinvar_"+t).html(c),$("#"+r.pre+"tt_clinvar_"+t).html(h),this.navClinVar(t,s);r.showAnnoCls.enableHlSeq(),i?(r.bAjaxSnp=!0,void 0!==r.deferredSnp&&r.deferredSnp.resolve()):(r.bAjaxClinvar=!0,void 0!==r.deferredClinvar&&r.deferredClinvar.resolve())}showClinvarPart2(e,t,s){this.icn3d.icn3dui;var i=this,n="https://www.ncbi.nlm.nih.gov/Structure/vastdyn/vastdyn.cgi?chainid_clinvar="+t;$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(s){if(s&&s.data&&s.data.length>0){var n=s;i.processSnpClinvar(n,e,t,!1)}else i.processNoClinvar(e)},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):this.processNoClinvar(e)}})}showSnp(e,t){this.icn3d.icn3dui,this.showSnpClinvar(e,t,!0)}showClinvar(e,t){this.icn3d.icn3dui,this.showSnpClinvar(e,t,!1)}showSnpClinvar(e,t,s){var i=this.icn3d;i.icn3dui;var n=this,r=i.icn3dui.htmlCls.baseUrl+"vastdyn/vastdyn.cgi?chainid="+t;$.ajax({url:r,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(i){var r=i.snpgi,a=i.gi;if(s)n.showSnpPart2(e,t,r);else{var l=r;[6137708,1942289,224510717,2624886,253723219,2554905,75765331,3660278,312207882,319443632,342350956,1827805,109157826,1065265,40889086,6730307,163931185,494469,163931091,60594093,55669745,18655489,17942684,6980537,166235465,6435586,4139398,4389047,364506122,78101667,262118402,20664221,2624640,158430173,494395,28948777,34810587,13399647,3660342,261278854,342350965,384482350,378792570,15988303,213424334,4558333,2098365,10835631,3318817,374074330,332639529,122919696,4389286,319443573,2781341,67464020,194709238,210061039,364506106,28949044,40889076,161172338,17943181,4557976,62738484,365813173,6137343,350610552,17942703,576308,223674070,15826518,1310997,93279697,4139395,255311799,157837067,361132363,357380836,146387678,383280379,1127268,299856826,13786789,1311054,46015217,3402130,381353319,30750059,218766885,340707375,27065817,355333104,2624634,62738384,241913553,304446010].includes(a)&&(l=a),n.showClinvarPart2(e,t,l)}},error:function(t,i,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):s?n.processNoSnp(e):n.processNoClinvar(e)}})}showSnpPart2(e,t,s){this.icn3d.icn3dui;var i=this;if(void 0!==s){var n="https://www.ncbi.nlm.nih.gov/projects/SNP/beVarSearch.cgi?appname=iCn3D&format=bed&report=pdb2bed&connect=MSSNPSUBMISSION1&gi="+s;$.ajax({url:n,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(s){if(s){i.processSnpClinvar(s,e,t,!0)}else{var n="https://www.ncbi.nlm.nih.gov/Structure/vastdyn/vastdyn.cgi?chainid_snp="+t;$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(s){if(s&&s.data&&s.data.length>0){i.processSnpClinvar(s,e,t,!0,!0)}else i.processNoSnp(e)},error:function(t,s,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):i.processNoSnp(e)}})}},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):this.processNoSnp(e)}})}else this.processNoSnp(e),console.log("No gi was found for the chain "+t+"...")}processNoClinvar(e){var t=this.icn3d;t.icn3dui,console.log("No ClinVar data were found for the protein "+e+"..."),$("#"+t.pre+"dt_clinvar_"+e).html(""),$("#"+t.pre+"ov_clinvar_"+e).html(""),t.showAnnoCls.enableHlSeq(),t.bAjaxClinvar=!0,void 0!==t.deferredClinvar&&t.deferredClinvar.resolve()}processNoSnp(e){var t=this.icn3d;t.icn3dui,console.log("No SNP data were found for the protein "+e+"..."),$("#"+t.pre+"dt_snp_"+e).html(""),$("#"+t.pre+"ov_snp_"+e).html(""),t.showAnnoCls.enableHlSeq(),t.bAjaxSnp=!0,void 0!==t.deferredSnp&&t.deferredSnp.resolve()}}class Ee{constructor(e){this.icn3d=e}showTransmem(e,t){var s=this.icn3d;s.icn3dui;var i=this;void 0===s.ssbondpnts?setTimeout((function(){i.showTransmem_base(e,t)}),1e3):this.showTransmem_base(e,t)}showTransmem_base(e,t){var s=this.icn3d;s.icn3dui;var i={};for(var n in s.chains[t]){var r=s.atoms[n];if(r.coord.z<s.halfBilayerSize&&r.coord.z>-s.halfBilayerSize)i[r.structure+"_"+r.chain+"_"+r.resi]=1}var a=Object.keys(i);s.annoCddSiteCls.showAnnoType(e,t,"transmem","Transmembrane domain",a)}}class Ie{constructor(e){this.icn3d=e}hideAllAnno(){var e=this.icn3d;e.icn3dui,this.hideAllAnnoBase(),$("[id^="+e.pre+"custom]").hide()}hideAllAnnoBase(){this.icn3d.icn3dui,this.setAnnoSeqBase(!1)}setAnnoSeqBase(e){var t=this.icn3d;t.icn3dui;var s=["site","snp","clinvar","cdd","domain","interaction","ssbond","crosslink","transmem"];for(var i in s){var n=s[i];e?$("[id^="+t.pre+n+"]").show():$("[id^="+t.pre+n+"]").hide()}}setAnnoTabBase(e){var t=this.icn3d;t.icn3dui;var s=["all","binding","snp","clinvar","cdd","3dd","interact","custom","ssbond","crosslink","transmem"];for(var i in s){var n=s[i];$("#"+t.pre+"anno_"+n).length&&($("#"+t.pre+"anno_"+n)[0].checked=e)}}setAnnoTabAll(){this.icn3d.icn3dui,this.setAnnoTabBase(!0),this.setAnnoSeqBase(!0),this.updateClinvar(),this.updateSnp(),this.updateDomain(),this.updateInteraction(),this.updateSsbond(),this.updateCrosslink(),this.updateTransmem()}hideAnnoTabAll(){this.icn3d.icn3dui,this.setAnnoTabBase(!1),this.hideAllAnno()}resetAnnoAll(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"dt_]").html(""),$("[id^="+e.pre+"tt_]").html(""),$("[id^="+e.pre+"ov_]").html(""),e.showAnnoCls.processSeqData(e.chainid_seq),this.setAnnoViewAndDisplay("detailed view"),this.resetAnnoTabAll()}resetAnnoTabAll(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"anno_binding").length&&$("#"+e.pre+"anno_binding")[0].checked&&$("[id^="+e.pre+"site]").show(),$("#"+e.pre+"anno_snp").length&&$("#"+e.pre+"anno_snp")[0].checked&&($("[id^="+e.pre+"snp]").show(),e.bSnpShown=!1,this.updateSnp()),$("#"+e.pre+"anno_clinvar").length&&$("#"+e.pre+"anno_clinvar")[0].checked&&($("[id^="+e.pre+"clinvar]").show(),e.bClinvarShown=!1,this.updateClinvar()),$("#"+e.pre+"anno_cdd").length&&$("#"+e.pre+"anno_cdd")[0].checked&&$("[id^="+e.pre+"cdd]").show(),$("#"+e.pre+"anno_3dd").length&&$("#"+e.pre+"anno_3dd")[0].checked&&($("[id^="+e.pre+"domain]").show(),e.bDomainShown=!1,this.updateDomain()),$("#"+e.pre+"anno_interact").length&&$("#"+e.pre+"anno_interact")[0].checked&&($("[id^="+e.pre+"interaction]").show(),e.bInteractionShown=!1,this.updateInteraction()),$("#"+e.pre+"anno_custom").length&&$("#"+e.pre+"anno_custom")[0].checked&&$("[id^="+e.pre+"custom]").show(),$("#"+e.pre+"anno_ssbond").length&&$("#"+e.pre+"anno_ssbond")[0].checked&&($("[id^="+e.pre+"ssbond]").show(),e.bSSbondShown=!1,this.updateSsbond()),$("#"+e.pre+"anno_crosslink").length&&$("#"+e.pre+"anno_crosslink")[0].checked&&($("[id^="+e.pre+"crosslink]").show(),e.bCrosslinkShown=!1,this.updateCrosslink()),$("#"+e.pre+"anno_transmem").length&&$("#"+e.pre+"anno_transmem")[0].checked&&($("[id^="+e.pre+"transmem]").show(),e.bTranememShown=!1,this.updateTransmem())}setAnnoTabCustom(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"custom]").show(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!0)}hideAnnoTabCustom(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"custom]").hide(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!1)}setAnnoTabClinvar(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"clinvar]").show(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!0),this.updateClinvar()}hideAnnoTabClinvar(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"clinvar]").hide(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!1)}setAnnoTabSnp(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").show(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!0),this.updateSnp()}hideAnnoTabSnp(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"snp]").hide(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!1)}setAnnoTabCdd(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"cdd]").show(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!0)}hideAnnoTabCdd(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"cdd]").hide(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!1)}setAnnoTab3ddomain(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"domain]").show(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!0),this.updateDomain()}hideAnnoTab3ddomain(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"domain]").hide(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!1)}setAnnoTabSite(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"site]").show(),$("[id^="+e.pre+"feat]").show(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!0)}hideAnnoTabSite(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"site]").hide(),$("[id^="+e.pre+"feat]").hide(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!1)}setAnnoTabInteraction(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"interaction]").show(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!0),this.updateInteraction()}hideAnnoTabInteraction(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"interaction]").hide(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!1)}setAnnoTabSsbond(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"ssbond]").show(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!0),this.updateSsbond()}hideAnnoTabSsbond(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"ssbond]").hide(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!1)}setAnnoTabCrosslink(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"crosslink]").show(),$("#"+e.pre+"anno_crosslink").length&&($("#"+e.pre+"anno_crosslink")[0].checked=!0),this.updateCrosslink()}hideAnnoTabCrosslink(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"crosslink]").hide(),$("#"+e.pre+"anno_crosslink").length&&($("#"+e.pre+"anno_crosslink")[0].checked=!1)}setAnnoTabTransmem(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"transmem]").show(),$("#"+e.pre+"anno_transmem").length&&($("#"+e.pre+"anno_transmem")[0].checked=!0),this.updateTransmem()}hideAnnoTabTransmem(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"transmem]").hide(),$("#"+e.pre+"anno_transmem").length&&($("#"+e.pre+"anno_transmem")[0].checked=!1)}setTabs(){var e=this.icn3d,t=e.icn3dui,s=this;$("#"+e.pre+"dl_addtrack_tabs").tabs(),$("#"+e.pre+"dl_anno_view_tabs").tabs(),t.myEventCls.onIds("#"+e.pre+"anno_all","click",(function(t){$("#"+e.pre+"anno_all")[0].checked?(s.setAnnoTabAll(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation all",!0)):(s.hideAnnoTabAll(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation all",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_binding","click",(function(t){$("#"+e.pre+"anno_binding")[0].checked?(s.setAnnoTabSite(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation site",!0)):(s.hideAnnoTabSite(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation site",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_snp","click",(function(t){$("#"+e.pre+"anno_snp")[0].checked?(s.setAnnoTabSnp(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation snp",!0)):(s.hideAnnoTabSnp(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation snp",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_clinvar","click",(function(t){$("#"+e.pre+"anno_clinvar")[0].checked?(s.setAnnoTabClinvar(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation clinvar",!0)):(s.hideAnnoTabClinvar(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation clinvar",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_cdd","click",(function(e){s.clickCdd()})),t.myEventCls.onIds("#"+e.pre+"anno_3dd","click",(function(t){$("#"+e.pre+"anno_3dd")[0].checked?(s.setAnnoTab3ddomain(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation 3ddomain",!0)):(s.hideAnnoTab3ddomain(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation 3ddomain",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_interact","click",(function(t){$("#"+e.pre+"anno_interact")[0].checked?(s.setAnnoTabInteraction(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation interaction",!0)):(s.hideAnnoTabInteraction(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation interaction",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_custom","click",(function(t){$("#"+e.pre+"anno_custom")[0].checked?(s.setAnnoTabCustom(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation custom",!0)):(s.hideAnnoTabCustom(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation custom",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_ssbond","click",(function(t){$("#"+e.pre+"anno_ssbond")[0].checked?(s.setAnnoTabSsbond(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation ssbond",!0)):(s.hideAnnoTabSsbond(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation ssbond",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_crosslink","click",(function(t){$("#"+e.pre+"anno_crosslink")[0].checked?(s.setAnnoTabCrosslink(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation crosslink",!0)):(s.hideAnnoTabCrosslink(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation crosslink",!0))})),t.myEventCls.onIds("#"+e.pre+"anno_transmem","click",(function(t){$("#"+e.pre+"anno_transmem").length&&$("#"+e.pre+"anno_transmem")[0].checked?(s.setAnnoTabTransmem(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation transmembrane",!0)):(s.hideAnnoTabTransmem(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation transmembrane",!0))}))}clickCdd(){var e=this.icn3d;e.icn3dui,$("[id^="+e.pre+"cdd]").length>0&&($("#"+e.pre+"anno_cdd")[0].checked?(this.setAnnoTabCdd(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("set annotation cdd",!0)):(this.hideAnnoTabCdd(),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide annotation cdd",!0)))}showAnnoSelectedChains(){var e=this.icn3d,t=e.icn3dui,s={};for(var i in e.hAtoms){s[n=(r=e.atoms[i]).structure+"_"+r.chain]=1}for(var n in $("#"+e.pre+"dl_annotations > .icn3d-annotation").hide(),s){var r;if($("#"+e.pre+"anno_"+n).length&&$("#"+e.pre+"anno_"+n).show(),void 0!==(r=e.firstAtomObjCls.getFirstCalphaAtomObj(e.chains[n])).resn){var a=t.utilsCls.residueName2Abbr(r.resn.substr(0,3));$("#"+e.pre+"anno_"+a).show()}}}showAnnoAllChains(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_annotations > .icn3d-annotation").show()}setAnnoView(e){var t=this.icn3d;t.icn3dui,"detailed view"===e?(t.view="detailed view",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",1)):(t.view="overview",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",0))}setAnnoDisplay(e,t){var s=this.icn3d;s.icn3dui;var i=["giseq","custom","site","snp","clinvar","cdd","domain","interaction","ssbond","crosslink","transmem"];for(var n in i){var r=i[n];$("[id^="+s.pre+t+"_"+r+"]").attr("style",e)}}showFixedTitle(){this.icn3d.icn3dui;this.setAnnoDisplay("display:block;","tt")}hideFixedTitle(){this.icn3d.icn3dui;this.setAnnoDisplay("display:none!important;","tt")}setAnnoViewAndDisplay(e){var t=this.icn3d;if(t.icn3dui,"detailed view"===e){this.setAnnoView("detailed view");var s="display:block;";this.setAnnoDisplay(s,"dt"),$("#"+t.pre+"seqguide_wrapper").attr("style",s),s="display:none;",this.setAnnoDisplay(s,"ov")}else{this.setAnnoView("overview"),this.hideFixedTitle();s="display:none;";this.setAnnoDisplay(s,"dt"),$("#"+t.pre+"seqguide_wrapper").attr("style",s),s="display:block;",this.setAnnoDisplay(s,"ov")}}updateClinvar(){var e=this.icn3d;if(e.icn3dui,void 0===e.bClinvarShown||!e.bClinvarShown)for(var t in e.protein_chainid){var s=e.protein_chainid[t];e.annoSnpClinVarCls.showClinvar(t,s)}e.bClinvarShown=!0}updateSnp(){var e=this.icn3d;if(e.icn3dui,void 0===e.bSnpShown||!e.bSnpShown)for(var t in e.protein_chainid){var s=e.protein_chainid[t];e.annoSnpClinVarCls.showSnp(t,s)}e.bSnpShown=!0}updateDomain(){var e=this.icn3d;e.icn3dui,void 0!==e.bDomainShown&&e.bDomainShown||e.annoDomainCls.showDomainAll(),e.bDomainShown=!0}updateInteraction(){var e=this.icn3d;if(e.icn3dui,void 0===e.bInteractionShown||!e.bInteractionShown)for(var t in e.interactChainbase){var s=e.interactChainbase[t];e.annoContactCls.showInteraction(t,s)}e.bInteractionShown=!0}updateSsbond(){var e=this.icn3d;if(e.icn3dui,void 0===e.bSSbondShown||!e.bSSbondShown)for(var t in e.ssbondChainbase){var s=e.ssbondChainbase[t];e.annoSsbondCls.showSsbond(t,s)}e.bSSbondShown=!0}updateCrosslink(){var e=this.icn3d;if(e.icn3dui,void 0===e.bCrosslinkShown||!e.bCrosslinkShown)for(var t in e.crosslinkChainbase){var s=e.crosslinkChainbase[t];e.annoCrossLinkCls.showCrosslink(t,s)}e.bCrosslinkShown=!0}updateTransmem(){var e=this.icn3d;if(e.icn3dui,void 0===e.bTranememShown||!e.bTranememShown)for(var t in e.protein_chainid){var s=e.protein_chainid[t];e.annoTransMemCls.showTransmem(t,s)}e.bTranememShown=!0}}class De{constructor(e){this.icn3d=e}draw2Ddgm(e,t,s,i){var n=this.icn3d;n.icn3dui,t=t.substr(0,4);var r=.5,a={},l={},o={},d={},c={};if(void 0===e)return"";for(var h in e.moleculeInfor){var m="#"+("000000"+e.moleculeInfor[h].color.toString(16)).slice(-6),p=e.moleculeInfor[h].chain.trim();void 0===c[p]?c[p]=1:++c[p];var u=1===c[p]?p:p+c[p].toString(),C=t+"_"+u;void 0!==n.mmdbid_q&&n.mmdbid_q===n.mmdbid_t&&0===s&&(C=t+n.icn3dui.htmlCls.postfix+"_"+u),a[h]=C,l[h]=m,o[h]=e.moleculeInfor[h].name,d[C]=h}if(void 0===i||!i)for(var v=0,g=e.intracResidues.length;v<g;++v){var f=e.intracResidues[v],b=0;for(var h in f){C=a[h],0===b?fe=C:be=C,++b}if(void 0!==fe&&void 0!==be)for(var h in b=0,f){var y,w,S=f[h];0===b?(y=fe,w=be):(y=be,w=fe),void 0===n.chainids2resids[y]&&(n.chainids2resids[y]={}),void 0===n.chainids2resids[y][w]&&(n.chainids2resids[y][w]=[]);for(var _=0,A=S.length;_<A;++_){var x=S[_],k=n.mmdbMolidResid2mmdbChainResi[t.toUpperCase()+"_"+h+"_"+x];n.chainids2resids[y][w].push(k)}if(void 0===n.chainname2residues&&(n.chainname2residues={}),be=w,n.chains.hasOwnProperty(be)){var O,H=n.firstAtomObjCls.getFirstCalphaAtomObj(n.chains[be]);n.chemicals.hasOwnProperty(H.serial)?O="chemical":n.nucleotides.hasOwnProperty(H.serial)?O="nucleotide":n.ions.hasOwnProperty(H.serial)?O="ion":n.proteins.hasOwnProperty(H.serial)?O="protein":n.water.hasOwnProperty(H.serial)&&(O="water");var R=be.substr(be.indexOf("_")+1)+"("+O+")";void 0===n.chainname2residues[y]&&(n.chainname2residues[y]={}),n.chainname2residues[y][R]=n.chainids2resids[y][w],++b}}}var E="<div id='#"+n.pre+t+"'>";E+="<b>"+t.toUpperCase()+"</b><br/>",E+="<svg viewBox='0,0,150,150'>";var I={},D=[],T="",M="",P={};if(i)for(var v in n.dAtoms){P[h=d[C=(ce=n.atoms[v]).structure+"_"+ce.chain]]=1}var F=Object.keys(e.moleculeInfor),L=Object.keys(e.intrac),N=[];for(v=0,g=F.length;v<g;++v)-1===L.indexOf(F[v])&&N.push(F[v]);var U={};if(N.length>0)for(var h in e.intrac){for(v=0,g=(Z=e.intrac[h]).intrac.length;v<g;++v){var q=Z.intrac[v].toString();-1!==N.indexOf(q)&&(void 0===U[q]&&(U[q]=[]),U[q].push(h),D.push([q,h]))}if("rect"===Z.shape){var j=Z.coords[0]*r,B=Z.coords[1]*r,z=Z.coords[2]*r-j,G=Z.coords[3]*r-B;I[h]=[j+z/2,B+G/2]}else if("circle"===Z.shape){j=Z.coords[0]*r,B=Z.coords[1]*r;Z.coords[2],I[h]=[j,B]}else if("poly"===Z.shape){var V=Z.coords[0]*r;Z.coords[1];var W=Z.coords[2]*r,Y=Z.coords[3]*r,X=Z.coords[4]*r,K=Z.coords[5]*r;Z.coords[6],Z.coords[7];j=V,B=Y;I[h]=[V,Y]}}for(var Q=0,J=(b=0,F.length);b<J;++b){C=a[h=F[b]];if(!i||P.hasOwnProperty(h)){var Z=e.intrac[h],ee=(m="#FFFFFF",l[h]);if(void 0!==C&&void 0!==n.chains[C]){var te=Object.keys(n.chains[C]);te.length>0&&(ee="#"+n.atoms[te[0]].color.getHexString().toUpperCase())}var se="";n.bInitial&&void 0!==s&&(void 0!==n.alignmolid2color&&n.alignmolid2color[s].hasOwnProperty(h)?(se=n.alignmolid2color[s][h],ee="#FF0000"):ee="#FFFFFF");var ie=o[h],ne=" ",re=" ";if(void 0!==C){var ae=C.indexOf("_");ne=(re=C.substr(ae+1)).length>1?re.substr(0,1)+"..":re}else C="Misc";void 0===ee&&(ee="#FFFFFF");var le=1;if(n.bInitial&&void 0!==n.alnChains[C]){var oe=0;for(var v in n.alnChains[C]){var de=n.atoms[v].color.getHexString().toUpperCase();"FF0000"!==de&&"00FF00"!==de||++oe}le=1*oe/Object.keys(n.chains[C]).length}if(le<.2&&(le=.2),-1===N.indexOf(h)){for(v=0,g=Z.intrac.length;v<g;++v)parseInt(h)<parseInt(Z.intrac[v])&&D.push([h,Z.intrac[v]]);if("rect"===Z.shape){j=Z.coords[0]*r,B=Z.coords[1]*r,z=Z.coords[2]*r-j,G=Z.coords[3]*r-B;T+=this.draw2DNucleotide(j+.5*z,B+.5*G,C,re,ne,ie,se,m,ee,r,le),I[h]=[j+z/2,B+G/2]}else if("circle"===Z.shape){j=Z.coords[0]*r,B=Z.coords[1]*r;T+=this.draw2DProtein(j,B,C,re,ne,ie,se,m,ee,r,le),I[h]=[j,B]}else if("poly"===Z.shape){V=Z.coords[0]*r;Z.coords[1];W=Z.coords[2]*r,Y=Z.coords[3]*r,X=Z.coords[4]*r,K=Z.coords[5]*r;Z.coords[6],Z.coords[7];j=V,B=Y;var ce=n.firstAtomObjCls.getFirstAtomObj(n.chains[C]);M+=this.draw2DChemical(j,B,C,re,ne,ie,se,m,ee,r,le),I[h]=[V,Y]}}else{var he,me;if(void 0!==U[h]&&U[h].length>1){var pe=0,ue=0;for(_=0,A=U[h].length;_<A;++_){q=U[h][_];if(I.hasOwnProperty(q)){var Ce=I[q];pe+=Ce[0],ue+=Ce[1]}}he=pe/U[h].length,me=ue/U[h].length}else{Q<5?(he=50*(Q+1)*r,me=15):Q-5<5?(he=15,me=50*(Q-5+1)*r):me=he=37.5,++Q}j=he,B=me,ce=n.firstAtomObjCls.getFirstAtomObj(n.chains[C]);M+=this.draw2DChemical(j,B,C,re,ne,ie,se,m,ee,r,le,!0),I[h]=[j,B]}}}for(v=0,g=D.length;v<g;++v){f=D[v];if(!i||P.hasOwnProperty(f[0])&&P.hasOwnProperty(f[1])){var ve=I[parseInt(f[0])],ge=I[parseInt(f[1])];if(void 0!==ve&&void 0!==ge){var fe,be;fe=a[f[0]],be=a[f[1]];var ye=fe.indexOf("_"),we=be.indexOf("_"),Se=fe.substr(ye+1),_e=be.substr(we+1),Ae=(W=ve[0],Y=ve[1],.5*(W+(X=ge[0]))),xe=.5*(Y+(K=ge[1]));E+="<g class='icn3d-interaction' chainid1='"+fe+"' chainid2='"+be+"' >",E+="<title>Interaction of chain "+Se+" with chain "+_e+"</title>",E+="<line x1='"+W+"' y1='"+Y+"' x2='"+Ae+"' y2='"+xe+"' stroke='"+"#000000' stroke-width='2' /></g>",E+="<g class='icn3d-interaction' chainid1='"+be+"' chainid2='"+fe+"' >",E+="<title>Interaction of chain "+_e+" with chain "+Se+"</title>",E+="<line x1='"+Ae+"' y1='"+xe+"' x2='"+X+"' y2='"+K+"' stroke='"+"#000000' stroke-width='2' /></g>"}}}return E+=M+T,E+="</svg>",E+="</div>",n.html2ddgm+=E,$("#"+n.pre+"dl_2ddgm").html(n.html2ddgm),E}set2DdgmNote(e){var t="<div style='width:150px'><b>Nodes</b>:<br>";return this.icn3d.icn3dui.utilsCls.isMac()?(t+="<span style='margin-right:18px;'>&#9711;</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9826;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"):(t+="<span style='margin-right:18px;'>O</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9671;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"),t+="<br><b>Lines</b>:<br> Interactions at 4 &#197;<br>",e&&(t+="<b>Numbers in red</b>:<br> Aligned chains"),t+="</div><br/>"}highlightNode(e,t,s,i){var n=this.icn3d;n.icn3dui,i<.2&&(i=.2);if("rect"===e){$(t).attr("stroke",n.icn3dui.htmlCls.ORANGE),$(t).attr("stroke-width",3);var r=Number($(s).attr("x")),a=Number($(s).attr("y")),l=Number($(s).attr("width")),o=Number($(s).attr("height"));$(t).attr("x",r+l/2*(1-i)),$(t).attr("y",a+o/2*(1-i)),$(t).attr("width",l*i),$(t).attr("height",o*i)}else if("circle"===e)$(t).attr("stroke",n.icn3dui.htmlCls.ORANGE),$(t).attr("stroke-width",3),$(t).attr("r",Number($(s).attr("r"))*i);else if("polygon"===e){$(t).attr("stroke",n.icn3dui.htmlCls.ORANGE),$(t).attr("stroke-width",3);r=Number($(s).attr("x")),a=Number($(s).attr("y"));var d=Number($(s).attr("x0d")),c=Number($(s).attr("y0d")),h=Number($(s).attr("x1d")),m=Number($(s).attr("y1d")),p=Number($(s).attr("x2d")),u=Number($(s).attr("y2d")),C=Number($(s).attr("x3d")),v=Number($(s).attr("y3d"));$(t).attr("points",(r+d*i).toString()+", "+(a+c*i).toString()+", "+(r+h*i).toString()+", "+(a+m*i).toString()+", "+(r+p*i).toString()+", "+(a+u*i).toString()+", "+(r+C*i).toString()+", "+(a+v*i).toString())}}removeLineGraphSelection(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_linegraph circle").attr("stroke","#000000"),$("#"+e.pre+"dl_linegraph circle").attr("stroke-width",1),$("#"+e.pre+"dl_linegraph svg line.icn3d-hlline").attr("stroke","#FFF")}removeScatterplotSelection(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_scatterplot circle").attr("stroke","#000000"),$("#"+e.pre+"dl_scatterplot circle").attr("stroke-width",1),$("#"+e.pre+"dl_scatterplot rect").attr("stroke","#000000"),$("#"+e.pre+"dl_scatterplot rect").attr("stroke-width",1)}click2Ddgm(){var e=this.icn3d,t=e.icn3dui,s=this;$(document).on("click","#"+e.pre+"dl_2ddgm .icn3d-node",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");var n=$(this).attr("chainid");i.bCtrl||i.bShift||(i.selectionCls.removeSelection(),i.lineArray2d=[]);var r=1;void 0!==i.alnChains[n]&&(r=1*Object.keys(i.alnChains[n]).length/Object.keys(i.chains[n]).length);var a=$(this).find("rect[class='icn3d-hlnode']"),l=$(this).find("rect[class='icn3d-basenode']");s.highlightNode("rect",a,l,r),a=$(this).find("circle[class='icn3d-hlnode']"),l=$(this).find("circle[class='icn3d-basenode']"),s.highlightNode("circle",a,l,r),a=$(this).find("polygon[class='icn3d-hlnode']"),l=$(this).find("polygon[class='icn3d-basenode']"),s.highlightNode("polygon",a,l,r),i.bCtrl||i.bShift?i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.chains[n]):i.hAtoms=t.hashUtilsCls.cloneHash(i.chains[n]),i.bCtrl||i.bShift?(void 0===i.chainArray2d&&(i.chainArray2d=[]),i.chainArray2d.push(n)):i.chainArray2d=[n],i.hlUpdateCls.updateHlAll(i.chainArray2d),i.annotationCls.showAnnoSelectedChains();var o="select chain "+n;i.icn3dui.htmlCls.clickMenuCls.setLogCmd(o,!0),i.bSelectResidue=!1})),$(document).on("click","#"+e.pre+"dl_2ddgm .icn3d-interaction",(function(e){var t=s.icn3d;e.stopImmediatePropagation(),Object.keys(t.hAtoms).length<Object.keys(t.atoms).length&&t.definedSetsCls.setMode("selection"),t.bClickInteraction=!0;var i=$(this).attr("chainid1"),n=$(this).attr("chainid2");$(this).find("line").attr("stroke",t.icn3dui.htmlCls.ORANGE),s.selectInteraction(i,n),t.annotationCls.showAnnoSelectedChains();var r="select interaction "+i+","+n;t.icn3dui.htmlCls.clickMenuCls.setLogCmd(r,!0),t.bClickInteraction=!1})),$(document).on("click","#"+e.pre+"dl_linegraph .icn3d-node",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");var n=$(this).attr("resid");i.bCtrl||i.bShift||(i.hAtoms={},s.removeLineGraphSelection());$(this).find("circle").attr("stroke",i.icn3dui.htmlCls.ORANGE),$(this).find("circle").attr("stroke-width",2),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[n]);var r="select "+i.resid2specCls.residueids2spec([n]);i.hlUpdateCls.updateHlAll(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd(r,!0),i.bSelectResidue=!1})),$(document).on("click","#"+e.pre+"dl_scatterplot .icn3d-node",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");var n=$(this).attr("resid");i.bCtrl||i.bShift||(i.hAtoms={},s.removeScatterplotSelection());$(this).find("circle").attr("stroke",i.icn3dui.htmlCls.ORANGE),$(this).find("circle").attr("stroke-width",2),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[n]);var r="select "+i.resid2specCls.residueids2spec([n]);i.hlUpdateCls.updateHlAll(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd(r,!0),i.bSelectResidue=!1})),$(document).on("click","#"+e.pre+"dl_linegraph .icn3d-interaction",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");var n=$(this).attr("resid1"),r=$(this).attr("resid2");i.bCtrl||i.bShift||(i.hAtoms={},s.removeLineGraphSelection()),$(this).find("line.icn3d-hlline").attr("stroke",i.icn3dui.htmlCls.ORANGE),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[n]),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[r]);var a="select "+i.resid2specCls.residueids2spec([n,r]);i.hlUpdateCls.updateHlAll(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd(a,!0)})),$(document).on("click","#"+e.pre+"dl_scatterplot .icn3d-interaction",(function(e){var i=s.icn3d;e.stopImmediatePropagation(),Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&i.definedSetsCls.setMode("selection");var n=$(this).attr("resid1"),r=$(this).attr("resid2");i.bCtrl||i.bShift||(i.hAtoms={},s.removeScatterplotSelection());$(this).find("rect").attr("stroke",i.icn3dui.htmlCls.ORANGE),$(this).find("rect").attr("stroke-width",2),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[n]),i.hAtoms=t.hashUtilsCls.unionHash(i.hAtoms,i.residues[r]);var a="select "+i.resid2specCls.residueids2spec([n,r]);i.hlUpdateCls.updateHlAll(),i.icn3dui.htmlCls.clickMenuCls.setLogCmd(a,!0)}))}selectInteraction(e,t){var s=this.icn3d;s.icn3dui,s.hlUpdateCls.removeHl2D(),s.hlObjectsCls.removeHlObjects(),s.bCtrl||s.bShift?(void 0===s.lineArray2d&&(s.lineArray2d=[]),s.lineArray2d.push(e),s.lineArray2d.push(t)):s.lineArray2d=[e,t],this.selectInteractionAtoms(e,t),s.hlObjectsCls.addHlObjects(),s.hlUpdateCls.updateHlAll()}selectInteractionAtoms(e,t){var s,i,n=this.icn3d,r=n.icn3dui,a=n.chainids2resids[e][t];n.bCtrl||n.bShift||(n.hAtoms={});for(var l=0,o=a.length;l<o;++l)n.hAtoms=r.hashUtilsCls.unionHash(n.hAtoms,n.residues[a[l]]);if(Object.keys(n.structures).length>1)s="inter_"+e+"_"+t;else{var d=e.indexOf("_"),c=t.indexOf("_");s="inter_"+e.substr(d+1)+"_"+t.substr(c+1)}i="select the atoms in chain "+e+" interacting with chain "+t+" in a distance of 4 angstrom";var h="select interaction "+e+","+t;n.selectionCls.addCustomSelection(a,s,i,h,!0)}draw2DProtein(e,t,s,i,n,r,a,l,o,d,c){this.icn3d.icn3dui;var h=20*d,m="<g class='icn3d-node' chainid='"+s+"' >";return m+="<title>Chain "+i+": "+r+"</title>",m+="<circle class='icn3d-basenode' cx='"+e+"' cy='"+t+"' r='"+h+"' fill='"+l+"' stroke-width='1' stroke='"+"#000000' class='icn3d-node' chainid='"+s+"' />",m+="<circle class='icn3d-hlnode' cx='"+e+"' cy='"+t+"' r='"+(h*c).toString()+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' />",m+="<text x='"+(e-0).toString()+"' y='"+(t+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+n+"</text>",""!==a&&(m+="<text x='"+(e-0).toString()+"' y='"+(t+h+4+6).toString()+"' style='fill:"+o+"; font-size:8; font-weight:bold; text-anchor:middle' >"+a+"</text>"),m+="</g>"}draw2DNucleotide(e,t,s,i,n,r,a,l,o,d,c){this.icn3d.icn3dui;var h=30*d,m=30*d,p="<g class='icn3d-node' chainid='"+s+"' >";return p+="<title>Chain "+i+": "+r+"</title>",p+="<rect class='icn3d-basenode' x='"+(e-=.5*h)+"' y='"+(t-=.5*m)+"' width='"+h+"' height='"+m+"' fill='"+l+"' stroke-width='1' stroke='"+"#000000' />",p+="<rect class='icn3d-hlnode' x='"+(e+h/2*(1-c)).toString()+"' y='"+(t+m/2*(1-c)).toString()+"' width='"+(h*c).toString()+"' height='"+(m*c).toString()+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' />",p+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+m/2+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+n+"</text>",""!==a&&(p+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+m+4+6).toString()+"' style='fill:"+o+"; font-size:8; font-weight:bold; text-anchor:middle' >"+a+"</text>"),p+="</g>"}draw2DChemical(e,t,s,i,n,r,a,l,o,d,c,h){this.icn3d.icn3dui;var m,p,u,C,v,g,f,b,y,w,S=30*d;h?(m=e-(y=.5*S/Math.sqrt(3)),p=t-(w=.5*S),u=e+3*y,C=t-w,v=e+y,g=t+w,f=e-3*y,b=t+w):(m=e-(y=.5*S),p=t,u=e,C=t+(w=.5*S),v=e+y,g=t,f=e,b=t-w);var _=m-e,A=p-t,x=u-e,k=C-t,O=v-e,H=g-t,R=f-e,E=b-t,I="<g class='icn3d-node' chainid='"+s+"' >";return I+="<title>Chain "+i+": "+r+"</title>",I+="<polygon class='icn3d-basenode' points='"+m+", "+p+","+u+", "+C+","+v+", "+g+","+f+", "+b+"' x='"+e+"' y='"+t+"' x0d='"+_+"' y0d='"+A+"' x1d='"+x+"' y1d='"+k+"' x2d='"+O+"' y2d='"+H+"' x3d='"+R+"' y3d='"+E+"' fill='"+l+"' stroke-width='1' stroke='"+"#000000' />",I+="<polygon class='icn3d-hlnode' points='"+(e+_*c).toString()+", "+(t+A*c).toString()+","+(e+x*c).toString()+", "+(t+k*c).toString()+","+(e+O*c).toString()+", "+(t+H*c).toString()+","+(e+R*c).toString()+", "+(t+E*c).toString()+"' fill='"+o+"' stroke-width='1' stroke='"+"#000000' />",I+="<text x='"+(e+1).toString()+"' y='"+(t+2).toString()+"' style='fill:#000000; font-size:8; text-anchor:middle' >"+n+"</text>",""!==a&&(I+="<text x='"+(e+1).toString()+"' y='"+(t+2+6).toString()+"' style='fill:"+o+"; font-size:8; font-weight:bold; text-anchor:middle' >"+a+"</text>"),I+="</g>"}}class Te{constructor(e){this.icn3d=e}update2DdgmContent(){var e=this.icn3d;e.icn3dui;var t="";void 0!==e.icn3dui.cfg.mmdbid||void 0!==e.icn3dui.cfg.gi?(t+=e.diagram2dCls.draw2Ddgm(e.interactionData,e.inputid,void 0,!0),t+=e.diagram2dCls.set2DdgmNote(),$("#"+e.pre+"dl_2ddgm").html(t)):e.mmdbidArray&&(void 0!==e.icn3dui.cfg.align||void 0!==e.icn3dui.cfg.chainalign||e.bRealign)&&(t+=e.diagram2dCls.draw2Ddgm(e.interactionData1,e.mmdbidArray[0].toUpperCase(),0,!0),void 0!==e.mmdbid_q&&e.mmdbid_q===e.mmdbid_t?t+=e.diagram2dCls.draw2Ddgm(e.interactionData2,e.mmdbidArray[0].toUpperCase(),1,!0):t+=e.diagram2dCls.draw2Ddgm(e.interactionData2,e.mmdbidArray[1].toUpperCase(),1,!0),t+=e.diagram2dCls.set2DdgmNote(!0),$("#"+e.pre+"dl_2ddgm").html(t))}changeSeqColor(e){var t=this.icn3d;t.icn3dui;for(var s=0,i=e.length;s<i;++s){var n=e[s],r=t.firstAtomObjCls.getFirstCalphaAtomObj(t.residues[n]),a=void 0===r.color||"FFFFFF"===r.color.getHexString().toUpperCase()?"DDDDDD":r.color.getHexString(),l=void 0!==r.color?a:"CCCCCC";$("[id=giseq_"+t.pre+n+"]").attr("style","color:#"+l),$("[id=align_"+t.pre+n+"]").attr("style","color:#"+l),(void 0!==t.icn3dui.cfg.align||void 0!==t.icn3dui.cfg.chainalign||t.bRealign||t.bSymd)&&$("[id=align_"+t.pre+n+"]").attr("style","color:#"+l)}}removeHlAll(){this.icn3d.icn3dui,this.removeHlObjects(),this.removeHlSeq(),this.removeHl2D(),this.removeHlMenus()}removeHlObjects(){var e=this.icn3d;e.icn3dui,e.hlObjectsCls.removeHlObjects()}removeHlSeq(){this.icn3d.icn3dui,this.removeSeqResidueBkgd()}removeHl2D(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"dl_2ddgm rect").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm circle").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm svg line").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm rect").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm circle").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm line").attr("stroke-width",1)}removeHlMenus(){var e=this.icn3d;e.icn3dui,$("#"+e.pre+"atomsCustom").val(""),$("#"+e.pre+"atomsCustom")[0].blur()}updateHlAll(e,t,s,i){var n=this.icn3d,r=n.icn3dui;n.prevHighlightAtoms=r.hashUtilsCls.cloneHash(n.hAtoms),this.updateHlObjects(i),void 0!==e?this.updateHlSeqInChain(e,s):this.updateHlSeq(void 0,void 0,s),this.updateHl2D(),(void 0===t||t)&&this.updateHlMenus(e)}updateHlObjects(e){var t=this.icn3d;t.icn3dui,t.hlObjectsCls.removeHlObjects(),(t.hAtoms&&Object.keys(t.hAtoms).length<Object.keys(t.atoms).length||e)&&(t.hlObjectsCls.addHlObjects(),t.definedSetsCls.setMode("selection"))}updateHlSeq(e,t,s){var i=this.icn3d;i.icn3dui,void 0!==s&&s||this.removeHlSeq(),void 0===t&&(t=i.firstAtomObjCls.getResiduesFromCalphaAtoms(i.hAtoms)),i.hAtoms&&Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&this.hlSequence(Object.keys(t)),this.changeSeqColor(Object.keys(t))}updateHlSeqInChain(e,t){var s=this.icn3d;if(s.icn3dui,void 0!==t&&t||this.removeHlSeq(),!s.hAtoms||Object.keys(s.hAtoms).length!=Object.keys(s.atoms).length)for(var i=0,n=e.length;i<n;++i){var r=e[i];if(-1!==Object.keys(s.chains).indexOf(r))this.hlSeqInChain(r);else{var a=[];void 0!==s.defNames2Residues[r]&&s.defNames2Residues[r].length>0&&(a=s.defNames2Residues[r]);var l={};if(void 0!==s.defNames2Atoms[r]&&s.defNames2Atoms[r].length>0){for(var o=0,d=s.defNames2Atoms[r].length;o<d;++o){var c=s.defNames2Atoms[r][o],h=s.atoms[c];l[h.structure+"_"+h.chain+"_"+h.resi]=1}a=a.concat(Object.keys(l))}this.hlSequence(a)}}}updateHl2D(e){var t=this.icn3d,s=t.icn3dui;if(this.removeHl2D(),!t.hAtoms||Object.keys(t.hAtoms).length!=Object.keys(t.atoms).length){if(void 0===e){var i=t.firstAtomObjCls.getChainsFromAtoms(t.hAtoms);e=Object.keys(i)}if(void 0!==e)for(var n=0,r=e.length;n<r;++n){var a=s.hashUtilsCls.intHash(t.chains[e[n]],t.hAtoms),l=1*Object.keys(a).length/Object.keys(t.chains[e[n]]).length,o=t.firstAtomObjCls.getFirstCalphaAtomObj(a);if(void 0!==t.alnChains[e[n]]){var d=s.hashUtilsCls.intHash(t.alnChains[e[n]],a);Object.keys(d).length>0&&(o=t.firstAtomObjCls.getFirstCalphaAtomObj(d))}var c=void 0!==o&&void 0!==o.color?"#"+o.color.getHexString():"#FFFFFF",h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-hlnode']"),m=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-basenode']");void 0!==h&&(t.diagram2dCls.highlightNode("rect",h,m,l),$(h).attr("fill",c)),h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-hlnode']"),m=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-basenode']"),void 0!==h&&(t.diagram2dCls.highlightNode("circle",h,m,l),$(h).attr("fill",c)),h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-hlnode']"),m=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-basenode']"),void 0!==h&&(t.diagram2dCls.highlightNode("polygon",h,m,l),$(h).attr("fill",c))}if(void 0!==t.lineArray2d)for(n=0,r=t.lineArray2d.length;n<r;n+=2)$("#"+t.pre+"dl_2ddgm g[chainid1="+t.lineArray2d[n]+"][chainid2="+t.lineArray2d[n+1]+"] line").attr("stroke",t.icn3dui.htmlCls.ORANGE);t.prevHighlightAtoms=s.hashUtilsCls.cloneHash(t.hAtoms),t.definedSetsCls.setMode("selection")}}updateHlMenus(e){var t=this.icn3d;t.icn3dui,void 0===e&&(e=[]);var s=t.definedSetsCls.setAtomMenu(e);$("#"+t.pre+"atomsCustom").length&&($("#"+t.pre+"atomsCustom").html(s),$("#"+t.pre+"atomsCustom")[0].blur())}hlSequence(e){var t=this.icn3d;t.icn3dui;for(var s={},i=0,n=e.length;i<n;++i){var r=e[i],a=$("[id=giseq_"+t.pre+r+"]");0!==a.length&&a.addClass("icn3d-highlightSeq"),0!==(a=$("[id=align_"+t.pre+r+"]")).length&&a.addClass("icn3d-highlightSeq");var l=r.lastIndexOf("_");s[o=r.substr(0,l)]=1}for(var o in s)0!==$("#giseq_summary_"+t.pre+o).length&&$("#giseq_summary_"+t.pre+o).addClass("icn3d-highlightSeqBox")}hlSeqInChain(e){var t=this.icn3d;t.icn3dui;for(var s=0,i=t.chainsSeq[e].length;s<i;++s){var n=e+"_"+t.chainsSeq[e][s].resi;0!==$("#giseq_"+t.pre+n).length&&$("#giseq_"+t.pre+n).addClass("icn3d-highlightSeq"),0!==$("#align_"+t.pre+n).length&&$("#align_"+t.pre+n).addClass("icn3d-highlightSeq")}0!==$("#giseq_summary_"+t.pre+e).length&&$("#giseq_summary_"+t.pre+e).addClass("icn3d-highlightSeqBox")}toggleHighlight(){var e=this.icn3d;e.icn3dui,e.bShowHighlight?(this.clearHighlight(),e.bShowHighlight=!1):(this.showHighlight(),e.bShowHighlight=!0)}clearHighlight(){var e=this.icn3d;e.icn3dui,e.labels.picking=[],e.drawCls.draw(),e.hlObjectsCls.removeHlObjects(),this.removeHl2D(),e.bRender&&e.drawCls.render(),this.removeSeqChainBkgd(),this.removeSeqResidueBkgd(),e.bSelectResidue=!1}showHighlight(){var e=this.icn3d;e.icn3dui,e.hlObjectsCls.addHlObjects(),this.updateHlAll()}highlightChains(e){var t=this.icn3d;t.icn3dui,t.hlObjectsCls.removeHlObjects(),this.removeHl2D(),t.hlObjectsCls.addHlObjects(),this.updateHl2D(e);for(var s={},i=0,n=e.length;i<n;++i){var r=e[i];for(var a in t.chainsSeq[r]){var l=t.chainsSeq[r][a],o=r+"_"+l.resi;""!==l.name&&"-"!==l.name&&(s[o]=1)}}this.hlSequence(Object.keys(s))}hlSummaryDomain3ddomain(e){if(this.icn3d.icn3dui,void 0!==$(e).attr("domain")){var t=$(e).attr("index"),s=$(e).attr("chain");0!==$("[id^="+s+"_domain_"+t+"]").length&&$("[id^="+s+"_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}if(void 0!==$(e).attr("3ddomain")){t=$(e).attr("index"),s=$(e).attr("chain");0!==$("[id^="+s+"_3d_domain_"+t+"]").length&&$("[id^="+s+"_3d_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}}removeSeqChainBkgd(e){void 0===e?$(".icn3d-seqTitle").each((function(e){$(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox")})):$(".icn3d-seqTitle").each((function(t){$(this).attr("chain")!==e&&($(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox"))}))}removeSeqResidueBkgd(){$(".icn3d-residue").each((function(e){$(this).removeClass("icn3d-highlightSeq")}))}updateHlAll(e,t,s,i){var n=this.icn3d,r=n.icn3dui;n.prevHighlightAtoms=r.hashUtilsCls.cloneHash(n.hAtoms),this.updateHlObjects(i),void 0!==e?this.updateHlSeqInChain(e,s):this.updateHlSeq(void 0,void 0,s),this.updateHl2D(),(void 0===t||t)&&this.updateHlMenus(e)}}class Me{constructor(e){this.icn3d=e}selectAll(){var e=this.icn3d;e.icn3dui,this.selectAll_base(),e.hlObjectsCls.removeHlObjects(),e.hlUpdateCls.removeHl2D(),e.hlUpdateCls.removeHlMenus(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.update2DdgmContent(),$("#"+e.pre+"dl_annotations > .icn3d-annotation").show(),e.definedSetsCls.setMode("all");var t=e.molTitle.length>40?e.molTitle.substr(0,40)+"...":e.molTitle;$("#"+e.pre+"title").html(t)}selectAll_base(){var e=this.icn3d,t=e.icn3dui;for(var s in e.hAtoms={},e.dAtoms={},e.chains)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.chains[s]),e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.chains[s])}selectAChain(e,t,s,i){var n=this.icn3d,r=n.icn3dui;t=t.replace(/\s/g,"");var a=void 0!==s||s?"select alignChain "+e:"select chain "+e;void 0!==i&&i?(n.hAtoms=r.hashUtilsCls.unionHash(n.hAtoms,n.chains[e]),void 0===n.menuHlHash&&(n.menuHlHash={})):(n.hAtoms={},n.menuHlHash={}),n.menuHlHash[e]=1;for(var l=s?n.alnChainsSeq[e]:n.chainsSeq[e],o={},d=0,c=void 0===l?0:l.length;d<c;++d){var h=l[d],m=e+"_"+h.resi,p=h.name;if(""!==p&&"-"!==p)for(var u in o[m]=1,n.residues[m])n.hAtoms[u]=1}void 0!==n.defNames2Atoms&&n.defNames2Atoms.hasOwnProperty(t)||void 0!==n.defNames2Residues&&n.defNames2Residues.hasOwnProperty(t)||this.addCustomSelection(Object.keys(o),t,t,a,!0);s?n.hlUpdateCls.updateHlAll(void 0,void 0,i,true):n.hlUpdateCls.updateHlAll(Object.keys(n.menuHlHash),void 0,i,true)}selectResidueList(e,t,s,i,n,r){var a=this.icn3d;if(a.icn3dui,void 0!==e&&Object.keys(e).length>0){if(void 0!==i&&i?void 0===a.menuHlHash&&(a.menuHlHash={}):(a.hAtoms={},a.menuHlHash={}),r)for(var l in e)a.hAtoms[l]=1;else for(var l in e)for(var o in a.residues[l])a.hAtoms[o]=1;var d,c;t=t.replace(/\s/g,""),a.menuHlHash[t]=1,r?(d="select "+a.resid2specCls.atoms2spec(a.hAtoms),c=!1):(d="select "+a.resid2specCls.residueids2spec(Object.keys(e)),c=!0);var h=Object.keys(e);this.addCustomSelection(h,t,s,d,c),(void 0===n||n)&&a.hlUpdateCls.updateHlAll(Object.keys(a.menuHlHash),void 0,i)}}selectMainChains(){var e=this.icn3d,t=e.icn3dui.hashUtilsCls.cloneHash(e.hAtoms);e.hAtoms=e.applyDisplayCls.selectMainChainSubset(t),e.hlUpdateCls.showHighlight()}selectSideChains(){var e=this.icn3d,t=e.icn3dui.hashUtilsCls.cloneHash(e.hAtoms),s=["C1'","C1*","C2'","C2*","C3'","C3*","C4'","C4*","C5'","C5*","O3'","O3*","O4'","O4*","O5'","O5*","P","OP1","O1P","OP2","O2P"];for(var i in e.hAtoms={},t)(e.proteins.hasOwnProperty(i)&&"N"!==e.atoms[i].name&&"C"!==e.atoms[i].name&&"O"!==e.atoms[i].name&&("CA"!==e.atoms[i].name||"C"!==e.atoms[i].elem)||e.nucleotides.hasOwnProperty(i)&&-1===s.indexOf(e.atoms[i].name))&&(e.hAtoms[i]=1);e.hlUpdateCls.showHighlight()}selectMainSideChains(){var e=this.icn3d,t=e.icn3dui,s=e.firstAtomObjCls.getResiduesFromAtoms(e.hAtoms);for(var i in e.hAtoms={},s)e.hAtoms=t.hashUtilsCls.unionHash(e.hAtoms,e.residues[i]),e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.residues[i]);e.drawCls.draw(),e.hlUpdateCls.showHighlight()}clickShow_selected(){var e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds(["#"+e.pre+"show_selected","#"+e.pre+"mn2_show_selected"],"click",(function(e){var t=s.icn3d;s.showSelection(),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("show selection",!0)}))}clickHide_selected(){var e=this.icn3d,t=e.icn3dui,s=this;t.myEventCls.onIds("#"+e.pre+"mn2_hide_selected","click",(function(e){var t=s.icn3d;s.hideSelection(),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("hide selection",!0)}))}getGraphDataForDisplayed(){var e=this.icn3d;e.icn3dui;for(var t=JSON.parse(e.graphStr),s=e.firstAtomObjCls.getResiduesFromAtoms(e.dAtoms),i=[],n=[],r={},a=0,l=t.nodes.length;a<l;++a){var o=t.nodes[a],d=o.r.substr(4);s.hasOwnProperty(d)&&(i.push(o),r[o.id]=1)}for(a=0,l=t.links.length;a<l;++a){var c=t.links[a];r.hasOwnProperty(c.source)&&r.hasOwnProperty(c.target)&&n.push(c)}return t.nodes=i,t.links=n,e.graphStr=JSON.stringify(t),e.graphStr}updateSelectionNameDesc(){var e=this.icn3d;e.icn3dui;var t=Object.keys(e.defNames2Residues).length+Object.keys(e.defNames2Atoms).length;$("#"+e.pre+"seq_command_name").val("seq_"+t),$("#"+e.pre+"seq_command_name2").val("seq_"+t),$("#"+e.pre+"alignseq_command_name").val("alseq_"+t)}addCustomSelection(e,t,s,i,n){var r=this.icn3d;r.icn3dui,n?r.defNames2Residues[t]=e:r.defNames2Atoms[t]=e,r.defNames2Command[t]=i,r.defNames2Descr[t]=s,r.hlUpdateCls.updateHlMenus([t])}showSelection(){var e=this.icn3d,t=e.icn3dui;e.dAtoms={},0==Object.keys(e.hAtoms).length&&this.selectAll_base(),e.dAtoms=t.hashUtilsCls.cloneHash(e.hAtoms);var s=e.applyCenterCls.centerAtoms(t.hashUtilsCls.hash2Atoms(e.dAtoms,e.atoms));e.maxD=s.maxD,e.maxD<5&&(e.maxD=5),e.opts.rotationcenter="display center",this.saveSelectionIfSelected(),e.drawCls.draw(),e.hlUpdateCls.update2DdgmContent(),e.hlUpdateCls.updateHl2D(),e.annotationCls.showAnnoSelectedChains(),void 0!==e.graphStr&&(e.graphStr=this.getGraphDataForDisplayed()),e.bGraph&&e.icn3dui.drawGraph(e.graphStr),e.bLinegraph&&e.lineGraphCls.drawLineGraph(e.graphStr),e.bScatterplot&&e.lineGraphCls.drawLineGraph(e.graphStr,!0)}hideSelection(){var e=this.icn3d,t=e.icn3dui;e.dAtoms=t.hashUtilsCls.exclHash(e.dAtoms,e.hAtoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.dAtoms);var s=e.applyCenterCls.centerAtoms(t.hashUtilsCls.hash2Atoms(e.dAtoms,e.atoms));e.maxD=s.maxD,e.maxD<5&&(e.maxD=5),e.opts.rotationcenter="display center",this.saveSelectionIfSelected(),e.drawCls.draw(),e.hlUpdateCls.update2DdgmContent(),e.hlUpdateCls.updateHl2D(),e.annotationCls.showAnnoSelectedChains()}saveSelection(e,t){var s=this.icn3d;if(s.icn3dui,s.selectedResidues={},s.selectedResidues=s.firstAtomObjCls.getResiduesFromCalphaAtoms(s.hAtoms),Object.keys(s.selectedResidues).length>0)if(1==s.pk){this.selectResidueList(s.hAtoms,e,t,void 0,void 0,!0),this.updateSelectionNameDesc(),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+s.resid2specCls.atoms2spec(s.hAtoms)+" | name "+e,!0)}else this.selectResidueList(s.selectedResidues,e,t),this.updateSelectionNameDesc(),s.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+s.resid2specCls.residueids2spec(Object.keys(s.selectedResidues))+" | name "+e,!0)}removeSelection(){var e=this.icn3d;e.icn3dui,e.bAnnotations||e.hlUpdateCls.removeSeqChainBkgd(),e.bCtrl||e.bShift||(e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.removeSeqChainBkgd()),e.selectedResidues={},e.bSelectResidue=!1,e.hAtoms={},e.hlObjectsCls.removeHlObjects(),e.hlUpdateCls.removeHl2D()}resetAll(){var e=this.icn3d;e.icn3dui,e.maxD=e.oriMaxD,e.center=e.oriCenter.clone(),e.reinitAfterLoad(),e.loadScriptCls.renderFinalStep(1),e.definedSetsCls.setMode("all"),e.icn3dui.htmlCls.clickMenuCls.setLogCmd("reset",!0),e.hlUpdateCls.removeSeqChainBkgd(),e.hlUpdateCls.removeSeqResidueBkgd(),e.hlUpdateCls.removeHl2D(),e.hlUpdateCls.removeHlMenus()}loadSelection(e){var t=this.icn3d;t.icn3dui;for(var s=e.trim().split("\n"),i=0,n=s.length;i<n;++i){var r=s[i].split("\t"),a=r[0],l=r[1],o=l.indexOf(" ");t.selByCommCls.selectByCommand(l.substr(o+1),a,a),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("select "+l.substr(o+1)+" | name "+a,!0)}}oneStructurePerWindow(){var e=this.icn3d,t=e.icn3dui,s=Object.keys(e.structures);if(e.icn3dui.cfg.bSidebyside&&2==s.length){for(var i=s[Object.keys(window.icn3duiHash).indexOf(e.divid)],n=e.structures[i],r={},a=0,l=n.length;a<l;++a)r=t.hashUtilsCls.unionHash(r,e.chains[n[a]]);e.dAtoms=t.hashUtilsCls.intHash(r,e.dAtoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.dAtoms)}}showAll(){var e=this.icn3d,t=e.icn3dui;e.dAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.maxD=e.oriMaxD,e.drawCls.draw()}saveSelectionIfSelected(e,t){var s=this.icn3d;if(s.icn3dui,s.bSelectResidue||s.bSelectAlignResidue){var i=$("#"+s.pre+"seq_command_name2").val().replace(/\s+/g,"_");""===i&&(i=$("#"+s.pre+"alignseq_command_name").val().replace(/\s+/g,"_")),""!==i&&this.saveSelection(i,i),s.bSelectResidue=!1,s.bSelectAlignResidue=!1}}saveSelectionPrep(){var e=this.icn3d;e.icn3dui,e.icn3dui.cfg.notebook?($("#"+e.pre+"dl_definedsets").show(),$("#"+e.pre+"atomsCustom").resizable()):$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||(e.icn3dui.htmlCls.dialogCls.openDlg("dl_definedsets","Select sets"),$("#"+e.pre+"atomsCustom").resizable()),e.bSelectResidue=!1,e.bSelectAlignResidue=!1}selectOneResid(e,t){var s=this.icn3d;s.icn3dui;var i=e.indexOf("$"),n=e.indexOf("."),r=e.indexOf(":"),a=e.indexOf("@");-1==a&&(a=e.length);var l=e.substr(i+1,n-i-1),o=e.substr(n+1,r-n-1),d=e.substr(r+1,a-r-1),c=l+"_"+o+"_"+d;for(var h in s.residues[c])t?delete s.hAtoms[h]:s.hAtoms[h]=1;return t?delete s.selectedResidues[c]:s.selectedResidues[c]=1,"$"+l+"."+o+":"+d}toggleSelection(){var e=this.icn3d,t=e.icn3dui;if(e.bHideSelection){for(var s in e.dAtoms)e.hAtoms.hasOwnProperty(s)&&delete e.dAtoms[s];e.bHideSelection=!1}else e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.hAtoms),e.bHideSelection=!0;e.drawCls.draw()}toggleMembrane(){var e=this.icn3d,t=e.icn3dui,s=Object.keys(e.structures)[0],i=e.residues[s+"_MEM_1"],n=e.firstAtomObjCls.getFirstAtomObj(i),r=n.style;for(var a in e.dAtoms.hasOwnProperty(n.serial)||(e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,i),r="nothing"),i){var l=e.atoms[a];l.style="nothing"!==r?"nothing":"stick"}e.drawCls.draw()}adjustMembrane(e,t){var s=this.icn3d;for(var i in s.icn3dui,s.chains[s.inputid.toUpperCase()+"_MEM"]){var n=s.atoms[i];"O"==n.name?n.coord.z=e:"N"==n.name&&(n.coord.z=t)}s.definedSetsCls.setTransmemInMenu(e,t,!0),s.hlUpdateCls.updateHlMenus(),s.drawCls.draw()}selectBtwPlanes(e,t){var s=this.icn3d;if(s.icn3dui,e<t){var i=t;t=e,e=i}var n={};for(var r in s.atoms){var a=s.atoms[r];if("DUM"!=a.resn)if(a.coord.z>=t&&a.coord.z<=e)n[a.structure+"_"+a.chain+"_"+a.resi]=1}var l="z_planes_"+e+"_"+t,o=l;this.selectResidueList(n,l,o,!1)}}class Pe{constructor(e){this.icn3d=e}setOption(e,t){var s=this.icn3d;if(s.icn3dui,s.opts[e]=t,s.selectionCls.saveSelectionIfSelected(),"color"===e){s.setColorCls.setColorByOptions(s.opts,s.hAtoms),s.drawCls.draw();var i=s.firstAtomObjCls.getResiduesFromCalphaAtoms(s.hAtoms);s.hlUpdateCls.changeSeqColor(Object.keys(i)),s.getGraphCls.updateGraphColor()}else"surface"===e||"opacity"===e||"wireframe"===e?("opacity"!==e&&"wireframe"!==e||s.applyMapCls.removeLastSurface(),s.applyMapCls.applySurfaceOptions(),s.drawCls.draw()):"map"===e||"mapwireframe"===e?("mapwireframe"===e&&s.applyMapCls.removeLastMap(),s.applyMapCls.applyMapOptions(),s.drawCls.draw()):"emmap"===e||"emmapwireframe"===e?("emmapwireframe"===e&&s.applyMapCls.removeLastEmmap(),s.applyMapCls.applyEmmapOptions(),s.drawCls.draw()):"phimap"===e||"phimapwireframe"===e?("phimapwireframe"===e&&s.applyMapCls.removeLastPhimap(),s.applyMapCls.applyPhimapOptions(),s.drawCls.draw()):"phisurface"===e?(s.applyMapCls.applyphisurfaceOptions(),s.drawCls.draw()):"chemicalbinding"===e?(s.bSkipChemicalbinding=!1,s.drawCls.draw()):s.drawCls.draw()}setStyle(e,t){var s=this.icn3d,i=s.icn3dui,n={};switch(e){case"proteins":n=i.hashUtilsCls.intHash(s.hAtoms,s.proteins),Object.keys(s.hAtoms).length,Object.keys(s.proteins).length;break;case"sidec":n=i.hashUtilsCls.intHash(s.hAtoms,s.sidec);break;case"nucleotides":n=i.hashUtilsCls.intHash(s.hAtoms,s.nucleotides),Object.keys(s.hAtoms).length,Object.keys(s.nucleotides).length;break;case"chemicals":n=i.hashUtilsCls.intHash(s.hAtoms,s.chemicals);break;case"ions":n=i.hashUtilsCls.intHash(s.hAtoms,s.ions);break;case"water":n=i.hashUtilsCls.intHash(s.hAtoms,s.water)}if("sidec"===e)for(var r in n)s.atoms[r].style2=t;else for(var r in n)s.atoms[r].style=t;s.opts[e]=t,s.selectionCls.saveSelectionIfSelected(),s.drawCls.draw()}saveStyle(){var e=this.icn3d;for(var t in e.icn3dui,e.atoms){var s=e.atoms[t];s.styleSave=s.style,void 0!==s.style2&&(s.style2Save=s.style2)}}applySavedStyle(){var e=this.icn3d;for(var t in e.icn3dui,e.atoms){var s=e.atoms[t];void 0!==s.styleSave&&(s.style=s.styleSave),void 0!==s.style2Save&&(s.style2=s.style2Save)}e.drawCls.draw()}saveColor(){var e=this.icn3d;for(var t in e.icn3dui,e.atoms){var s=e.atoms[t];s.colorSave=s.color.clone()}}applySavedColor(){var e=this.icn3d;for(var t in e.icn3dui,e.atoms){var s=e.atoms[t];void 0!==s.colorSave&&(s.color=s.colorSave.clone())}e.drawCls.draw(),e.hlUpdateCls.changeSeqColor(Object.keys(e.residues))}}class Fe{constructor(e){this.icn3d=e}setStyle2Atoms(e){var t=this.icn3d;for(var s in t.icn3dui,t.style2atoms={},e)void 0===t.style2atoms[t.atoms[s].style]&&(t.style2atoms[t.atoms[s].style]={}),t.style2atoms[t.atoms[s].style][s]=1,void 0!==t.atoms[s].style2&&"nothing"!==t.atoms[s].style2&&(void 0===t.style2atoms[t.atoms[s].style2]&&(t.style2atoms[t.atoms[s].style2]={}),t.style2atoms[t.atoms[s].style2][s]=1)}setAtomStyleByOptions(e){var t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),void 0!==e.proteins)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.proteins))t.atoms[i].style=e.proteins.toLowerCase();if(void 0!==e.sidec&&"nothing"!==e.sidec)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.sidec))t.atoms[i].style2=e.sidec.toLowerCase();if(void 0!==e.chemicals)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.chemicals))t.atoms[i].style=e.chemicals.toLowerCase();if(void 0!==e.ions)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.ions))t.atoms[i].style=e.ions.toLowerCase();if(void 0!==e.water)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.water))t.atoms[i].style=e.water.toLowerCase();if(void 0!==e.nucleotides)for(var i in s.hashUtilsCls.intHash(t.hAtoms,t.nucleotides))t.atoms[i].style=e.nucleotides.toLowerCase()}setBackground(e){var t=this.icn3d;t.icn3dui,t.setOptionCls.setOption("background",e),t.icn3dui.htmlCls.clickMenuCls.setLogCmd("set background "+e,!0);var s="black"==e||"transparent"==e?t.icn3dui.htmlCls.GREYD:"black";$("#"+t.pre+"title").css("color",s),$("#"+t.pre+"titlelink").css("color",s)}saveCommandsToSession(){var e=this.icn3d;e.icn3dui;var t=e.commands.join("\n"),s=decodeURIComponent(t);sessionStorage.setItem("commands",s)}getCommandsBeforeCrash(){var e=this.icn3d,t=e.icn3dui;window.addEventListener("load",(function(){sessionStorage.setItem("good_exit","pending")})),window.addEventListener("beforeunload",(function(){sessionStorage.setItem("good_exit","true")})),sessionStorage.getItem("good_exit")&&"pending"===sessionStorage.getItem("good_exit")&&(t.utilsCls.isMac()||(e.bCrashed=!0),e.commandsBeforeCrash=sessionStorage.getItem("commands"),e.commandsBeforeCrash||(e.commandsBeforeCrash=""))}handleContextLost(){var e=this.icn3d;e.icn3dui;var t=$("#"+e.pre+"canvas")[0];t.addEventListener("webglcontextlost",(function(e){e.preventDefault()}),!1),t.addEventListener("webglcontextrestored",(function(t){console.log("WebGL context was lost. Reset WebGLRenderer and launch iCn3D again."),e.renderer=new THREE.WebGLRenderer({canvas:e.container.get(0),antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),e.drawCls.draw()}),!1)}adjustIcon(){var e=this.icn3d;e.icn3dui,1===e.STATENUMBER?$("#"+e.pre+"back").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")):$("#"+e.pre+"back").hasClass("icn3d-endIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")),e.STATENUMBER===e.commands.length?$("#"+e.pre+"forward").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon")):$("#"+e.pre+"forward").hasClass("icn3d-endIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon"))}}class Le{constructor(e){this.icn3d=e}createStickRepresentation(e,t,s,i,n,r){var a=this.icn3d;if(a.icn3dui,!a.icn3dui.bNode){var l=void 0!==r&&r?t/a.cylinderRadius:1;a.reprSubCls.createRepresentationSub(e,(function(e){a.sphereCls.createSphere(e,t,!i,i,n)}),(function(e,t){var i=e.coord.clone().add(t.coord).multiplyScalar(.5),r=e.serial+"_"+t.serial;if(a.doublebonds.hasOwnProperty(r)){var o=new THREE.Vector3(Math.random(),Math.random(),Math.random());if(1==e.bonds.length&&1==t.bonds.length){(C=t.coord.clone()).sub(e.coord);var d=o.clone();C.cross(d).normalize().multiplyScalar(.2*l)}else{if(e.bonds.length>=t.bonds.length&&e.bonds.length>1)c=e.serial,h=e.bonds[0],m=e.bonds[1];else{if(!(t.bonds.length>=e.bonds.length&&t.bonds.length>1))return void console.log("Double bond was not drawn due to the undefined cross plane");c=t.serial,h=t.bonds[0],m=t.bonds[1]}(p=a.atoms[c].coord.clone()).sub(a.atoms[h].coord),(u=a.atoms[c].coord.clone()).sub(a.atoms[m].coord),p.cross(u),0==parseInt(1e4*p.length())&&(p=new THREE.Vector3(.2,.3,.5)),(C=t.coord.clone()).sub(e.coord),C.cross(p).normalize().multiplyScalar(.2*l),0==parseInt(1e4*C.length())&&(p=new THREE.Vector3(.5,.3,.2),C.cross(p).normalize().multiplyScalar(.2*l))}e.color===t.color?a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord.clone().add(C),t.coord.clone().add(C),a.cylinderRadius*l*.3,e.color,n),a.cylinderCls.createCylinder(e.coord.clone().sub(C),t.coord.clone().sub(C),a.cylinderRadius*l*.3,e.color,n)):a.bImpo?a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord.clone().add(C),t.coord.clone().add(C),a.cylinderRadius*l*.3,e.color,n,t.color),a.cylinderCls.createCylinder(e.coord.clone().sub(C),t.coord.clone().sub(C),a.cylinderRadius*l*.3,e.color,n,t.color)):a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord.clone().add(C),i.clone().add(C),a.cylinderRadius*l*.3,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().add(C),i.clone().add(C),a.cylinderRadius*l*.3,t.color,n),a.cylinderCls.createCylinder(e.coord.clone().sub(C),i.clone().sub(C),a.cylinderRadius*l*.3,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().sub(C),i.clone().sub(C),a.cylinderRadius*l*.3,t.color,n))}else if(a.aromaticbonds.hasOwnProperty(r)){var c,h,m,p,u,C;if(e.bonds.length>t.bonds.length&&e.bonds.length>1)c=e.serial,h=e.bonds[0],m=e.bonds[1];else{if(!(t.bonds.length>1))return;c=t.serial,h=t.bonds[0],m=t.bonds[1]}(p=a.atoms[c].coord.clone()).sub(a.atoms[h].coord),(u=a.atoms[c].coord.clone()).sub(a.atoms[m].coord),p.cross(u),(C=t.coord.clone()).sub(e.coord),C.cross(p).normalize().multiplyScalar(.2*l);for(var v=0,g=0,f=e.bondOrder.length;g<f;++g)"1.5"===e.bondOrder[g]&&e.bonds[g]!==t.serial&&(v=e.bonds[g]);var b="add";if(0===v)b="add";else{var y=e.coord.clone().add(C),w=e.coord.clone().sub(C),S=t.coord.clone().sub(y).normalize(),_=a.atoms[v].coord.clone().sub(y).normalize(),A=t.coord.clone().sub(w).normalize(),x=a.atoms[v].coord.clone().sub(w).normalize();b=Math.acos(S.dot(_))<Math.acos(A.dot(x))?"sub":"add"}if(e.color===t.color){"add"===b?(a.cylinderCls.createCylinder(e.coord.clone().sub(C),t.coord.clone().sub(C),a.cylinderRadius*l*.3,e.color,n),H=e.coord.clone().add(C),R=t.coord.clone().add(C).sub(H).multiplyScalar(1/11)):(a.cylinderCls.createCylinder(e.coord.clone().add(C),t.coord.clone().add(C),a.cylinderRadius*l*.3,e.color,n),H=e.coord.clone().sub(C),R=t.coord.clone().sub(C).sub(H).multiplyScalar(1/11));for(g=0;g<=10;++g)if(g%2==0){var k=H.clone().add(R.clone().multiplyScalar(g)),O=H.clone().add(R.clone().multiplyScalar(g+1));a.cylinderCls.createCylinder(k,O,a.cylinderRadius*l*.3,e.color,n)}}else{var H,R;"add"===b?(a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord.clone().sub(C),i.clone().sub(C),a.cylinderRadius*l*.3,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().sub(C),i.clone().sub(C),a.cylinderRadius*l*.3,t.color,n)),H=e.coord.clone().add(C),R=t.coord.clone().add(C).sub(H).multiplyScalar(1/11)):(a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord.clone().add(C),i.clone().add(C),a.cylinderRadius*l*.3,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().add(C),i.clone().add(C),a.cylinderRadius*l*.3,t.color,n)),H=e.coord.clone().sub(C),R=t.coord.clone().sub(C).sub(H).multiplyScalar(1/11));for(g=0;g<=10;++g)if(g%2==0&&a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)){k=H.clone().add(R.clone().multiplyScalar(g)),O=H.clone().add(R.clone().multiplyScalar(g+1));g<5?a.cylinderCls.createCylinder(k,O,a.cylinderRadius*l*.3,e.color,n):a.cylinderCls.createCylinder(k,O,a.cylinderRadius*l*.3,t.color,n)}}}else if(a.triplebonds.hasOwnProperty(r)){o=new THREE.Vector3(Math.random(),Math.random(),Math.random());(d=t.coord.clone()).sub(e.coord),(A=o.clone()).cross(d).normalize().multiplyScalar(.3*l),e.color===t.color?a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord,t.coord,a.cylinderRadius*l*.2,e.color,n),a.cylinderCls.createCylinder(e.coord.clone().add(A),t.coord.clone().add(A),a.cylinderRadius*l*.2,e.color,n),a.cylinderCls.createCylinder(e.coord.clone().sub(A),t.coord.clone().sub(A),a.cylinderRadius*l*.2,e.color,n)):a.bImpo?a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord,t.coord,a.cylinderRadius*l*.2,e.color,n,t.color),a.cylinderCls.createCylinder(e.coord.clone().add(A),t.coord.clone().add(A),a.cylinderRadius*l*.2,e.color,n,t.color),a.cylinderCls.createCylinder(e.coord.clone().sub(A),t.coord.clone().sub(A),a.cylinderRadius*l*.2,e.color,n,t.color)):a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord,i,a.cylinderRadius*l*.2,e.color,n),a.cylinderCls.createCylinder(t.coord,i,a.cylinderRadius*l*.2,t.color,n),a.cylinderCls.createCylinder(e.coord.clone().add(A),i.clone().add(A),a.cylinderRadius*l*.2,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().add(A),i.clone().add(A),a.cylinderRadius*l*.2,t.color,n),a.cylinderCls.createCylinder(e.coord.clone().sub(A),i.clone().sub(A),a.cylinderRadius*l*.2,e.color,n),a.cylinderCls.createCylinder(t.coord.clone().sub(A),i.clone().sub(A),a.cylinderRadius*l*.2,t.color,n))}else e.color===t.color?a.cylinderCls.createCylinder(e.coord,t.coord,s,e.color,n):a.bImpo?a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&a.cylinderCls.createCylinder(e.coord,t.coord,s,e.color,n,t.color):a.dAtoms.hasOwnProperty(e.serial)&&a.dAtoms.hasOwnProperty(t.serial)&&(a.cylinderCls.createCylinder(e.coord,i,s,e.color,n),a.cylinderCls.createCylinder(t.coord,i,s,t.color,n))}))}}}class Ne{constructor(e){this.icn3d=e}drawCartoonNucleicAcid(e,t,s,i){this.drawStrandNucleicAcid(e,2,t,!0,void 0,s,i)}drawStrandNucleicAcid(e,t,s,i,n,r,a){var l=this.icn3d;if(l.icn3dui,!l.icn3dui.bNode){var o,d,c;2===a&&(t=void 0,r=void 0),n=n||l.nucleicAcidWidth,s=s||l.axisDIV,t=t||l.nucleicAcidStrandDIV;var h=[];for(c=0;c<t;c++)h[c]=[];var m,p,u,C=[],v=null;for(o in e){var g=e[o];if(void 0!==g&&(("O3'"===g.name||"OP2"===g.name||"O3*"===g.name||"O2P"===g.name)&&!g.het))if("O3'"===g.name||"O3*"===g.name){if(m!==g.chain||p+1!==g.resi){if(u&&v)for(d=0;d<t;d++){var f=2/(t-1)*d-1;h[d].push(new THREE.Vector3(u.x+v.x*f,u.y+v.y*f,u.z+v.z*f))}for(i&&l.stripCls.createStrip(h[0],h[1],C,s,r,a),d=0;!r&&d<t;d++)l.curveCls.createCurveSub(h[d],1,C,s,a);for(h=[],c=0;c<t;c++)h[c]=[];C=[],v=null}u=new THREE.Vector3(g.coord.x,g.coord.y,g.coord.z),m=g.chain,p=g.resi,1===a||2===a?C.push(l.hColor):C.push(g.color)}else if("OP2"===g.name||"O2P"===g.name){if(!u){v=null;continue}var b=new THREE.Vector3(g.coord.x,g.coord.y,g.coord.z);for(b.sub(u),b.normalize().multiplyScalar(n),null!==v&&b.dot(v)<0&&b.negate(),v=b,d=0;d<t;d++){f=2/(t-1)*d-1;h[d].push(new THREE.Vector3(u.x+v.x*f,u.y+v.y*f,u.z+v.z*f))}u=null}}if(u&&v)for(d=0;d<t;d++){f=2/(t-1)*d-1;h[d].push(new THREE.Vector3(u.x+v.x*f,u.y+v.y*f,u.z+v.z*f))}for(i&&l.stripCls.createStrip(h[0],h[1],C,s,r,a),d=0;!r&&d<t;d++)l.curveCls.createCurveSub(h[d],1,C,s,a)}}drawNucleicAcidStick(e,t){var s=this.icn3d;if(s.icn3dui,!s.icn3dui.bNode){var i,n,r,a=null,l=null;for(r in e){var o=e[r];void 0===o||o.het||(o.resi===n&&o.chain===i||(null!==a&&null!==l&&s.cylinderCls.createCylinder(new THREE.Vector3(a.coord.x,a.coord.y,a.coord.z),new THREE.Vector3(l.coord.x,l.coord.y,l.coord.z),s.cylinderRadius,a.color,t),a=null,l=null),"O3'"!==o.name&&"O3*"!==o.name||(a=o),"  A"===o.resn||"  G"===o.resn||" DA"===o.resn||" DG"===o.resn?"N1"===o.name&&(l=o):"N3"===o.name&&(l=o),n=o.resi,i=o.chain)}null!==a&&null!==l&&s.cylinderCls.createCylinder(new THREE.Vector3(a.coord.x,a.coord.y,a.coord.z),new THREE.Vector3(l.coord.x,l.coord.y,l.coord.z),s.cylinderRadius,a.color,t)}}}class $e{constructor(){}static makeTextSprite(e,t){if(!ic.icn3dui.bNode){void 0===t&&(t={});var s,i,n,r=t.hasOwnProperty("fontface")?t.fontface:"Arial",a=t.hasOwnProperty("fontsize")?t.fontsize:18,l=t.hasOwnProperty("factor")?t.factor:1,o=t.hasOwnProperty("alpha")?t.alpha:1,d=!0,c=!1;t.hasOwnProperty("bSchematic")&&t.bSchematic&&(c=!0,a=40),t.hasOwnProperty("backgroundColor")&&void 0!==t.backgroundColor?(s=me.utilsCls.hexToRgb(t.backgroundColor,o),i=t.hasOwnProperty("borderColor")?me.utilsCls.hexToRgb(t.borderColor,o):{r:0,g:0,b:0,a:1},n=t.hasOwnProperty("borderThickness")?t.borderThickness:4):(d=!1,s=void 0,i=void 0,n=0);var h=t.hasOwnProperty("textColor")&&void 0!==t.textColor?me.utilsCls.hexToRgb(t.textColor,1):{r:255,g:255,b:0,a:1},m=document.createElement("canvas"),p=m.getContext("2d");p.font="Bold "+a+"px "+r;var u=p.measureText(e).width,C=u+2*n,v=a+2*n;c&&(C>v?v=C:C=v);var g=.8*u/v;if(m.width=C,m.height=v,p.clearRect(0,0,C,v),d)if(p.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",p.strokeStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",p.lineWidth=n,c){var f=.35*C;$e.circle(p,0,0,C,v,f)}else{f=0;$e.roundRect(p,0,0,C,v,f)}p.font="Bold "+a+"px "+r,p.textAlign="center",p.textBaseline="middle",p.fillStyle="rgba("+h.r+", "+h.g+", "+h.b+", 1.0)",p.strokeStyle="rgba("+h.r+", "+h.g+", "+h.b+", 1.0)",p.fillText(e,.5*C,.5*v);var b=new THREE.Texture(m);b.needsUpdate=!0;var y=new THREE.SpriteMaterial({map:b,depthTest:!1,depthWrite:!1});y.map.minFilter=THREE.LinearFilter;var w=new THREE.Sprite(y);return c?w.scale.set(.3*l,.3*l,1):w.scale.set(g*l,l,1),w}}static roundRect(e,t,s,i,n,r){e.beginPath(),e.moveTo(t+r,s),e.lineTo(t+i-r,s),e.quadraticCurveTo(t+i,s,t+i,s+r),e.lineTo(t+i,s+n-r),e.quadraticCurveTo(t+i,s+n,t+i-r,s+n),e.lineTo(t+r,s+n),e.quadraticCurveTo(t,s+n,t,s+n-r),e.lineTo(t,s+r),e.quadraticCurveTo(t,s,t+r,s),e.closePath(),e.fill(),e.stroke()}static circle(e,t,s,i,n,r){e.beginPath(),e.arc(t+i/2,s+n/2,r,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()}}class Ue{constructor(e){this.icn3d=e}createLabelRepresentation(e){var t=this.icn3d;t.icn3dui;var s=3*t.oriMaxD/100*t.labelScale;for(var i in e)for(var n=void 0!==e[i]?e[i]:[],r=0,a=n.length;r<a;++r){var l=n[r];0==l.size&&(l.size=void 0),0==l.color&&(l.color=void 0),0==l.background&&(l.background=void 0);var o,d=void 0!==l.size?l.size:t.LABELSIZE,c=void 0!==l.color?l.color:"#ffff00",h=void 0!==l.background?l.background:"#cccccc",m=void 0!==l.alpha?l.alpha:1;h=l.background,void 0!==c&&void 0!==h&&c.toLowerCase()===h.toLowerCase()&&(c="#888888"),(o=void 0!==l.bSchematic&&l.bSchematic||1===l.text.length?$e.makeTextSprite(l.text,{fontsize:parseInt(d),textColor:c,borderColor:h,backgroundColor:h,alpha:m,bSchematic:1,factor:s}):$e.makeTextSprite(l.text,{fontsize:parseInt(d),textColor:c,borderColor:h,backgroundColor:h,alpha:m,bSchematic:0,factor:s})).position.set(l.position.x,l.position.y,l.position.z),t.mdl.add(o)}}hideLabels(){var e=this.icn3d;if(e.icn3dui,void 0!==e.mdl)for(var t=0,s=e.mdl.children.length;t<s;++t){var i=e.mdl.children[t];void 0!==i&&"Sprite"===i.type&&e.mdl.remove(i)}}}class qe{constructor(e){this.icn3d=e}applyDisplayOptions(e,t,s){var i=this.icn3d,n=i.icn3dui;void 0===e&&(e=i.opts);var r={},a={},l={};if(1===s&&Object.keys(t).length<Object.keys(i.atoms).length){for(var o in l=n.hashUtilsCls.hash2Atoms(t,i.atoms),r=i.firstAtomObjCls.getResiduesFromAtoms(t,i.atoms)){v=o;var d=o.lastIndexOf("_"),c=o.substr(0,d+1),h=parseInt(o.substr(d+1)),m=c+(h-1).toString(),p=c+(h+1).toString();r.hasOwnProperty(m)||r.hasOwnProperty(m)||(a[o]=1)}if(1===Object.keys(l).length&&Object.keys(i.residues[v]).length>1&&"sphere"!==l[Object.keys(l)[0]].style&&"dot"!==l[Object.keys(l)[0]].style){if(void 0===i.bCid||!i.bCid)for(var o in l){var u=l[o],C=1;i.boxCls.createBox(u,void 0,void 0,C,void 0,s)}}else for(var v in a){var g=i.firstAtomObjCls.getFirstCalphaAtomObj(i.residues[v]);m=(u=g).structure+"_"+u.chain+"_"+parseInt(u.resi-1),p=u.structure+"_"+u.chain+"_"+parseInt(u.resi+1);if("cylinder and plate"===u.style&&"helix"===u.ss)for(var o in i.residues[v]){u=i.atoms[o],C=1;i.boxCls.createBox(u,void 0,void 0,C,void 0,s)}else if("ribbon"===u.style&&"coil"===u.ss||"strand"===u.style&&"coil"===u.ss||"o3 trace"===u.style||"schematic"===u.style||"c alpha trace"===u.style||"b factor tube"===u.style||"cylinder and plate"===u.style&&"helix"!==u.ss){if(void 0!==g&&void 0!==g.style2&&"nothing"!==g.style2)continue;if(!(w=!1)&&i.residues.hasOwnProperty(p)){var f=Object.keys(i.residues[p])[0],b=n.hashUtilsCls.hash2Atoms(i.residues[p],i.atoms)[f];if(u.style===b.style&&!b.ssbegin||b.ssbegin){var y=i.residues[p];if(t=n.hashUtilsCls.unionHash(t,y),w=!0,b.ssbegin)for(var o in y)i.atoms[o].notshow=!0}}if(!w&&i.residues.hasOwnProperty(m)){f=Object.keys(i.residues[m])[0],b=n.hashUtilsCls.hash2Atoms(i.residues[m],i.atoms)[f];u.style===b.style&&(t=n.hashUtilsCls.unionHash(t,i.residues[m]),w=!0)}}else if("ribbon"===u.style&&"coil"!==u.ss&&u.ssend||"strand"===u.style&&"coil"!==u.ss&&u.ssend){if(void 0!==g&&void 0!==g.style2&&"nothing"!==g.style2)continue;var w;if(!(w=!1)&&i.residues.hasOwnProperty(p)){f=Object.keys(i.residues[p])[0],b=n.hashUtilsCls.hash2Atoms(i.residues[p],i.atoms)[f];t=n.hashUtilsCls.unionHash(t,i.residues[p]),w=!0}}}l={}}i.setStyleCls.setStyle2Atoms(t),i.bAllAtoms=!1,t&&void 0!==t&&(i.bAllAtoms=Object.keys(t).length===Object.keys(i.atoms).length);var S=.5*i.cylinderRadius;void 0!==i.labels&&delete i.labels.schematic;var _=!1;if(s){var A=i.firstAtomObjCls.getResiduesFromCalphaAtoms(i.hAtoms),x=n.hashUtilsCls.intHash(i.hAtoms,i.proteins);r=i.firstAtomObjCls.getResiduesFromAtoms(x);Object.keys(r)>Object.keys(A)&&(_=!0)}for(var k in i.style2atoms){var O=i.style2atoms[k],H=n.utilsCls.isCalphaPhosOnly(n.hashUtilsCls.hash2Atoms(O,i.atoms));if("ribbon"!==k||s&&(!s||_))if("strand"!==k||s&&(!s||_))if("cylinder and plate"!==k||s&&(!s||_))if("nucleotide cartoon"===k)H?i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["P"],i.traceRadius,!1,s):(i.cartoonNuclCls.drawCartoonNucleicAcid(n.hashUtilsCls.hash2Atoms(O,i.atoms),null,i.ribbonthickness,s),2!==s&&i.cartoonNuclCls.drawNucleicAcidStick(n.hashUtilsCls.hash2Atoms(O,i.atoms),s));else if("o3 trace"===k)H?i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["P"],i.traceRadius,!1,s):i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["O3'","O3*"],i.traceRadius,!1,s);else if("schematic"===k){var R=i.firstAtomObjCls.getFirstAtomObj(O);i.chemicals.hasOwnProperty(R.serial)?(i.residueLabelsCls.addNonCarbonAtomLabels(n.hashUtilsCls.hash2Atoms(O,i.atoms)),bSchematic=!0,i.stickCls.createStickRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),S,S,void 0,s,bSchematic)):(i.residueLabelsCls.addResidueLabels(n.hashUtilsCls.hash2Atoms(O,i.atoms),!0),H?i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["P"],i.traceRadius,!1,s):i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["O3'","O3*"],i.traceRadius,!1,s),i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["CA"],i.traceRadius,!1,s))}else"c alpha trace"===k?i.cylinderCls.createCylinderCurve(n.hashUtilsCls.hash2Atoms(O,i.atoms),["CA"],i.traceRadius,!1,s):"b factor tube"===k?i.tubeCls.createTube(n.hashUtilsCls.hash2Atoms(O,i.atoms),"CA",null,s,!1,!0):"custom tube"===k?i.tubeCls.createTube(n.hashUtilsCls.hash2Atoms(O,i.atoms),"CA",null,s,!0,!0):"lines"===k?(1===s?i.stickCls.createStickRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.hlLineRadius,i.hlLineRadius,void 0,s):i.lineCls.createLineRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),s),i.lineCls.createConnCalphSidechain(n.hashUtilsCls.hash2Atoms(O,i.atoms),k)):"stick"===k?(i.stickCls.createStickRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.cylinderRadius,i.cylinderRadius,void 0,s,void 0),i.lineCls.createConnCalphSidechain(n.hashUtilsCls.hash2Atoms(O,i.atoms),k)):"backbone"===k?(O=this.selectMainChainSubset(O),i.stickCls.createStickRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.cylinderRadius,i.cylinderRadius,void 0,s,void 0)):"ball and stick"===k?(i.stickCls.createStickRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.cylinderRadius,.5*i.cylinderRadius,i.dotSphereScale,s,void 0),i.lineCls.createConnCalphSidechain(n.hashUtilsCls.hash2Atoms(O,i.atoms),k)):"sphere"===k?i.sphereCls.createSphereRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.sphereRadius,void 0,void 0,s):"dot"===k&&i.sphereCls.createSphereRepresentation(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.sphereRadius,!1,i.dotSphereScale,s);else i.cylinderCls.createCylinderHelix(n.hashUtilsCls.hash2Atoms(O,i.atoms),i.cylinderHelixRadius,s);else i.strandCls.createStrand(n.hashUtilsCls.hash2Atoms(O,i.atoms),null,null,null,null,null,!1,void 0,s);else i.strandCls.createStrand(n.hashUtilsCls.hash2Atoms(O,i.atoms),2,void 0,!0,void 0,void 0,!1,i.ribbonthickness,s)}i.cnt>i.maxmaxatomcnt&&i.init_base(),void 0!==i.labels&&Object.keys(i.labels).length>0&&(i.labelCls.hideLabels(),i.labelCls.createLabelRepresentation(i.labels))}selectMainChainSubset(e){var t=this.icn3d;t.icn3dui;var s=["C1'","C1*","C2'","C2*","C3'","C3*","C4'","C4*","C5'","C5*","O3'","O3*","O4'","O4*","O5'","O5*","P","OP1","O1P","OP2","O2P"],i={};for(var n in e)(t.proteins.hasOwnProperty(n)&&("N"===t.atoms[n].name||"C"===t.atoms[n].name||"O"===t.atoms[n].name||"CA"===t.atoms[n].name&&"C"===t.atoms[n].elem)||t.nucleotides.hasOwnProperty(n)&&-1!==s.indexOf(t.atoms[n].name))&&(i[n]=1);return i}}class je{constructor(e){this.icn3d=e}showGlycans(){var e=this.icn3d,t=e.icn3dui;if(!e.icn3dui.bNode){var s={},i=e.dAtoms;for(var n in i){var r=e.atoms[n];r.het&&-1!=t.parasCls.glycanHash.hasOwnProperty(r.resn)&&(void 0===s[r.resn]&&(s[r.resn]={}),"Misc"!=r.chain&&(s[r.resn][r.structure+"_"+r.chain+"_"+r.resi]=1))}for(var a=Object.keys(s),l=(n=0,a.length);n<l;++n){var o=a[n];if(t.parasCls.glycanHash.hasOwnProperty(o))for(var d=t.parasCls.glycanHash[o].s,c=new THREE.Color("#"+t.parasCls.glycanHash[o].c),h=Object.keys(s[o]),m=0,p=h.length;m<p;++m){var u=e.applyCenterCls.centerAtoms(e.residues[h[m]]),C=u.center,v=.5*u.maxD*.6;if("cube"==d)e.boxCls.createBox_base(C,v,c,!1,!1,!0);else if("sphere"==d)e.sphereCls.createSphereBase(C,c,v,1,!1,!0);else if("cone"==d){var g=new THREE.Vector3(0,0,1),f=e.axesCls.createArrow(g,new THREE.Vector3(0,0,-1*v).add(C),0,c,2*v,2*v,!0);e.mdl.add(f),e.objects.push(f)}else if("cylinder"==d){var b=new THREE.Vector3(0,0,v).add(C),y=new THREE.Vector3(0,0,-1*v).add(C);e.cylinderCls.createCylinder(b,y,v,c,!1,c,!1,!0)}}}}}}class Be{constructor(e){this.icn3d=e}applySymd(){var e=this.icn3d;e.icn3dui;for(var t=0,s=e.symdArray.length;t<s;++t){var i=e.symdArray[t],n=Object.keys(i)[0];this.applySymmetry(n,!0,i[n])}}applySymmetry(e,t,s){var i=this.icn3d,n=i.icn3dui,r=t?s:i.symmetryHash[e];r||(r=[]);var a=e.substr(0,1),l=parseInt(e.substring(1,e.indexOf(" "))),o=2*i.cylinderRadius*i.oriMaxD/150,d=1*i.cylinderRadius*i.oriMaxD/150;"I"==a&&(o*=2,d*=2);for(var c=[],h=0,m=r.length;h<m;++h){var p=r[h][0],u=r[h][1],C=r[h][2],v=r[h][3],g=r[h][4],f=r[h][5];if(i.cylinderCls.createCylinder(p,u,o,C,0),"C"==a||"D"==a&&g==l){var b={};Object.keys(i.chains).length;var y=!1,w={};if(t&&Object.keys(i.hAtoms).length<Object.keys(i.atoms).length){for(var S in i.hAtoms){w[H=(F=i.atoms[S]).structure+"_"+F.chain]=1}Object.keys(w).length>1&&(y=!0)}if(t)if(y){O=Object.keys(w)[0];b=i.chains[O]}else{0==Object.keys(i.hAtoms).length&&(i.hAtoms=n.hashUtilsCls.cloneHash(i.atoms));var _,A=parseInt(Object.keys(i.hAtoms).length/g),x=0;for(var S in i.hAtoms)if(b[S]=1,_=S,++x>A)break;var k=i.atoms[_].structure+"_"+i.atoms[_].chain+"_"+i.atoms[_].resi;b=n.hashUtilsCls.unionHash(b,i.residues[k])}else{var O=Object.keys(i.structures)[0]+"_"+f;if(i.chains.hasOwnProperty(O)||(O=Object.keys(i.structures)[0]+"_"+f.toLowerCase()),!i.chains.hasOwnProperty(O))for(var H in O=Object.keys(i.chains)[0],i.chains){var R=Object.keys(i.chains[H])[0];if(i.proteins.hasOwnProperty(R)){O=H;break}}b=i.chains[O]}var E=p.clone().add(u).multiplyScalar(.5),I=new THREE.Vector3,D=(A=0,u.clone().sub(p).normalize()),T=new THREE.Vector3(0,0,1),M=new THREE.Quaternion;M.setFromUnitVectors(D,T);var P=-9999;for(var S in b){var F,L=(F=i.atoms[S]).coord.clone();I.add(L),L.sub(E).applyQuaternion(M);var N=L.x*L.x+L.y*L.y;N>P&&(P=N),++A}var $=I.multiplyScalar(1/A),U=new THREE.Line3(p,u),q=new THREE.Vector3;U.closestPointToPoint($,!0,q);var j,B,z,G,V=Math.sqrt(P),W=$.clone().sub(q).normalize().multiplyScalar(V),Y=E.clone().add(p.clone().sub(E).multiplyScalar(.83)).add(W),X=E.clone().add(u.clone().sub(E).multiplyScalar(.83)).add(W),K=2*Math.PI/l;for(x=0;x<l;++x){var Q=(.5+x)*K,J=Y.clone().sub(p);J.applyAxisAngle(D,Q).add(p);var Z=X.clone().sub(p);Z.applyAxisAngle(D,Q).add(p),i.cylinderCls.createCylinder(J,Z,d,v,0),i.sphereCls.createSphereBase(J,v,d,1,0),i.sphereCls.createSphereBase(Z,v,d,1,0),0==x?(j=J,B=Z):(i.cylinderCls.createCylinder(J,z,d,v,0),i.cylinderCls.createCylinder(Z,G,d,v,0)),z=J,G=Z}j&&z&&i.cylinderCls.createCylinder(j,z,d,v,0),B&&G&&i.cylinderCls.createCylinder(B,G,d,v,0)}else("T"==a&&3==g||"O"==a&&4==g||"I"==a&&5==g)&&(c.push(p),c.push(u))}if("T"==a){var ee=c[0];i.sphereCls.createSphereBase(ee,v,d,1,0);var te,se,ie,ne=ee.distanceTo(c[2]);ne<(oe=ee.distanceTo(c[3]))?(te=ne,se=c[3]):(te=oe,se=c[2]),i.sphereCls.createSphereBase(se,v,d,1,0),i.cylinderCls.createCylinder(ee,se,d,v,0);for(h=4,m=c.length;h<m;++h){var re=c[h];ee.distanceTo(re)>te&&(i.sphereCls.createSphereBase(re,v,d,1,0),i.cylinderCls.createCylinder(ee,re,d,v,0),i.cylinderCls.createCylinder(se,re,d,v,0),void 0!==ie&&i.cylinderCls.createCylinder(c[ie],re,d,v,0),ie=h)}}else if("O"==a)for(h=0,m=c.length;h<m;h+=2){ee=c[h],re=c[h+1];i.sphereCls.createSphereBase(ee,v,d,1,0),i.sphereCls.createSphereBase(re,v,d,1,0);x=h+2;for(var ae=c.length;x<ae;++x){var le=c[x];i.sphereCls.createSphereBase(le,v,d,1,0),i.cylinderCls.createCylinder(ee,le,d,v,0),i.cylinderCls.createCylinder(re,le,d,v,0)}}else if("I"==a)for(h=0,m=c.length;h<m;h+=2){ee=c[h],re=c[h+1];i.sphereCls.createSphereBase(ee,v,d,1,0),i.sphereCls.createSphereBase(re,v,d,1,0);for(x=h+2,ae=c.length;x<ae;x+=2){le=c[x];var oe,de,ce,he=c[x+1];(oe=ee.distanceTo(le))<ee.distanceTo(he)?(de=le,ce=he):(de=he,ce=le),i.sphereCls.createSphereBase(de,v,d,1,0),i.sphereCls.createSphereBase(ce,v,d,1,0),i.cylinderCls.createCylinder(ee,de,d,v,0),i.cylinderCls.createCylinder(re,ce,d,v,0)}}}}class ze{constructor(e){this.icn3d=e}applyOtherOptions(e){var t=this.icn3d;if(t.icn3dui,void 0===e&&(e=t.opts),t.hBondCls.setHbondsContacts(e,"contact"),t.hBondCls.setHbondsContacts(e,"halogen"),t.hBondCls.setHbondsContacts(e,"pi-cation"),t.hBondCls.setHbondsContacts(e,"pi-stacking"),t.hBondCls.setHbondsContacts(e,"hbond"),t.hBondCls.setHbondsContacts(e,"saltbridge"),void 0!==t.pairArray&&t.pairArray.length>0){this.updateStabilizer();var s=t.stabilizerpnts;t.lines.stabilizer=[];for(var i=0,n=Math.floor(s.length/2);i<n;i++){var r={};r.position1=s[2*i],r.position2=s[2*i+1],r.color="#FFFFFF",r.dashed=!1,t.lines.stabilizer.push(r)}}if(t.lineCls.createLines(t.lines),t.distPnts.length>0){i=0;for(var a=t.distPnts.length;i<a;++i)t.boxCls.createBox_base(t.distPnts[i],t.originSize,t.hColor,!1)}if(void 0!==t.prevMaps)for(i=0,a=t.prevMaps.length;i<a;++i)t.mdl.add(t.prevMaps[i]);if(void 0!==t.prevEmmaps)for(i=0,a=t.prevEmmaps.length;i<a;++i)t.mdl.add(t.prevEmmaps[i]);if(void 0!==t.prevPhimaps)for(i=0,a=t.prevPhimaps.length;i<a;++i)t.mdl.add(t.prevPhimaps[i]);if(void 0!==t.prevSurfaces)for(i=0,a=t.prevSurfaces.length;i<a;++i)t.mdl.add(t.prevSurfaces[i]);if(void 0!==t.symmetryHash&&void 0!==t.symmetrytitle&&t.applySymdCls.applySymmetry(t.symmetrytitle),void 0!==t.symdArray&&t.symdArray.length>0&&t.applySymdCls.applySymd(),void 0!==t.prevOtherMesh)for(i=0,a=t.prevOtherMesh.length;i<a;++i)t.mdl.add(t.prevOtherMesh[i]);switch(t.bGlycansCartoon&&!t.bAlternate&&t.glycanCls.showGlycans(),t.applyCenterCls.applyCenterOptions(e),t.axesCls.buildAllAxes(void 0,!0),e.axis.toLowerCase()){case"yes":t.axis=!0,t.axesCls.buildAxes(t.maxD/2);break;case"no":t.axis=!1}switch(e.pk.toLowerCase()){case"atom":t.pk=1;break;case"no":t.pk=0;break;case"residue":t.pk=2;break;case"strand":t.pk=3}}applyChemicalbindingOptions(e){var t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),"show"===e.chemicalbinding){var i;void 0!==t.chemicals&&Object.keys(t.chemicals).length>0&&(i=s.hashUtilsCls.hash2Atoms(t.chemicals,t.atoms));if(void 0!==i){var n=t.contactCls.getAtomsWithinAtom(t.atoms,i,4);t.opts.hbonds="yes",Object.keys(n).length>0&&t.hBondCls.calculateChemicalHbonds(i,n,parseFloat(3.5)),t.bSetFog||t.transformCls.zoominSelection(s.hashUtilsCls.unionHash(i,n))}}else"hide"===e.chemicalbinding&&(t.hBondCls.hideHbonds(),t.bSetFog||t.transformCls.zoominSelection(t.atoms))}updateStabilizer(){var e=this.icn3d;if(e.icn3dui,e.stabilizerpnts=[],void 0!==e.pairArray)for(var t=0,s=e.pairArray.length;t<s;t+=2){var i=this.getResidueRepPos(e.pairArray[t]),n=this.getResidueRepPos(e.pairArray[t+1]);e.stabilizerpnts.push(i),e.stabilizerpnts.push(n)}}getResidueRepPos(e){var t=this.icn3d;t.icn3dui;var s,i=t.atoms[e],n=i.structure+"_"+i.chain+"_"+i.resi;if(t.proteins.hasOwnProperty(e)||t.nucleotides.hasOwnProperty(e))for(var r in t.residues[n]){var a=t.atoms[r];if("N3"===a.name){s=t.atoms[r].coord;break}if("CA"===a.name&&"coil"==a.ss){s=t.atoms[r].coord;break}if("CA"===a.name&&("helix"==a.ss||"sheet"==a.ss)){s=void 0!==t.atoms[r].coord2?t.atoms[r].coord2:t.atoms[r].coord;break}}else s=i.coord;return void 0===s&&(s=i.coord),s}}class Ge{constructor(e){this.icn3d=e}applySsbondsOptions(e){var t=this.icn3d,s=t.icn3dui;if(void 0===e&&(e=t.opts),"yes"===e.ssbonds.toLowerCase()&&void 0!==t.ssbondpnts){var i,n,r=s.parasCls.thr(16776960),a=Object.keys(t.structures);t.bAlternate?(i=t.ALTERNATE_STRUCTURE,n=t.ALTERNATE_STRUCTURE+1):(i=0,n=a.length),t.lines.ssbond=[];for(var l=i,o=n;l<o;++l){var d=a[l];if(void 0!==t.ssbondpnts[d])for(var c=Math.floor(t.ssbondpnts[d].length/2)-1;c>=0;c--){var h=t.ssbondpnts[d][2*c],m=t.ssbondpnts[d][2*c+1],p={color:"#FFFF00",dashed:!0},u=[],C=[],v=[],g=[],f=!1,b=!1;for(var y in t.residues[h])"SG"===t.atoms[y].name&&(v.push(t.atoms[y].coord),u.push(t.atoms[y].serial),f=!0);if(!f)for(var y in t.residues[h])if("CA"===t.atoms[y].name){v.push(t.atoms[y].coord),u.push(t.atoms[y].serial),f=!0,b=!0;break}for(var y in f=!1,t.residues[m])"SG"===t.atoms[y].name&&(g.push(t.atoms[y].coord),C.push(t.atoms[y].serial),f=!0);if(!f)for(var y in t.residues[m])if("CA"===t.atoms[y].name){g.push(t.atoms[y].coord),C.push(t.atoms[y].serial),f=!0,b=!0;break}for(var w=b?7:3,S=!1,_=0,A=v.length;_<A;++_)for(var x=0,k=g.length;x<k;++x)if(v[_].distanceTo(g[x])<w){S=!0,p.serial1=u[_],p.position1=v[_],p.serial2=C[x],p.position2=g[x];break}if(void 0===p.serial1||void 0===p.serial2||t.dAtoms.hasOwnProperty(p.serial1)||t.dAtoms.hasOwnProperty(p.serial2))if(S){var O,H,R,E=t.atoms[p.serial1].bonds.indexOf(p.serial2);-1!=E&&(O=t.atoms[p.serial1].bonds.slice(0,E),H=t.atoms[p.serial1].bonds.slice(E+1),t.atoms[p.serial1].bonds=O.concat(H)),-1!=(E=t.atoms[p.serial2].bonds.indexOf(p.serial1))&&(O=t.atoms[p.serial2].bonds.slice(0,E),H=t.atoms[p.serial2].bonds.slice(E+1),t.atoms[p.serial2].bonds=O.concat(H)),t.lines.ssbond.push(p),t.cylinderCls.createCylinder(p.position1,p.position2,t.cylinderRadius,r),R=s.hashUtilsCls.unionHash(R,t.residues[h]),R=s.hashUtilsCls.unionHash(R,t.residues[m]);var I=s.hashUtilsCls.intHash(R,t.sidec);for(var y in I)t.atoms[y].style2="stick"}else t.ssbondpnts[d].splice(2*c,2)}}}}}class Ve{constructor(e){this.icn3d=e}rebuildScene(e){var t=this.icn3d;t.icn3dui,void 0===e&&(e=t.opts),this.rebuildSceneBase(e),t.fogCls.setFog(),t.cameraCls.setCamera(),void 0!==t.bSkipChemicalbinding&&t.bSkipChemicalbinding||t.applyOtherCls.applyChemicalbindingOptions(),t.bSkipChemicalbinding=!0,"show"===e.chemicalbinding&&(t.opts.hbonds="yes"),t.applySsbondsCls.applySsbondsOptions(),t.applyClbondsCls.applyClbondsOptions(),t.applyDisplayCls.applyDisplayOptions(t.opts,t.dAtoms),t.applyOtherCls.applyOtherOptions(),t.scene_ghost.updateMatrixWorld(!0)}rebuildSceneBase(e){var t=this.icn3d,s=t.icn3dui;if($.extend(t.opts,e),t.cam_z=2*t.maxD,void 0!==t.scene)for(var i=t.scene.children.length-1;i>=0;i--){var n=t.scene.children[i];t.scene.remove(n)}else t.scene=new THREE.Scene;if(void 0!==t.scene_ghost)for(i=t.scene_ghost.children.length-1;i>=0;i--){n=t.scene_ghost.children[i];t.scene_ghost.remove(n)}else t.scene_ghost=new THREE.Scene;t.directionalLight=new THREE.DirectionalLight(16777215,1),t.directionalLight2=new THREE.DirectionalLight(16777215,.4),t.directionalLight3=new THREE.DirectionalLight(16777215,.2),t.cam_z>0?(t.directionalLight.position.set(0,1,1),t.directionalLight2.position.set(0,-1,1),t.directionalLight3.position.set(0,1,-1),t.lightPos=new THREE.Vector3(0,1,1),t.lightPos2=new THREE.Vector3(0,-1,1),t.lightPos3=new THREE.Vector3(0,1,-1)):(t.directionalLight.position.set(0,1,-1),t.directionalLight2.position.set(0,-1,-1),t.directionalLight3.position.set(0,1,1),t.lightPos=new THREE.Vector3(0,1,-1),t.lightPos2=new THREE.Vector3(0,-1,-1),t.lightPos3=new THREE.Vector3(0,1,1));var r=new THREE.AmbientLight(4210752);if(t.scene.add(t.directionalLight),t.scene.add(r),void 0!==t.mdl)for(i=t.mdl.children.length-1;i>=0;i--){(n=t.mdl.children[i]).geometry.dispose(),n.material.dispose(),t.mdl.remove(n)}if(void 0!==t.mdlImpostor){for(i=t.mdlImpostor.children.length-1;i>=0;i--){(n=t.mdlImpostor.children[i]).geometry.dispose(),n.material.dispose(),t.mdlImpostor.remove(n)}t.mdlImpostor.children.length=0}t.icn3dui.bNode||t.renderer.renderLists.dispose(),t.mdl=new THREE.Object3D,t.mdlImpostor=new THREE.Object3D,t.scene.add(t.mdl),t.scene.add(t.mdlImpostor),t.mdl_ghost=new THREE.Object3D,t.scene_ghost.add(t.mdl_ghost),t.objects=[],t.objects_ghost=[],t.raycaster=new THREE.Raycaster,t.projector=new THREE.Projector,t.mouse=new THREE.Vector2;var a=s.parasCls.backgroundColors[t.opts.background.toLowerCase()];t.icn3dui.bNode||("transparent"===t.opts.background.toLowerCase()?t.renderer.setClearColor(a,0):t.renderer.setClearColor(a,1)),t.perspectiveCamera=new THREE.PerspectiveCamera(20,t.container.whratio,.1,1e4),t.perspectiveCamera.position.set(0,0,t.cam_z),t.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),t.orthographicCamera=new THREE.OrthographicCamera,t.orthographicCamera.position.set(0,0,t.cam_z),t.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),t.cams={perspective:t.perspectiveCamera,orthographic:t.orthographicCamera}}}class We{constructor(e){this.icn3d=e}onBeforeRender(e,t,s,i,n){var r=n.uniforms,a=[];if(r.objectId&&(r.objectId.value=SupportsReadPixelsFloat?this.id:this.id/255,a.push("objectId")),(r.modelViewMatrixInverse||r.modelViewMatrixInverseTranspose||r.modelViewProjectionMatrix||r.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,this.matrixWorld),r.modelViewMatrixInverse&&(r.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),a.push("modelViewMatrixInverse")),r.modelViewMatrixInverseTranspose&&(r.modelViewMatrixInverse?r.modelViewMatrixInverseTranspose.value.copy(r.modelViewMatrixInverse.value).transpose():r.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),a.push("modelViewMatrixInverseTranspose")),r.modelViewProjectionMatrix&&(s.updateProjectionMatrix(),r.modelViewProjectionMatrix.value.multiplyMatrices(s.projectionMatrix,this.modelViewMatrix),a.push("modelViewProjectionMatrix")),r.modelViewProjectionMatrixInverse){var l=new THREE.Matrix4;r.modelViewProjectionMatrix?(l.copy(r.modelViewProjectionMatrix.value),r.modelViewProjectionMatrixInverse.value.getInverse(l)):(s.updateProjectionMatrix(),l.multiplyMatrices(s.projectionMatrix,this.modelViewMatrix),r.modelViewProjectionMatrixInverse.value.getInverse(l)),a.push("modelViewProjectionMatrixInverse")}if(r.projectionMatrix&&(s.updateProjectionMatrix(),r.projectionMatrix.value.copy(s.projectionMatrix),a.push("projectionMatrix")),r.projectionMatrixInverse&&(s.updateProjectionMatrix(),r.projectionMatrixInverse.value.getInverse(s.projectionMatrix),a.push("projectionMatrixInverse")),a.length){var o=e.properties.get(n);if(o.program){var d=e.getContext(),c=o.program;d.useProgram(c.program);var h=c.getUniforms();a.forEach((function(e){h.setValue(d,e,r[e].value)}))}}}setParametersForShader(e){var t,s=this.icn3d,i=s.icn3dui.parasCls.backgroundColors[s.opts.background.toLowerCase()],n=2.5*s.maxD,r=4*s.maxD,a=void 0!==s.biomtMatrices&&s.biomtMatrices.length*s.cnt>s.maxatomcnt;"yes"===s.opts.slab?a?t=.1:void 0!==s.camMaxDFactorFog?(t=s.maxD*s.camMaxDFactorFog-10,n=2.5*s.maxD-t<0?0:2.5*s.maxD-t,r=4*s.maxD-t):t=s.maxD*s.camMaxDFactor:t=.1;var l=void 0!==e?e:1;s.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{modelViewMatrix:{value:new THREE.Matrix4},modelViewMatrixInverse:{value:new THREE.Matrix4},modelViewMatrixInverseTranspose:{value:new THREE.Matrix4},modelViewProjectionMatrix:{value:new THREE.Matrix4},modelViewProjectionMatrixInverse:{value:new THREE.Matrix4},projectionMatrix:{value:new THREE.Matrix4},projectionMatrixInverse:{value:new THREE.Matrix4},diffuse:{type:"v3",value:[1,1,1]},emissive:{type:"v3",value:[0,0,0]},roughness:{type:"f",value:.5},metalness:{type:"f",value:.3},opacity:{type:"f",value:l},nearClip:{type:"f",value:t},ortho:{type:"f",value:0},shrink:{type:"f",value:.13},fogColor:{type:"v3",value:[i.r,i.g,i.b]},fogNear:{type:"f",value:n},fogFar:{type:"f",value:r},fogDensity:{type:"f",value:2}},THREE.UniformsLib.ambient,THREE.UniformsLib.lights]),s.defines={USE_COLOR:1,NEAR_CLIP:1,CAP:1},"yes"!==s.opts.fog||a||(s.defines.USE_FOG=1,"orthographic"===s.opts.camera&&(s.defines.FOG_EXP2=1)),s.bExtFragDepth&&(s.defines.USE_LOGDEPTHBUF_EXT=1)}drawImpostorShader(){var e=this.icn3d;e.icn3dui,e.icn3dui.bNode||(this.setParametersForShader(),this.createImpostorShaderSphere("SphereImpostor"),this.createImpostorShaderCylinder("CylinderImpostor"))}getShader(e){this.icn3d.icn3dui;var t=$NGL_shaderTextHash[e];return t=t.replace(/#include\s+(\S+)/gim,(function(e,t){var s;return THREE.ShaderChunk.hasOwnProperty(t)&&(s=THREE.ShaderChunk[t]),s||""}))}createImpostorShaderBase(e,t,s,i,n,r,a,l,o){var d=this.icn3d;d.icn3dui;var c=new THREE.ShaderMaterial({defines:d.defines,uniforms:d.uniforms,vertexShader:this.getShader(e+".vert"),fragmentShader:this.getShader(e+".frag"),depthTest:!0,depthWrite:!0,lights:!0});c.extensions.fragDepth=!0,"CylinderImpostor"==e?d.CylinderImpostorMaterial=c:"SphereImpostor"==e&&(d.SphereImpostorMaterial=c);for(var h,m,p=r*a,u=r*l,C=new(p>65535?Uint32Array:Uint16Array)(u),v=0;v<r;v++){h=v*l,m=v*a,C.set(s,h);for(var g=0;g<l;++g)C[h+g]+=m}var f=new THREE.BufferGeometry;C&&(f.setIndex(new THREE.BufferAttribute(C,1)),f.getIndex().setDynamic(true));var b={f:1,v2:2,v3:3,c:3};for(var y in n){var w,S=n[y];w=new Float32Array(p*b[S.type]),f.addAttribute(y,new THREE.BufferAttribute(w,b[S.type]).setDynamic(true))}var _,A,x,k,O,H=f.attributes;for(var y in i){_=i[y],A=(S=H[y]).itemSize,x=S.array;for(var R=0;R<r;++R){k=(u=R*A)*a;for(var E=0;E<a;++E){O=k+A*E;for(var I=0;I<A;++I)x[O+I]=_[u+I]}}S.needsUpdate=!0}var D=f.attributes.mapping.array;for(v=0;v<r;v++)D.set(t,v*o*a);var T=new THREE.Mesh(f,c);T.frustumCulled=!1,T.scale.x=T.scale.y=T.scale.z=1,"CylinderImpostor"==e?T.type="Cylinder":"SphereImpostor"==e&&(T.type="Sphere"),T.onBeforeRender=this.onBeforeRender,d.mdlImpostor.add(T)}createImpostorShaderCylinder(e){var t=this.icn3d;t.icn3dui;var s=new Float32Array(t.posArray),i=new Float32Array(t.colorArray),n=new Float32Array(t.pos2Array),r=new Float32Array(t.color2Array),a=new Float32Array(t.radiusArray),l=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),o=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),d=s.length/3,c={position1:s,color:i,position2:n,color2:r,radius:a},h={position1:{type:"v3",value:null},color:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v3",value:null}};this.createImpostorShaderBase(e,l,o,c,h,d,6,12,3),c=null,s=null,i=null,n=null,r=null,a=null,t.posArray=[],t.colorArray=[],t.pos2Array=[],t.color2Array=[],t.radiusArray=[]}createImpostorShaderSphere(e){var t=this.icn3d;t.icn3dui;var s=new Float32Array(t.posArraySphere),i=new Float32Array(t.colorArraySphere),n=new Float32Array(t.radiusArraySphere),r=new Float32Array([-1,1,-1,-1,1,1,1,-1]),a=new Uint16Array([0,1,2,1,3,2]),l=s.length/3,o={position:s,color:i,radius:n},d={position:{type:"v3",value:null},color:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v2",value:null}};this.createImpostorShaderBase(e,r,a,o,d,l,4,6,2),o=null,s=null,i=null,n=null,t.posArraySphere=[],t.colorArraySphere=[],t.radiusArraySphere=[]}clearImpostors(){var e=this.icn3d;e.icn3dui,e.posArray=[],e.colorArray=[],e.pos2Array=[],e.color2Array=[],e.radiusArray=[],e.posArraySphere=[],e.colorArraySphere=[],e.radiusArraySphere=[]}}class Ye{constructor(e){this.icn3d=e}positionFromGeometry(e){this.icn3d.icn3dui;for(var t,s,i=e.geometry,n=i.vertices,r=e.position,a=e.scale,l=e.matrix,o=n.length,d=[],c=0;c<o;c++)t=3*c,s="SphereGeometry"==i.type||"BoxGeometry"==i.type?n[c].clone().multiply(a).add(r):"CylinderGeometry"==i.type?n[c].clone().applyMatrix4(l):n[c],d[t+0]=s.x,d[t+1]=s.y,d[t+2]=s.z;return d}colorFromGeometry(e){var t=this.icn3d.icn3dui,s=e.geometry,i=t.parasCls.thr(1,1,1);"SphereGeometry"!=s.type&&"BoxGeometry"!=s.type&&"CylinderGeometry"!=s.type||void 0!==e.material&&(i=e.material.color);var n,r,a,l,o,d=s.faces;s.vertices.length,s.type;for(var c=d.length,h=[],m=0;m<c;m++)r=d[m],"Surface"==s.type?(a=r.vertexColors[0],l=r.vertexColors[1],o=r.vertexColors[2]):"SphereGeometry"==s.type||"BoxGeometry"==s.type||"CylinderGeometry"==s.type?(a=i,l=i,o=i):(a=r.color,l=r.color,o=r.color),h[(n=3*r.a)+0]=a.r,h[n+1]=a.g,h[n+2]=a.b,h[(n=3*r.b)+0]=l.r,h[n+1]=l.g,h[n+2]=l.b,h[(n=3*r.c)+0]=o.r,h[n+1]=o.g,h[n+2]=o.b;return h}indexFromGeometry(e){this.icn3d.icn3dui;for(var t,s,i=e.geometry.faces,n=i.length,r=[],a=0;a<n;a++)t=3*a,s=i[a],r[t+0]=s.a,r[t+1]=s.b,r[t+2]=s.c;return r}normalFromGeometry(e){this.icn3d.icn3dui;var t,s,i,n,r,a,l=e.geometry,o=l.faces;l.vertices.length;for(var d=o.length,c=[],h=0;h<d;h++)n=(i=(s=o[h]).vertexNormals)[0],r=i[1],a=i[2],c[(t=3*s.a)+0]=n.x,c[t+1]=n.y,c[t+2]=n.z,c[(t=3*s.b)+0]=r.x,c[t+1]=r.y,c[t+2]=r.z,c[(t=3*s.c)+0]=a.x,c[t+1]=a.y,c[t+2]=a.z;return c}drawSymmetryMates(){var e=this.icn3d;e.icn3dui,e.icn3dui.bNode||(e.bInstanced&&Object.keys(e.atoms).length*e.biomtMatrices.length>e.maxatomcnt?this.drawSymmetryMatesInstancing():this.drawSymmetryMatesNoInstancing())}applyMat(e,t,s){var i=this.icn3d;if(i.icn3dui,void 0===i.rmsd_supr)void 0===s?e.applyMatrix(t):s&&e.applyMatrix4(t);else{var n=i.rmsd_supr.rot,r=i.rmsd_supr.trans1,a=i.rmsd_supr.trans2,l=new THREE.Matrix4;l.set(n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1);var o=new THREE.Matrix4;o.getInverse(l);var d=new THREE.Matrix4;void 0===s?(d.makeTranslation(-a.x,-a.y,-a.z),e.applyMatrix(d),e.applyMatrix(o),d.makeTranslation(r.x,r.y,r.z),e.applyMatrix(d),e.applyMatrix(t),d.makeTranslation(-r.x,-r.y,-r.z),e.applyMatrix(d),e.applyMatrix(l),d.makeTranslation(a.x,a.y,a.z),e.applyMatrix(d)):s&&(d.makeTranslation(-a.x,-a.y,-a.z),e.applyMatrix4(d),e.applyMatrix4(o),d.makeTranslation(r.x,r.y,r.z),e.applyMatrix4(d),e.applyMatrix4(t),d.makeTranslation(-r.x,-r.y,-r.z),e.applyMatrix4(d),e.applyMatrix4(l),d.makeTranslation(a.x,a.y,a.z),e.applyMatrix4(d))}}drawSymmetryMatesNoInstancing(){var e=this.icn3d;if(e.icn3dui,void 0!==e.biomtMatrices&&0!=e.biomtMatrices.length){var t=1,s=e.center.clone(),i=new THREE.Matrix4;i.identity();for(var n=new THREE.Object3D,r=new THREE.Object3D,a=new THREE.Object3D,l=0;l<e.biomtMatrices.length;l++){var o=e.biomtMatrices[l];if(void 0!==o&&!o.equals(i)){var d;if(void 0!==e.mdl&&(d=e.mdl.clone(),this.applyMat(d,o),n.add(d)),void 0!==e.mdlImpostor){d=e.mdlImpostor.clone(),this.applyMat(d,o);for(var c=d.children.length-1;c>=0;c--){d.children[c].onBeforeRender=e.impostorCls.onBeforeRender}r.add(d)}void 0!==e.mdl_ghost&&(d=e.mdl_ghost.clone(),this.applyMat(d,o),a.add(d));var h=e.center.clone();this.applyMat(h,o,!0),s.add(h),++t}}e.mdl.add(n),e.mdlImpostor.add(r),e.mdl_ghost.add(a),void 0!==e.bSetInstancing&&e.bSetInstancing?(e.maxD=e.maxDAssembly,e.center=e.centerAssembly.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()):(e.maxD*=Math.sqrt(t),e.center=s.multiplyScalar(1/t),e.maxDAssembly=e.maxD,e.centerAssembly=e.center.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()),e.bSetInstancing=!0}}createInstancedGeometry(e){var t=this.icn3d,s=t.icn3dui,i=e.geometry,n=new THREE.InstancedBufferGeometry,r=[],a=[],l=[],o=[],d=[],c=[],h=[],m=[];if(i.vertices&&i.faces){t.instancedMaterial=this.getInstancedMaterial("Instancing");var p=this.positionFromGeometry(e),u=this.normalFromGeometry(e),C=this.colorFromGeometry(e),v=this.indexFromGeometry(e);r=r.concat(p),a=a.concat(u),l=l.concat(C),o=o.concat(v);for(var g=[],f="CylinderGeometry"==i.type?1:0,b=0,y=r.length/3;b<y;++b)g.push(f);n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),n.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(a),3)),n.addAttribute("color",new THREE.BufferAttribute(new Float32Array(l),3)),n.addAttribute("cylinder",new THREE.BufferAttribute(new Float32Array(g),1)),n.setIndex(new THREE.BufferAttribute(new Uint32Array(o),1)),p=null,u=null,C=null,v=null}else if(t.bImpo&&void 0!==i.attributes.color2){t.instancedMaterial=this.getInstancedMaterial("CylinderInstancing");p=s.hashUtilsCls.hashvalue2array(i.attributes.position1.array),C=s.hashUtilsCls.hashvalue2array(i.attributes.color.array);var w=s.hashUtilsCls.hashvalue2array(i.attributes.position2.array),S=s.hashUtilsCls.hashvalue2array(i.attributes.color2.array),_=(v=s.hashUtilsCls.hashvalue2array(i.index.array),s.hashUtilsCls.hashvalue2array(i.attributes.radius.array)),A=s.hashUtilsCls.hashvalue2array(i.attributes.mapping.array);r=r.concat(p),l=l.concat(C),h=h.concat(w),m=m.concat(S),o=o.concat(v),d=d.concat(_),c=c.concat(A),n.addAttribute("position1",new THREE.BufferAttribute(new Float32Array(r),3)),n.addAttribute("color",new THREE.BufferAttribute(new Float32Array(l),3)),n.addAttribute("position2",new THREE.BufferAttribute(new Float32Array(h),3)),n.addAttribute("color2",new THREE.BufferAttribute(new Float32Array(m),3)),n.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(d),1)),n.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),3)),n.setIndex(new THREE.BufferAttribute(new Uint32Array(o),1)),p=null,C=null,w=null,S=null,v=null,_=null,A=null}else if(t.bImpo&&void 0!==i.attributes.color){t.instancedMaterial=this.getInstancedMaterial("SphereInstancing");p=s.hashUtilsCls.hashvalue2array(i.attributes.position.array),C=s.hashUtilsCls.hashvalue2array(i.attributes.color.array),v=s.hashUtilsCls.hashvalue2array(i.index.array),_=s.hashUtilsCls.hashvalue2array(i.attributes.radius.array),A=s.hashUtilsCls.hashvalue2array(i.attributes.mapping.array);r=r.concat(p),l=l.concat(C),o=o.concat(v),d=d.concat(_),c=c.concat(A),n.addAttribute("position",new THREE.BufferAttribute(new Float32Array(r),3)),n.addAttribute("color",new THREE.BufferAttribute(new Float32Array(l),3)),n.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(d),1)),n.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),2)),n.setIndex(new THREE.BufferAttribute(new Uint32Array(o),1)),p=null,C=null,v=null,_=null,A=null}r=null,a=null,l=null,o=null,d=null,c=null,h=null,m=null;var x=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements1),4),k=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements2),4),O=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements3),4),H=new THREE.InstancedBufferAttribute(new Float32Array(t.matricesElements4),4);return n.addAttribute("matrix1",x),n.addAttribute("matrix2",k),n.addAttribute("matrix3",O),n.addAttribute("matrix4",H),n}getInstancedMaterial(e){var t=this.icn3d;t.icn3dui;var s=new THREE.ShaderMaterial({defines:t.defines,uniforms:t.uniforms,vertexShader:t.impostorCls.getShader(e+".vert"),fragmentShader:t.impostorCls.getShader(e+".frag"),depthTest:!0,depthWrite:!0,lights:!0});return s.extensions.fragDepth=!0,s.extensions.derivatives="#extension GL_OES_standard_derivatives : enable",s}createInstancedMesh(e){var t=this.icn3d;t.icn3dui;for(var s=0,i=e.children.length;s<i;++s){var n=e.children[s];if("Sprite"!==n.type){var r=this.createInstancedGeometry(n),a=new THREE.Mesh(r,t.instancedMaterial);a.onBeforeRender=t.impostorCls.onBeforeRender,a.frustumCulled=!1,r=null,e.add(a)}}}drawSymmetryMatesInstancing(){var e=this.icn3d;if(e.icn3dui,void 0!==e.biomtMatrices&&0!=e.biomtMatrices.length){var t=1,s=e.center.clone();if(e.impostorCls.setParametersForShader(),void 0===e.bSetInstancing||!e.bSetInstancing){e.matricesElements1=[],e.matricesElements2=[],e.matricesElements3=[],e.matricesElements4=[];var i=new THREE.Matrix4;i.identity();for(var n=0;n<e.biomtMatrices.length;n++){var r=e.biomtMatrices[n];if(void 0!==r){var a=r.toArray();if(!r.equals(i)){e.matricesElements1.push(a[0],a[1],a[2],a[3]),e.matricesElements2.push(a[4],a[5],a[6],a[7]),e.matricesElements3.push(a[8],a[9],a[10],a[11]),e.matricesElements4.push(a[12],a[13],a[14],a[15]);var l=e.center.clone();l.applyMatrix4(r),s.add(l),++t}}}}this.createInstancedMesh(e.mdl),this.createInstancedMesh(e.mdlImpostor),void 0!==e.bSetInstancing&&e.bSetInstancing?(e.maxD=e.maxDAssembly,e.center=e.centerAssembly.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()):(e.maxD*=Math.sqrt(t),e.center=s.multiplyScalar(1/t),e.maxDAssembly=e.maxD,e.centerAssembly=e.center.clone(),e.applyCenterCls.setCenter(e.center),e.cameraCls.setCamera()),e.bSetInstancing=!0}}}class Xe{constructor(e){this.icn3d=e}draw(){var e=this.icn3d,t=e.icn3dui;e.bRender&&0==Object.keys(e.hAtoms)&&(e.hAtoms=t.hashUtilsCls.cloneHash(e.atoms)),e.sceneCls.rebuildScene(),e.bImpo&&e.impostorCls.drawImpostorShader(),e.setColorCls.applyPrevColor(),void 0!==e.biomtMatrices&&e.biomtMatrices.length>1&&(e.bAssembly?e.instancingCls.drawSymmetryMates():e.applyCenterCls.centerSelection());var s=void 0!==e.hAtoms?Object.keys(e.hAtoms).length:0;s>0&&s<Object.keys(e.dAtoms).length&&(e.hlObjectsCls.removeHlObjects(),(void 0===e.bShowHighlight||e.bShowHighlight)&&e.hlObjectsCls.addHlObjects()),!0===e.bRender&&((e.bInitial||$("#"+e.pre+"wait").is(":visible"))&&($("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()),this.applyTransformation(e._zoomFactor,e.mouseChange,e.quaternion),this.render()),e.impostorCls.clearImpostors()}applyTransformation(e,t,s){var i=this.icn3d;if(i.icn3dui,!i.icn3dui.bNode){var n={update:!1};n._zoomFactor=e,n.mouseChange=new THREE.Vector2,n.mouseChange.copy(t),n.quaternion=new THREE.Quaternion,n.quaternion.copy(s),i.bControlGl&&!i.icn3dui.bNode?window.controls.update(n):i.controls.update(n)}}render(){var e=this.icn3d;if(e.icn3dui,!e.icn3dui.bNode){var t=e.bControlGl&&!e.icn3dui.bNode?window.cam:e.cam,s=new THREE.Quaternion;s.setFromUnitVectors(new THREE.Vector3(0,0,e.cam_z).normalize(),t.position.clone().normalize()),e.directionalLight.position.copy(e.lightPos.clone().applyQuaternion(s).normalize()),e.directionalLight2.position.copy(e.lightPos2.clone().applyQuaternion(s).normalize()),e.directionalLight3.position.copy(e.lightPos3.clone().applyQuaternion(s).normalize()),e.renderer.gammaInput=!0,e.renderer.gammaOutput=!0,e.renderer.setPixelRatio(window.devicePixelRatio),e.scene&&e.renderer.render(e.scene,t)}}}class Ke{constructor(e){this.icn3d=e}resetOrientation(){var e=this.icn3d;e.icn3dui;var t=!1;if(e.commands.length>0){var s=e.commands[0].split("|||");if(2==s.length){var i=JSON.parse(s[1]);e._zoomFactor=i.factor,e.mouseChange.x=i.mouseChange.x,e.mouseChange.y=i.mouseChange.y,e.quaternion._x=i.quaternion._x,e.quaternion._y=i.quaternion._y,e.quaternion._z=i.quaternion._z,e.quaternion._w=i.quaternion._w,t=!0}}t||(e._zoomFactor=1,e.mouseChange=new THREE.Vector2(0,0),e.quaternion=new THREE.Quaternion(0,0,0,1)),e.maxD=e.oriMaxD,e.center=e.oriCenter.clone(),"show"==e.ori_chemicalbinding?e.bSkipChemicalbinding=!1:"hide"==e.ori_chemicalbinding&&(e.bSkipChemicalbinding=!0)}rotateLeft(e){var t=this.icn3d;t.icn3dui;var s=new THREE.Vector3(0,1,0),i=-e/180*Math.PI;t.bControlGl&&!t.icn3dui.bNode?s.applyQuaternion(window.cam.quaternion).normalize():s.applyQuaternion(t.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(s,-i);var r={};r.quaternion=n,r.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}rotateRight(e){var t=this.icn3d;t.icn3dui;var s=new THREE.Vector3(0,1,0),i=e/180*Math.PI;t.bControlGl&&!t.icn3dui.bNode?s.applyQuaternion(window.cam.quaternion).normalize():s.applyQuaternion(t.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(s,-i);var r={};r.quaternion=n,r.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}rotateUp(e){this.icn3d.icn3dui,this.rotate_base(-e)}rotateDown(e){this.icn3d.icn3dui,this.rotate_base(e)}rotate_base(e){var t=this.icn3d;t.icn3dui;var s=new THREE.Vector3(1,0,0),i=e/180*Math.PI;t.bControlGl&&!t.icn3dui.bNode?s.applyQuaternion(window.cam.quaternion).normalize():s.applyQuaternion(t.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(s,-i);var r={};r.quaternion=n,r.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(r):t.controls.update(r),t.bRender&&t.drawCls.render()}setRotation(e,t){var s=this.icn3d;s.icn3dui,s.bControlGl&&!s.icn3dui.bNode?e.applyQuaternion(window.cam.quaternion).normalize():e.applyQuaternion(s.cam.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(e,-t);var n={};n.quaternion=i,n.update=!0,s.bControlGl&&!s.icn3dui.bNode?window.controls.update(n):s.controls.update(n),s.bRender&&s.drawCls.render()}translateLeft(e){this.icn3d.icn3dui,this.translate_base(-e,0)}translateRight(e){this.icn3d.icn3dui,this.translate_base(e,0)}translateUp(e){this.icn3d.icn3dui,this.translate_base(0,-e)}translateDown(e){this.icn3d.icn3dui,this.translate_base(0,e)}translate_base(e,t){var s=this.icn3d;s.icn3dui;var i=new THREE.Vector2(0,0);i.x+=e/100,i.y+=t/100;var n={};n.mouseChange=i,n.update=!0,s.bControlGl&&!s.icn3dui.bNode?window.controls.update(n):s.controls.update(n),s.bRender&&s.drawCls.render()}zoomIn(e){var t=this.icn3d;t.icn3dui;var s={};s._zoomFactor=1-e,s.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(s):t.controls.update(s),t.bRender&&t.drawCls.render()}zoomOut(e){var t=this.icn3d;t.icn3dui;var s={};s._zoomFactor=1+e,s.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(s):t.controls.update(s),t.bRender&&t.drawCls.render()}zoominSelection(e){var t=this.icn3d,s=t.icn3dui,i={};if(i._zoomFactor=1/t._zoomFactor,i.update=!0,t.bControlGl&&!t.icn3dui.bNode?window.controls.update(i):t.controls.update(i),void 0===e&&(e=s.hashUtilsCls.hash2Atoms(t.hAtoms,t.atoms)),Object.keys(e).length>1){var n=t.applyCenterCls.centerAtoms(e);t.maxD=n.maxD,t.maxD<5&&(t.maxD=5),t.center=n.center,t.applyCenterCls.setCenter(t.center),t.cameraCls.setCamera()}}getTransformationStr(e){this.icn3d.icn3dui;var t={factor:1,mouseChange:{x:0,y:0},quaternion:{_x:0,_y:0,_z:0,_w:1}};return t.factor=parseFloat(e.factor).toPrecision(4),t.mouseChange.x=parseFloat(e.mouseChange.x).toPrecision(4),t.mouseChange.y=parseFloat(e.mouseChange.y).toPrecision(4),t.quaternion._x=parseFloat(e.quaternion._x).toPrecision(4),t.quaternion._y=parseFloat(e.quaternion._y).toPrecision(4),t.quaternion._z=parseFloat(e.quaternion._z).toPrecision(4),t.quaternion._w=parseFloat(e.quaternion._w).toPrecision(4),"1.0000"==t.factor&&(t.factor=1),"0.0000"==t.mouseChange.x&&(t.mouseChange.x=0),"0.0000"==t.mouseChange.y&&(t.mouseChange.y=0),"0.0000"==t.quaternion._x&&(t.quaternion._x=0),"0.0000"==t.quaternion._y&&(t.quaternion._y=0),"0.0000"==t.quaternion._z&&(t.quaternion._z=0),"1.0000"==t.quaternion._w&&(t.quaternion._w=1),JSON.stringify(t)}}class Qe{constructor(e){this.icn3d=e}saveFile(e,t,s){var i,n=this.icn3d,r=n.icn3dui;if("command"===t){for(var a=n.loadCmd?n.loadCmd+"\n":"",l=0,o=n.commands.length;l<o;++l){var d=n.commands[l].trim();if(l==o-1){var c=d.split("|||"),h={};h.factor=n._zoomFactor,h.mouseChange=n.mouseChange,h.quaternion=n.quaternion,d=c[0]+"|||"+n.transformCls.getTransformationStr(h)}a+=d+"\n"}var m=decodeURIComponent(a);i=new Blob([m],{type:"text;charset=utf-8;"})}else if("png"===t){var p=$("#"+n.pre+"canvas").width(),u=$("#"+n.pre+"canvas").height();n.applyCenterCls.setWidthHeight(p,u),n.bRender&&n.drawCls.render();var C=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob||(C=!1),r.utilsCls.isIE()){if(i=n.renderer.domElement.msToBlob(),!C)return void saveAs(i,e);var v=new FileReader;v.onload=function(t){var s=t.target.result,a=n.shareLinkCls.getPngText();i=r.convertTypeCls.getBlobFromBufferAndText(s,a),saveAs(i,e)},v.readAsArrayBuffer(i)}else n.renderer.domElement.toBlob((function(t){if(!C)return i=t,void saveAs(i,e);var s=new FileReader;s.onload=function(t){var s=t.target.result,a=n.shareLinkCls.getPngText();i=r.convertTypeCls.getBlobFromBufferAndText(s,a),saveAs(i,e)},s.readAsArrayBuffer(t)}));n.scaleFactor=1,n.applyCenterCls.setWidthHeight(p,u),n.bRender&&n.drawCls.render()}else if("html"===t){a=s,m=decodeURIComponent(a);i=new Blob([m],{type:"text/html;charset=utf-8;"})}else if("text"===t){m=s;i=new Blob(m,{type:"text;charset=utf-8;"})}else if("binary"===t){m=s;i=new Blob(m,{type:"application/octet-stream"})}"png"!==t&&saveAs(i,e)}saveSvg(e,t){this.icn3d.icn3dui;var s=this.getSvgXml(e),i=new Blob([s],{type:"image/svg+xml"});saveAs(i,t)}getSvgXml(e){var t=this.icn3d;if(t.icn3dui,t.icn3dui.bNode)return"";return'<svg title="graph" version="1.1" xmlns="http://www.w3.org/2000/svg"><style>text {font-family: sans-serif; font-weight: bold; font-size: 18px;}</style>'+document.getElementById(e).innerHTML+"</svg>"}savePng(e,t,s,i){var n=this.icn3d,r=n.icn3dui;if(n.icn3dui.bNode)return"";var a=document.getElementById(e),l=a.getBBox(),o=a.cloneNode(!0);n.lineGraphCls.copyStylesInline(o,a);var d=document.createElement("CANVAS");d.width=s,d.height=i;var c=d.getContext("2d");c.clearRect(0,0,l.width,l.height);var h=this.getSvgXml(e),m=window.URL||window.webkitURL||window,p=new Blob([h],{type:"image/svg+xml;charset=utf-8"}),u=new Image;u.src=m.createObjectURL(p),u.onload=function(){if(c.drawImage(u,0,0),m.revokeObjectURL(this.src),r.utilsCls.isIE()){var e=d.msToBlob();return saveAs(e,t),void d.remove()}d.toBlob((function(e){saveAs(e,t),d.remove()}))}}exportCustomAtoms(){var e=this.icn3d;e.icn3dui;for(var t="",s=void 0!==e.defNames2Residues?Object.keys(e.defNames2Residues).sort():[],i=0,n=s.length;i<n;++i){var r=s[i],a=e.defNames2Residues[r];e.defNames2Descr[r],e.defNames2Command[r].replace(/,/g,", "),t+=r+"\tselect ",t+=e.resid2specCls.residueids2spec(a),t+="\n"}for(i=0,n=(s=void 0!==e.defNames2Atoms?Object.keys(e.defNames2Atoms).sort():[]).length;i<n;++i){r=s[i];var l=e.defNames2Atoms[r];e.defNames2Descr[r],e.defNames2Command[r].replace(/,/g,", "),(a=e.resid2specCls.atoms2residues(l)).length>0&&(t+=r+"\tselect ",t+=e.resid2specCls.residueids2spec(a),t+="\n")}return t}getAtomPDB(e,t,s){var i=this.icn3d,n=i.icn3dui,r="",a={},l={};for(var o in i.chemicals){if("P"==(w=i.atoms[o]).elem){a[o]=1;for(var d=0,c=w.bonds.length;d<c;++d){var h=w.bonds[d];h&&"O"==i.atoms[h].elem&&(l[h]=1)}}}var m=n.hashUtilsCls.intHash(e,i.calphas),p=!1,u=!0,C=!1,v=!0;for(var o in m){(w=i.atoms[o]).ssbegin&&("helix"==w.ss?(p=!0,u&&(r+="HELIX".padEnd(15," ")+w.resn.padStart(3," ")+w.chain.padStart(2," ")+w.resi.toString().padStart(5," ")),u=!1):"sheet"==w.ss&&(C=!0,v&&(r+="SHEET".padEnd(17," ")+w.resn.padStart(3," ")+w.chain.padStart(2," ")+w.resi.toString().padStart(4," ")),v=!1)),w.ssend&&("helix"==w.ss?(u=!0,p&&(r+=w.resn.padStart(5," ")+w.chain.padStart(2," ")+w.resi.toString().padStart(5," ")+"\n"),p=!1):"sheet"==w.ss&&(v=!0,C&&(r+=w.resn.padStart(5," ")+w.chain.padStart(2," ")+w.resi.toString().padStart(4," ")+"\n"),C=!1))}var g="",f=Object.keys(i.structures).length>1,b=1,y="";for(var o in r+="\n",e){var w=i.atoms[o];if(!s||!w.het){f&&w.structure!=y&&(r+=g,g="",b>1&&(r+="ENDMDL\n"),r+="MODEL        "+b+"\n",y=w.structure,++b);var S="";S+=w.het?"HETATM":"ATOM  ",S+=o.toString().padStart(5," "),S+=" ";var _=w.name.trim();isNaN(_.substr(0,1))||(_=_.substr(1)+_.substr(0,1)),4==_.length?S+=_:(S+=" ","O1P"==(_=_.replace(/\*/g,"'"))?_="OP1":"O2P"==_?_="OP2":"C5M"==_&&(_="C7 "),S+=_.padEnd(3," ")),S+=" ";var A=w.resn;S+=A.length<=3?A.padStart(3," "):A.substr(0,3),S+=" ",S+=w.chain.length<=1?w.chain.padStart(1," "):w.chain.substr(0,1);var x=w.resi;if(w.chain.length>3&&!isNaN(w.chain.substr(3))&&(x=x-1+parseInt(w.chain.substr(3))),S+=x.toString().length<=4?x.toString().padStart(4," "):x.toString().substr(0,4),S+=" ".padStart(4," "),S+=w.coord.x.toFixed(3).toString().padStart(8," "),S+=w.coord.y.toFixed(3).toString().padStart(8," "),S+=w.coord.z.toFixed(3).toString().padStart(8," "),t&&w.het||a.hasOwnProperty(o)||l.hasOwnProperty(o)){var k=1.5,O=0;"C"==w.elem?k=1.908:"N"==w.elem?k=1.824:"O"==w.elem?k=1.6612:"H"==w.elem?k=1.25:"S"==w.elem?k=2:"P"==w.elem?k=2.1:n.parasCls.vdwRadii.hasOwnProperty(w.elem)&&(k=n.parasCls.vdwRadii[w.elem]),void 0!==i.icn3dui.cfg.cid&&void 0!==w.crg?O=w.crg:a.hasOwnProperty(o)?O=1.38:l.hasOwnProperty(o)?O=-.595:n.parasCls.ionCharges.hasOwnProperty(w.elem)&&(O=n.parasCls.ionCharges[w.elem]),S+=O.toFixed(4).toString().padStart(8," "),S+=k.toFixed(4).toString().padStart(7," ")}else S+="1.00".padStart(6," "),S+=w.b?parseFloat(w.b).toFixed(2).toString().padStart(6," "):" ".padStart(6," "),S+=" ".padStart(10," "),S+=w.elem.padStart(2," "),S+=" ".padStart(2," ");if(w.het&&w.bonds.length>0){g+="CONECT"+o.toString().padStart(5," ");var H={};for(d=0,c=w.bonds.length;d<c;++d)w.bonds[d]&&!H.hasOwnProperty(w.bonds[d])&&(g+=w.bonds[d].toString().padStart(5," "),H[w.bonds[d]]=1);g+="\n"}r+=S+"\n"}}return r+=g,f&&(r+="ENDMDL\n"),r}getSelectedResiduePDB(){var e=this.icn3d,t=e.icn3dui,s="";s+=this.getPDBHeader();var i=t.hashUtilsCls.intHash(e.dAtoms,e.hAtoms);return s+=this.getAtomPDB(i)}getPDBHeader(e){var t=this.icn3d;t.icn3dui,void 0===e&&(e=0);var s="";s+="HEADER    PDB From iCn3D".padEnd(62," ")+Object.keys(t.structures)[e]+"\n";var i=t.molTitle.length>50?t.molTitle.substr(0,47)+"...":t.molTitle;return-1!=i.indexOf('"')&&(i=""),s+="TITLE     "+i+"\n"}showTitle(){var e=this.icn3d;if(e.icn3dui,void 0!==e.molTitle&&""!==e.molTitle){var t=e.molTitle,s="white"==e.opts.background||"grey"==e.opts.background?"black":e.icn3dui.htmlCls.GREYD;if(void 0===e.inputid)e.molTitle.length>40&&(t=e.molTitle.substr(0,40)+"..."),$("#"+e.pre+"title").html(t);else if(void 0!==e.icn3dui.cfg.cid){var i=this.getLinkToStructureSummary();$("#"+e.pre+"title").html("PubChem CID <a id='"+e.pre+"titlelink' href='"+i+"' style='color:"+s+"' target='_blank'>"+e.inputid.toUpperCase()+"</a>: "+t)}else if(void 0!==e.icn3dui.cfg.align)$("#"+e.pre+"title").html(t);else if(void 0!==e.icn3dui.cfg.chainalign){var n=e.icn3dui.cfg.chainalign.split(",");t="Dynamic Structure Alignment of Chain "+n[0]+" to Chain "+n[1],$("#"+e.pre+"title").html(t)}else{i=this.getLinkToStructureSummary();e.molTitle.length>40&&(t=e.molTitle.substr(0,40)+"...");$("#"+e.pre+"title").html("PDB ID <a id='"+e.pre+"titlelink' href='"+i+"' style='color:"+s+"' target='_blank'>"+e.inputid.toUpperCase()+"</a>: "+t)}}else $("#"+e.pre+"title").html("")}getLinkToStructureSummary(e){var t=this.icn3d;t.icn3dui;var s="https://www.ncbi.nlm.nih.gov/structure/?term=";if(s=void 0!==t.icn3dui.cfg.cid?"https://www.ncbi.nlm.nih.gov/pccompound/?term=":Object.keys(t.structures).length>1?"https://www.ncbi.nlm.nih.gov/structure/?term=":t.icn3dui.htmlCls.baseUrl+"pdb/",void 0===t.inputid)s="https://www.ncbi.nlm.nih.gov/pccompound/?term="+t.molTitle;else{var i=t.inputid.split("_");1===i.length?(s+=t.inputid,e&&t.icn3dui.htmlCls.clickMenuCls.setLogCmd("link to Structure Summary "+t.inputid+": "+s,!1)):2===i.length&&(s+=i[0]+" OR "+i[1],e&&t.icn3dui.htmlCls.clickMenuCls.setLogCmd("link to structures "+i[0]+" and "+i[1]+": "+s,!1))}return s}setEntrezLinks(e){var t=this.icn3d;t.icn3dui;var s,i=Object.keys(t.structures);1===i.length?(s="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+i[0],t.icn3dui.htmlCls.clickMenuCls.setLogCmd("Entrez "+e+" about PDB "+i[0]+": "+s,!1),window.open(s,"_blank")):2===i.length&&(s="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+i[0]+" OR "+i[1],t.icn3dui.htmlCls.clickMenuCls.setLogCmd("Entrez "+e+" about PDB "+i[0]+" OR "+i[1]+": "+s,!1),window.open(s,"_blank"))}}class Je{constructor(e){this.icn3dui=e}clickMenu1(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn1_mmtfid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmtfid","Please input MMTF ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_pdbid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pdbid","Please input PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_opmid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_opmid","Please input OPM PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_align","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_align","Align two 3D structures")})),e.myEventCls.onIds("#"+e.pre+"mn1_chainalign","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_chainalign","Align multiple chains of 3D structures")})),e.myEventCls.onIds("#"+e.pre+"mn1_mutation","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mutation","Show the mutations in 3D")})),e.myEventCls.onIds("#"+e.pre+"mn1_pdbfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pdbfile","Please input PDB File")})),e.myEventCls.onIds("#"+e.pre+"mn1_mol2file","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mol2file","Please input Mol2 File")})),e.myEventCls.onIds("#"+e.pre+"mn1_sdffile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_sdffile","Please input SDF File")})),e.myEventCls.onIds("#"+e.pre+"mn1_xyzfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_xyzfile","Please input XYZ File")})),e.myEventCls.onIds("#"+e.pre+"mn1_urlfile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_urlfile","Load data by URL")})),e.myEventCls.onIds("#"+e.pre+"mn1_fixedversion","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_fixedversion","Open Share Link URL in the archived version of iCn3D")})),e.myEventCls.onIds("#"+e.pre+"reload_fixedversion","click",(function(s){e.icn3d;var i=$("#"+e.pre+"sharelinkurl").val();t.setLogCmd("open "+i,!1),localStorage.setItem("fixedversion","1"),window.open(i,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmciffile","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmciffile","Please input mmCIF File")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmcifid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmcifid","Please input mmCIF ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_mmdbid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_mmdbid","Please input MMDB or PDB ID")})),e.myEventCls.onIds("#"+e.pre+"mn1_blast_rep_id","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_blast_rep_id","Align sequence to structure")})),e.myEventCls.onIds("#"+e.pre+"mn1_gi","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_gi","Please input protein gi")})),e.myEventCls.onIds("#"+e.pre+"mn1_cid","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_cid","Please input PubChem CID")})),e.myEventCls.onIds("#"+e.pre+"mn1_pngimage","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_pngimage","Please input the PNG image")})),e.myEventCls.onIds("#"+e.pre+"mn1_state","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_state","Please input the state file")})),e.myEventCls.onIds("#"+e.pre+"mn1_selection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_selection","Please input the selection file")})),e.myEventCls.onIds("#"+e.pre+"mn1_dsn6","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_dsn6","Please input the DSN6 file to display electron density map")})),e.myEventCls.onIds(["#"+e.pre+"mn1_delphi","#"+e.pre+"mn1_delphi2"],"click",(function(t){e.icn3d.loadPhiFrom="delphi",$("#"+e.pre+"dl_delphi_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_delphi","Please set parameters to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_phi","click",(function(t){e.icn3d.loadPhiFrom="phi",$("#"+e.pre+"dl_phi_tabs").tabs(),$("#"+e.pre+"phitab1_tabs").tabs(),$("#"+e.pre+"phitab2_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_phi","Please input local phi or cube file to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_phiurl","click",(function(t){e.icn3d.loadPhiFrom="phiurl",$("#"+e.pre+"dl_phiurl_tabs").tabs(),$("#"+e.pre+"phiurltab1_tabs").tabs(),$("#"+e.pre+"phiurltab2_tabs").tabs(),e.htmlCls.dialogCls.openDlg("dl_phiurl","Please input URL phi or cube file to display DelPhi potential map")})),e.myEventCls.onIds("#"+e.pre+"mn1_dsn6url","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_dsn6url","Please input the DSN6 file to display electron density map")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportState","click",(function(s){var i=e.icn3d;t.setLogCmd("export state file",!1);var n=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(n+"_statefile.txt","command")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportPdbRes","click",(function(s){e.icn3d,e.htmlCls.setHtmlCls.exportPdb(),t.setLogCmd("export pdb",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphipdb","#"+e.pre+"phipdb"],"click",(function(s){var i=e.icn3d,n=i.saveFileCls.getSelectedResiduePDB();t.setLogCmd("export PDB of selected residues",!1);var r=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(r+"_icn3d_residues.pdb","text",[n])})),e.myEventCls.onIds(["#"+e.pre+"delphipqr","#"+e.pre+"phipqr","#"+e.pre+"phiurlpqr"],"click",(function(s){e.icn3d,e.htmlCls.setHtmlCls.exportPqr(),t.setLogCmd("export pqr",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportStl","click",(function(s){var i=e.icn3d;t.setLogCmd("export stl file",!1),i.export3DCls.exportStlFile("")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportVrml","click",(function(s){var i=e.icn3d;t.setLogCmd("export vrml file",!1),i.export3DCls.exportVrmlFile("")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportStlStab","click",(function(s){var i=e.icn3d;t.setLogCmd("export stl stabilizer file",!1),i.threeDPrintCls.hideStabilizer(),i.threeDPrintCls.resetAfter3Dprint(),i.threeDPrintCls.addStabilizer(),i.export3DCls.exportStlFile("_stab")})),e.myEventCls.onIds("#"+e.pre+"mn1_exportVrmlStab","click",(function(s){var i=e.icn3d;t.setLogCmd("export vrml stabilizer file",!1),i.threeDPrintCls.hideStabilizer(),i.threeDPrintCls.resetAfter3Dprint(),i.threeDPrintCls.addStabilizer(),i.export3DCls.exportVrmlFile("_stab")})),e.myEventCls.onIds("#"+e.pre+"mn6_exportInteraction","click",(function(s){var i=e.icn3d;t.setLogCmd("export interactions",!1),void 0!==e.cfg.mmdbid&&i.viewInterPairsCls.retrieveInteractionData(),i.viewInterPairsCls.exportInteractions()})),e.myEventCls.onIds(["#"+e.pre+"mn1_exportCanvas","#"+e.pre+"saveimage"],"click",(function(s){var i=e.icn3d;t.setLogCmd("export canvas",!1);i.shareLinkCls.shareLink(!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas2","click",(function(s){var i=e.icn3d;t.setLogCmd("export canvas 2",!1),i.scaleFactor=2,i.shareLinkCls.shareLink(!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas4","click",(function(s){var i=e.icn3d;t.setLogCmd("export canvas 4",!1),i.scaleFactor=4,i.shareLinkCls.shareLink(!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCanvas8","click",(function(s){var i=e.icn3d;t.setLogCmd("export canvas 8",!1),i.scaleFactor=8,i.shareLinkCls.shareLink(!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportCounts","click",(function(s){var i=e.icn3d;t.setLogCmd("export counts",!1);var n='<html><body><div style="text-align:center"><br><b>Total Count for atoms with coordinates</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Structure Count</th><th>Chain Count</th><th>Residue Count</th><th>Atom Count</th></tr>';n+="<tr><td>"+Object.keys(i.structures).length+"</td><td>"+Object.keys(i.chains).length+"</td><td>"+Object.keys(i.residues).length+"</td><td>"+Object.keys(i.atoms).length+"</td></tr>",n+="</table><br/>",n+="<b>Counts by Chain for atoms with coordinates</b>:<br/><table align=center border=1 cellpadding=10 cellspacing=0><tr><th>Structure</th><th>Chain</th><th>Residue Count</th><th>Atom Count</th></tr>";for(var r=Object.keys(i.chains),a=0,l=r.length;a<l;++a){var o=r[a],d=o.indexOf("_"),c=o.substr(0,d),h=o.substr(d+1),m={},p=i.chains[o];for(var u in p)m[i.atoms[u].resi]=1;n+="<tr><td>"+c+"</td><td>"+h+"</td><td>"+Object.keys(m).length+"</td><td>"+Object.keys(i.chains[o]).length+"</td></tr>"}n+="</table><br/></div></body></html>";var C=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(C+"_counts.html","html",n)})),e.myEventCls.onIds("#"+e.pre+"mn1_exportSelections","click",(function(s){var i=e.icn3d;if(t.setLogCmd("export all selections",!1),void 0===i.bSetChainsAdvancedMenu||!i.bSetChainsAdvancedMenu){var n=e.hashUtilsCls.cloneHash(i.hAtoms);i.definedSetsCls.setPredefinedInMenu(),i.bSetChainsAdvancedMenu=!0,i.hAtoms=e.hashUtilsCls.cloneHash(n)}var r=i.saveFileCls.exportCustomAtoms(),a=i.inputid?i.inputid:"custom";i.saveFileCls.saveFile(a+"_selections.txt","text",[r])})),e.myEventCls.onIds("#"+e.pre+"mn1_sharelink","click",(function(t){e.icn3d.shareLinkCls.shareLink()})),e.myEventCls.onIds("#"+e.pre+"mn1_replayon","click",(function(s){e.icn3d.resizeCanvasCls.replayon(),t.setLogCmd("replay on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_replayoff","click",(function(s){e.icn3d.resizeCanvasCls.replayoff(),t.setLogCmd("replay off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_link_structure","click",(function(t){var s=e.icn3d.saveFileCls.getLinkToStructureSummary(!0);window.open(s,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_bind","click",(function(s){var i=e.icn3d;url="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_structure&from_uid="+i.inputid,t.setLogCmd("link to 3D protein structures bound to CID "+i.inputid+": "+url,!1),window.open(url,"_blank")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_vast","click",(function(s){var i=e.icn3d;if(void 0===i.inputid)n="https://www.ncbi.nlm.nih.gov/pccompound?term="+i.molTitle,t.setLogCmd("link to compounds "+i.molTitle+": "+n,!1);else{if(void 0!==e.cfg.cid)n="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_pccompound_3d&from_uid="+i.inputid,t.setLogCmd("link to compounds with structure similar to CID "+i.inputid+": "+n,!1);else{var n,r=i.inputid.split("_");1===r.length?(n=e.htmlCls.baseUrl+"vastplus/vastplus.cgi?uid="+i.inputid,t.setLogCmd("link to structures similar to "+i.inputid+": "+n,!1)):2===r.length&&(n=e.htmlCls.baseUrl+"vastplus/vastplus.cgi?uid="+r[0],t.setLogCmd("link to structures similar to "+r[0]+": "+n,!1))}window.open(n,"_blank")}})),e.myEventCls.onIds("#"+e.pre+"mn1_link_pubmed","click",(function(s){var i=e.icn3d;if(void 0===i.inputid)r="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i.molTitle,t.setLogCmd("link to literature about "+i.molTitle+": "+r,!1),window.open(r,"_blank");else if(i.pmid){1===(n=i.pmid.toString().split("_")).length?(r="https://www.ncbi.nlm.nih.gov/pubmed/"+i.pmid,t.setLogCmd("link to PubMed ID "+i.pmid+": "+r,!1)):2===n.length&&(r="https://www.ncbi.nlm.nih.gov/pubmed/?term="+n[0]+" OR "+n[1],t.setLogCmd("link to PubMed IDs "+n[0]+", "+n[1]+": "+r,!1)),window.open(r,"_blank")}else if(isNaN(i.inputid)){var n,r;1===(n=i.inputid.toString().split("_")).length?(r="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i.inputid,t.setLogCmd("link to literature about PDB "+i.inputid+": "+r,!1)):2===n.length&&(r="https://www.ncbi.nlm.nih.gov/pubmed/?term="+n[0]+" OR "+n[1],t.setLogCmd("link to literature about PDB "+n[0]+" OR "+n[1]+": "+r,!1)),window.open(r,"_blank")}else void 0!==e.cfg.cid?alert("No literature information is available for this compound in the SDF file."):alert("No literature information is available for this structure.")})),e.myEventCls.onIds("#"+e.pre+"mn1_link_protein","click",(function(s){for(var i=e.icn3d,n=Object.keys(i.structures),r=Object.keys(i.chains),a="",l=0,o=r.length;l<o;++l){var d=i.firstAtomObjCls.getFirstCalphaAtomObj(i.chains[r[l]]);i.proteins.hasOwnProperty(d.serial)&&6==r[l].length&&(a+=r[l]+"[accession] OR ")}a.length>0&&(a=a.substr(0,a.length-4));var c="https://www.ncbi.nlm.nih.gov/protein/?term="+a;t.setLogCmd("link to Entrez protein about PDB "+n+": "+c,!1),window.open(c,"_blank")}))}}clickMenu2(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn6_selectannotations","click",(function(s){e.icn3d.showAnnoCls.showAnnotations(),t.setLogCmd("view annotations",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_selectall","click",(function(s){var i=e.icn3d;t.setLogCmd("select all",!0),i.selectionCls.selectAll(),i.hlUpdateCls.removeHlAll(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"clearall","click",(function(s){var i=e.icn3d;t.setLogCmd("clear all",!0),i.bSelectResidue=!1,i.selectionCls.selectAll(),i.hlUpdateCls.removeHlAll(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectdisplayed","click",(function(s){var i=e.icn3d;t.setLogCmd("select displayed set",!0),i.hAtoms=e.hashUtilsCls.cloneHash(i.dAtoms),i.hlUpdateCls.updateHlAll()})),e.myEventCls.onIds("#"+e.pre+"mn2_fullstru","click",(function(s){var i=e.icn3d;t.setLogCmd("show all",!0),i.selectionCls.showAll()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectcomplement","click",(function(s){var i=e.icn3d;Object.keys(i.hAtoms).length<Object.keys(i.atoms).length&&(t.setLogCmd("select complement",!0),i.resid2specCls.selectComplement())})),e.myEventCls.onIds("#"+e.pre+"mn2_selectmainchains","click",(function(s){var i=e.icn3d;t.setLogCmd("select main chains",!0),i.selectionCls.selectMainChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectsidechains","click",(function(s){var i=e.icn3d;t.setLogCmd("select side chains",!0),i.selectionCls.selectSideChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_selectmainsidechains","click",(function(s){var i=e.icn3d;t.setLogCmd("select main side chains",!0),i.selectionCls.selectMainSideChains()})),e.myEventCls.onIds("#"+e.pre+"mn2_propPos","click",(function(s){var i=e.icn3d;t.setLogCmd("select prop positive",!0),i.resid2specCls.selectProperty("positive")})),e.myEventCls.onIds("#"+e.pre+"mn2_propNeg","click",(function(s){var i=e.icn3d;t.setLogCmd("select prop negative",!0),i.resid2specCls.selectProperty("negative")})),e.myEventCls.onIds("#"+e.pre+"mn2_propHydro","click",(function(s){var i=e.icn3d;t.setLogCmd("select prop hydrophobic",!0),i.resid2specCls.selectProperty("hydrophobic")})),e.myEventCls.onIds("#"+e.pre+"mn2_propPolar","click",(function(s){var i=e.icn3d;t.setLogCmd("select prop polar",!0),i.resid2specCls.selectProperty("polar")})),e.myEventCls.onIds("#"+e.pre+"mn2_propBfactor","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_propbybfactor","Select residue based on B-factor")})),e.myEventCls.onIds("#"+e.pre+"mn2_propSolAcc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_propbypercentout","Select residue based on the percentage of solvent accessilbe surface area")})),e.myEventCls.onIds("#"+e.pre+"applypropbybfactor","click",(function(s){var i=e.icn3d,n=$("#"+e.pre+"minbfactor").val(),r=$("#"+e.pre+"maxbfactor").val();t.setLogCmd("select prop b factor | "+n+"_"+r,!0),i.resid2specCls.selectProperty("b factor",n,r)})),e.myEventCls.onIds("#"+e.pre+"applypropbypercentout","click",(function(s){var i=e.icn3d,n=$("#"+e.pre+"minpercentout").val(),r=$("#"+e.pre+"maxpercentout").val();t.setLogCmd("select prop percent out | "+n+"_"+r,!0),i.resid2specCls.selectProperty("percent out",n,r)})),e.myEventCls.onIds("#"+e.pre+"mn2_alignment","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences"),t.setLogCmd("window aligned sequences",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_table","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_allinteraction","Show interactions"),t.setLogCmd("window interaction table",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_linegraph","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_linegraph","Show interactions between two lines of residue nodes"),t.setLogCmd("window interaction graph",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_scatterplot","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_scatterplot","Show interactions as map"),t.setLogCmd("window interaction scatterplot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_window_graph","click",(function(s){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_graph","Force-directed graph"),t.setLogCmd("window force-directed graph",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_yournote","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_yournote","Your note about the current display")})),e.myEventCls.onIds("#"+e.pre+"applyyournote","click",(function(s){var i=e.icn3d;i.yournote=$("#"+e.pre+"yournote").val(),document.title=i.yournote,e.cfg.notebook||dialog.dialog("close"),t.setLogCmd("your note | "+i.yournote,!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_command","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_advanced2","Select by specification")})),e.myEventCls.onIds(["#"+e.pre+"mn2_definedsets","#"+e.pre+"definedsets","#"+e.pre+"definedsets2"],"click",(function(s){e.icn3d.definedSetsCls.showSets(),t.setLogCmd("defined sets",!0)})),e.myEventCls.onIds("#"+e.pre+"setOr","click",(function(t){e.icn3d.setOperation="or"})),e.myEventCls.onIds("#"+e.pre+"setAnd","click",(function(t){e.icn3d.setOperation="and"})),e.myEventCls.onIds("#"+e.pre+"setNot","click",(function(t){e.icn3d.setOperation="not"})),e.myEventCls.onIds("#"+e.pre+"mn2_pkNo","click",(function(s){var i=e.icn3d;i.pk=0,i.opts.pk="no",t.setLogCmd("set pk off",!0),i.drawCls.draw(),i.hlObjectsCls.removeHlObjects()})),e.myEventCls.onIds("#"+e.pre+"mn2_pkYes","click",(function(s){var i=e.icn3d;i.pk=1,i.opts.pk="atom",t.setLogCmd("set pk atom",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkResidue","click",(function(s){var i=e.icn3d;i.pk=2,i.opts.pk="residue",t.setLogCmd("set pk residue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkStrand","click",(function(s){var i=e.icn3d;i.pk=3,i.opts.pk="strand",t.setLogCmd("set pk strand",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkDomain","click",(function(s){var i=e.icn3d;i.pk=4,i.opts.pk="domain",t.setLogCmd("set pk domain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_pkChain","click",(function(s){var i=e.icn3d;i.pk=5,i.opts.pk="chain",t.setLogCmd("set pk chain",!0)})),e.myEventCls.onIds("#"+e.pre+"adjustmem","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_adjustmem","Adjust the Z-axis positions of the membrane")})),e.myEventCls.onIds("#"+e.pre+"togglemem","click",(function(s){e.icn3d.selectionCls.toggleMembrane(),t.setLogCmd("toggle membrane",!0)})),e.myEventCls.onIds("#"+e.pre+"selectplane","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_selectplane","Select a region between two planes")})),e.myEventCls.onIds("#"+e.pre+"mn2_aroundsphere","click",(function(t){var s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){var i=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(i)}var n=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomSphere").length&&$("#"+e.pre+"atomsCustomSphere").html("  <option value='non-selected' selected>non-selected</option><option value='selected'>selected</option>"+n),$("#"+e.pre+"atomsCustomSphere2").length&&$("#"+e.pre+"atomsCustomSphere2").html("  <option value='selected' selected>selected</option>"+n),e.htmlCls.dialogCls.openDlg("dl_aroundsphere","Select a sphere around a set of residues"),s.bSphereCalc=!1,$("#"+e.pre+"atomsCustomSphere").resizable(),$("#"+e.pre+"atomsCustomSphere2").resizable()})),e.myEventCls.onIds(["#"+e.pre+"mn2_select_chain","#"+e.pre+"definedSets"],"click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_select_chain","Select Structure/Chain/Custom Selection")}))}}clickMenu3(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn3_proteinsRibbon","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","ribbon"),t.setLogCmd("style proteins ribbon",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsStrand","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","strand"),t.setLogCmd("style proteins strand",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsCylinder","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","cylinder and plate"),t.setLogCmd("style proteins cylinder and plate",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","schematic"),t.setLogCmd("style proteins schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsCalpha","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","c alpha trace"),t.setLogCmd("style proteins c alpha trace",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBackbone","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","backbone"),t.setLogCmd("style proteins backbone",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBfactor","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","b factor tube"),t.setLogCmd("style proteins b factor tube",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsLines","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","lines"),t.setLogCmd("style proteins lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsStick","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","stick"),t.setLogCmd("style proteins stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","ball and stick"),t.setLogCmd("style proteins ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","sphere"),t.setLogCmd("style proteins sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_proteinsNo","click",(function(s){e.icn3d.setOptionCls.setStyle("proteins","nothing"),t.setLogCmd("style proteins nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecLines","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","lines"),t.setLogCmd("style sidec lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecStick","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","stick"),t.setLogCmd("style sidec stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","ball and stick"),t.setLogCmd("style sidec ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","sphere"),t.setLogCmd("style sidec sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_sidecNo","click",(function(s){e.icn3d.setOptionCls.setStyle("sidec","nothing"),t.setLogCmd("style sidec nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclCartoon","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","nucleotide cartoon"),t.setLogCmd("style nucleotides nucleotide cartoon",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclBackbone","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","backbone"),t.setLogCmd("style nucleotides backbone",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","schematic"),t.setLogCmd("style nucleotides schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclPhos","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","o3 trace"),t.setLogCmd("style nucleotides o3 trace",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclLines","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","lines"),t.setLogCmd("style nucleotides lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclStick","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","stick"),t.setLogCmd("style nucleotides stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","ball and stick"),t.setLogCmd("style nucleotides ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","sphere"),t.setLogCmd("style nucleotides sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_nuclNo","click",(function(s){e.icn3d.setOptionCls.setStyle("nucleotides","nothing"),t.setLogCmd("style nucleotides nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligLines","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","lines"),t.setLogCmd("style chemicals lines",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligStick","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","stick"),t.setLogCmd("style chemicals stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligBallstick","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","ball and stick"),t.setLogCmd("style chemicals ball and stick",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligSchematic","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","schematic"),t.setLogCmd("style chemicals schematic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","sphere"),t.setLogCmd("style chemicals sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ligNo","click",(function(s){e.icn3d.setOptionCls.setStyle("chemicals","nothing"),t.setLogCmd("style chemicals nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_glycansCartYes","click",(function(s){var i=e.icn3d;i.bGlycansCartoon=!0,i.drawCls.draw(),t.setLogCmd("glycans cartoon yes",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_glycansCartNo","click",(function(s){var i=e.icn3d;i.bGlycansCartoon=!1,i.drawCls.draw(),t.setLogCmd("glycans cartoon no",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_hydrogensYes","click",(function(s){var i=e.icn3d;i.showInterCls.showHydrogens(),i.drawCls.draw(),t.setLogCmd("hydrogens",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_hydrogensNo","click",(function(s){var i=e.icn3d;i.showInterCls.hideHydrogens(),i.drawCls.draw(),t.setLogCmd("set hydrogens off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","sphere"),t.setLogCmd("style ions sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsDot","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","dot"),t.setLogCmd("style ions dot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_ionsNo","click",(function(s){e.icn3d.setOptionCls.setStyle("ions","nothing"),t.setLogCmd("style ions nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterSphere","click",(function(s){e.icn3d.setOptionCls.setStyle("water","sphere"),t.setLogCmd("style water sphere",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterDot","click",(function(s){e.icn3d.setOptionCls.setStyle("water","dot"),t.setLogCmd("style water dot",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_waterNo","click",(function(s){e.icn3d.setOptionCls.setStyle("water","nothing"),t.setLogCmd("style water nothing",!0)}))}}clickMenu4(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn4_clrSpectrum","click",(function(s){e.icn3d.setOptionCls.setOption("color","spectrum"),t.setLogCmd("color spectrum",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrChain","click",(function(s){e.icn3d.setOptionCls.setOption("color","chain"),t.setLogCmd("color chain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrdomain","click",(function(s){e.icn3d.setOptionCls.setOption("color","domain"),t.setLogCmd("color domain",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSGreen","click",(function(s){var i=e.icn3d;i.sheetcolor="green",i.setOptionCls.setOption("color","secondary structure green"),t.setLogCmd("color secondary structure green",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSYellow","click",(function(s){var i=e.icn3d;i.sheetcolor="yellow",i.setOptionCls.setOption("color","secondary structure yellow"),t.setLogCmd("color secondary structure yellow",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSSSpectrum","click",(function(s){e.icn3d.setOptionCls.setOption("color","secondary structure spectrum"),t.setLogCmd("color secondary structure spectrum",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrResidue","click",(function(s){e.icn3d.setOptionCls.setOption("color","residue"),t.setLogCmd("color residue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrResidueCustom","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_rescolorfile","Please input the file on residue colors")})),e.myEventCls.onIds("#"+e.pre+"reload_rescolorfile","click",(function(s){var i=e.icn3d;s.preventDefault(),e.cfg.notebook||dialog.dialog("close");var n=$("#"+e.pre+"rescolorfile")[0].files[0];if(n){e.htmlCls.setHtmlCls.fileSupport();var r=new FileReader;r.onload=function(s){var n=s.target.result.replace(/#/g,"");for(var r in i.customResidueColors=JSON.parse(n),i.customResidueColors)i.customResidueColors[r.toUpperCase()]=e.parasCls.thr("#"+i.customResidueColors[r]);i.setOptionCls.setOption("color","residue custom"),t.setLogCmd("color residue custom | "+n,!0)},r.readAsText(n)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_customcolorfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.addTrackCls.setCustomFile("color")})),e.myEventCls.onIds("#"+e.pre+"reload_customtubefile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.addTrackCls.setCustomFile("tube")})),e.myEventCls.onIds("#"+e.pre+"mn4_clrCharge","click",(function(s){e.icn3d.setOptionCls.setOption("color","charge"),t.setLogCmd("color charge",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrHydrophobic","click",(function(s){e.icn3d.setOptionCls.setOption("color","hydrophobic"),t.setLogCmd("color hydrophobic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrAtom","click",(function(s){e.icn3d.setOptionCls.setOption("color","atom"),t.setLogCmd("color atom",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrBfactor","click",(function(s){e.icn3d.setOptionCls.setOption("color","b factor"),t.setLogCmd("color b factor",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrArea","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_colorbyarea","Color based on residue's solvent accessibility")})),e.myEventCls.onIds("#"+e.pre+"applycolorbyarea","click",(function(s){var i=e.icn3d;i.midpercent=$("#"+e.pre+"midpercent").val(),i.setOptionCls.setOption("color","area"),t.setLogCmd("color area | "+i.midpercent,!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrBfactorNorm","click",(function(s){e.icn3d.setOptionCls.setOption("color","b factor percentile"),t.setLogCmd("color b factor percentile",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrIdentity","click",(function(s){e.icn3d.setOptionCls.setOption("color","identity"),t.setLogCmd("color identity",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrConserved","click",(function(s){e.icn3d.setOptionCls.setOption("color","conservation"),t.setLogCmd("color conservation",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrCustom","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_clr","Color picker")})),$(document).on("click",".icn3d-color-rad-text",(function(s){var i=e.icn3d;s.stopImmediatePropagation();var n=$(this).attr("color");i.setOptionCls.setOption("color",n),t.setLogCmd("color "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrSave","click",(function(s){e.icn3d.setOptionCls.saveColor(),t.setLogCmd("save color",!0)})),e.myEventCls.onIds("#"+e.pre+"mn4_clrApplySave","click",(function(s){e.icn3d.setOptionCls.applySavedColor(),t.setLogCmd("apply saved color",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_styleSave","click",(function(s){e.icn3d.setOptionCls.saveStyle(),t.setLogCmd("save style",!0)})),e.myEventCls.onIds("#"+e.pre+"mn3_styleApplySave","click",(function(s){e.icn3d.setOptionCls.applySavedStyle(),t.setLogCmd("apply saved style",!0)}))}}clickMenu5(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn5_neighborsYes","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!0,i.applyMapCls.removeLastSurface(),i.applyMapCls.applySurfaceOptions(),i.bRender&&i.drawCls.render(),t.setLogCmd("set surface neighbors on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_neighborsNo","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!1,i.applyMapCls.removeLastSurface(),i.applyMapCls.applySurfaceOptions(),i.bRender&&i.drawCls.render(),t.setLogCmd("set surface neighbors off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceVDW","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","Van der Waals surface"),t.setLogCmd("set surface Van der Waals surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceSAS","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","solvent accessible surface"),t.setLogCmd("set surface solvent accessible surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceMolecular","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!1,i.setOptionCls.setOption("surface","molecular surface"),t.setLogCmd("set surface molecular surface",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceVDWContext","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","Van der Waals surface with context"),t.setLogCmd("set surface Van der Waals surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceSASContext","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","solvent accessible surface with context"),t.setLogCmd("set surface solvent accessible surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceMolecularContext","click",(function(s){var i=e.icn3d;i.bConsiderNeighbors=!0,i.setOptionCls.setOption("surface","molecular surface with context"),t.setLogCmd("set surface molecular surface with context",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_surfaceNo","click",(function(s){e.icn3d.setOptionCls.setOption("surface","nothing"),t.setLogCmd("set surface nothing",!0)})),$(document).on("click","."+e.pre+"mn5_opacity",(function(s){var i=e.icn3d,n=$(this).attr("v");i.setOptionCls.setOption("opacity",n),t.setLogCmd("set surface opacity "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_wireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("wireframe","yes"),t.setLogCmd("set surface wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_wireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("wireframe","no"),t.setLogCmd("set surface wireframe off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_elecmap2fofc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_elecmap2fofc","2Fo-Fc Electron Density Map")})),e.myEventCls.onIds("#"+e.pre+"mn5_elecmapfofc","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_elecmapfofc","Fo-Fc Electron Density Map")})),e.myEventCls.onIds(["#"+e.pre+"mn5_elecmapNo","#"+e.pre+"elecmapNo2","#"+e.pre+"elecmapNo3","#"+e.pre+"elecmapNo4","#"+e.pre+"elecmapNo5"],"click",(function(s){e.icn3d.setOptionCls.setOption("map","nothing"),t.setLogCmd("setoption map nothing",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphimapNo","#"+e.pre+"phimapNo","#"+e.pre+"phiurlmapNo","#"+e.pre+"mn1_phimapNo"],"click",(function(s){e.icn3d.setOptionCls.setOption("phimap","nothing"),t.setLogCmd("setoption phimap nothing",!0)})),e.myEventCls.onIds(["#"+e.pre+"delphimapNo2","#"+e.pre+"phimapNo2","#"+e.pre+"phiurlmapNo2"],"click",(function(s){e.icn3d.setOptionCls.setOption("phisurface","nothing"),t.setLogCmd("setoption phisurface nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"applymap2fofc","click",(function(s){var i=e.icn3d;s.preventDefault();var n=parseFloat($("#"+e.pre+"sigma2fofc").val());i.dsn6ParserCls.dsn6Parser(i.inputid,"2fofc",n),t.setLogCmd("set map 2fofc sigma "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"applymapfofc","click",(function(s){var i=e.icn3d;s.preventDefault();var n=parseFloat($("#"+e.pre+"sigmafofc").val());i.dsn6ParserCls.dsn6Parser(i.inputid,"fofc",n),t.setLogCmd("set map fofc sigma "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_mapwireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("mapwireframe","yes"),t.setLogCmd("set map wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_mapwireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("mapwireframe","no"),t.setLogCmd("set map wireframe off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmap","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_emmap","EM Density Map")})),e.myEventCls.onIds(["#"+e.pre+"mn5_emmapNo","#"+e.pre+"emmapNo2"],"click",(function(s){e.icn3d.setOptionCls.setOption("emmap","nothing"),t.setLogCmd("setoption emmap nothing",!0)})),e.myEventCls.onIds("#"+e.pre+"applyemmap","click",(function(s){var i=e.icn3d;s.preventDefault();var n=parseFloat($("#"+e.pre+"empercentage").val());i.densityCifParserCls.densityCifParser(i.inputid,"em",n,i.emd),t.setLogCmd("set emmap percentage "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmapwireframeYes","click",(function(s){e.icn3d.setOptionCls.setOption("emmapwireframe","yes"),t.setLogCmd("set emmap wireframe on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn5_emmapwireframeNo","click",(function(s){e.icn3d.setOptionCls.setOption("emmapwireframe","no"),t.setLogCmd("set emmap wireframe off",!0)}))}}clickMenu6(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"mn6_assemblyYes","click",(function(s){var i=e.icn3d;i.bAssembly=!0,t.setLogCmd("set assembly on",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_assemblyNo","click",(function(s){var i=e.icn3d;i.bAssembly=!1,t.setLogCmd("set assembly off",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelAtoms","click",(function(s){var i=e.icn3d;i.residueLabelsCls.addAtomLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add atom labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelResidues","click",(function(s){var i=e.icn3d;i.residueLabelsCls.addResidueLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add residue labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelResnum","click",(function(s){var i=e.icn3d;i.residueLabelsCls.addResidueLabels(i.hAtoms,void 0,void 0,!0),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add residue number labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelChains","click",(function(s){var i=e.icn3d;i.analysisCls.addChainLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add chain labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelTermini","click",(function(s){var i=e.icn3d;i.analysisCls.addTerminiLabels(i.hAtoms),i.selectionCls.saveSelectionIfSelected(),t.setLogCmd("add terminal labels",!0),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelYes","click",(function(t){var s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_addlabel","Add custom labels by selection"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn6_addlabelSelection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_addlabelselection","Add custom labels by the selected")})),e.myEventCls.onIds("#"+e.pre+"mn2_saveselection","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_saveselection","Save the selected")})),e.myEventCls.onIds(["#"+e.pre+"mn6_addlabelNo","#"+e.pre+"removeLabels"],"click",(function(s){var i=e.icn3d;i.pickpair=!1;for(var n in t.setLogCmd("set labels off",!0),i.labels)i.labels[n]=[];i.drawCls.draw()})),$(document).on("click","."+e.pre+"mn6_labelscale",(function(s){var i=e.icn3d,n=$(this).attr("v");i.labelScale=n,i.drawCls.draw(),t.setLogCmd("set label scale "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_distanceYes","click",(function(t){var s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_distance","Measure the distance of atoms"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0,s.bMeasureDistance=!0})),e.myEventCls.onIds("#"+e.pre+"mn6_distTwoSets","click",(function(t){var s=e.icn3d;if(e.htmlCls.dialogCls.openDlg("dl_disttwosets","Measure the distance between two sets"),void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){var i=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(i)}var n=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomDist").length&&$("#"+e.pre+"atomsCustomDist").html("  <option value='selected'>selected</option>"+n),$("#"+e.pre+"atomsCustomDist2").length&&$("#"+e.pre+"atomsCustomDist2").html("  <option value='selected' selected>selected</option>"+n),$("#"+e.pre+"atomsCustomDist").resizable(),$("#"+e.pre+"atomsCustomDist2").resizable(),s.bMeasureDistance=!0})),e.myEventCls.onIds("#"+e.pre+"mn6_distanceNo","click",(function(s){var i=e.icn3d;i.pickpair=!1;t.setLogCmd("set lines off",!0),i.labels.distance=[],i.lines.distance=[],i.distPnts=[],i.pk=2,i.drawCls.draw()})),e.myEventCls.onIds(["#"+e.pre+"mn2_selectedcenter","#"+e.pre+"zoomin_selection"],"click",(function(s){var i=e.icn3d;i.transformCls.zoominSelection(),i.drawCls.draw(),t.setLogCmd("zoom selection",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_center","click",(function(s){var i=e.icn3d;i.applyCenterCls.centerSelection(),i.drawCls.draw(),t.setLogCmd("center selection",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_resetOrientation","#"+e.pre+"resetOrientation"],"click",(function(s){var i=e.icn3d;i.transformCls.resetOrientation(),i.drawCls.draw(),t.setLogCmd("reset orientation",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_chemicalbindingshow","#"+e.pre+"chemicalbindingshow"],"click",(function(s){e.icn3d.setOptionCls.setOption("chemicalbinding","show"),t.setLogCmd("set chemicalbinding show",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_chemicalbindinghide","#"+e.pre+"chemicalbindinghide"],"click",(function(s){e.icn3d.setOptionCls.setOption("chemicalbinding","hide"),t.setLogCmd("set chemicalbinding hide",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_sidebyside","click",(function(s){var i=e.icn3d.shareLinkCls.shareLinkUrl(void 0);0!==i.indexOf("http")?alert("The url is more than 4000 characters and may not work."):(i=i.replace("full.html","full2.html"),i+="&closepopup=1",window.open(i,"_blank"),t.setLogCmd("side by side | "+i,!0))})),$(document).on("click","."+e.pre+"mn6_rotate",(function(s){var i=e.icn3d,n=$(this).attr("v").toLowerCase(),r=n.split(" ")[1];t.setLogCmd(n,!0),i.bStopRotate=!1,i.transformCls.rotateCount=0,i.transformCls.rotateCountMax=6e3,i.ROT_DIR=r,i.resizeCanvasCls.rotStruc(r)})),$(document).on("click","."+e.pre+"mn6_rotate90",(function(s){var i,n=e.icn3d,r=$(this).attr("v").toLowerCase(),a=r.split("-")[0];t.setLogCmd(r,!0),"x"==a?i=new THREE.Vector3(1,0,0):"y"==a?i=new THREE.Vector3(0,1,0):"z"==a&&(i=new THREE.Vector3(0,0,1));var l=.5*Math.PI;n.transformCls.setRotation(i,l)})),e.myEventCls.onIds("#"+e.pre+"mn6_cameraPers","click",(function(s){e.icn3d.setOptionCls.setOption("camera","perspective"),t.setLogCmd("set camera perspective",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_cameraOrth","click",(function(s){e.icn3d.setOptionCls.setOption("camera","orthographic"),t.setLogCmd("set camera orthographic",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdBlack","click",(function(t){e.icn3d.setStyleCls.setBackground("black")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdGrey","click",(function(t){e.icn3d.setStyleCls.setBackground("grey")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdWhite","click",(function(t){e.icn3d.setStyleCls.setBackground("white")})),e.myEventCls.onIds("#"+e.pre+"mn6_bkgdTransparent","click",(function(t){e.icn3d.setStyleCls.setBackground("transparent")})),e.myEventCls.onIds("#"+e.pre+"mn6_showfogYes","click",(function(s){var i=e.icn3d;i.opts.fog="yes",i.fogCls.setFog(!0),i.drawCls.draw(),t.setLogCmd("set fog on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showfogNo","click",(function(s){var i=e.icn3d;i.opts.fog="no",i.fogCls.setFog(!0),i.drawCls.draw(),t.setLogCmd("set fog off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showslabYes","click",(function(s){e.icn3d.setOptionCls.setOption("slab","yes"),t.setLogCmd("set slab on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showslabNo","click",(function(s){e.icn3d.setOptionCls.setOption("slab","no"),t.setLogCmd("set slab off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisYes","click",(function(s){e.icn3d.setOptionCls.setOption("axis","yes"),t.setLogCmd("set axis on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisSel","click",(function(s){var i=e.icn3d;i.pc1=!0,i.axesCls.setPc1Axes(),t.setLogCmd("set pc1 axis",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_showaxisNo","click",(function(s){var i=e.icn3d;i.pc1=!1,i.axes=[],i.setOptionCls.setOption("axis","no"),t.setLogCmd("set axis off",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_symmetry","click",(function(t){var s=e.icn3d;s.symdCls.retrieveSymmetry(Object.keys(s.structures)[0])})),e.myEventCls.onIds("#"+e.pre+"mn6_symd","click",(function(s){var i=e.icn3d;i.symdCls.retrieveSymd(),i.bSymd=!0,t.setLogCmd("symd symmetry",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_clear_sym","click",(function(s){var i=e.icn3d;i.symdArray=[],i.drawCls.draw(),t.setLogCmd("clear symd symmetry",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_area","click",(function(s){e.icn3d.analysisCls.calculateArea(),t.setLogCmd("area",!0)})),e.myEventCls.onIds("#"+e.pre+"applysymmetry","click",(function(s){var i=e.icn3d,n=$("#"+e.pre+"selectSymmetry").val();i.symmetrytitle="none"===n?void 0:n,i.drawCls.draw(),t.setLogCmd("symmetry "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"clearsymmetry","click",(function(s){var i=e.icn3d;i.symmetrytitle=void 0,i.drawCls.draw(),t.setLogCmd("symmetry none",!0)})),e.myEventCls.onIds(["#"+e.pre+"mn6_hbondsYes","#"+e.pre+"hbondsYes"],"click",(function(t){var s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){var i=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(i)}var n=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomHbond").length&&$("#"+e.pre+"atomsCustomHbond").html("  <option value='non-selected' selected>non-selected</option><option value='selected'>selected</option>"+n),$("#"+e.pre+"atomsCustomHbond2").length&&$("#"+e.pre+"atomsCustomHbond2").html("  <option value='selected' selected>selected</option>"+n),e.htmlCls.dialogCls.openDlg("dl_hbonds","Hydrogen bonds/interactions between two sets of atoms"),s.bHbondCalc=!1,$("#"+e.pre+"atomsCustomHbond").resizable(),$("#"+e.pre+"atomsCustomHbond2").resizable()})),e.myEventCls.onIds("#"+e.pre+"mn6_hbondsNo","click",(function(t){var s=e.icn3d;s.showInterCls.hideHbondsContacts(),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerYes","click",(function(s){var i=e.icn3d;i.threeDPrintCls.addStabilizer(),i.threeDPrintCls.prepareFor3Dprint(),t.setLogCmd("stabilizer",!0)})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerNo","click",(function(s){var i=e.icn3d;t.setLogCmd("set stabilizer off",!0),i.threeDPrintCls.hideStabilizer(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerOne","click",(function(t){var s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_stabilizer","Add One Stabilizer"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn1_stabilizerRmOne","click",(function(t){var s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_stabilizer_rm","Remove One Stabilizer"),s.pk=1,s.opts.pk="atom",s.pickpair=!0,s.pAtomNum=0})),e.myEventCls.onIds("#"+e.pre+"mn1_thicknessSet","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_thickness","Set Thickness for 3D Printing")})),e.myEventCls.onIds("#"+e.pre+"mn3_setThickness","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_thickness2","Set Thickness")})),e.myEventCls.onIds("#"+e.pre+"mn1_thicknessReset","click",(function(s){var i=e.icn3d;t.setLogCmd("reset thickness",!0),i.bSetThickness=!1,i.threeDPrintCls.resetAfter3Dprint(),i.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsYes","click",(function(s){var i=e.icn3d;t.setLogCmd("disulfide bonds",!0),i.annoSsbondCls.showSsbonds()})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsExport","click",(function(s){e.icn3d.viewInterPairsCls.exportSsbondPairs(),t.setLogCmd("export disulfide bond pairs",!1)})),e.myEventCls.onIds("#"+e.pre+"mn6_ssbondsNo","click",(function(s){var i=e.icn3d;i.opts.ssbonds="no";t.setLogCmd("set disulfide bonds off",!0),i.lines.ssbond=[],i.setOptionCls.setStyle("sidec","nothing")})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsYes","click",(function(s){var i=e.icn3d;t.setLogCmd("cross linkage",!0),i.showInterCls.showClbonds()})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsExport","click",(function(s){e.icn3d.viewInterPairsCls.exportClbondPairs(),t.setLogCmd("export cross linkage pairs",!1)})),e.myEventCls.onIds("#"+e.pre+"mn6_clbondsNo","click",(function(s){var i=e.icn3d;i.opts.clbonds="no";t.setLogCmd("set cross linkage off",!0),i.lines.clbond=[],i.setOptionCls.setStyle("sidec","nothing")}))}}setLogCmd(e,t,s){var i=this.icn3dui,n=i.icn3d;if(""===e.trim())return!1;-1!==(a=e.indexOf("|||"))&&(e=e.substr(0,a));var r={};if(r.factor=n._zoomFactor,r.mouseChange=n.mouseChange,r.quaternion={},r.quaternion._x=parseFloat(n.quaternion._x).toPrecision(5),r.quaternion._y=parseFloat(n.quaternion._y).toPrecision(5),r.quaternion._z=parseFloat(n.quaternion._z).toPrecision(5),r.quaternion._w=parseFloat(n.quaternion._w).toPrecision(5),t&&n.bAddCommands)if(n.STATENUMBER<n.commands.length){var a,l=n.commands[n.STATENUMBER-1];-1!=(a=l.indexOf("|||"))&&e!==l.substr(0,a)&&(n.commands=n.commands.slice(0,n.STATENUMBER),n.commands.push(e+"|||"+n.transformCls.getTransformationStr(r)),n.optsHistory.push(i.hashUtilsCls.cloneHash(n.opts)),n.optsHistory[n.optsHistory.length-1].hlatomcount=Object.keys(n.hAtoms).length,i.utilsCls.isSessionStorageSupported()&&n.setStyleCls.saveCommandsToSession(),n.STATENUMBER=n.commands.length)}else n.commands.push(e+"|||"+n.transformCls.getTransformationStr(r)),n.optsHistory.push(i.hashUtilsCls.cloneHash(n.opts)),void 0!==n.hAtoms&&(n.optsHistory[n.optsHistory.length-1].hlatomcount=Object.keys(n.hAtoms).length),i.utilsCls.isSessionStorageSupported()&&n.setStyleCls.saveCommandsToSession(),n.STATENUMBER=n.commands.length;n.bAddLogs&&i.cfg.showcommand&&(n.logs.push(e),$("#"+i.pre+"logtext").val("> "+n.logs.join("\n> ")+"\n> ").scrollTop($("#"+i.pre+"logtext")[0].scrollHeight)),n.setStyleCls.adjustIcon()}}class Ze{constructor(e){this.icn3dui=e}setTopMenusHtml(e,t,s){var i=this.icn3dui;if(i.bNode)return"";var n="";n+="<div style='position:relative;'>",n+=i.htmlCls.divStr+"popup' class='icn3d-text icn3d-popup'></div>",n+=this.setReplayHtml(),n+="\x3c!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar--\x3e",n+=i.htmlCls.divStr+"mnlist' style='position:absolute; z-index:999; float:left; display:table-row; margin-top: -2px;'>",n+="<table border='0' cellpadding='0' cellspacing='0' width='100'><tr>";var r='<td valign="top">';if(n+=r+this.setMenu1()+"</td>",i.cfg.simplemenu||(n+=r+this.setMenu2()+"</td>"),n+=r+this.setMenu2b()+"</td>",n+=r+this.setMenu3()+"</td>",n+=r+this.setMenu4()+"</td>",i.cfg.simplemenu||(n+=r+this.setMenu5()+"</td>",n+=r+this.setMenu6()+"</td>",n+=r+"<div style='position:relative; margin-left:6px;'>"+t,n+="<div class='icn3d-commandTitle' style='min-width:40px; margin-top: 3px; white-space: nowrap;'>"+s,n+=r+'<div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:10px; border-left:solid 1px #888888"><span id="'+i.pre+'selection_expand" class="icn3d-expand icn3d-link" title="Expand">'+i.htmlCls.space2+"Show Toolbar"+i.htmlCls.space2+'</span><span id="'+i.pre+'selection_shrink" class="icn3d-shrink icn3d-link" style="display:none;" title="Shrink">'+i.htmlCls.space2+"Hide Toolbar"+i.htmlCls.space2+"</span></div></td>",n+=r+'<div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:8px; border-left:solid 1px #888888">'+i.htmlCls.space2+'<input type="text" id="'+i.pre+'search_seq" size="10" placeholder="one-letter seq."> <button style="white-space:nowrap;" id="'+i.pre+'search_seq_button">Search Seq.</button> <a style="text-decoration: none;" href="'+i.htmlCls.baseUrl+'icn3d/icn3d.html#selectb" target="_blank" title="Specification tips">?</a></div></td>'),n+="</tr>",n+="</table>",n+="</div>",n+=this.setTools(),n+=i.htmlCls.divStr+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:table-row; margin: 85px 0px 0px 5px; color:"+i.htmlCls.GREYD+"; width:"+i.htmlCls.WIDTH+"px'></div>",n+=i.htmlCls.divStr+"viewer' style='position:relative; width:100%; height:100%; background-color: "+i.htmlCls.GREYD+";'>",n+=i.htmlCls.divStr+"mnLogSection'>",n+="<div style='height: "+i.htmlCls.MENU_HEIGHT+"px;'></div>",n+=" </div>",void 0===i.cfg.mmtfid){n+=i.htmlCls.divStr+"wait' style='position:absolute; left:50px; top:180px; font-size: 1.8em; color: #444444;'>Loading data...</div>"}n+="<canvas id='"+i.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>",(void 0===i.cfg.showcommand||i.cfg.showcommand)&&(n+=this.setLogWindow()),n+="</div>",n+="</div>",n+=i.htmlCls.setDialogCls.setDialogs(),n+=i.htmlCls.setDialogCls.setCustomDialogs(),$("#"+e).html(n),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn-item").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn-item").hover((function(){}),(function(){$("accordion").accordion("option","active","none")})),$("#"+i.pre+"accordion1").hover((function(){$("#"+i.pre+"accordion1 div").css("display","block")}),(function(){$("#"+i.pre+"accordion1 div").css("display","none")})),$("#"+i.pre+"accordion2").hover((function(){$("#"+i.pre+"accordion2 div").css("display","block")}),(function(){$("#"+i.pre+"accordion2 div").css("display","none")})),$("#"+i.pre+"accordion2b").hover((function(){$("#"+i.pre+"accordion2b div").css("display","block")}),(function(){$("#"+i.pre+"accordion2b div").css("display","none")})),$("#"+i.pre+"accordion3").hover((function(){$("#"+i.pre+"accordion3 div").css("display","block")}),(function(){$("#"+i.pre+"accordion3 div").css("display","none")})),$("#"+i.pre+"accordion4").hover((function(){$("#"+i.pre+"accordion4 div").css("display","block")}),(function(){$("#"+i.pre+"accordion4 div").css("display","none")})),$("#"+i.pre+"accordion5").hover((function(){$("#"+i.pre+"accordion5 div").css("display","block")}),(function(){$("#"+i.pre+"accordion5 div").css("display","none")})),$("#"+i.pre+"accordion6").hover((function(){$("#"+i.pre+"accordion6 div").css("display","block")}),(function(){$("#"+i.pre+"accordion6 div").css("display","none")}))}setTopMenusHtmlMobile(e,t,s){var i=this.icn3dui;if(i.bNode)return"";var n="";if(n+="<div style='position:relative;'>",n+=i.htmlCls.divStr+"popup' class='icn3d-text icn3d-popup'></div>",n+=this.setReplayHtml(),!i.utilsCls.isMobile()){var r=i.htmlCls.WIDTH-40+5;n+=i.htmlCls.buttonStr+"fullscreen' style='position:absolute; z-index:1999; display:block; padding:0px; margin: 7px 0px 0px "+r+"px; width:30px; height:34px; border-radius:4px; border:none;' title='Full screen'>",n+="<svg fill='#1c94c4' viewBox='0 0 24 24' width='24' height='24'>",n+="<path d='M0 0h24v24H0z' fill='none'></path>",n+="<path d='M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z'></path>",n+="</svg>",n+="</button>"}n+="\x3c!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar--\x3e",n+=i.htmlCls.divStr+"mnlist' style='position:absolute; z-index:999; float:left; display:block; margin: 5px 0px 0px 5px;'>",n+="<div>",n+="<accordion id='"+i.pre+"accordion0' class='icn3d-accordion'>",i.cfg.notebook?n+="<h3 style='width:20px; height:24px; position:relative; padding: 0'><span style='position:absolute; left:3px; top:4px;'>&#9776;</span></h3>":n+="<h3 style='width:30px; height:34px; position:relative; padding: 0'><span style='position:absolute; left:7px; top:8px;'>&#9776;</span></h3>",n+="<div>";var a="<li><span class='icn3d-menu-color'";n+="<ul class='icn3d-mn-item'>",n+=a+">File</span>",n+=this.setMenu1_base(),n+=a+">Select</span>",n+=this.setMenu2_base(),n+=a+">View</span>",n+=this.setMenu2b_base(),n+=a+" id='"+i.pre+"style'>Style</span>",n+=this.setMenu3_base(),n+=a+" id='"+i.pre+"color'>Color</span>",n+=this.setMenu4_base(),n+=a+">Analysis</span>",n+=this.setMenu5_base(),n+=a+">Help</span>",n+=this.setMenu6_base(),n+="<li><div style='position:relative; margin-top:-6px;'>"+t,n+="<div class='icn3d-commandTitle' style='margin-top: 3px; white-space: nowrap;'>"+s,void 0!==i.cfg.align&&(n+="<li><span id='"+i.pre+"alternate2' class='icn3d-menu-color' title='Alternate the structures'>Alternate</span>"),n+="</ul>",n+="</div>",n+="</accordion>",n+="</div>",n+="</div>";var l="white"==i.htmlCls.opts.background||"grey"==i.htmlCls.opts.background?"black":i.htmlCls.GREYD;if(n+=i.htmlCls.divStr+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:block; margin: 12px 0px 0px 40px; color:"+l+"; width:"+(i.htmlCls.WIDTH-40).toString()+"px'></div>",n+=i.htmlCls.divStr+"viewer' style='position:relative; width:100%; height:100%; background-color: "+i.htmlCls.GREYD+";'>",n+=i.htmlCls.divStr+"mnLogSection'>",n+="<div style='height: "+i.htmlCls.MENU_HEIGHT+"px;'></div>",n+="</div>",void 0===i.cfg.mmtfid){n+=i.htmlCls.divStr+"wait' style='position:absolute; left:50px; top:180px; font-size: 1.8em; color: #444444;'>Loading data...</div>"}n+="<canvas id='"+i.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>",(void 0===i.cfg.showcommand||i.cfg.showcommand)&&(n+=this.setLogWindow()),n+="</div>",n+="</div>",n+=i.htmlCls.setDialogCls.setDialogs(),n+=i.htmlCls.setDialogCls.setCustomDialogs(),$("#"+e).html(n),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn-item").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn-item").hover((function(){}),(function(){$("accordion").accordion("option","active","none")})),$("#"+i.pre+"accordion0").hover((function(){$("#"+i.pre+"accordion0 div").css("display","block")}),(function(){$("#"+i.pre+"accordion0 div").css("display","none")}))}setReplayHtml(e){var t=this.icn3dui;if(t.bNode)return"";var s="";return s+=t.htmlCls.divStr+"replay' style='display:none; position:absolute; z-index:9999; top:"+parseInt(t.htmlCls.HEIGHT-100).toString()+"px; left:20px;'>",s+="<div title='Click to replay one step'><svg style='cursor:pointer;' fill='#f8b84e' viewBox='0 0 60 60' width='40' height='40'>",s+='<circle style="fill:#f8b84e;" cx="29" cy="29" r="29"/>',s+="<g>",s+='<polygon style="fill:#FFFFFF;" points="44,29 22,44 22,29.273 22,14"/>',s+='<path style="fill:#FFFFFF;" d="M22,45c-0.16,0-0.321-0.038-0.467-0.116C21.205,44.711,21,44.371,21,44V14c0-0.371,0.205-0.711,0.533-0.884c0.328-0.174,0.724-0.15,1.031,0.058l22,15C44.836,28.36,45,28.669,45,29s-0.164,0.64-0.437,0.826l-22,15C22.394,44.941,22.197,45,22,45z M23,15.893v26.215L42.225,29L23,15.893z"/>',s+="</g>",s+="</svg></div>",s+=t.htmlCls.divStr+"replay_menu' style='background-color:#DDDDDD; padding:3px; font-weight:bold;'></div>",s+=t.htmlCls.divStr+"replay_cmd' style='background-color:#DDDDDD; padding:3px; max-width:250px'></div>",s+="</div>"}setTools(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+=e.htmlCls.divStr+"selection' style='display:none;'><div style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>",t+="<table style='margin-top: 3px; width:100px;'><tr valign='center'>",t+=this.setTools_base(),t+="</tr></table>",t+="</div></div>"}setButton(e,t,s,i,n){var r=this.icn3dui;return r.bNode?"":(n=void 0!==n?"color:"+n:"","<div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+e+"; height:36px;"+(r.utilsCls.isMobile()?" background-color:#DDDDDD;":"")+"' id='"+r.pre+t+"'><span style='white-space:nowrap;"+n+"' class='icn3d-commandTitle' title='"+s+"'>"+i+"</span></button></div>")}setTools_base(){var e=this.icn3dui;if(e.bNode)return"";var t="",s=e.utilsCls.isMobile()?"none":"button",i="<td valign='top'>";return void 0===e.cfg.align&&void 0===e.cfg.chainalign||(t+=i+this.setButton(s,"alternate","Alternate the structures",'Alternate<br/>(Key "a")',e.htmlCls.ORANGE)+"</td>"),t+=i+this.setButton(s,"saveimage","Save iCn3D PNG Image","Save iCn3D<br/>PNG Image")+"</td>",void 0===e.cfg.cid&&(t+=i+this.setButton(s,"hbondsYes","View H-Bonds & Interactions","H-Bonds &<br/> Interactions")+"</td>"),t+=i+this.setButton(s,"show_selected","View ONLY the selected atoms","View Only<br/>Selection")+"</td>",t+=i+this.setButton(s,"toggleHighlight","Turn on and off the 3D highlight in the viewer","Toggle<br/>Highlight")+"</td>",void 0===e.cfg.cid&&(t+=i+this.setButton(s,"removeLabels","Remove Labels","Remove<br/>Labels")+"</td>"),t}setTheme(e){var t,s,i,n,r,a=this.icn3dui;if(a.bNode)return"";a.htmlCls.themecolor=e,"orange"==e?(t="#e78f08",s="#f6a828",i="ui-bg_gloss-wave_35_f6a828_500x100.png",n="ui-icons_ef8c08_256x240.png",r="#eb8f00"):"black"==e?(t="#333333",s="#333333",i="ui-bg_gloss-wave_25_333333_500x100.png",n="ui-icons_222222_256x240.png",r="#222222"):"blue"==e&&(t="#4297d7",s="#5c9ccc",i="ui-bg_gloss-wave_55_5c9ccc_500x100.png",n="ui-icons_228ef1_256x240.png",r="#444"),$(".ui-widget-header").css({border:"1px solid "+t,background:s+' url("lib/images/'+i+'") 50% 50% repeat-x',color:"#fff","font-weight":"bold"}),$(".ui-button .ui-icon").css({"background-image":"url(lib/images/"+n+")"}),$(".ui-state-active a, .ui-state-active a:link, .ui-state-active a:visited").css({color:r,"text-decoration":"none"})}setLogWindow(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+=e.htmlCls.divStr+"cmdlog' style='float:left; margin-top: -5px; width: 100%;'>",t+="<textarea id='"+e.pre+"logtext' rows='2' style='width: 100%; height: "+e.htmlCls.CMD_HEIGHT+"px; padding: 0px; border: 0px; background-color: "+e.htmlCls.GREYD+";'></textarea>",t+="</div>"}setMenu1(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion1' class='icn3d-accordion'>",t+="<h3>File</h3>",t+="<div>",t+=this.setMenu1_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu1_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<ul class='icn3d-mn-item'>",t+="<li><span>Retrieve by ID</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_mmdbid","MMDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmtfid","MMTF ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_pdbid","PDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_opmid","OPM PDB ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmcifid","mmCIF ID "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_gi","NCBI gi "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_cid","PubChem CID "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>",t+="<li><span>Open File</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_pdbfile","PDB File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_mmciffile","mmCIF File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_mol2file","Mol2 File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_sdffile","SDF File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_xyzfile","XYZ File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_urlfile","URL(Same Host) "+e.htmlCls.wifiStr),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_pngimage","iCn3D PNG Image"),t+=e.htmlCls.setHtmlCls.getLink("mn1_state","State/Script File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_fixedversion","Share Link in Archived Ver. "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_selection","Selection File"),t+="<li>-</li>",t+="<li><span>Electron Density(DSN6)</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_dsn6","Local File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_dsn6url","URL(Same Host) "+e.htmlCls.wifiStr),t+="</ul>",t+="</ul>",t+="</li>",t+="<li><span>Align</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_blast_rep_id","Sequence to Structure "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_align","Structure to Structure "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_chainalign","Multiple Chains "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>",t+="<li id='"+e.pre+"mn2_realignWrap'><span>Realign Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_realign","mn2_realignonseqalign","on Sequence Alignment "+e.htmlCls.wifiStr,!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_realign","mn2_realignresbyres","Residue by Residue"),t+="</ul>",t+="</li>",t+="<li><span>3D Printing</span>",t+="<ul>",void 0===e.cfg.cid?(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrmlStab","VRML(Color, W/  Stabilizers)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStlStab","STL(W/  Stabilizers)"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrml","VRML(Color)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStl","STL"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerYes","Add All  Stabilizers"),t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerNo","Remove All  Stabilizers"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerOne","Add One  Stabilizer"),t+=e.htmlCls.setHtmlCls.getLink("mn1_stabilizerRmOne","Remove One  Stabilizer"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_thicknessSet","Set Thickness"),t+=e.htmlCls.setHtmlCls.getLink("mn1_thicknessReset","Reset Thickness")):(t+=e.htmlCls.setHtmlCls.getLink("mn1_exportVrml","VRML(Color)"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportStl","STL")),t+="</ul>",t+="</li>",t+="<li><span>Save Files</span>",t+="<ul>",t+="<li><span>iCn3D PNG Image</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas","Original Size"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas2","2X Large"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas4","4X Large"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCanvas8","8X Large"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_exportState","State File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportSelections","Selection File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportCounts","Residue Counts"),t+=e.htmlCls.setHtmlCls.getLink("mn1_exportPdbRes","PDB"),t+="<li><br/></li>",t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn1_sharelink","Share Link "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_replayon","Replay Each Step"),t+="<li><br/></li>",t+="</ul>"}setMenu2(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion2' class='icn3d-accordion'>",t+="<h3>Select</h3>",t+="<div>",t+=this.setMenu2_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu2_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<ul class='icn3d-mn-item'>",t+=e.htmlCls.setHtmlCls.getLink("mn2_definedsets","Defined Sets"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectall","All"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectdisplayed","Displayed Set"),t+=e.htmlCls.setHtmlCls.getLink("mn2_aroundsphere","by Distance"),t+="<li><span>by Property</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn2_propPos","Positive"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propNeg","Negative"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propHydro","Hydrophobic"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propPolar","Polar"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propBfactor","B-factor"),t+=e.htmlCls.setHtmlCls.getLink("mn2_propSolAcc","Solvent Accessibility"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn2_selectcomplement","Inverse"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectmainchains","Main Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectsidechains","Side Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectmainsidechains","Main & Side Chains"),t+=e.htmlCls.setHtmlCls.getLink("mn2_command","Advanced"),void 0===e.cfg.cid?(t+="<li><span>Select on 3D</span>",t+="<ul>",t+='<li>"Alt"+Click: start selection</li>',t+='<li>"Ctrl"+Click: union selection</li>',t+='<li>"Shift"+Click: range Selection</li>',t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkChain","Chain"),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi||(t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkDomain","3D Domain")),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkStrand","Strand/Helix"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkResidue","Residue",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkYes","Atom"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_pk","mn2_pkNo","None"),t+="</ul>",t+="</li>"):e.utilsCls.isMobile()?t+="<li><span>Touch to pick</span>":t+='<li><span>Picking with<br>"Alt" + Click</span>',t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn2_saveselection","Save Selection"),t+=e.htmlCls.setHtmlCls.getLink("clearall","Clear Selection"),t+="<li>-</li>",t+="<li><span>Highlight Color</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrYellow","Yellow",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrGreen","Green"),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_clr","mn2_hl_clrRed","Red"),t+="</ul>",t+="</li>",t+="<li><span>Highlight Style</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_style","mn2_hl_styleOutline","Outline",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn2_hl_style","mn2_hl_styleObject","3D Objects"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("toggleHighlight2","Toggle Highlight"),t+="<li><br/></li>",t+="</ul>"}setMenu2b(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion2b' class='icn3d-accordion'>",t+="<h3>View</h3>",t+="<div>",t+=this.setMenu2b_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu2b_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<ul class='icn3d-mn-item'>",t+=e.htmlCls.setHtmlCls.getLink("mn2_show_selected","View Only <br>Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn2_hide_selected","Hide Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn2_selectedcenter","Zoom in Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn6_center","Center Selection"),t+=e.htmlCls.setHtmlCls.getLink("mn2_fullstru","View Full Structure"),t+="<li id='"+e.pre+"mn2_alternateWrap'><span id='"+e.pre+"mn2_alternate' class='icn3d-link'>Alternate(Key \"a\")</span></li>",void 0!==e.cfg.opmid?(t+="<li id='"+e.pre+"togglememli'><span id='"+e.pre+"togglemem' class='icn3d-link'>Toggle Membrane</span></li>",t+="<li id='"+e.pre+"adjustmemli'><span id='"+e.pre+"adjustmem' class='icn3d-link'>Adjust Membrane</span></li>",t+="<li id='"+e.pre+"selectplaneli'><span id='"+e.pre+"selectplane' class='icn3d-link'>Select between<br>Two X-Y Planes</span></li>"):(t+="<li id='"+e.pre+"togglememli' style='display:none'><span id='"+e.pre+"togglemem' class='icn3d-link'>Toggle Membrane</span></li>",t+="<li id='"+e.pre+"adjustmemli' style='display:none'><span id='"+e.pre+"adjustmem' class='icn3d-link'>Adjust Membrane</span></li>",t+="<li id='"+e.pre+"selectplaneli' style='display:none'><span id='"+e.pre+"selectplane' class='icn3d-link'>Select between<br>Two X-Y Planes</span></li>"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_sidebyside","Side by Side"),t+="<li><span>Rotate</span>",t+="<ul>",t+="<li><span>Rotate 90&deg;</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatex","X-axis(Shift + Key M)"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatey","Y-axis(Shift + Key J)"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate90","mn6_rotatez","Z-axis"),t+="</ul>",t+="</li>",t+="<li><span>Auto Rotation</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateleft","Rotate Left"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateright","Rotate Right"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotateup","Rotate Up"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_rotate","mn6_rotatedown","Rotate Down"),t+="</ul>",t+="</li>",t+="</ul>",t+="</li>",t+="<li><span>Camera</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_camera","mn6_cameraPers","Perspective",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_camera","mn6_cameraOrth","Orthographic"),t+="</ul>",t+="</li>",t+="<li><span>Fog for Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showfog","mn6_showfogYes","On"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showfog","mn6_showfogNo","Off",!0),t+="</ul>",t+="</li>",t+="<li><span>Slab for Selection</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showslab","mn6_showslabYes","On"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showslab","mn6_showslabNo","Off",!0),t+="</ul>",t+="</li>",t+="<li><span>XYZ-axes</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisYes","Original"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisSel","Prin. Axes on Sel."),t+=e.htmlCls.setHtmlCls.getRadio("mn6_showaxis","mn6_showaxisNo","Hide",!0),t+="</ul>",t+="</li>",t+="<li>-</li>",t+="<li><span>Reset</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_reset","reset","All"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_reset","mn6_resetOrientation","Orientation"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_back","Undo"),t+=e.htmlCls.setHtmlCls.getLink("mn6_forward","Redo"),t+=e.htmlCls.setHtmlCls.getLink("mn6_fullscreen","Full Screen"),t+="<li><br/></li>",t+="</ul>"}setMenu3(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion3' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"style'>Style</h3>",t+="<div>",t+=this.setMenu3_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu3_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";t+="<ul class='icn3d-mn-item'>",void 0===e.cfg.cid&&(t+="<li><span>Proteins</span>",t+="<ul>",void 0!==e.cfg.align||void 0!==e.cfg.chainalign?t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon"):t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsStrand","Strand"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCylinder","Cylinder and Plate"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsSchematic","Schematic"),void 0!==e.cfg.align||void 0!==e.cfg.chainalign?t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace",!0):t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBackbone","Backbone"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBfactor","B-factor Tube"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_proteins","mn3_proteinsNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Side Chains</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_sidec","mn3_sidecNo","Hide",!0),t+="</ul>",t+="</li>",t+="<li><span>Nucleotides</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclCartoon","Cartoon",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclPhos","O3' Trace"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclBackbone","Backbone"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclSchematic","Schematic"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclLines","Lines"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclBallstick","Ball and Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_nucl","mn3_nuclNo","Hide"),t+="</ul>",t+="</li>"),t+="<li><span>Chemicals</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligLines","Lines"),void 0===e.cfg.cid?(t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligStick","Stick",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick")):(t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligStick","Stick"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick",!0)),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligSchematic","Schematic"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_lig","mn3_ligNo","Hide"),t+="</ul>",t+="</li>",void 0!==e.cfg.cid?(t+="<li><span>Hydrogens</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_hydrogens","mn3_hydrogensYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_hydrogens","mn3_hydrogensNo","Hide"),t+="</ul>",t+="</li>"):(t+="<li><span>Glycans</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_glycansCart","mn3_glycansCartYes","Add Cartoon",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_glycansCart","mn3_glycansCartNo","Remove Cartoon"),t+="</ul>",t+="</li>"),t+="<li><span>Ions</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsSphere","Sphere",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsDot","Dot"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_ions","mn3_ionsNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Water</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterSphere","Sphere"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterDot","Dot"),t+=e.htmlCls.setHtmlCls.getRadio("mn3_water","mn3_waterNo","Hide",!0),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn3_setThickness","Set Thickness"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn3_styleSave","Save Style"),t+=e.htmlCls.setHtmlCls.getLink("mn3_styleApplySave","Apply Saved Style"),t+="<li>-</li>",t+="<li><span>Surface Type</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceVDW","Van der Waals"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceVDWContext","VDW with Context"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceMolecular","Molecular Surface"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceMolecularContext","MS with Context"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceSAS","Solvent Accessible"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_surface","mn5_surfaceSASContext","SA with Context"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn5_surfaceNo","Remove Surface"),t+="<li><span>Surface Opacity</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_opacity","mn5_opacity10","1.0",!0);for(var s=9;s>0;--s)t+=e.htmlCls.setHtmlCls.getRadio("mn5_opacity","mn5_opacity0"+s,"0."+s);return t+="</ul>",t+="</li>",t+="<li><span>Surface <br>Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_wireframe","mn5_wireframeYes","Yes"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_wireframe","mn5_wireframeNo","No",!0),t+="</ul>",t+="</li>",void 0===e.cfg.cid&&void 0===e.cfg.align&&void 0===e.cfg.chainalign&&(t+="<li>-</li>",t+="<li id='"+e.pre+"mapWrapper1'><span>Electron Density</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_elecmap","mn5_elecmap2fofc","2Fo-Fc Map"),t+=e.htmlCls.setHtmlCls.getRadio("mn5_elecmap","mn5_elecmapfofc","Fo-Fc Map"),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_elecmapNo","Remove Map","mapWrapper2"),t+="<li id='"+e.pre+"mapWrapper3'><span>Map <br>Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_mapwireframe","mn5_mapwireframeYes","Yes",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn5_mapwireframe","mn5_mapwireframeNo","No"),t+="</ul>",t+="</li>",void 0===e.cfg.mmtfid&&(t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_emmap","EM Density Map","emmapWrapper1"),t+=e.htmlCls.setHtmlCls.getLinkWrapper("mn5_emmapNo","Remove EM Map","emmapWrapper2"),t+="<li id='"+e.pre+"emmapWrapper3'><span>EM Map <br>Wireframe</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn5_emmapwireframe","mn5_emmapwireframeYes","Yes",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn5_emmapwireframe","mn5_emmapwireframeNo","No"),t+="</ul>",t+="</li>")),t+="<li>-</li>",t+="<li><span>Background</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdTransparent","Transparent",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdBlack","Black"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdGrey","Grey"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_bkgd","mn6_bkgdWhite","White"),t+="</ul>",t+="</li>",t+="<li><span>Dialog Color</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeBlue","Blue",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeOrange","Orange"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_theme","mn6_themeBlack","Black"),t+="</ul>",t+="</li>",t+="<li><span>Two-color Helix</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_doublecolor","mn6_doublecolorYes","Yes"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_doublecolor","mn6_doublecolorNo","No",!0),t+="</ul>",t+="</li>",t+="<li><br/></li>",t+="</ul>"}setMenu4(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion4' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"color'>Color</h3>",t+="<div>",t+=this.setMenu4_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu4_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<ul class='icn3d-mn-item'>",t+="<li><span style='padding-left:2.3em;'>Unicolor</span>",t+="<ul>",t+="<li><span>Red</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed1","Red","F00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed2","Indian Red","CD5C5C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed3","Light Coral","F08080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed4","Salmon","FA8072"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed5","Dark Salmon","E9967A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed6","Light Salmon","FFA07A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed7","Crimson","DC143C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed8","Fire Brick","B22222"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrRed9","Dark Red","8B0000"),t+="</ul>",t+="<li><span>Pink</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink1","Pink","FFC0CB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink2","Light Pink","FFB6C1"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink3","Hot Pink","FF69B4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink4","Deep Pink","FF1493"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink5","Medium Violet Red","C71585"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrPink6","Pale Violet Red","DB7093"),t+="</ul>",t+="<li><span>Orange</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran1","Orange","FFA500"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran2","Dark Orange","FF8C00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran3","Orange Red","FF4500"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran4","Tomato","FF6347"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran5","Coral","FF7F50"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrOran6","Light Salmon","FFA07A"),t+="</ul>",t+="<li><span>Yellow</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw1","Yellow","FF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw2","Gold","FFD700"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw3","Light Yellow","FFFFE0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw4","Lemon Chiffon","FFFACD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw5","Light Golden Rod","FAFAD2"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw6","Papaya Whip","FFEFD5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw7","Moccasin","FFE4B5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw8","Peach Puff","FFDAB9"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw9","Pale Golden Rod","EEE8AA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw10","Khaki","F0E68C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrYllw11","Dark Khaki","BDB76B"),t+="</ul>",t+="<li><span>Magenta</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt1","Magenta","F0F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt2","Orchid","DA70D6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt3","Violet","EE82EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt4","Plum","DDA0DD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt5","Thistle","D8BFD8"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt6","Lavender","E6E6FA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt7","Medium Orchid","BA55D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt8","Medium Purple","9370DB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt9","Rebecca Purple","663399"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt10","Blue Violet","8A2BE2"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt11","Dark Violet","9400D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt12","Dark Orchid","9932CC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt13","Dark Magenta","8B008B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt14","Purple","800080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt15","Indigo","4B0082"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt16","Slat Blue","6A5ACD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt17","Dark Slate Blue","483D8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrMgnt18","Medium Slat Blue","6A5ACD"),t+="</ul>",t+="<li><span>Green</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn1","Green","0F0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn2","Dark Green","006400"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn3","Yellow Green","9ACD32"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn4","Olive Drab","6B8E23"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn5","Olive","808000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn6","Dark Olive Green","556B2F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn7","Medium Aquamarine","66CDAA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn8","Dark Sea Green","8FBC8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn9","Lignt Sea Green","20B2AA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn10","Dark Cyan","008B8B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn11","Teal","008080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn12","Forest Green","228B22"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn13","Sea Green","2E8B57"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn14","Medium Sea Green","3CB371"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn15","Spring Green","00FF7F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn16","Medium Spring","00FA9A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn17","Light Green","90EE90"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn18","Pale Green","98FB98"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn19","Lime Green","32CD32"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn20","Lawn Green","7CFC00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn21","Chartreuse","7FFF00"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGrn22","Green Yellow","ADFF2F"),t+="</ul>",t+="<li><span>Cyan</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan1","Cyan","0FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan2","Light Cyan","E0FFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan3","Pale Turquoise","AFEEEE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan4","Aquamarine","7FFFD4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan5","Turquoise","40E0D0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan6","Medium Turquoise","48D1CC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrCyan7","Dark Turquoise","00CED1"),t+="</ul>",t+="<li><span>Blue</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue1","Blue","00F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue2","Medium Blue","0000CD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue3","Dark Blue","00008B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue4","Navy","000080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue5","Midnight Blue","191970"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue6","Royal Blue","4169E1"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue7","Medium Slate Blue","7B68EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue8","Corn Flower Blue","6495ED"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue9","Dodger Blue","1E90FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue10","Deep Sky Blue","00BFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue11","Light Sky Blue","87CEFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue12","Sky Blue","87CEEB"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue13","Light Blue","ADD8E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue14","Powder Blue","B0E0E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue15","Light Steel Blue","B0C4DE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue16","Steel Blue","4682B4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBlue17","Cadet Blue","5F9EA0"),t+="</ul>",t+="<li><span>Brown</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown1","Brown","A52A2A"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown2","Maroon","800000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown3","Sienna","A0522D"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown4","Saddle Brown","8B4513"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown5","Chocolate","D2691E"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown6","Peru","CD853F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown7","Dark Golden Rod","B8860B"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown8","Golden Rod","DAA520"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown9","Sandy Brown","F4A460"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown10","Rosy Brown","BC8F8F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown11","Tan","D2B48C"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown12","Burlywood","DEB887"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown13","Wheat","F5DEB3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown14","Navajo White","FFDEAD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown15","Bisque","FFE4C4"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown16","Blanched Almond","FFEBCD"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrBrown17","Corn Silk","FFF8DC"),t+="</ul>",t+="<li><span>White</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite1","White","FFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite2","Snow","FFFAFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite3","Honey Dew","F0FFF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite4","Mint Cream","F5FFFA"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite5","Azure","F0FFFF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite6","Alice Blue","F0F8FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite7","Ghost White","F8F8FF"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite8","White Smoke","F5F5F5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite9","Sea Shell","FFF5EE"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite10","Beige","F5F5DC"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite11","Old Lace","FDF5E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite12","Floral White","FFFAF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite13","Ivory","FFFFF0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite14","Antique White","FAEBD7"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite15","Linen","FAF0E6"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite16","Lavenderblush","FFF0F5"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrWhite17","Misty Rose","FFE4E1"),t+="</ul>",t+="<li><span>Grey</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray1","Gray","808080"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray2","Dim Gray","696969"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray3","Light Slate Gray","778899"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray4","Slate Gray","708090"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray5","Dark Slate Gray","2F4F4F"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray6","Black","000000"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray7","Dark Gray","A9A9A9"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray8","Silver","C0C0C0"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray9","Light Gray","D3D3D3"),t+=e.htmlCls.setHtmlCls.getRadioColor("mn4_clr","mn4_clrGray10","Gainsboro","DCDCDC"),t+="</ul>",t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrCustom","Color Picker"),t+="<li>-</li>",void 0===e.cfg.cid?(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSpectrum","Spectrum"),t+="<li><span style='padding-left:2.3em;'>Secondary</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSGreen","Sheet in Green"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSYellow","Sheet in Yellow"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrSSSpectrum","Spectrum"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrCharge","Charge"),e.cfg.notebook||(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn1_delphi2",'DelPhi<br><span style="padding-left:1.5em;">Potential '+e.htmlCls.licenseStr+"</span>")),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrHydrophobic",'Wimley-White<br><span style="padding-left:1.5em;">Hydrophobicity</span>'),t+="<li><span style='padding-left:2.3em;'>B-factor</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrBfactor","Original"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrBfactorNorm","Percentile"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrArea",'Solvent<br><span style="padding-left:1.5em;">Accessibility</span>'),void 0!==e.cfg.align||void 0!==e.cfg.chainalign||void 0!==e.cfg.blast_rep_id?t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrChain","Chain"):t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrChain","Chain",!0),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi||(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrdomain","3D Domain")),t+="<li><span style='padding-left:2.3em;'>Residue</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrResidue","Default"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrResidueCustom","Custom"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrAtom","Atom"),void 0!==e.cfg.align||void 0!==e.cfg.chainalign?(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrIdentity","Identity",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrConserved","Conservation")):void 0!==e.cfg.blast_rep_id&&(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrIdentity","Identity"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrConserved","Conservation",!0))):(t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn1_delphi2",'DelPhi<br><span style="padding-left:1.5em;">Potential '+e.htmlCls.licenseStr+"</span>"),t+=e.htmlCls.setHtmlCls.getRadio("mn4_clr","mn4_clrAtom","Atom",!0)),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn4_clrSave","Save Color"),t+=e.htmlCls.setHtmlCls.getLink("mn4_clrApplySave","Apply Saved Color"),t+="<li><br/></li>",t+="</ul>"}setMenu5(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion5' class='icn3d-accordion'>",t+="<h3 id='"+e.pre+"analysis' style='font-size:1.2em'>&nbsp;Analysis</h3>",t+="<div>",t+=this.setMenu5_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu5_base(){var e=this.icn3dui;if(e.bNode)return"";var t="";t+="<ul class='icn3d-mn-item'>",void 0===e.cfg.cid&&(t+=e.htmlCls.setHtmlCls.getLink("mn6_selectannotations","View Sequences<br>& Annotations "+e.htmlCls.wifiStr),void 0===e.cfg.align&&void 0===e.cfg.chainalign||(t+=e.htmlCls.setHtmlCls.getLink("mn2_alignment","View Aligned<br>Sequences "+e.htmlCls.wifiStr)),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align&&void 0===e.cfg.chainalign||(t+=e.htmlCls.setHtmlCls.getLink("mn2_2ddgm","View 2D Diagram "+e.htmlCls.wifiStr)),t+=e.htmlCls.setHtmlCls.getLink("definedsets2","Defined Sets"),t+="<li>-</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_hbondsYes","H-Bonds <br>& Interactions"),t+="<li><span>Bring to Front</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_window_table","Interaction Table"),t+=e.htmlCls.setHtmlCls.getLink("mn1_window_linegraph","2D Interaction Network"),t+=e.htmlCls.setHtmlCls.getLink("mn1_window_scatterplot","2D Interaction Map"),t+=e.htmlCls.setHtmlCls.getLink("mn1_window_graph","2D Graph(Force-Directed)"),t+="</ul>",t+="</li>",e.cfg.notebook||(t+=e.htmlCls.setHtmlCls.getLink("mn1_mutation","Mutation "+e.htmlCls.licenseStr)),t+="<li>-</li>"),e.cfg.notebook||(t+=e.htmlCls.setHtmlCls.getLink("mn1_delphi","DelPhi Potential "+e.htmlCls.licenseStr),t+="<li><span>Load PQR/Phi</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_phi","Local PQR/Phi/Cube File"),t+=e.htmlCls.setHtmlCls.getLink("mn1_phiurl","URL PQR/Phi/Cube File"),t+="</ul>",t+=e.htmlCls.setHtmlCls.getLink("delphipqr","Download PQR"),t+="<li>-</li>"),t+="<li><span>Distance</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distanceYes","between Two Atoms"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distTwoSets","between Two Sets"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_distance","mn6_distanceNo","Hide",!0),t+="</ul>",t+="</li>",t+=e.htmlCls.setHtmlCls.getLink("mn6_area","Surface Area"),t+="<li><span>Label</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelYes","by Picking Atoms"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelSelection","per Selection"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelAtoms","per Atom"),void 0===e.cfg.cid&&(t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelResidues","per Residue"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelResnum","per Residue & Number"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelChains","per Chain"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelTermini","N- & C-Termini")),t+=e.htmlCls.setHtmlCls.getRadio("mn6_addlabel","mn6_addlabelNo","Remove",!0),t+="</ul>",t+="</li>",t+="<li><span>Label Scale</span>",t+="<ul>";for(var s=1;s<=9;++s)t+=e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale0"+s,"0."+s);for(s=1;s<=4;s*=2)t+=1==s?e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale"+s+"0",s+".0",!0):e.htmlCls.setHtmlCls.getRadio("mn6_labelscale","mn6_labelscale"+s+"0",s+".0");if(t+="</ul>",t+="</li>",t+="<li>-</li>",void 0===e.cfg.cid){t+="<li><span>Chem. Binding</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_chemicalbinding","mn6_chemicalbindingshow","Show"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_chemicalbinding","mn6_chemicalbindinghide","Hide",!0),t+="</ul>",t+="</li>",t+="<li><span>Disulfide Bonds</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsExport","Export Pairs"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_ssbonds","mn6_ssbondsNo","Hide"),t+="</ul>",t+="</li>",t+="<li><span>Cross-Linkages</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsYes","Show",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsExport","Export Pairs"),t+=e.htmlCls.setHtmlCls.getRadio("mn6_clbonds","mn6_clbondsNo","Hide"),t+="</ul>",t+="</li>";var i=void 0!==e.cfg.mmtfid||void 0!==e.cfg.pdbid||void 0!==e.cfg.opmid||void 0!==e.cfg.mmcifid||void 0!==e.cfg.mmdbid||void 0!==e.cfg.gi||void 0!==e.cfg.blast_rep_id;i&&(t+="<li id='"+e.pre+"assemblyWrapper'><span>Assembly</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyYes","Biological Assembly",!0),t+=e.htmlCls.setHtmlCls.getRadio("mn6_assembly","mn6_assemblyNo","Asymmetric Unit"),t+="</ul>",t+="</li>"),t+="<li><span>Symmetry</span>",t+="<ul>",i&&(t+=e.htmlCls.setHtmlCls.getLink("mn6_symmetry","from RCSB(precalculated) "+e.htmlCls.wifiStr)),t+=e.htmlCls.setHtmlCls.getLink("mn6_symd","from SymD(Dynamic) "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn6_clear_sym","Clear SymD Symmetry"),t+="</ul>",t+="</li>",t+="<li>-</li>"}return t+=e.htmlCls.setHtmlCls.getLink("mn6_yournote","Your Note /<br>Window Title"),void 0!==e.cfg.cid?(t+="<li><span>Links</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_link_structure","Compound Summary "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_vast","Similar Compounds "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_bind","Structures Bound "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>"):(t+="<li><span>Links</span>",t+="<ul>",t+=e.htmlCls.setHtmlCls.getLink("mn1_link_structure","Structure Summary "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_vast","Similar Structures "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_pubmed","Literature "+e.htmlCls.wifiStr),t+=e.htmlCls.setHtmlCls.getLink("mn1_link_protein","Protein "+e.htmlCls.wifiStr),t+="</ul>",t+="</li>"),t+="<li><br/></li>",t+="</ul>"}setMenu6(){var e=this.icn3dui;if(e.bNode)return"";var t="";return t+="<div class='icn3d-menu'>",t+="<accordion id='"+e.pre+"accordion6' class='icn3d-accordion'>",t+="<h3>Help</h3>",t+="<div>",t+=this.setMenu6_base(),t+="</div>",t+="</accordion>",t+="</div>"}setMenu6_base(){var e=this.icn3dui;if(e.bNode)return"";var t="",s="<li><a href='";return t+="<ul class='icn3d-mn-item'>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#about' target='_blank'>About iCn3D<span style='font-size:0.9em'> "+e.REVISION+" "+e.htmlCls.wifiStr+"</span></a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#gallery' target='_blank'>Live Gallery "+e.htmlCls.wifiStr+"</a></li>",t+="<li><span>Tutorial</span>",t+="<ul>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#useicn3d' target='_blank'>Use iCn3D</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#videos' target='_blank'>iCn3D Videos</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#parameters' target='_blank'>URL Parameters</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#commands' target='_blank'>Commands</a></li>",t+="</ul>",t+="</li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#citing' target='_blank'>Citing iCn3D "+e.htmlCls.wifiStr+"</a></li>",t+="<li><span>Source Code</span>",t+="<ul>",t+=s+"https://github.com/ncbi/icn3d' target='_blank'>GitHub (browser) "+e.htmlCls.wifiStr+"</a></li>",t+=s+"https://www.npmjs.com/package/icn3d' target='_blank'>npm (Node.js) "+e.htmlCls.wifiStr+"</a></li>",t+="</ul>",t+="</li>",t+="<li><span>Develop</span>",t+="<ul>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#embed' target='_blank'>How to Embed</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#datastructure' target='_blank'>Data Structure</a></li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#classstructure' target='_blank'>Class Structure</a></li>",t+="</ul>",t+="</li>",t+=s+e.htmlCls.baseUrl+"icn3d/docs/icn3d_help.html' target='_blank'>Help Doc "+e.htmlCls.wifiStr+"</a></li>",t+="<li>-</li>",t+="<li><span>Transform Hints</span>",t+="<ul>",t+="<li><span>Rotate</span>",t+="<ul>",t+="<li>Left Mouse</li>",t+="<li>Key l: Left</li>",t+="<li>Key j: Right</li>",t+="<li>Key i: Up</li>",t+="<li>Key m: Down</li>",t+="<li>Shift + Key l: Left 90&deg;</li>",t+="<li>Shift + Key j: Right 90&deg;</li>",t+="<li>Shift + Key i: Up 90&deg;</li>",t+="<li>Shift + Key m: Down 90&deg;</li>",t+="</ul>",t+="</li>",t+="<li><span>Zoom</span>",t+="<ul>",t+="<li>Middle Mouse</li>",t+="<li>Key z: Zoom in</li>",t+="<li>Key x: Zoom out</li>",t+="</ul>",t+="</li>",t+="<li><span>Translate</span>",t+="<ul>",t+="<li>Right Mouse</li>",t+="</ul>",t+="</li>",t+="</ul>",t+="</li>",t+=s+e.htmlCls.baseUrl+"icn3d/icn3d.html#HowToUseStep5' target='_blank'>Selection Hints</a></li>",t+="<li><br/></li>",t+="</ul>"}hideMenu(){var e=this.icn3dui;e.bNode||(void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="none"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="none"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="none"),$("#"+e.pre+"title")[0].style.margin="10px 0 0 10px")}showMenu(){var e=this.icn3dui;e.bNode||(void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="block"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="block"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="block"))}}class et{constructor(e){this.icn3dui=e}openDlg(e,t){var s=this.icn3dui;s.icn3d,s.bNode||(e=s.pre+e,s.cfg.notebook?this.openDlgNotebook(e,t):this.openDlgRegular(e,t),s.htmlCls.themecolor||(s.htmlCls.themecolor="blue"),s.htmlCls.setMenuCls.setTheme(s.htmlCls.themecolor))}addSaveButton(e){var t=this.icn3dui;t.icn3d,t.bNode||void 0!==this.dialogHashSave&&this.dialogHashSave.hasOwnProperty(e)||($("#"+e).parent().children(".ui-dialog-titlebar").append("<span pid='"+e+"' class='icn3d-saveicon ui-icon ui-icon-disk' title='Save as an HTML file'></span>"),void 0===this.dialogHashSave&&(this.dialogHashSave={}),this.dialogHashSave[e]=1)}addHideButton(e){var t=this.icn3dui;t.icn3d,t.bNode||void 0!==this.dialogHashHide&&this.dialogHashHide.hasOwnProperty(e)||($("#"+e).parent().children(".ui-dialog-titlebar").append("<span pid='"+e+"' class='icn3d-hideicon ui-icon ui-icon-arrowthick-2-ne-sw' title='Resize the window'></span>"),void 0===this.dialogHashHide&&(this.dialogHashHide={}),this.dialogHashHide[e]=1)}getDialogStatus(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t={},s=$("#"+e.pre+"dl_selectannotations").hasClass("ui-dialog-content"),i=$("#"+e.pre+"dl_graph").hasClass("ui-dialog-content"),n=$("#"+e.pre+"dl_linegraph").hasClass("ui-dialog-content"),r=$("#"+e.pre+"dl_scatterplot").hasClass("ui-dialog-content"),a=$("#"+e.pre+"dl_interactionsorted").hasClass("ui-dialog-content"),l=$("#"+e.pre+"dl_alignment").hasClass("ui-dialog-content"),o=$("#"+e.pre+"dl_2ddgm").hasClass("ui-dialog-content"),d=$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content");return t.bSelectannotationsInit2=!1,t.bGraph2=!1,t.bLineGraph2=!1,t.bScatterplot2=!1,t.bTable2=!1,t.bAlignmentInit2=!1,t.bTwoddgmInit2=!1,t.bSetsInit2=!1,s&&(t.bSelectannotationsInit2=$("#"+e.pre+"dl_selectannotations").dialog("isOpen")),i&&(t.bGraph2=$("#"+e.pre+"dl_graph").dialog("isOpen")),n&&(t.bLineGraph2=$("#"+e.pre+"dl_linegraph").dialog("isOpen")),r&&(t.bScatterplot2=$("#"+e.pre+"dl_scatterplot").dialog("isOpen")),a&&(t.bTable2=$("#"+e.pre+"dl_interactionsorted").dialog("isOpen")),l&&(t.bAlignmentInit2=$("#"+e.pre+"dl_alignment").dialog("isOpen")),o&&(t.bTwoddgmInit2=$("#"+e.pre+"dl_2ddgm").dialog("isOpen")),d&&(t.bSetsInit2=$("#"+e.pre+"dl_definedsets").dialog("isOpen")),t}}openDlgHalfWindow(e,t,s,i){var n=this.icn3dui,r=n.icn3d;if(!n.bNode){var a=this;r.resizeCanvasCls.resizeCanvas(n.htmlCls.WIDTH-s,n.htmlCls.HEIGHT,i);var l,o=n.htmlCls.HEIGHT,d=s;l=!n.cfg.showmenu||n.utilsCls.isMobile()||n.cfg.mobilemenu?{my:"left top",at:"right top",of:"#"+n.pre+"viewer",collision:"none"}:{my:"left top",at:"right top+40",of:"#"+n.pre+"viewer",collision:"none"},n.cfg.resize=!1,window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:o,width:d,modal:!1,position:l,close:function(t){var s=a.getDialogStatus();if(!((e!==n.pre+"dl_selectannotations"||s.bAlignmentInit2||s.bGraph2||s.bTable2||s.bLineGraph2||s.bScatterplot2)&&(e!==n.pre+"dl_graph"||s.bSelectannotationsInit2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2||s.bScatterplot2)&&(e!==n.pre+"dl_alignment"||s.bSelectannotationsInit2||s.bGraph2||s.bTable2||s.bLineGraph2||s.bScatterplot2)&&(e!==n.pre+"dl_interactionsorted"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bLineGraph2||s.bScatterplot2)&&(e!==n.pre+"dl_linegraph"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bScatterplot2)&&(e!==n.pre+"dl_scatterplot"||s.bSelectannotationsInit2||s.bGraph2||s.bAlignmentInit2||s.bTable2||s.bLineGraph2)))if(s.bTwoddgmInit2||s.bSetsInit2){var i=n.utilsCls.isMobile()?n.htmlCls.WIDTH:n.htmlCls.WIDTH-170;r.resizeCanvasCls.resizeCanvas(i,n.htmlCls.HEIGHT,!0),s.bTwoddgmInit2&&this.openDlg2Ddgm(n.pre+"dl_2ddgm",void 0,s.bSetsInit2),s.bSetsInit2&&this.openDlg2Ddgm(n.pre+"dl_definedsets")}else r.resizeCanvasCls.resizeCanvas(n.htmlCls.WIDTH,n.htmlCls.HEIGHT,!0)},resize:function(t){if(e==n.pre+"dl_selectannotations")r.annotationCls.hideFixedTitle();else if(e==n.pre+"dl_graph"){var s=$("#"+e).width(),i=$("#"+e).height();d3.select("#"+n.svgid).attr("width",s).attr("height",i)}else if(e==n.pre+"dl_linegraph"||e==n.pre+"dl_scatterplot"){var a=status.bTwoddgmInit2||status.bSetsInit2?(n.htmlCls.WIDTH-170)/2:n.htmlCls.WIDTH/2,l=$("#"+e).width()/a;if(e==n.pre+"dl_linegraph"){s=r.linegraphWidth*l;$("#"+n.linegraphid).attr("width",s)}else if(e==n.pre+"dl_scatterplot"){s=r.scatterplotWidth*l;$("#"+n.scatterplotid).attr("width",s)}}}}),this.addSaveButton(e),this.addHideButton(e)}}openDlg2Ddgm(e,t,s){var i=this.icn3dui,n=i.icn3d;if(!i.bNode){var r,a,l=this;e===i.pre+"dl_definedsets"?(r="right top",a="Select sets"):e===i.pre+"dl_2ddgm"&&(r=s?"right top+240":"right top",a="2D Diagram");var o={my:"left top+"+i.htmlCls.MENU_HEIGHT,at:r,of:"#"+i.pre+"viewer",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:a,height:"auto",width:170,modal:!1,position:o,close:function(e){var t=l.getDialogStatus();t.bSelectannotationsInit2||t.bGraph2||t.bLineGraph2||t.bScatterplot2||t.bTable2||t.bAlignmentInit2||n.resizeCanvasCls.resizeCanvas(i.htmlCls.WIDTH,i.htmlCls.HEIGHT,!0)}}),this.addSaveButton(e),this.addHideButton(e)}}openDlgRegular(e,t){var s=this.icn3dui,i=s.icn3d;if(!s.bNode){var n=400,r=150,a=170,l=this.getDialogStatus();if(e===s.pre+"dl_selectannotations"||e===s.pre+"dl_graph"||e===s.pre+"dl_linegraph"||e===s.pre+"dl_scatterplot"||e===s.pre+"dl_interactionsorted"||e===s.pre+"dl_alignment"){var o=.5*s.htmlCls.WIDTH-85;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)this.openDlgHalfWindow(e,t,o,!0),(l.bTwoddgmInit2||l.bSetsInit2)&&(i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-o-a,s.htmlCls.HEIGHT,!0),l.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,l.bSetsInit2),l.bSetsInit2&&this.openDlg2Ddgm(s.pre+"dl_definedsets"));else{i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH,.5*s.htmlCls.HEIGHT,!0),r=.5*s.htmlCls.HEIGHT,n=s.htmlCls.WIDTH;var d={my:"left top",at:"left bottom+32",of:"#"+s.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:r,width:n,modal:!1,position:d,close:function(t){if(!((e!==s.pre+"dl_selectannotations"||l.bAlignmentInit2||l.bGraph2||l.bTable2||l.bLineGraph2||l.bScatterplot2)&&(e!==s.pre+"dl_graph"||l.bSelectannotationsInit2||l.bAlignmentInit2||l.bTable2||l.bLineGraph2||l.bScatterplot2)&&(e!==s.pre+"dl_alignment"||l.bSelectannotationsInit2||l.bGraph2||l.bTable2||l.bLineGraph2||l.bScatterplot2)&&(e!==s.pre+"dl_interactionsorted"||l.bSelectannotationsInit2||l.bGraph2||l.bAlignmentInit2||l.bLineGraph2||l.bScatterplot2)&&(e!==s.pre+"dl_linegraph"||l.bSelectannotationsInit2||l.bGraph2||l.bAlignmentInit2||l.bTable2||l.bScatterplot2)&&(e!==s.pre+"dl_scatterplot"||l.bSelectannotationsInit2||l.bGraph2||l.bAlignmentInit2||l.bTable2||l.bLineGraph2)))if(l.bTwoddgmInit2||l.bSetsInit2){var n=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-a;i.resizeCanvasCls.resizeCanvas(n,s.htmlCls.HEIGHT,!0),l.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,l.bSetsInit2),l.bSetsInit2&&this.openDlg2Ddgm(s.pre+"dl_definedsets")}else i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH,s.htmlCls.HEIGHT,!0)},resize:function(t){if(e==s.pre+"dl_selectannotations")i.annotationCls.hideFixedTitle();else if(e==s.pre+"dl_graph"){var n=$("#"+e).width(),r=$("#"+e).height();d3.select("#"+s.svgid).attr("width",n).attr("height",r)}else if(e==s.pre+"dl_linegraph"||e==s.pre+"dl_scatterplot"){var o=l.bTwoddgmInit2||l.bSetsInit2?(s.htmlCls.WIDTH-a)/2:s.htmlCls.WIDTH/2,d=$("#"+e).width()/o;if(e==s.pre+"dl_linegraph"){n=i.linegraphWidth*d;$("#"+s.linegraphid).attr("width",n)}else if(e==s.pre+"dl_scatterplot"){n=i.scatterplotWidth*d;$("#"+s.scatterplotid).attr("width",n)}}}}),this.addSaveButton(e),this.addHideButton(e)}}else if(e===s.pre+"dl_2ddgm"){var c=0;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)(l.bSelectannotationsInit2||l.bGraph2||l.bLineGraph2||l.bScatterplot2||l.bTable2||l.bAlignmentInit2)&&(c=.5*s.htmlCls.WIDTH-85),i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-c-a,s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,void 0,l.bSetsInit2);else{var h=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-a;i.resizeCanvasCls.resizeCanvas(h,.5*s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT,l.bSetsInit2)}}else{if(r="auto",n="auto",e===s.pre+"dl_addtrack"&&(n="50%"),e===s.pre+"dl_definedsets"){c=0;if(s.htmlCls.WIDTH>=s.htmlCls.HEIGHT)(l.bSelectannotationsInit2||l.bGraph2||l.bLineGraph2||l.bScatterplot2||l.bTable2||l.bAlignmentInit2)&&(c=.5*s.htmlCls.WIDTH-85),i.resizeCanvasCls.resizeCanvas(s.htmlCls.WIDTH-c-a,s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e),l.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",void 0,!0);else{h=s.utilsCls.isMobile()?s.htmlCls.WIDTH:s.htmlCls.WIDTH-a;i.resizeCanvasCls.resizeCanvas(h,.5*s.htmlCls.HEIGHT,!0),this.openDlg2Ddgm(e,.5*s.htmlCls.HEIGHT),l.bTwoddgmInit2&&this.openDlg2Ddgm(s.pre+"dl_2ddgm",.5*s.htmlCls.HEIGHT,!0)}}else s.utilsCls.isMobile()?d={my:"left top",at:"left bottom-50",of:"#"+s.pre+"canvas",collision:"none"}:e===s.pre+"dl_allinteraction"||e===s.pre+"dl_buriedarea"?(d={my:"right top",at:"right top+50",of:"#"+i.divid,collision:"none"},n=700,r=500):d=e===s.pre+"dl_rmsd"?{my:"left top",at:"right bottom-90",of:"#"+s.pre+"canvas",collision:"none"}:e===s.pre+"dl_symd"?{my:"left top",at:"right-200 bottom-200",of:"#"+s.pre+"canvas",collision:"none"}:s.cfg.align?{my:"left top",at:"left top+90",of:"#"+s.pre+"canvas",collision:"none"}:{my:"left top",at:"left top+50",of:"#"+s.pre+"canvas",collision:"none"},window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:r,width:n,modal:!1,position:d}),this.addSaveButton(e),this.addHideButton(e)}$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")}}openDlgNotebook(e,t){var s=this.icn3dui,i=s.icn3d;if(!s.bNode){var n=400,r=150;e===s.pre+"dl_selectannotations"||e===s.pre+"dl_graph"||e===s.pre+"dl_linegraph"||e===s.pre+"dl_scatterplot"||e===s.pre+"dl_interactionsorted"||e===s.pre+"dl_alignment"?($("#"+e).show(),r=.5*s.htmlCls.HEIGHT,n=s.htmlCls.WIDTH,$("#"+e).width(n),$("#"+e).height(r),$("#"+e).resize((function(t){if(e==s.pre+"dl_selectannotations")i.annotationCls.hideFixedTitle();else if(e==s.pre+"dl_graph"){var n=$("#"+e).width(),r=$("#"+e).height();d3.select("#"+s.svgid).attr("width",n).attr("height",r)}else if(e==s.pre+"dl_linegraph"){var a=s.htmlCls.WIDTH/2,l=$("#"+e).width()/a;n=i.linegraphWidth*l;$("#"+s.linegraphid).attr("width",n)}else if(e==s.pre+"dl_scatterplot"){a=s.htmlCls.WIDTH/2,l=$("#"+e).width()/a,n=i.scatterplotWidth*l;$("#"+s.scatterplotid).attr("width",n)}}))):(i.bRender&&$("#"+e).show(),r="auto",n="auto",e===s.pre+"dl_addtrack"?n="50%":e===s.pre+"dl_2ddgm"||e===s.pre+"dl_definedsets"?n=170:e!==s.pre+"dl_allinteraction"&&e!==s.pre+"dl_buriedarea"||(n=700,r=500),$("#"+e).width(n),$("#"+e).height(r))}}}class tt{constructor(e){this.icn3dui=e}setCustomDialogs(){var e=this.icn3dui;if(e.icn3d,e.bNode)return"";return""}setDialogs(){var e=this.icn3dui,t=e.icn3d;if(e.bNode)return"";var s="";e.htmlCls.optionStr="<option value=",s+="\x3c!-- dialog will not be part of the form --\x3e";var i=e.cfg.notebook?"":"icn3d-hidden",n=e.cfg.notebook?"icn3d-hidden":"";s+=e.htmlCls.divStr+"alldialogs' class='"+i+" icn3d-dialog'>",s+=e.htmlCls.divStr+"dl_2ddgm' class='"+n+" icn3d-dl_2ddgm'>",s+="</div>",s+=e.htmlCls.divStr+"dl_alignment' class='"+n+"' style='background-color:white;'>",s+=e.htmlCls.divStr+"symd_info'></div>",s+=e.htmlCls.divStr+"alignseqguide_wrapper'><br>"+e.htmlCls.setHtmlCls.setAlignSequenceGuide()+"</div>",s+=e.htmlCls.divStr+"dl_sequence2' class='icn3d-dl_sequence'>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_definedsets' class='"+n+"'>",s+=e.htmlCls.divStr+"dl_setsmenu'>",s+="<b>Defined Sets:</b> <br/>",s+="<select id='"+e.pre+"atomsCustom' multiple size='6' style='min-width:130px;'>",s+="</select>",s+="<div style='margin: 6px 0 6px 0;'>"+e.htmlCls.buttonStr+"deletesets'><b>Delete Selected Sets</b></button></div>",s+='        <b>Set Operations</b>: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_command_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_command_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',s+="</div>",s+=e.htmlCls.divStr+"dl_command' style='display:none;'>",s+=e.htmlCls.divStr+"dl_setoperations'>",s+="<label for='"+e.pre+"setOr'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setOr' checked> Union(or) </label><br/>",s+="<label for='"+e.pre+"setAnd'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setAnd'> Intersection(and) </label><br/>",s+="<label for='"+e.pre+"setNot'>"+e.htmlCls.inputRadioStr+"name='"+e.pre+"setOperation' id='"+e.pre+"setNot'> Exclusion(not) </label>",s+="</div><br>",s+=e.htmlCls.setHtmlCls.setAdvanced(),s+="</div>",s+="</div>",s+=e.htmlCls.setHtmlCls.setAdvanced(2),s+=e.htmlCls.divStr+"dl_mmtfid' class='"+n+"'>",s+="MMTF ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmtfid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmtf'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pdbid' class='"+n+"'>",s+="PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"pdbid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_pdb'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_opmid' class='"+n+"'>",s+="<a href='https://opm.phar.umich.edu' target='_blank'>Orientations of Proteins in Membranes(OPM)</a> PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"opmid' value='6JXR' size=8> ",s+=e.htmlCls.buttonStr+"reload_opm'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pdbfile' class='"+n+"'>",s+='Note: Several PDB files could be concatenated into a single PDB file. Use the line "ENDMDL" to separate PDB files.<br><br>',s+="PDB File: "+e.htmlCls.inputFileStr+" id='"+e.pre+"pdbfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_pdbfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_rescolorfile' class='"+n+"'>",s+='<div style="width:450px;">The custom JSON file on residue colors has the following format for proteins("ALA" and "ARG") and nucleotides("G" and "A"):<br>',s+='{"ALA":"#C8C8C8", "ARG":"#145AFF", ..., "G":"#008000", "A":"#6080FF", ...}</div><br>',s+="Residue Color File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"rescolorfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_rescolorfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_customcolor' class='"+n+"'>",s+=" <input type='hidden' id='"+e.pre+"customcolor_chainid' value=''>",s+='<div style="width:450px;">The custom file for the structure has two columns separated by space or tab: ',s+='residue number, and score in the range of 0-100. If you click "Custom Color" button, ',s+='scores 0 and 100 mean blue and red, respectively. If you click "Custom Tube", ',s+='the selected residues will be displayed in a style similar to "B-factor Tube".</div><br>',s+="Custom File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"cstcolorfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_customcolorfile' style='margin-left:15px'>Custom Color</button>",s+=e.htmlCls.buttonStr+"reload_customtubefile' style='margin-left:15px'>Custom Tube</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_align' class='"+n+"'>",s+="Enter the PDB IDs or MMDB IDs of two structures that have been found to be similar by <A HREF=' "+e.htmlCls.baseUrl+"vastplus/vastplus.cgi'>VAST+</A> : <br/><br/>ID1: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignid1' value='1HHO' size=8>"+e.htmlCls.space3+e.htmlCls.space3+"ID2: "+e.htmlCls.inputTextStr+"id='"+e.pre+"alignid2' value='4N7N' size=8><br/><br/>",s+=e.htmlCls.buttonStr+"reload_align_ori'>All Matching Molecules Superposed</button>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_align_refined'>Invariant Substructure Superposed</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_chainalign' class='"+n+"'>",s+="<div style='width:500px'>",s+="All chains will be aligned to the first chain in the comma-separated chain IDs. Each chain ID has the form of pdbid_chain(e.g., 1HHO_A, case sensitive). If the residue numbers to be aligned in the first chain is not defined, the full chain will be used for sequence alignment.<br/><br/>",s+="<div style='display:inline-block; width:110px'>Chain IDs: </div>"+e.htmlCls.inputTextStr+"id='"+e.pre+"chainalignids' value='1HHO_A,4N7N_A' size=50><br/>",s+="<div style='display:inline-block; width:110px'>Residue Numbers(optional): </div>"+e.htmlCls.inputTextStr+"id='"+e.pre+"resalignids' placeholder='1,5,10-50' size=50><br/><br/>",s+=e.htmlCls.buttonStr+"reload_chainalign'>Align Biological Unit</button>"+e.htmlCls.buttonStr+"reload_chainalign_asym' style='margin-left:30px'>Align Asymmetric Unit</button><br/><br/>",s+='(Note: To align chains in custom PDB files, you could concatenate PDB files in a single PDB file with the separation line "ENDMDL". Then load it in "Open File > PDB File" in the "File" menu and click "View Sequences & Annotations" in the "Window" menu. Finally select multiple chains in the sequence window and click "Realign Selection" in the "File" menu.)<br><br>',s+="</div></div>",s+=e.htmlCls.divStr+"dl_mutation' class='"+n+"'>",s+="<div style='width:500px'>",s+='Please specify the mutations with a comma separated mutation list. Each mutation can be specified as "[PDB ID]_[Chain ID]_[Residue Number]_[One Letter Mutatnt Residue]". E.g., the mutation of N501Y in the E chain of PDB 6M0J can be specified as "6M0J_E_501_Y". <br/><br/>',s+="<div style='display:inline-block; width:110px'>Mutations: </div>"+e.htmlCls.inputTextStr+"id='"+e.pre+"mutationids' value='6M0J_E_484_K,6M0J_E_501_Y,6M0J_E_417_N' size=50><br/><br/>",s+=e.htmlCls.buttonStr+"reload_mutation_3d' title='Show the mutations in 3D using the scap program'>3D with scap</button>",s+=e.htmlCls.buttonStr+"reload_mutation_inter' style='margin-left:20px' title='Show the mutations in 3D and the change of interactions'>Interactions</button>",s+=e.htmlCls.buttonStr+"reload_mutation_pdb' style='margin-left:20px' title='Show the mutations in 3D and export the PDB of the mutant within 10 angstrom'>PDB</button>",s+="<br/><br/></div></div>",s+=e.htmlCls.divStr+"dl_mol2file' class='"+n+"'>",s+="Mol2 File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"mol2file' size=8> ",s+=e.htmlCls.buttonStr+"reload_mol2file'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_sdffile' class='"+n+"'>",s+="SDF File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"sdffile' size=8> ",s+=e.htmlCls.buttonStr+"reload_sdffile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_xyzfile' class='"+n+"'>",s+="XYZ File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"xyzfile' size=8> ",s+=e.htmlCls.buttonStr+"reload_xyzfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_urlfile' class='"+n+"'>",s+="File type: ",s+="<select id='"+e.pre+"filetype'>",s+=e.htmlCls.optionStr+"'pdb' selected>pdb</option>",s+=e.htmlCls.optionStr+"'mol2'>mol2</option>",s+=e.htmlCls.optionStr+"'sdf'>sdf</option>",s+=e.htmlCls.optionStr+"'xyz'>xyz</option>",s+="</select><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"urlfile' size=20><br/> ",s+=e.htmlCls.buttonStr+"reload_urlfile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmciffile' class='"+n+"'>",s+="mmCIF File: "+e.htmlCls.inputFileStr+"id='"+e.pre+"mmciffile' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmciffile'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmcifid' class='"+n+"'>",s+="mmCIF ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmcifid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmcif'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_mmdbid' class='"+n+"'>",s+="MMDB or PDB ID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"mmdbid' value='1TUP' size=8> ",s+=e.htmlCls.buttonStr+"reload_mmdb'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_blast_rep_id' style='max-width:500px;' class='"+n+"'>",s+="Enter a Sequence ID(or FASTA sequence) and the aligned Structure ID, which can be found using the <a href='https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&PAGE_TYPE=BlastSearch&DATABASE=pdb' target='_blank'>BLAST</a> search against the pdb database with the Sequence ID or FASTA sequence as input.<br><br> ",s+="<b>Sequence ID</b>(NCBI protein accession of a sequence): "+e.htmlCls.inputTextStr+"id='"+e.pre+"query_id' value='NP_001108451.1' size=8><br> ",s+="or FASTA sequence: <br><textarea id='"+e.pre+"query_fasta' rows='5' style='width: 100%; height: "+e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+="<b>Structure ID</b>(NCBI protein accession of a chain of a 3D structure): "+e.htmlCls.inputTextStr+"id='"+e.pre+"blast_rep_id' value='1TSR_A' size=8><br> ",s+=e.htmlCls.buttonStr+"reload_blast_rep_id'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_yournote' class='"+n+"'>",s+='Your note will be saved in the HTML file when you click "File > Save Files > iCn3D PNG Image".<br><br>',s+="<textarea id='"+e.pre+"yournote' rows='5' style='width: 100%; height: "+e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;' placeholder='Enter your note here'></textarea><br>",s+=e.htmlCls.buttonStr+"applyyournote'>Save</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_gi' class='"+n+"'>",s+="Protein gi: "+e.htmlCls.inputTextStr+"id='"+e.pre+"gi' value='1310960' size=8> ",s+=e.htmlCls.buttonStr+"reload_gi'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_cid' class='"+n+"'>",s+="PubChem CID: "+e.htmlCls.inputTextStr+"id='"+e.pre+"cid' value='2244' size=8> ",s+=e.htmlCls.buttonStr+"reload_cid'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_pngimage' class='"+n+"'>",s+="iCn3D PNG image: "+e.htmlCls.inputFileStr+"id='"+e.pre+"pngimage'><br/>",s+=e.htmlCls.buttonStr+"reload_pngimage' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_state' class='"+n+"'>",s+="State file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"state'><br/>",s+=e.htmlCls.buttonStr+"reload_state' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_fixedversion' style='max-width:500px' class='"+n+"'>",s+='Since January 6, 2021, you can show the original view with the archived version of iCn3D by pasting your URL below and click "Show Originial View". Note the version in the parameter "v" was used to replace "full.html" with "full_[v].html" in the URL.<br><br>',s+="Share Link URL: "+e.htmlCls.inputTextStr+"id='"+e.pre+"sharelinkurl' size=60><br>",s+=e.htmlCls.buttonStr+"reload_fixedversion'>Show Original View</button><br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selection' class='"+n+"'>",s+="Selection file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"selectionfile'><br/>",s+=e.htmlCls.buttonStr+"reload_selectionfile' style='margin-top: 6px;'>Load</button>",s+="</div>",s+=e.htmlCls.divStr+"dl_dsn6' class='"+n+"'>",s+="<b>Note</b>: Always load a PDB file before loading DSN6 files. <br/><br/><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>2fofc contour at: <select id='"+e.pre+"dsn6sigma2fofc'>";var r=["0","0.5","1","1.5","2","3","4","5","6","7","8","9","10"];s+=e.htmlCls.setHtmlCls.getOptionHtml(r,3),s+="</select> &sigma;</span><br/>",s+=e.htmlCls.inputFileStr+"id='"+e.pre+"dsn6file2fofc'> "+e.htmlCls.buttonStr+"reload_dsn6file2fofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>fofc contour at: <select id='"+e.pre+"dsn6sigmafofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(r,5),s+="</select> &sigma;</span><br/>",s+=e.htmlCls.inputFileStr+"id='"+e.pre+"dsn6filefofc'> "+e.htmlCls.buttonStr+"reload_dsn6filefofc' style='margin-top: 6px;'>Load</button><br><br><br>",s+=e.htmlCls.buttonStr+"elecmapNo4'>Remove Map</button><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_dsn6url' class='"+n+"'>",s+="<b>Note</b>: Always load a PDB file before loading DSN6 files. <br/><br/><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>2fofc contour at: <select id='"+e.pre+"dsn6sigmaurl2fofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(r,3),s+="</select> &sigma;</span><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"dsn6fileurl2fofc' size=20>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_dsn6fileurl2fofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+="<span style='white-space:nowrap;font-weight:bold;'>fofc contour at: <select id='"+e.pre+"dsn6sigmaurlfofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(r,5),s+="</select> &sigma;</span><br/>",s+="URL in the same host: "+e.htmlCls.inputTextStr+"id='"+e.pre+"dsn6fileurlfofc' size=20>"+e.htmlCls.space3+e.htmlCls.buttonStr+"reload_dsn6fileurlfofc' style='margin-top: 6px;'>Load</button><br><br><br/>",s+=e.htmlCls.buttonStr+"elecmapNo5'>Remove Map</button><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_clr' class='"+n+"'>",s+="Click in the input box to use the color picker:<br><br> ",s+="Custom Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"colorcustom' value='FF0000' size=8> ",s+=e.htmlCls.buttonStr+"applycustomcolor'>Apply</button>",s+="</div>",s+=e.htmlCls.setHtmlCls.getPotentialHtml("delphi",n),s+=e.htmlCls.setHtmlCls.getPotentialHtml("local",n),s+=e.htmlCls.setHtmlCls.getPotentialHtml("url",n),s+=e.htmlCls.divStr+"dl_symmetry' class='"+n+"'><br>",s+=e.htmlCls.divNowrapStr+"Symmetry: <select id='"+e.pre+"selectSymmetry'>",s+="</select>"+e.htmlCls.space3,s+=e.htmlCls.buttonStr+"applysymmetry'>Apply</button>"+e.htmlCls.space3,s+=e.htmlCls.buttonStr+"clearsymmetry'>Clear</button></div>",s+="</div>",s+=e.htmlCls.divStr+"dl_symd' style='max-width:400px' class='"+n+"'><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_hbonds' class='"+n+"'>",s+="1. Choose interaction types and their thresholds:<br>",s+="<div class='icn3d-box'><table border=0 width=450><tr>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_hbond' checked>Hydrogen Bonds <span style='background-color:#"+e.htmlCls.hbondColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"hbondthreshold'>";var a=["3.2","3.3","3.4","3.5","3.6","3.7","3.8","3.9","4.0","4.1","4.2"];s+=e.htmlCls.setHtmlCls.getOptionHtml(a,6),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_saltbridge' checked>Salt Bridge/Ionic <span style='background-color:#"+e.htmlCls.ionicColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"saltbridgethreshold'>";var l=["3","4","5","6","7","8"];s+=e.htmlCls.setHtmlCls.getOptionHtml(l,3),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_contact' checked>Contacts/Interactions <span style='background-color:#"+e.htmlCls.contactColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"contactthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(l,1),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="</tr>",s+="<tr>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_halogen' checked>Halogen Bonds <span style='background-color:#"+e.htmlCls.halogenColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"halogenthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(a,6),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_pication' checked>&pi;-Cation <span style='background-color:#"+e.htmlCls.picationColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"picationthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(l,3),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="<td style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"analysis_pistacking' checked>&pi;-Stacking <span style='background-color:#"+e.htmlCls.pistackingColor+"'>"+e.htmlCls.space3+"</span></td>",s+="<td>",s+=e.htmlCls.divNowrapStr+" <select id='"+e.pre+"pistackingthreshold'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["3","4","5"],99),s+=e.htmlCls.optionStr+"'5.5' selected>5.5</option>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["6","7","8"],99),s+="</select> &#197;"+e.htmlCls.space3+"</div></td>",s+="</tr></table></div>",s+="<table border=0 width=400 cellspacing=10><tr><td>",s+=e.htmlCls.divNowrapStr+"2. Select the first set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomHbond2' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td><td>",s+=e.htmlCls.divNowrapStr+"3. Select the second set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomHbond' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td></tr></table>",void 0!==e.cfg.align||void 0!==e.cfg.chainalign?(s+="<div>4. <b>Cross Structure Interactions</b>: <select id='"+e.pre+"crossstrucinter'>",s+=e.htmlCls.optionStr+"'1'>Yes</option>",s+=e.htmlCls.optionStr+"'0' selected>No</option>",s+="</select></div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"applyhbonds'>3D Display Interactions</button></div><br>"):s+="<div>4. "+e.htmlCls.buttonStr+"applyhbonds'>3D Display Interactions</button></div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondWindow'>Highlight Interactions in Table</button><span style='margin-left:30px; font-wieght:bold'>Sort Interactions on</span>: "+e.htmlCls.buttonStr+"sortSet1'> Set 1</button>"+e.htmlCls.buttonStr+"sortSet2' style='margin-left:20px'>Set 2</button></div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondLineGraph'>2D Interaction Network</button> to show interactions between two lines of residue nodes</div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondScatterplot'>2D Interaction Map</button> to show interactions as map</div><br>";var o=': </td><td><input style="margin-left:-12px" type="text" id="';s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"hbondGraph'>2D Graph(Force-Directed)</button> to show interactions with strength parameters in 0-200:</div>",s+='<div style="text-indent:1.1em"><table><tr><td>Helix or Sheet'+o+e.pre+'dist_ss" size="4" value="100"></td>',s+="<td>Coil or Nucleotide"+o+e.pre+'dist_coil" size="4" value="50"></td>',s+="<td>Disulfide Bonds"+o+e.pre+'dist_ssbond" size="4" value="50"></td></tr>',s+="<tr><td>Hydrogen Bonds"+o+e.pre+'dist_hbond" size="4" value="50"></td>',s+="<td>Salt Bridge/Ionic"+o+e.pre+'dist_ionic" size="4" value="50"></td>',s+="<td>Contacts"+o+e.pre+'dist_inter" size="4" value="25"></td></tr>',s+="<tr><td>Halogen Bonds"+o+e.pre+'dist_halogen" size="4" value="50"></td>',s+="<td>&pi;-Cation"+o+e.pre+'dist_pication" size="4" value="50"></td>',s+="<td>&pi;-Stacking"+o+e.pre+'dist_pistacking" size="4" value="50"></td></tr></table></div>',s+='<div style="text-indent:1.1em">(Note: you can also adjust thresholds at #1 to add/remove interactions.)</div><br>',s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"areaWindow'>Buried Surface Area</button></div><br>",s+="<div>5. "+e.htmlCls.buttonStr+"hbondReset'>Reset</button> and select new sets</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_realign' class='"+n+"'>",s+=e.htmlCls.divNowrapStr+"1. Select sets from two structures below <br>or use your current selection:</div><br>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomRealign' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="<div>2. "+e.htmlCls.buttonStr+"applyRealign'>Realign</button></div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_allinteraction' style='background-color:white' class='"+n+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_interactionsorted' style='background-color:white' class='"+n+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_linegraph' style='background-color:white' class='"+n+"'>",s+=e.htmlCls.divNowrapStr+'<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_linegraphcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="display:none; width:15px;" title="Expand"></span><span id="'+e.pre+'dl_linegraphcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="width:15px;" title="Shrink"></span></div>',s+=e.htmlCls.space2+"Hold Ctrl key to select multiple nodes/lines.</div>",s+=e.htmlCls.divStr+"dl_linegraphcolor' style='display:block;'>",s+=e.htmlCls.setHtmlCls.setColorHints(),s+="</div><br>";var d='<button class="icn3d-commandTitle" style="-webkit-appearance:button; height:24px;background-color:#DDD;" id="';e.linegraphid=e.pre+"linegraph",s+=e.htmlCls.divNowrapStr+d+e.linegraphid+'_svg">SVG</button>'+e.htmlCls.space2,s+=d+e.linegraphid+'_png">PNG</button>'+e.htmlCls.space2,s+=d+e.linegraphid+'_json">JSON</button>'+e.htmlCls.space4,s+="<b>Scale</b>: <select id='"+e.linegraphid+"_scale'>";var c=["0.1","0.2","0.4","0.6","0.8","1","2","4","6","8","10"];s+=e.htmlCls.setHtmlCls.getOptionHtml(c,5),s+="</select></div><br>",s+='<div id="'+e.pre+'linegraphDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_scatterplot' style='background-color:white' class='"+n+"'>",s+=e.htmlCls.divNowrapStr+"Hold Ctrl key to select multiple nodes."+e.htmlCls.space3,s+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_scatterplotcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_scatterplotcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div></div>',s+=e.htmlCls.divStr+"dl_scatterplotcolor' style='display:none;'>",s+=e.htmlCls.setHtmlCls.setColorHints(),s+="</div>",e.scatterplotid=e.pre+"scatterplot",s+=e.htmlCls.divNowrapStr+d+e.scatterplotid+'_svg">SVG</button>'+e.htmlCls.space2,s+=d+e.scatterplotid+'_png">PNG</button>'+e.htmlCls.space2,s+=d+e.scatterplotid+'_json">JSON</button>'+e.htmlCls.space4,s+="<b>Scale</b>: <select id='"+e.scatterplotid+"_scale'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(c,5),s+="</select></div><br>",s+='<div id="'+e.pre+'scatterplotDiv"></div>',s+="</div>",s+=e.htmlCls.divStr+"dl_elecmap2fofc' class='"+n+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigma2fofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(r,3),s+="</select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applymap2fofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"elecmapNo2'>Remove Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_elecmapfofc' class='"+n+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigmafofc'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(r,5),s+="</select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applymapfofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"elecmapNo3'>Remove Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_emmap' class='"+n+"'>",s+="<span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"empercentage'>",s+=e.htmlCls.setHtmlCls.getOptionHtml(["0","10","20","30","40","50","60","70","80","90","100"],3),s+="</select> % of maximum EM values</span><br><span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"applyemmap'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'>"+e.htmlCls.buttonStr+"emmapNo2'>Remove EM Map</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_aroundsphere' class='"+n+"'>",s+=e.htmlCls.divNowrapStr+"1. Select the first set:</div>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomSphere2' multiple size='3' style='min-width:130px;'>",s+="</select></div><br>",s+=e.htmlCls.divNowrapStr+"2. Sphere with a radius: "+e.htmlCls.inputTextStr+"id='"+e.pre+"radius_aroundsphere' value='4' size='2'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. Select the second set to apply the sphere:</div>",s+="<div style='text-indent:1.1em'><select id='"+e.pre+"atomsCustomSphere' multiple size='3' style='min-width:130px;'>",s+="</select></div><br>",s+=e.htmlCls.divNowrapStr+"4. "+e.htmlCls.buttonStr+"applypick_aroundsphere'>Display</button> the sphere around the first set of atoms</div><br>",s+="<div style='text-indent:1.1em'>"+e.htmlCls.buttonStr+"sphereExport'>Save</button> interacting/contacting residue pairs in a file</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_adjustmem' class='"+n+"'>",s+="<b>Note</b>: The membranes are parallel to the X-Y plane. The center of the membranes is at Z = 0. <br/><br/>",s+=e.htmlCls.divNowrapStr+"1. Extracellular membrane Z-axis position: "+e.htmlCls.inputTextStr+"id='"+e.pre+"extra_mem_z' value='' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"2. intracellular membrane Z-axis position: "+e.htmlCls.inputTextStr+"id='"+e.pre+"intra_mem_z' value='' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. "+e.htmlCls.buttonStr+"apply_adjustmem'>Display</button> the adjusted membranes</div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selectplane' class='"+n+"'>",s+="<b>Note</b>: The membranes are parallel to the X-Y plane. The center of the membranes is at Z = 0. <br/><br/>",s+=e.htmlCls.divNowrapStr+"1. Z-axis position of the first X-Y plane: "+e.htmlCls.inputTextStr+"id='"+e.pre+"selectplane_z1' value='15' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"2. Z-axis position of the second X-Y plane: "+e.htmlCls.inputTextStr+"id='"+e.pre+"selectplane_z2' value='-15' size='3'> &#197;</div><br/>",s+=e.htmlCls.divNowrapStr+"3. "+e.htmlCls.buttonStr+"apply_selectplane'>Save</button> the region between the planes to Defined Sets</div><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_addlabel' class='"+n+"'>",s+="1. Text: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labeltext' value='Text' size=4><br/>",s+="2. Size: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelsize' value='18' size=4 maxlength=2><br/>",s+="3. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelcolor' value='ffff00' size=4><br/>",s+="4. Background: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelbkgd' value='cccccc' size=4><br/>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"5. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'5. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"6. "+e.htmlCls.buttonStr+"applypick_labels'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_addlabelselection' class='"+n+"'>",s+="1. Text: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labeltext2' value='Text' size=4><br/>",s+="2. Size: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelsize2' value='18' size=4 maxlength=2><br/>",s+="3. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelcolor2' value='ffff00' size=4><br/>",s+="4. Background: "+e.htmlCls.inputTextStr+"id='"+e.pre+"labelbkgd2' value='cccccc' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"5. "+e.htmlCls.buttonStr+"applyselection_labels'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_distance' class='"+n+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"distancecolor' value='ffff00' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applypick_measuredistance'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_stabilizer' class='"+n+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"stabilizercolor' value='ffffff' size=4><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applypick_stabilizer'>Add</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_disttwosets' class='"+n+"'>",s+=e.htmlCls.spanNowrapStr+"1. Select two sets</span><br/>",s+="<table border=0 width=400 cellspacing=10><tr><td>",s+=e.htmlCls.divNowrapStr+"First set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDist2' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td><td>",s+=e.htmlCls.divNowrapStr+"Second set:</div>",s+="<div style='text-indent:1.1em'><select style='max-width:200px' id='"+e.pre+"atomsCustomDist' multiple size='5' style='min-width:130px;'>",s+="</select></div>",s+="</td></tr></table>",s+=e.htmlCls.spanNowrapStr+"2. Color: "+e.htmlCls.inputTextStr+"id='"+e.pre+"distancecolor2' value='ffff00' size=4><br/><br/>",s+=e.htmlCls.spanNowrapStr+"3. "+e.htmlCls.buttonStr+"applydist2'>Display</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_stabilizer_rm' class='"+n+"'>",e.utilsCls.isMobile()?s+=e.htmlCls.spanNowrapStr+"1. Touch TWO atoms</span><br/>":s+=e.htmlCls.spanNowrapStr+'1. Pick TWO atoms while holding "Alt" key</span><br/>',s+=e.htmlCls.spanNowrapStr+"2. "+e.htmlCls.buttonStr+"applypick_stabilizer_rm'>Remove</button></span>",s+="</div>",s+=e.htmlCls.divStr+"dl_thickness' class='"+n+"'>",s+=e.htmlCls.setHtmlCls.setThicknessHtml("3dprint"),s+="</div>",s+=e.htmlCls.divStr+"dl_thickness2' class='"+n+"'>",s+=e.htmlCls.setHtmlCls.setThicknessHtml("style"),s+="</div>",s+=e.htmlCls.divStr+"dl_addtrack' class='"+n+"'>",s+=" <input type='hidden' id='"+e.pre+"track_chainid' value=''>",s+=e.htmlCls.divStr+"dl_addtrack_tabs' style='border:0px;'>",s+="<ul>",s+="<li><a href='#"+e.pre+"tracktab1'>NCBI gi/Accession</a></li>",s+="<li><a href='#"+e.pre+"tracktab2'>FASTA</a></li>",s+="<li><a href='#"+e.pre+"tracktab2b'>FASTA Alignment</a></li>",s+="<li><a href='#"+e.pre+"tracktab3'>BED File</a></li>",s+="<li><a href='#"+e.pre+"tracktab4'>Custom</a></li>",s+="<li><a href='#"+e.pre+"tracktab5'>Current Selection</a></li>",s+="</ul>",s+=e.htmlCls.divStr+"tracktab1'>",s+="NCBI gi/Accession: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_gi' placeholder='gi' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button1'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab2'>",s+="FASTA Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"fasta_title' placeholder='track title' size=16> <br><br>",s+="FASTA sequence: <br><textarea id='"+e.pre+"track_fasta' rows='5' style='width: 100%; height: "+2*e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+=e.htmlCls.buttonStr+"addtrack_button2'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab2b'>",s+="<div style='width:600px'>The full protein sequences with gaps are listed one by one. The sequence of the structure is listed at the top. If there are non-gap residues(e.g., from RefSeq) outside of the sequence of the structure, please remove them. Each sequence has a title line starting with \">\".</div><br>",s+="<b>FASTA alignment sequences</b>:<br>",s+="<textarea id='"+e.pre+"track_fastaalign' rows='5' style='width: 100%; height: "+2*e.htmlCls.LOG_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+="Position of the first residue in Sequences & Annotations window: "+e.htmlCls.inputTextStr+"id='"+e.pre+"fasta_startpos' value='1' size=2> <br><br>",s+="Color Sequence by: <select id='"+e.pre+"colorseqby'>",s+=e.htmlCls.optionStr+"'identity' selected>Identity</option>",s+=e.htmlCls.optionStr+"'conservation'>Conservation</option>",s+="</select> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button2b'>Add Track(s)</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab3'>",s+="BED file: "+e.htmlCls.inputFileStr+"id='"+e.pre+"track_bed' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button3'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab4'>",s+="Track Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_title' placeholder='track title' size=16> <br><br>",s+='Track Text(e.g., "152 G, 155-156 RR" defines a character "G" at the position 152 and two continuous characters "RR" at positions from 155 to 156. The starting position is 1): <br>',s+="<textarea id='"+e.pre+"track_text' rows='5' style='width: 100%; height: "+2*e.htmlCls.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",s+=e.htmlCls.buttonStr+"addtrack_button4'>Add Track</button>",s+="</div>",s+=e.htmlCls.divStr+"tracktab5'>",s+="Track Title: "+e.htmlCls.inputTextStr+"id='"+e.pre+"track_selection' placeholder='track title' size=16> <br><br>",s+=e.htmlCls.buttonStr+"addtrack_button5'>Add Track</button>",s+="</div>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_saveselection' class='"+n+"'>";var h=t&&t.defNames2Atoms?Object.keys(t.defNames2Atoms).length:1;s+="Name: "+e.htmlCls.inputTextStr+"id='"+e.pre+"seq_command_name' value='seq_"+h+"' size='5'> <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"seq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+e.pre+"seq_clearselection'>Clear</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_copyurl' style='width:520px;' class='"+n+"'>",s+='Please copy one of the URLs below. They show the same result.<br>(To add a title to share link, click "Windows > Your Note" and click "File > Share Link" again.)<br><br>',s+="Original URL with commands: <br><textarea id='"+e.pre+"ori_url' rows='4' style='width:100%'></textarea><br><br>",s+="Lifelong Short URL:(To replace this URL, send a pull request to update share.html at <a href='https://github.com/ncbi/icn3d' target='_blank'>iCn3D GitHub</a>)<br>"+e.htmlCls.inputTextStr+"id='"+e.pre+"short_url' value='' style='width:100%'><br><br>",s+='Lifelong Short URL + Window Title:(To update the window title, click "Analysis > Your Note/Window Title".)<br>'+e.htmlCls.inputTextStr+"id='"+e.pre+"short_url_title' value='' style='width:100%'><br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_selectannotations' class='"+n+" icn3d-annotation' style='background-color:white;'>",s+=e.htmlCls.divStr+"dl_annotations_tabs'>",s+=e.htmlCls.divStr+"dl_anno_view_tabs' style='border:0px; height:33px;'>",s+="<ul>",s+="<li><a href='#"+e.pre+"anno_tmp1' id='"+e.pre+"anno_summary'>Summary</a></li>",s+="<li><a href='#"+e.pre+"anno_tmp2' id='"+e.pre+"anno_details'>Details</a></li>",s+="</ul>",s+=e.htmlCls.divStr+"anno_tmp1'>",s+="</div>",s+=e.htmlCls.divStr+"anno_tmp2'>",s+="</div>",s+="</div>",s+="<div class='icn3d-box' style='width:520px;'><b>Annotations:&nbsp;</b><br><table border=0><tr>";var m="<td style='min-width:110px;'><span style='white-space:nowrap'>",p="<td style='min-width:130px;'><span style='white-space:nowrap'>";return s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_all'>All"+e.htmlCls.space2+"</span></td>",s+=p+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_cdd' checked>Conserved Domains"+e.htmlCls.space2+"</span></td>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_clinvar'>ClinVar"+e.htmlCls.space2+"</span></td>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_binding'>Functional Sites"+e.htmlCls.space2+"</span></td>",s+="</tr><tr>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_custom'>Custom"+e.htmlCls.space2+"</span></td>",s+=p+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_3dd'>3D Domains"+e.htmlCls.space2+"</span></td>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_snp'>SNPs"+e.htmlCls.space2+"</span></td>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_interact'>Interactions"+e.htmlCls.space2+"</span></td>",s+="<td></td>",s+="</tr><tr>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_ssbond'>Disulfide Bonds"+e.htmlCls.space2+"</span></td>",s+=m+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_crosslink'>Cross-Linkages"+e.htmlCls.space2+"</span></td>",void 0!==e.cfg.opmid?s+="<td style='min-width:110px;'><span id='"+e.pre+"anno_transmemli' style='white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_transmem'>Transmembrane"+e.htmlCls.space2+"</span></td>":s+="<td style='min-width:110px;'><span id='"+e.pre+"anno_transmemli' style='display:none; white-space:nowrap'>"+e.htmlCls.inputCheckStr+"id='"+e.pre+"anno_transmem'>Transmembrane"+e.htmlCls.space2+"</span></td>",s+="<td></td>",s+="</tr></table></div>",s+="<button style='white-space:nowrap; margin-left:5px;' id='"+e.pre+"showallchains'>Show All Chains</button><br>",s+=e.htmlCls.divStr+"seqguide_wrapper' style='display:none'><br>"+e.htmlCls.setHtmlCls.setSequenceGuide("2")+"</div>",s+="</div><br/><hr><br>",s+=e.htmlCls.divStr+"dl_annotations'>",s+="</div>",s+="</div>",s+=e.htmlCls.divStr+"dl_graph' style='background-color:white;' class='"+n+"'>",e.svgid=e.pre+"icn3d_viz",s+="<style>",s+="#"+e.svgid+" svg { border: 1px solid; font: 13px sans-serif; text-anchor: end; }",s+="#"+e.svgid+" .node { stroke: #eee; stroke-width: 1.5px; }",s+=".node .selected { stroke: "+e.htmlCls.ORANGE+"; }",s+=".link { stroke: #999; stroke-opacity: 0.6; }",s+="</style>",s+=e.htmlCls.divNowrapStr+"<b>Zoom</b>: mouse wheel; "+e.htmlCls.space3+" <b>Move</b>: left button; "+e.htmlCls.space3+" <b>Select Multiple Nodes</b>: Ctrl Key and drag an Area"+e.htmlCls.space3,s+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_svgcolor_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_svgcolor_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div></div>',s+=e.htmlCls.divStr+"dl_svgcolor' style='display:none;'>",s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px">Click "View > H-Bonds & Interactions" to adjust parameters and relaunch the graph</span></div>',s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#00FF00; font-weight:bold">Green</span>: H-Bonds; ',s+='<span style="color:#00FFFF; font-weight:bold">Cyan</span>: Salt Bridge/Ionic; ',s+='<span style="font-weight:bold">Grey</span>: contacts; ',s+='<span style="color:'+e.htmlCls.ORANGE+'; font-weight:bold">Orange</span>: disulfide bonds</div>',s+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#FF00FF; font-weight:bold">Magenta</span>: Halogen Bonds; ',s+='<span style="color:#FF0000; font-weight:bold">Red</span>: &pi;-Cation; ',s+='<span style="color:#0000FF; font-weight:bold">Blue</span>: &pi;-Stacking</div>',s+="</div>",s+=e.htmlCls.divNowrapStr+d+e.svgid+'_svg">SVG</button>'+e.htmlCls.space2,s+=d+e.svgid+'_png">PNG</button>'+e.htmlCls.space2,s+=d+e.svgid+'_json">JSON</button>',s+=e.htmlCls.space3+"<b>Force on Nodes</b>: <select id='"+e.svgid+"_force'>",s+=e.htmlCls.optionStr+"'0'>No</option>",s+=e.htmlCls.optionStr+"'1'>X-axis</option>",s+=e.htmlCls.optionStr+"'2'>Y-axis</option>",s+=e.htmlCls.optionStr+"'3'>Circle</option>",s+=e.htmlCls.optionStr+"'4' selected>Random</option>",s+="</select>",s+=e.htmlCls.space3+"<b>Label Size</b>: <select id='"+e.svgid+"_label'>",o="icn3d-node-text",s+=e.htmlCls.optionStr+"'"+o+"0'>No</option>",s+=e.htmlCls.optionStr+"'"+o+"4'>4px</option>",s+=e.htmlCls.optionStr+"'"+o+"8' selected>8px</option>",s+=e.htmlCls.optionStr+"'"+o+"12'>12px</option>",s+=e.htmlCls.optionStr+"'"+o+"16'>16px</option>",s+=e.htmlCls.optionStr+"'"+o+"24'>24px</option>",s+=e.htmlCls.optionStr+"'"+o+"32'>32px</option>",s+="</select>",s+=e.htmlCls.space3+"<b>Internal Edges</b>: <select id='"+e.svgid+"_hideedges'>",s+=e.htmlCls.optionStr+"'1' selected>Hide</option>",s+=e.htmlCls.optionStr+"'0'>Show</option>",s+="</select>",s+="</div>",s+='<svg id="'+e.svgid+'" style="margin-top:6px;"></svg>',s+="</div>",s+=e.htmlCls.divStr+"dl_area' class='"+n+"'>",s+="Solvent Accessible Surface Area(SASA) calculated using the <a href='https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0008140' target='_blank'>EDTSurf algorithm</a>: <br>",s+='(0-20% out is considered "in". 50-100% out is considered "out".)<br><br>',s+="<b>Toal</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"areavalue' value='' size='10'> &#8491;<sup>2</sup><br><br>",s+="<div id='"+e.pre+"areatable' style='max-height:400px; overflow:auto'></div>",s+="</div>",s+=e.htmlCls.divStr+"dl_colorbyarea' class='"+n+"'>",s+="<div style='width:500px'>Color each residue based on the percentage of solvent accessilbe surface area. The color ranges from blue, to white, to red for a percentage of 0, 35(variable), and 100, respectively.</div><br>",s+="<b>Middle Percentage(White)</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"midpercent' value='35' size='10'>% <br><br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applycolorbyarea'>Color</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_rmsd' class='"+n+"'>",s+="<br><b>Alignment RMSD</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"realignrmsd' value='35' size='10'>&#8491;<br><br>",s+="</div>",s+=e.htmlCls.divStr+"dl_buriedarea' class='"+n+"'>",s+="</div>",s+=e.htmlCls.divStr+"dl_propbypercentout' class='"+n+"'>",s+="<div style='width:400px'>Select residue based on the percentage of solvent accessilbe surface area. The values are in the range of 0-100.</div><br>",s+="<b>Min Percentage</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"minpercentout' value='0' size='10'>% <br>",s+="<b>Max Percentage</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"maxpercentout' value='100' size='10'>% <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applypropbypercentout'>Apply</button><br/><br/>",s+="</div>",s+=e.htmlCls.divStr+"dl_propbybfactor' class='"+n+"'>",s+="<div style='width:400px'>Select residue based on B-factor. The values are in the range of 0-100.</div><br>",s+="<b>Min B-factor</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"minbfactor' value='0' size='10'>% <br>",s+="<b>Max B-factor</b>: "+e.htmlCls.inputTextStr+"id='"+e.pre+"maxbfactor' value='100' size='10'>% <br>",s+="<button style='white-space:nowrap;' id='"+e.pre+"applypropbybfactor'>Apply</button><br/><br/>",s+="</div>",s+="</div>",s+="\x3c!--/form--\x3e"}}class st{constructor(e){this.icn3dui=e}fullScreenChange(){var e=this.icn3dui,t=e.icn3d;e.bNode||(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullscreenElement||document.msFullscreenElement||(e.htmlCls.clickMenuCls.setLogCmd("exit full screen",!1),t.bFullscreen=!1,e.utilsCls.setViewerWidthHeight(e),t.applyCenterCls.setWidthHeight(e.htmlCls.WIDTH,e.htmlCls.HEIGHT),t.drawCls.draw()))}allEventFunctions(){var e=this.icn3dui,t=e.icn3d;if(!e.bNode){t.definedSetsCls.clickCustomAtoms(),t.definedSetsCls.clickCommand_apply(),t.definedSetsCls.clickModeswitch(),t.selectionCls.clickShow_selected(),t.selectionCls.clickHide_selected(),t.diagram2dCls.click2Ddgm(),t.addTrackCls.clickAddTrackButton(),t.resizeCanvasCls.windowResize(),t.annotationCls.setTabs(),t.resid2specCls.switchHighlightLevel(),e.utilsCls.isMobile()?(t.hlSeqCls.selectSequenceMobile(),t.hlSeqCls.selectChainMobile()):t.hlSeqCls.selectSequenceNonMobile(),e.htmlCls.clickMenuCls.clickMenu1(),e.htmlCls.clickMenuCls.clickMenu2(),e.htmlCls.clickMenuCls.clickMenu3(),e.htmlCls.clickMenuCls.clickMenu4(),e.htmlCls.clickMenuCls.clickMenu5(),e.htmlCls.clickMenuCls.clickMenu6(),e.myEventCls.onIds(["#"+e.pre+"back","#"+e.pre+"mn6_back"],"click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("back",!1),s.resizeCanvasCls.back()})),e.myEventCls.onIds(["#"+e.pre+"forward","#"+e.pre+"mn6_forward"],"click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("forward",!1),s.resizeCanvasCls.forward()})),e.myEventCls.onIds(["#"+e.pre+"fullscreen","#"+e.pre+"mn6_fullscreen"],"click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.clickMenuCls.setLogCmd("enter full screen",!1),s.bFullscreen=!0,e.htmlCls.WIDTH=$(window).width(),e.htmlCls.HEIGHT=$(window).height(),s.applyCenterCls.setWidthHeight(e.htmlCls.WIDTH,e.htmlCls.HEIGHT),s.drawCls.draw(),s.resizeCanvasCls.openFullscreen($("#"+e.pre+"canvas")[0])})),document.addEventListener("fullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("mozfullscreenchange",this.fullScreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.fullScreenChange.bind(this)),e.myEventCls.onIds(["#"+e.pre+"toggle","#"+e.pre+"mn2_toggle"],"click",(function(t){e.icn3d.selectionCls.toggleSelection(),e.htmlCls.clickMenuCls.setLogCmd("toggle selection",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrYellow","click",(function(t){var s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color yellow",!0),s.hColor=e.parasCls.thr(16776960),s.matShader=s.setColorCls.setOutlineColor("yellow"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrGreen","click",(function(t){var s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color green",!0),s.hColor=e.parasCls.thr(65280),s.matShader=s.setColorCls.setOutlineColor("green"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_clrRed","click",(function(t){var s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight color red",!0),s.hColor=e.parasCls.thr(16711680),s.matShader=s.setColorCls.setOutlineColor("red"),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleOutline","click",(function(t){var s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight style outline",!0),s.bHighlight=1,s.hlUpdateCls.showHighlight()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleObject","click",(function(t){var s=e.icn3d;e.htmlCls.clickMenuCls.setLogCmd("set highlight style 3d",!0),s.bHighlight=2,s.hlUpdateCls.showHighlight()})),e.myEventCls.onIds("#"+e.pre+"mn2_hl_styleNone","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds(["#"+e.pre+"alternate","#"+e.pre+"mn2_alternate","#"+e.pre+"alternate2"],"click",(function(t){var s=e.icn3d;s.bAlternate=!0,s.alternateCls.alternateStructures(),s.bAlternate=!1,e.htmlCls.clickMenuCls.setLogCmd("alternate structures",!1)})),e.myEventCls.onIds("#"+e.pre+"mn2_realignresbyres","click",(function(t){e.icn3d.realignParserCls.realign(),e.htmlCls.clickMenuCls.setLogCmd("realign",!0)})),e.myEventCls.onIds("#"+e.pre+"mn2_realignonseqalign","click",(function(t){var s=e.icn3d;if(void 0===s.bSetChainsAdvancedMenu||!s.bSetChainsAdvancedMenu){var i=e.hashUtilsCls.cloneHash(s.hAtoms);s.definedSetsCls.setPredefinedInMenu(),s.bSetChainsAdvancedMenu=!0,s.hAtoms=e.hashUtilsCls.cloneHash(i)}var n=s.definedSetsCls.setAtomMenu(["protein"]);$("#"+e.pre+"atomsCustomRealign").length&&$("#"+e.pre+"atomsCustomRealign").html(n),$("#"+e.pre+"atomsCustomRealign2").length&&$("#"+e.pre+"atomsCustomRealign2").html(n),s.bRender&&e.htmlCls.dialogCls.openDlg("dl_realign","Please select two sets to realign"),$("#"+e.pre+"atomsCustomRealign").resizable(),$("#"+e.pre+"atomsCustomRealign2").resizable()})),e.myEventCls.onIds("#"+e.pre+"applyRealign","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var i=$("#"+e.pre+"atomsCustomRealign").val();i.length>0&&(s.hAtoms=s.definedSetsCls.getAtomsFromNameArray(i)),s.realignParserCls.realignOnSeqAlign(),i.length>0?e.htmlCls.clickMenuCls.setLogCmd("realign on seq align | "+i,!0):e.htmlCls.clickMenuCls.setLogCmd("realign on seq align",!0)})),e.myEventCls.onIds("#"+e.pre+"anno_summary","click",(function(t){var s=e.icn3d;t.preventDefault(),s.annotationCls.setAnnoViewAndDisplay("overview"),e.htmlCls.clickMenuCls.setLogCmd("set view overview",!0)})),e.myEventCls.onIds("#"+e.pre+"anno_details","click",(function(t){var s=e.icn3d;t.preventDefault(),s.annotationCls.setAnnoViewAndDisplay("detailed view"),e.htmlCls.clickMenuCls.setLogCmd("set view detailed view",!0)})),e.myEventCls.onIds("#"+e.pre+"show_annotations","click",(function(t){e.icn3d.showAnnoCls.showAnnotations(),e.htmlCls.clickMenuCls.setLogCmd("view annotations",!0)})),e.myEventCls.onIds("#"+e.pre+"showallchains","click",(function(t){e.icn3d.annotationCls.showAnnoAllChains(),e.htmlCls.clickMenuCls.setLogCmd("show annotations all chains",!0)})),e.myEventCls.onIds("#"+e.pre+"show_alignsequences","click",(function(t){e.icn3d,e.htmlCls.dialogCls.openDlg("dl_alignment","Select residues in aligned sequences")})),e.myEventCls.onIds(["#"+e.pre+"show_2ddgm","#"+e.pre+"mn2_2ddgm"],"click",(function(t){var s=e.icn3d;e.htmlCls.dialogCls.openDlg("dl_2ddgm","2D Diagram"),s.viewInterPairsCls.retrieveInteractionData(),e.htmlCls.clickMenuCls.setLogCmd("view interactions",!0)})),e.myEventCls.onIds("#"+e.pre+"search_seq_button","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$("#"+e.pre+"search_seq").val();isNaN(i)&&-1==i.indexOf("$")&&-1==i.indexOf(".")&&-1==i.indexOf(":")&&-1==i.indexOf("@")&&(i=":"+i);var n=i.replace(/\s+/g,"_"),r=n;s.selByCommCls.selectByCommand(i,n,r),e.htmlCls.clickMenuCls.setLogCmd("select "+i+" | name "+n,!0)})),e.myEventCls.onIds("#"+e.pre+"reload_mmtf","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmtf "+$("#"+e.pre+"mmtfid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmtfid="+$("#"+e.pre+"mmtfid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_pdb","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_opm","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load opm "+$("#"+e.pre+"opmid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?opmid="+$("#"+e.pre+"opmid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_align_refined","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.htmlCls.clickMenuCls.setLogCmd("load alignment "+s+" | parameters &atype=1",!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?align="+s+"&showalignseq=1&atype=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_align_ori","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.htmlCls.clickMenuCls.setLogCmd("load alignment "+s+" | parameters &atype=0",!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?align="+s+"&showalignseq=1&atype=0","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_chainalign","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"chainalignids").val(),i=$("#"+e.pre+"resalignids").val();e.htmlCls.clickMenuCls.setLogCmd("load chains "+s+" | residues "+i,!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?chainalign="+s+"&resnum="+i+"&showalignseq=1","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_chainalign_asym","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"chainalignids").val(),i=$("#"+e.pre+"resalignids").val();e.htmlCls.clickMenuCls.setLogCmd("load chains "+s+" on asymmetric unit | residues "+i,!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?chainalign="+s+"&resnum="+i+"&showalignseq=1&buidx=0","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_3d","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"mutationids").val(),i=s.substr(0,s.indexOf("_"));e.htmlCls.clickMenuCls.setLogCmd("3d of mutation "+s,!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmdbid="+i+"&command=scap 3d "+s+"; select displayed set","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_pdb","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"mutationids").val(),i=s.substr(0,s.indexOf("_"));e.htmlCls.clickMenuCls.setLogCmd("pdb of mutation "+s,!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmdbid="+i+"&command=scap pdb "+s+"; select displayed set","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mutation_inter","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");for(var i=$("#"+e.pre+"mutationids").val(),n=i.split(","),r=[],a=0,l=n.length;a<l;++a){var o=n[a].lastIndexOf("_"),d=n[a].substr(0,o);r.push(d)}var c=i.substr(0,i.indexOf("_"));s.structures||(s.structures={},s.structures[c]=1);var h=s.resid2specCls.residueids2spec(r);e.htmlCls.clickMenuCls.setLogCmd("interaction change of mutation "+i,!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmdbid="+c+"&command=scap interaction "+i+"; select "+h+" | name test; line graph interaction pairs | selected non-selected | hbonds,salt bridge,interactions,halogen,pi-cation,pi-stacking | false | threshold 3.8 6 4 3.8 6 5.5; adjust dialog dl_linegraph; select displayed set","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmcif","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmcifid="+$("#"+e.pre+"mmcifid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_mmdb","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load mmdb "+$("#"+e.pre+"mmdbid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?mmdbid="+$("#"+e.pre+"mmdbid").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_blast_rep_id","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var s=$("#"+e.pre+"query_id").val(),i=encodeURIComponent($("#"+e.pre+"query_fasta").val()),n=$("#"+e.pre+"blast_rep_id").val();e.htmlCls.clickMenuCls.setLogCmd("load seq_struc_ids "+s+","+n,!1),s=""!==s&&void 0!==s?s:i,window.open(e.htmlCls.baseUrl+"icn3d/full.html?from=icn3d&blast_rep_id="+n+"&query_id="+s+"&command=view annotations; set annotation cdd; set annotation site; set view detailed view; select chain "+n+"; show selection","_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_gi","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load gi "+$("#"+e.pre+"gi").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?gi="+$("#"+e.pre+"gi").val(),"_blank")})),e.myEventCls.onIds("#"+e.pre+"reload_cid","click",(function(t){e.icn3d,t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.htmlCls.clickMenuCls.setLogCmd("load cid "+$("#"+e.pre+"cid").val(),!1),window.open(e.htmlCls.baseUrl+"icn3d/full.html?cid="+$("#"+e.pre+"cid").val(),"_blank")})),e.htmlCls.setHtmlCls.clickReload_pngimage(),e.myEventCls.onIds("#"+e.pre+"reload_state","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close"),s.bInputfile||s.init();var i=$("#"+e.pre+"state")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){s.bStatefile=!0;var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load state file "+$("#"+e.pre+"state").val(),!1),s.commands=[],s.optsHistory=[],s.loadScriptCls.loadScript(i,!0)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_selectionfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var i=$("#"+e.pre+"selectionfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;s.selectionCls.loadSelection(i),e.htmlCls.clickMenuCls.setLogCmd("load selection file "+$("#"+e.pre+"selectionfile").val(),!1)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6file2fofc","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6File("2fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6filefofc","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6File("fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_delphifile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadDelphiFile("delphi")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("pqr")})),e.myEventCls.onIds("#"+e.pre+"reload_phifile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("phi")})),e.myEventCls.onIds("#"+e.pre+"reload_cubefile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("cube")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrurlfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("pqrurl")})),e.myEventCls.onIds("#"+e.pre+"reload_phiurlfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("phiurl")})),e.myEventCls.onIds("#"+e.pre+"reload_cubeurlfile","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("cubeurl")})),e.myEventCls.onIds("#"+e.pre+"reload_delphifile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("delphi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadDelphiFile("delphi2")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrfile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("pqr2")})),e.myEventCls.onIds("#"+e.pre+"reload_phifile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("phi2")})),e.myEventCls.onIds("#"+e.pre+"reload_cubefile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phi"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFile("cube2")})),e.myEventCls.onIds("#"+e.pre+"reload_pqrurlfile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("pqrurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_phiurlfile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("phiurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_cubeurlfile2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.setHtmlCls.updateSurfPara("phiurl"),e.cfg.notebook||dialog.dialog("close"),s.delphiCls.loadPhiFileUrl("cubeurl2")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6fileurl2fofc","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6FileUrl("2fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_dsn6fileurlfofc","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.dsn6ParserCls.loadDsn6FileUrl("fofc")})),e.myEventCls.onIds("#"+e.pre+"reload_pdbfile","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"pdbfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load pdb file "+$("#"+e.pre+"pdbfile").val(),!1),s.molTitle="",s.init(),s.bInputfile=!0,s.InputfileData=i,s.InputfileType="pdb",s.pdbParserCls.loadPdbData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_mol2file","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mol2file")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load mol2 file "+$("#"+e.pre+"mol2file").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=i,s.InputfileType="mol2",s.mol2ParserCls.loadMol2Data(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_sdffile","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"sdffile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load sdf file "+$("#"+e.pre+"sdffile").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=i,s.InputfileType="sdf",s.sdfParserCls.loadSdfData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_xyzfile","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"xyzfile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load xyz file "+$("#"+e.pre+"xyzfile").val(),!1),s.molTitle="",s.inputid=void 0,s.init(),s.bInputfile=!0,s.InputfileData=i,s.InputfileType="xyz",s.xyzParserCls.loadXyzData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"reload_urlfile","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"filetype").val(),n=$("#"+e.pre+"urlfile").val();s.inputurl="type="+i+"&url="+encodeURIComponent(n),s.init(),s.bInputfile=!0,s.bInputUrlfile=!0,s.pdbParserCls.downloadUrl(n,i)})),e.myEventCls.onIds("#"+e.pre+"reload_mmciffile","click",(function(t){var s=e.icn3d;t.preventDefault(),s.bInitial=!0,e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?s.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mmciffile")[0].files[0];if(i){e.htmlCls.setHtmlCls.fileSupport();var n=new FileReader;n.onload=function(t){var i=t.target.result;e.htmlCls.clickMenuCls.setLogCmd("load mmcif file "+$("#"+e.pre+"mmciffile").val(),!1),s.molTitle="";var n=e.htmlCls.baseUrl+"mmcifparser/mmcifparser.cgi";s.bCid=void 0,$.ajax({url:n,type:"POST",data:{mmciffile:i},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){s.ParserUtilsCls.showLoading()},complete:function(){},success:function(e){s.init(),s.bInputfile=!0,s.InputfileData=e,s.InputfileType="mmcif",s.mmcifParserCls.loadMmcifData(e)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})),e.myEventCls.onIds("#"+e.pre+"applycustomcolor","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.setOptionCls.setOption("color",$("#"+e.pre+"colorcustom").val()),e.htmlCls.clickMenuCls.setLogCmd("color "+$("#"+e.pre+"colorcustom").val(),!0)})),e.myEventCls.onIds(["#"+e.pre+"atomsCustomSphere2","#"+e.pre+"atomsCustomSphere","#"+e.pre+"radius_aroundsphere"],"change",(function(t){e.icn3d.bSphereCalc=!1})),e.myEventCls.onIds("#"+e.pre+"applypick_aroundsphere","click",(function(t){var s=e.icn3d,i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),n=$("#"+e.pre+"atomsCustomSphere").val(),r=$("#"+e.pre+"atomsCustomSphere2").val();if(0==r.length)alert("Please select the first set at step #1");else{var a="select zone cutoff "+i+" | sets "+r+" "+n+" | "+s.bSphereCalc;s.bSphereCalc||s.showInterCls.pickCustomSphere(i,r,n,s.bSphereCalc),s.bSphereCalc=!0,s.hlUpdateCls.updateHlAll(),e.htmlCls.clickMenuCls.setLogCmd(a,!0)}})),e.myEventCls.onIds("#"+e.pre+"sphereExport","click",(function(t){var s=e.icn3d;t.preventDefault();var i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),n=$("#"+e.pre+"atomsCustomSphere").val(),r=$("#"+e.pre+"atomsCustomSphere2").val();if(0==r.length)alert("Please select the first set at step #1");else{s.showInterCls.pickCustomSphere(i,r,n,s.bSphereCalc),s.bSphereCalc=!0;var a=s.viewInterPairsCls.exportSpherePairs(),l=s.inputid?s.inputid:"custom";s.saveFileCls.saveFile(l+"_sphere_pairs.html","html",a),e.htmlCls.clickMenuCls.setLogCmd("export pairs | "+r+" "+n+" | dist "+i,!0)}})),e.myEventCls.onIds("#"+e.pre+"apply_adjustmem","click",(function(t){var s=e.icn3d;e.cfg.notebook||dialog.dialog("close");var i=parseFloat($("#"+e.pre+"extra_mem_z").val()),n=parseFloat($("#"+e.pre+"intra_mem_z").val());s.selectionCls.adjustMembrane(i,n);var r="adjust membrane z-axis "+i+" "+n;e.htmlCls.clickMenuCls.setLogCmd(r,!0)})),e.myEventCls.onIds("#"+e.pre+"apply_selectplane","click",(function(t){var s=e.icn3d;e.cfg.notebook||dialog.dialog("close");var i=parseFloat($("#"+e.pre+"selectplane_z1").val()),n=parseFloat($("#"+e.pre+"selectplane_z2").val());s.selectionCls.selectBtwPlanes(i,n);var r="select planes z-axis "+i+" "+n;e.htmlCls.clickMenuCls.setLogCmd(r,!0)})),e.myEventCls.onIds(["#"+e.pre+"atomsCustomHbond2","#"+e.pre+"atomsCustomHbond","#"+e.pre+"analysis_hbond","#"+e.pre+"analysis_saltbridge","#"+e.pre+"analysis_contact","#"+e.pre+"hbondthreshold","#"+e.pre+"saltbridgethreshold","#"+e.pre+"contactthreshold"],"change",(function(t){e.icn3d.bHbondCalc=!1})),e.myEventCls.onIds("#"+e.pre+"crossstrucinter","change",(function(t){var s=e.icn3d;t.preventDefault(),s.crossstrucinter=parseInt($("#"+e.pre+"crossstrucinter").val()),e.htmlCls.clickMenuCls.setLogCmd("cross structure interaction "+s.crossstrucinter,!0)})),e.myEventCls.onIds("#"+e.pre+"applyhbonds","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("3d")})),e.myEventCls.onIds("#"+e.pre+"hbondWindow","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("view")})),e.myEventCls.onIds("#"+e.pre+"areaWindow","click",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.pre+"atomsCustomHbond").val(),n=$("#"+e.pre+"atomsCustomHbond2").val();s.analysisCls.calcBuriedSurface(n,i),e.htmlCls.clickMenuCls.setLogCmd("calc buried surface | "+n+" "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"sortSet1","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("save1")})),$(document).on("click","."+e.pre+"showintercntonly",(function(t){e.icn3d,t.stopImmediatePropagation(),$(".icn3d-border").hide(),e.htmlCls.clickMenuCls.setLogCmd("table inter count only",!0)})),$(document).on("click","."+e.pre+"showinterdetails",(function(t){e.icn3d,t.stopImmediatePropagation(),$(".icn3d-border").show(),e.htmlCls.clickMenuCls.setLogCmd("table inter details",!0)})),e.myEventCls.onIds("#"+e.pre+"sortSet2","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("save2")})),e.myEventCls.onIds("#"+e.pre+"hbondGraph","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("graph")})),e.myEventCls.onIds("#"+e.pre+"hbondLineGraph","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("linegraph")})),e.myEventCls.onIds("#"+e.pre+"hbondScatterplot","click",(function(t){var s=e.icn3d;t.preventDefault(),s.showInterCls.showInteractions("scatterplot")})),$(document).on("click","#"+e.svgid+" circle.selected",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("res");!1!==s.bSelectResidue||s.bShift||s.bCtrl||s.selectionCls.removeSelection(),void 0!==i&&(s.hlSeqCls.selectResidues(i,this),s.hlObjectsCls.addHlObjects())})),e.myEventCls.onIds("#"+e.svgid+"_svg","click",(function(t){var s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.svgid,s.inputid+"_force_directed_graph.svg")})),e.myEventCls.onIds("#"+e.svgid+"_png","click",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.pre+"dl_graph").width(),n=$("#"+e.pre+"dl_graph").height();s.saveFileCls.savePng(e.svgid,s.inputid+"_force_directed_graph.png",i,n)})),e.myEventCls.onIds("#"+e.svgid+"_json","click",(function(t){var s=e.icn3d;t.preventDefault();var i=s.graphStr.substr(0,s.graphStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_force_directed_graph.json","text",[i])})),e.myEventCls.onIds("#"+e.linegraphid+"_svg","click",(function(t){var s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.linegraphid,s.inputid+"_line_graph.svg")})),e.myEventCls.onIds("#"+e.linegraphid+"_png","click",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.pre+"dl_linegraph").width(),n=$("#"+e.pre+"dl_linegraph").height();s.saveFileCls.savePng(e.linegraphid,s.inputid+"_line_graph.png",i,n)})),e.myEventCls.onIds("#"+e.linegraphid+"_json","click",(function(t){var s=e.icn3d;t.preventDefault();var i=s.lineGraphStr.substr(0,s.lineGraphStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_line_graph.json","text",[i])})),e.myEventCls.onIds("#"+e.linegraphid+"_scale","change",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.linegraphid+"_scale").val();$("#"+e.linegraphid).attr("width",(s.linegraphWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("line graph scale "+i,!0)})),e.myEventCls.onIds("#"+e.scatterplotid+"_svg","click",(function(t){var s=e.icn3d;t.preventDefault(),s.saveFileCls.saveSvg(e.scatterplotid,s.inputid+"_scatterplot.svg")})),e.myEventCls.onIds("#"+e.scatterplotid+"_png","click",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.pre+"dl_scatterplot").width(),n=$("#"+e.pre+"dl_scatterplot").height();s.saveFileCls.savePng(e.scatterplotid,s.inputid+"_scatterplot.png",i,n)})),e.myEventCls.onIds("#"+e.scatterplotid+"_json","click",(function(t){var s=e.icn3d;t.preventDefault();var i=s.scatterplotStr.substr(0,s.scatterplotStr.lastIndexOf("}"));i+=e.htmlCls.setHtmlCls.getLinkColor(),s.saveFileCls.saveFile(s.inputid+"_scatterplot.json","text",[i])})),e.myEventCls.onIds("#"+e.scatterplotid+"_scale","change",(function(t){var s=e.icn3d;t.preventDefault();var i=$("#"+e.scatterplotid+"_scale").val();$("#"+e.scatterplotid).attr("width",(s.scatterplotWidth*parseFloat(i)).toString()+"px"),e.htmlCls.clickMenuCls.setLogCmd("scatterplot scale "+i,!0)})),e.myEventCls.onIds("#"+e.svgid+"_label","change",(function(t){e.icn3d,t.preventDefault();var s=$("#"+e.svgid+"_label").val();$("#"+e.svgid+" text").removeClass(),$("#"+e.svgid+" text").addClass(s),e.htmlCls.clickMenuCls.setLogCmd("graph label "+s,!0)})),e.myEventCls.onIds("#"+e.svgid+"_hideedges","change",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.hideedges=parseInt($("#"+e.svgid+"_hideedges").val()),e.htmlCls.hideedges?(e.htmlCls.contactInsideColor="FFF",e.htmlCls.hbondInsideColor="FFF",e.htmlCls.ionicInsideColor="FFF"):(e.htmlCls.contactInsideColor="DDD",e.htmlCls.hbondInsideColor="AFA",e.htmlCls.ionicInsideColor="8FF"),void 0!==s.graphStr&&(s.bRender&&e.htmlCls.force&&e.drawGraph(s.graphStr,e.pre+"dl_graph"),e.htmlCls.clickMenuCls.setLogCmd("hide edges "+e.htmlCls.hideedges,!0))})),e.myEventCls.onIds("#"+e.svgid+"_force","change",(function(t){var s=e.icn3d;t.preventDefault(),e.htmlCls.force=parseInt($("#"+e.svgid+"_force").val()),void 0!==s.graphStr&&(e.htmlCls.clickMenuCls.setLogCmd("graph force "+e.htmlCls.force,!0),s.getGraphCls.handleForce())})),e.myEventCls.onIds("#"+e.pre+"hbondReset","click",(function(t){var s=e.icn3d;t.preventDefault(),s.viewInterPairsCls.resetInteractionPairs(),e.htmlCls.clickMenuCls.setLogCmd("reset interaction pairs",!0)})),e.myEventCls.onIds("#"+e.pre+"applypick_labels","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var i=$("#"+e.pre+"labeltext").val(),n=$("#"+e.pre+"labelsize").val(),r=$("#"+e.pre+"labelcolor").val(),a=$("#"+e.pre+"labelbkgd").val();if("0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),"0"!==a&&""!==a&&"undefined"!==a||(a=0),void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{var l=(s.pAtom.coord.x+s.pAtom2.coord.x)/2,o=(s.pAtom.coord.y+s.pAtom2.coord.y)/2,d=(s.pAtom.coord.z+s.pAtom2.coord.z)/2;s.analysisCls.addLabel(i,l,o,d,n,r,a,"custom"),s.pickpair=!1;var c="",h="",m="";0!=n&&(c=" | size "+n),0!=r&&(h=" | color "+r),0!=a&&(m=" | background "+a),e.htmlCls.clickMenuCls.setLogCmd("add label "+i+" | x "+l.toPrecision(4)+" y "+o.toPrecision(4)+" z "+d.toPrecision(4)+c+h+m+" | type custom",!0),s.drawCls.draw()}})),e.myEventCls.onIds("#"+e.pre+"applyselection_labels","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close");var i=$("#"+e.pre+"labeltext2").val(),n=$("#"+e.pre+"labelsize2").val(),r=$("#"+e.pre+"labelcolor2").val(),a=$("#"+e.pre+"labelbkgd2").val();"0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),"0"!==a&&""!==a&&"undefined"!==a||(a=0);var l=s.applyCenterCls.centerAtoms(e.hashUtilsCls.hash2Atoms(s.hAtoms,s.atoms)),o=l.center.x,d=l.center.y,c=l.center.z;s.analysisCls.addLabel(i,o,d,c,n,r,a,"custom");var h="",m="",p="";0!=n&&(h=" | size "+n),0!=r&&(m=" | color "+r),0!=a&&(p=" | background "+a),e.htmlCls.clickMenuCls.setLogCmd("add label "+i+" | x "+o.toPrecision(4)+" y "+d.toPrecision(4)+" z "+c.toPrecision(4)+h+m+p+" | type custom",!0),s.drawCls.draw()})),e.myEventCls.onIds("#"+e.pre+"applypick_stabilizer","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),void 0===s.pAtom||void 0===s.pAtom2?alert("Please pick another atom"):(s.pickpair=!1,e.htmlCls.clickMenuCls.setLogCmd("add one stabilizer | "+s.pAtom.serial+" "+s.pAtom2.serial,!0),void 0===s.pairArray&&(s.pairArray=[]),s.pairArray.push(s.pAtom.serial),s.pairArray.push(s.pAtom2.serial),s.threeDPrintCls.setThichknessFor3Dprint(),s.drawCls.draw())}));var s=new CP(document.querySelector("#"+e.pre+"colorcustom"));s.on("change",(function(e){this.target.value=e})),e.myEventCls.onIds("#"+e.pre+"colorcustom","input",(function(){var t=$("#"+e.pre+"colorcustom").val();s.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","keyup",(function(){var t=$("#"+e.pre+"colorcustom").val();s.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","paste",(function(){var t=$("#"+e.pre+"colorcustom").val();s.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"colorcustom","cut",(function(){var t=$("#"+e.pre+"colorcustom").val();s.set("#"+t).enter()})),e.myEventCls.onIds("#"+e.pre+"applypick_stabilizer_rm","click",(function(t){var s=e.icn3d;if(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{s.pickpair=!1,e.htmlCls.clickMenuCls.setLogCmd("remove one stabilizer | "+s.pAtom.serial+" "+s.pAtom2.serial,!0);var i=[];i.push(s.pAtom.serial),i.push(s.pAtom2.serial),s.threeDPrintCls.removeOneStabilizer(i),s.drawCls.draw()}})),e.myEventCls.onIds("#"+e.pre+"applypick_measuredistance","click",(function(t){var s=e.icn3d;if(t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.bMeasureDistance=!1,void 0===s.pAtom||void 0===s.pAtom2)alert("Please pick another atom");else{var i=$("#"+e.pre+"linecolor").val(),n=(s.pAtom.coord.x+s.pAtom2.coord.x)/2,r=(s.pAtom.coord.y+s.pAtom2.coord.y)/2,a=(s.pAtom.coord.z+s.pAtom2.coord.z)/2;s.analysisCls.addLineFromPicking("distance");var l=(parseInt(10*s.pAtom.coord.distanceTo(s.pAtom2.coord))/10).toString()+" A";s.analysisCls.addLabel(l,n,r,a,0,i,0,"distance");var o="",d="",c="";0,0!=i&&(d=" | color "+i),e.htmlCls.clickMenuCls.setLogCmd("add label "+l+" | x "+n.toPrecision(4)+" y "+r.toPrecision(4)+" z "+a.toPrecision(4)+o+d+c+" | type distance",!0),s.drawCls.draw(),s.pk=2}})),e.myEventCls.onIds("#"+e.pre+"applydist2","click",(function(t){var s=e.icn3d;t.preventDefault(),e.cfg.notebook||dialog.dialog("close"),s.bMeasureDistance=!1;var i=$("#"+e.pre+"atomsCustomDist").val(),n=$("#"+e.pre+"atomsCustomDist2").val();s.analysisCls.measureDistTwoSets(i,n),e.htmlCls.clickMenuCls.setLogCmd("dist | "+n+" "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"apply_thickness_3dprint","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("3dprint")})),e.myEventCls.onIds("#"+e.pre+"apply_thickness_style","click",(function(t){e.icn3d,t.preventDefault(),e.htmlCls.setHtmlCls.setLineThickness("style")})),e.myEventCls.onIds("#"+e.pre+"reset","click",(function(t){var s=e.icn3d;s.selectionCls.resetAll(),s.bRender&&s.drawCls.draw()})),e.myEventCls.onIds(["#"+e.pre+"toggleHighlight","#"+e.pre+"toggleHighlight2"],"click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.toggleHighlight(),e.htmlCls.clickMenuCls.setLogCmd("toggle highlight",!0)})),e.myEventCls.onIds("#"+e.pre+"seq_clearselection","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),e.cfg.notebook||dialog.dialog("close"),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"seq_clearselection2","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),t.preventDefault(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"alignseq_clearselection","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.hlUpdateCls.clearHighlight(),e.htmlCls.clickMenuCls.setLogCmd("clear selection",!0)})),e.myEventCls.onIds("#"+e.pre+"replay","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.CURRENTNUMBER++;var i=e.cfg.replay?s.STATENUMBER:s.STATENUMBER-1;if(s.CURRENTNUMBER==i)s.bReplay=0,$("#"+e.pre+"replay").hide();else if(s.commands.length>0&&s.commands[s.CURRENTNUMBER]){s.loadScriptCls.execCommandsBase(s.CURRENTNUMBER,s.CURRENTNUMBER,s.STATENUMBER);var n=s.commands[s.CURRENTNUMBER].indexOf("|||"),r=-1!=n?s.commands[s.CURRENTNUMBER].substr(0,n):s.commands[s.CURRENTNUMBER],a=r.length>30?r.substr(0,30)+"...":r,l=s.applyCommandCls.getMenuFromCmd(a);$("#"+e.pre+"replay_cmd").html("Cmd: "+a),$("#"+e.pre+"replay_menu").html("Menu: "+l),s.drawCls.draw()}})),t.loadScriptCls.pressCommandtext(),e.myEventCls.onIds("#"+e.pre+"seq_saveselection","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),e.cfg.notebook||dialog.dialog("close"),s.selectionCls.saveSelectionPrep();var i=$("#"+e.pre+"seq_command_name").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),e.myEventCls.onIds("#"+e.pre+"seq_saveselection2","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.selectionCls.saveSelectionPrep();var i=$("#"+e.pre+"seq_command_name2").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),e.myEventCls.onIds("#"+e.pre+"alignseq_saveselection","click",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.selectionCls.saveSelectionPrep();var i=$("#"+e.pre+"alignseq_command_name").val().replace(/\s+/g,"_");s.selectionCls.saveSelection(i,i)})),$(document).on("click","."+e.pre+"outputselection",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.bSelectResidue=!1,s.bSelectAlignResidue=!1,e.htmlCls.clickMenuCls.setLogCmd("output selection",!0),s.threeDPrintCls.outputSelection()})),$(document).on("click",".icn3d-saveicon",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("pid"),n="";n+='<link rel="stylesheet" href="https:///structure.ncbi.nlm.nih.gov/icn3d/lib/jquery-ui-1.12.1.min.css">\n',n+='<link rel="stylesheet" href="https:///structure.ncbi.nlm.nih.gov/icn3d/icn3d_full_ui.css">\n',n+=$("#"+i).html();var r=i.split("_"),a=r.length>2?r[2]:i,l=Object.keys(s.structures)[0];Object.keys(s.structures).length>1&&(l+="-"+Object.keys(s.structures)[1]),s.saveFileCls.saveFile(l+"-"+a+".html","html",encodeURIComponent(n))})),$(document).on("click",".icn3d-hideicon",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("pid");if(!e.cfg.notebook)if(void 0===s.dialogHashHideDone&&(s.dialogHashHideDone={}),void 0===s.dialogHashPosToRight&&(s.dialogHashPosToRight={}),s.dialogHashHideDone.hasOwnProperty(i)){var n=s.dialogHashHideDone[i].width,r=s.dialogHashHideDone[i].height;l=s.dialogHashHideDone[i].position;$("#"+i).dialog("option","width",n),$("#"+i).dialog("option","height",r),$("#"+i).dialog("option","position",l),delete s.dialogHashHideDone[i]}else{s.dialogHashHideDone[i]={width:$("#"+i).dialog("option","width"),height:$("#"+i).dialog("option","height"),position:$("#"+i).dialog("option","position")};var a;$("#"+i).dialog("option","width",160),$("#"+i).dialog("option","height",80),s.dialogHashPosToRight.hasOwnProperty(i)?a=s.dialogHashPosToRight[i]:(a=170*Object.keys(s.dialogHashPosToRight).length,s.dialogHashPosToRight[i]=a);var l={my:"right bottom",at:"right-"+a+" bottom+60",of:"#"+s.divid,collision:"none"};$("#"+i).dialog("option","position",l)}})),$(document).on("click","."+e.pre+"selres",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes=!1;for(var i=$("."+e.pre+"seloneres"),n=0,r=i.length;n<r;++n)i[n].checked=!1;var a=$(this).attr("resid").split("|");s.hAtoms={},s.selectedResidues={};var l="select ";for(n=0,r=a.length;n<r;++n){var o=a[n];n>0&&(l+=" or "),l+=s.selectionCls.selectOneResid(o)}s.hlUpdateCls.updateHlAll(),e.htmlCls.clickMenuCls.setLogCmd(l,!0)})),$(document).on("click","."+e.pre+"seloneres",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes||(s.hAtoms={},s.selectedResidues={},s.bSelOneRes=!0);var i=$(this).attr("resid"),n=$(this).attr("id");$("#"+n).length&&$("#"+n)[0].checked?s.selectionCls.selectOneResid(i):$("#"+n).length&&!$("#"+n)[0].checked&&s.selectionCls.selectOneResid(i,!0),s.hlUpdateCls.updateHlAll()})),$(document).on("click","."+e.pre+"selset",(function(t){var s=e.icn3d;t.stopImmediatePropagation(),s.bSelOneRes=!1;for(var i=$("."+e.pre+"seloneres"),n=0,r=i.length;n<r;++n)i[n].checked=!1;var a=$(this).attr("cmd");s.selByCommCls.selectByCommand(a,"",""),s.hlObjectsCls.removeHlObjects(),s.hlObjectsCls.addHlObjects(),e.htmlCls.clickMenuCls.setLogCmd(a,!0)})),$(document).on("click",".icn3d-addtrack",(function(t){e.icn3d,t.stopImmediatePropagation(),$("#"+e.pre+"anno_custom")[0].checked=!0,$("[id^="+e.pre+"custom]").show();var s=$(this).attr("chainid");$("#"+e.pre+"track_chainid").val(s),e.htmlCls.dialogCls.openDlg("dl_addtrack","Add track for Chain: "+s),$("#"+e.pre+"track_gi").focus()})),$(document).on("click",".icn3d-customcolor",(function(t){e.icn3d,t.stopImmediatePropagation();var s=$(this).attr("chainid");$("#"+e.pre+"customcolor_chainid").val(s),e.htmlCls.dialogCls.openDlg("dl_customcolor","Apply custom color or tube for Chain: "+s)})),$(document).on("click",".icn3d-helixsets",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"helix"),e.htmlCls.clickMenuCls.setLogCmd("define helix sets | chain "+i,!0)})),$(document).on("click",".icn3d-sheetsets",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"sheet"),e.htmlCls.clickMenuCls.setLogCmd("define sheet sets | chain "+i,!0)})),$(document).on("click",".icn3d-coilsets",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("chainid");s.addTrackCls.defineSecondary(i,"coil"),e.htmlCls.clickMenuCls.setLogCmd("define coil sets | chain "+i,!0)})),e.myEventCls.onIds("#"+e.pre+"deletesets","click",(function(t){e.icn3d.definedSetsCls.deleteSelectedSets(),e.htmlCls.clickMenuCls.setLogCmd("delete selected sets",!0)})),$(document).on("mouseup touchend","accordion",(function(t){var s=e.icn3d;s.bControlGl&&!s.icn3dui.bNode?window.controls&&(window.controls.noRotate=!1,window.controls.noZoom=!1,window.controls.noPan=!1):s.controls&&(s.controls.noRotate=!1,s.controls.noZoom=!1,s.controls.noPan=!1)})),$(document).on("mousedown touchstart","accordion",(function(t){var s=e.icn3d;s.bControlGl&&!s.icn3dui.bNode?window.controls&&(window.controls.noRotate=!0,window.controls.noZoom=!0,window.controls.noPan=!0):s.controls&&(s.controls.noRotate=!0,s.controls.noZoom=!0,s.controls.noPan=!0)})),$(document).on("click",".icn3d-expand",(function(t){e.icn3d,t.stopImmediatePropagation();var s=$(this).attr("id"),i=s.lastIndexOf("_"),n=s.substr(0,i);$("#"+n).show(),$("#"+n+"_expand").hide(),$("#"+n+"_shrink").show()})),$(document).on("click",".icn3d-shrink",(function(t){e.icn3d,t.stopImmediatePropagation();var s=$(this).attr("id"),i=s.lastIndexOf("_"),n=s.substr(0,i);$("#"+n).hide(),$("#"+n+"_expand").show(),$("#"+n+"_shrink").hide()})),window.onscroll=function(t){var s=e.icn3d;"detailed view"==s.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?s.annotationCls.showFixedTitle():s.annotationCls.hideFixedTitle()},e.myEventCls.onIds("#"+e.pre+"dl_selectannotations","scroll",(function(){"detailed view"==t.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?t.annotationCls.showFixedTitle():t.annotationCls.hideFixedTitle()})),e.myEventCls.onIds("#"+e.pre+"mn6_themeBlue","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("blue"),e.htmlCls.clickMenuCls.setLogCmd("set theme blue",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_themeOrange","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("orange"),e.htmlCls.clickMenuCls.setLogCmd("set theme orange",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_themeBlack","click",(function(t){e.icn3d,e.htmlCls.setMenuCls.setTheme("black"),e.htmlCls.clickMenuCls.setLogCmd("set theme black",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_doublecolorYes","click",(function(t){var s=e.icn3d;s.bDoublecolor=!0,s.setOptionCls.setStyle("proteins","ribbon"),e.htmlCls.clickMenuCls.setLogCmd("set double color on",!0)})),e.myEventCls.onIds("#"+e.pre+"mn6_doublecolorNo","click",(function(t){var s=e.icn3d;s.bDoublecolor=!1,s.drawCls.draw(),e.htmlCls.clickMenuCls.setLogCmd("set double color off",!0)})),$(document).on("click","."+e.pre+"snpin3d",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("snp");s.scapCls.retrieveScap(i),e.htmlCls.clickMenuCls.setLogCmd("scap 3d "+i,!0),e.htmlCls.clickMenuCls.setLogCmd("select displayed set",!0)})),$(document).on("click","."+e.pre+"snpinter",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("snp");s.scapCls.retrieveScap(i,!0),e.htmlCls.clickMenuCls.setLogCmd("scap interaction "+i,!0);var n=i.split("_"),r="."+n[1]+":"+n[2],a="snp_"+n[1]+"_"+n[2];e.htmlCls.clickMenuCls.setLogCmd("select "+r+" | name "+a,!0),e.htmlCls.clickMenuCls.setLogCmd("line graph interaction pairs | selected non-selected | hbonds,salt bridge,interactions,halogen,pi-cation,pi-stacking | false | threshold 3.8 6 4 3.8 6 5.5",!0),e.htmlCls.clickMenuCls.setLogCmd("adjust dialog dl_linegraph",!0),e.htmlCls.clickMenuCls.setLogCmd("select displayed set",!0)})),$(document).on("click","."+e.pre+"snppdb",(function(t){var s=e.icn3d;t.stopImmediatePropagation();var i=$(this).attr("snp");s.scapCls.retrieveScap(i,void 0,!0),e.htmlCls.clickMenuCls.setLogCmd("scap pdb "+i,!0)}))}}}class it{constructor(e){this.icn3dui=e}getAlignSequencesAnnotations(e,t,s,i,n,r){var a=this.icn3dui,l=a.icn3d,o="";e=Object.keys(l.alnChains),r&&(e=e.reverse());var d=0,c={};if(void 0!==e)for(var h=0,m=e.length;h<m;++h)c[e[h]]=1;var p,u=void 0===t||t;u&&(l.hAtoms={});for(var C,v,g=0,f=0,b=0,y=e.length;b<y;++b){h=e[b];0==g&&(C=h),v=n&&g>0?C:h,u&&(l.hAtoms=a.hashUtilsCls.unionHash(l.hAtoms,l.alnChains[h]));var w=[],S="",_=void 0!==l.alnChainsSeq[h]?l.alnChainsSeq[h].length:0;_>d&&(d=_);var A=v.indexOf("_"),x=v.substr(0,A),k=v.substr(A+1);S+="<span class='icn3d-residueNum' title='starting residue number'>"+(void 0!==l.alnChainsSeq[h][0]?l.alnChainsSeq[h][0].resi:"")+"</span>",p=!(void 0===e||!c.hasOwnProperty(v));for(var O=0,H=_;O<H;++O){var R="";""===l.alnChainsSeq[h][O].resi||isNaN(l.alnChainsSeq[h][O].resi)||(R=x+"_"+k+"_"+l.alnChainsSeq[h][O].resi,l.alnChainsSeq[h][O].color);var E,I="class='icn3d-residue";if((void 0===i||i)&&(p||void 0!==s&&""!==R&&-1!==s.indexOf(R))&&(I="class='icn3d-residue icn3d-highlightSeq"),I+=""===R?"'":" "+l.alnChainsSeq[h][O].class+"'",l.residues.hasOwnProperty(R)){var D=l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[R]);E=void 0!==D.color?"#"+D.color.getHexString()+";":"#000000;"}else E="#000000;";if("#FFFFFF;"===E.toUpperCase()&&(E=a.htmlCls.GREYD),n&&0==O){S+="<span style='width:"+10*f+"px'></span>"}""!==R?-1!=l.alnChainsSeq[h][O].resi?S+="<span id='align_"+a.pre+R+"' "+I+" style='color:"+E+"' title='"+l.alnChainsSeq[h][O].resn+l.alnChainsSeq[h][O].resi+"'>"+l.alnChainsSeq[h][O].resn+"</span>":S+="<span>"+l.alnChainsSeq[h][O].resn+"</span>":S+="<span title='"+l.alnChainsSeq[h][O].resn+l.alnChainsSeq[h][O].resi+"'>"+l.alnChainsSeq[h][O].resn+"</span>"}S+="<span class='icn3d-residueNum' title='ending residue number'>"+(void 0!==l.alnChainsSeq[h][_-1]?l.alnChainsSeq[h][_-1].resi:"")+"</span>";for(var T=void 0!==l.alnChainsAnno[h]?l.alnChainsAnno[h].length:0,M=0,P=T;M<P;++M){w[M]="";var F=0==M&&T>=7?l.alnChainsAnTtl[h][4][0]:v;w[M]+="<span class='icn3d-residueNum'></span>";for(O=0,H=l.alnChainsAnno[h][M].length;O<H;++O){var L=l.alnChainsAnno[h][M][O];if("H"==L||"E"==L||"c"==L||"o"==L)if("H"==L)w[M]+=O%2==0?'<span class="icn3d-helix">&nbsp;</span>':'<span class="icn3d-helix2">&nbsp;</span>';else if("E"==L){if(void 0!==l.alnChainsSeq[F][O]){R=F+"_"+l.alnChainsSeq[F][O].resi;if(l.residues.hasOwnProperty(R))l.firstAtomObjCls.getFirstCalphaAtomObj(l.residues[R]).ssend?w[M]+='<span class="icn3d-sheet2">&nbsp;</span>':w[M]+='<span class="icn3d-sheet">&nbsp;</span>'}}else w[M]+="c"==L?'<span class="icn3d-coil">&nbsp;</span>':"o"==L?'<span class="icn3d-other">&nbsp;</span>':"<span></span>";else w[M]+="<span>"+L+"</span>"}w[M]+="<span class='icn3d-residueNum'></span>"}var N=h,$=void 0!==l.pdbid_chain2title?l.pdbid_chain2title[v]:"";for(M=T-1;M>=0;--M){var U=l.alnChainsAnTtl[h][M][0];"SS"==U&&(U=""),o+="<div class='icn3d-residueLine' style='white-space:nowrap;'><div class='icn3d-seqTitle' anno='"+M+"'>"+U+"</div>"+w[M]+"<br/></div>"}o+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" chain="'+h+'" anno="sequence" title="'+$+'">'+N+' </div><span class="icn3d-seqLine">'+S+"</span><br/>",g>0&&(f+=_),++g}return{sequencesHtml:o,maxSeqCnt:d}}}class nt{constructor(e){this.icn3dui=e}getLink(e,t){var s=this.icn3dui;return s.icn3d,"<li><span id='"+s.pre+e+"' class='icn3d-link'>"+t+"</span></li>"}getLinkWrapper(e,t,s){var i=this.icn3dui;return i.icn3d,"<li id='"+i.pre+s+"'><span id='"+i.pre+e+"' class='icn3d-link'>"+t+"</span></li>"}getRadio(e,t,s,i){var n=this.icn3dui;n.icn3d;var r=i?" checked":"";return"<li><label for='"+n.pre+t+"' class='icn3d-rad'>"+n.htmlCls.inputRadioStr+"name='"+n.pre+e+"' class='"+n.pre+e+"' v='"+s+"' id='"+n.pre+t+"'"+r+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-rad-text'>"+s+"</span></label></li>"}getRadioColor(e,t,s,i,n){var r=this.icn3dui;r.icn3d;var a=n?" checked":"";return"<li><label for='"+r.pre+t+"' class='icn3d-rad'>"+r.htmlCls.inputRadioStr+"name='"+r.pre+e+"' id='"+r.pre+t+"'"+a+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-color-rad-text' color='"+i+"'><span style='background-color:#"+i+"'>"+r.htmlCls.space3+"</span> "+s+"</span></label></li>"}setAdvanced(e){var t=this.icn3dui;t.icn3d;var s=void 0===e?"":e,i=t.cfg.notebook?"icn3d-hidden":"",n=t.htmlCls.divStr+"dl_advanced"+s+"' class='"+i+"'>";return n+="<table width='500'><tr><td valign='top'><table cellspacing='0'>",n+="<tr><td><b>Select:</b></td><td>"+t.htmlCls.inputTextStr+"id='"+t.pre+"command"+s+"' placeholder='$[structures].[chains]:[residues]@[atoms]' size='60'></td></tr>",n+="<tr><td><b>Name:</b></td><td>"+t.htmlCls.inputTextStr+"id='"+t.pre+"command_name"+s+"' placeholder='my_selection' size='60'></td></tr>",n+="<tr><td colspan='2' align='left'>"+t.htmlCls.space3+t.htmlCls.buttonStr+"command_apply"+s+"'><b>Save Selection to Defined Sets</b></button></td></tr>",n+="</table></td>",n+="</tr>",n+="<tr><td>",n+='Specification Tips: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+t.pre+"specguide"+s+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+t.pre+"specguide"+s+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',n+=t.htmlCls.divStr+"specguide"+s+"' style='display:none; width:500px' class='icn3d-box'>",n+='<b>Specification:</b> In the selection "$1HHO,4N7N.A,B,C:5-10,LV,3AlaVal,chemicals@CA,C":',n+='<ul><li>"$1HHO,4N7N" uses "$" to indicate structure selection.<br/>',n+='<li>".A,B,C" uses "." to indicate chain selection.<br/>',n+='<li>":5-10,LV,3LeuVal,chemicals" uses the colon ":" to indicate residue selection. Residue selection could be residue number(5-10), one-letter IUPAC residue name abbreviations(LV), three-letter residue names(AlaVal, "3" indicates each residue name has three letters), or predefined names: "proteins", "nucleotides", "chemicals", "ions", and "water". IUPAC abbreviations can be written either as a contiguous string(e.g., ":LV"), in order to find all instances of that sequence in the structure, or they can be separated by commas(e.g., ":L,V") to select all residues of a given type in the structure(in the latter case, select all Leucine and Valine in the structure).<br/>',n+='<li>"@CA,C" uses "@" to indicate atom selection.<br/>',n+='<li>Partial definition is allowed, e.g., ":1-10" selects all residue IDs 1-10 in all chains.<br/>',n+='<li>Different selections can be unioned(with "<b>or</b>", default), intersected(with "<b>and</b>"), or negated(with "<b>not</b>"). For example, ":1-10 or :K" selects all residues 1-10 and all Lys residues. ":1-10 and :K" selects all Lys residues in the range of residue number 1-10. ":1-10 or not :K" selects all residues 1-10, which are not Lys residues.<br/>',n+='<li>The wild card character "X" or "x" can be used to represent any character.',n+="</ul>",n+="<b>Set Operation:</b>",n+='<ul><li>Users can select multiple sets in the menu "Select > Defined Sets".<br/>',n+='<li>Different sets can be unioned(with "<b>or</b>", default), intersected(with "<b>and</b>"), or negated(with "<b>not</b>"). For example, if the "Defined Sets" menu has four sets ":1-10", ":11-20", ":5-15", and ":7-8", the command "saved atoms :1-10 or :11-20 and :5-15 not :7-8" unions all residues 1-10 and 11-20 to get the residues 1-20, then intersects with the residues 5-15 to get the residues 5-15, then exclude the residues 7-8 to get the final residues 5-6 and 9-15.</ul>',n+="<b>Full commands in url or command window:</b>",n+="<ul><li>Select without saving the set: select $1HHO,4N7N.A,B,C:5-10,LV,chemicals@CA,C<br/>",n+="<li>Select and save: select $1HHO,4N7N.A,B,C:5-10,LV,chemicals@CA,C | name my_name</ul>",n+="</div>",n+="</td></tr></table>",n+="</div>"}getOptionHtml(e,t){var s=this.icn3dui;s.icn3d;for(var i="",n=0,r=e.length;n<r;++n){var a=e[n];i+=n==t?s.htmlCls.optionStr+"'"+a+"' selected>"+a+"</option>":s.htmlCls.optionStr+"'"+a+"'>"+a+"</option>"}return i}setColorHints(){var e=this.icn3dui;e.icn3d;var t="";return t+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#00FF00; font-weight:bold">Green</span>: H-Bonds; ',t+='<span style="color:#00FFFF; font-weight:bold">Cyan</span>: Salt Bridge/Ionic; ',t+='<span style="font-weight:bold">Grey</span>: contacts</div>',t+=e.htmlCls.divNowrapStr+'<span style="margin-left:33px; color:#FF00FF; font-weight:bold">Magenta</span>: Halogen Bonds; ',t+='<span style="color:#FF0000; font-weight:bold">Red</span>: &pi;-Cation; ',t+='<span style="color:#0000FF; font-weight:bold">Blue</span>: &pi;-Stacking</div>'}setThicknessHtml(e){var t=this.icn3dui;t.icn3d;var s="",i="3dprint"==e?"1":"0.1",n="3dprint"==e?"1.2":"0.3",r="3dprint"==e?"0.8":"0.4",a="3dprint"==e?"1":"0.2",l="3dprint"==e?"1":"0.2",o="3dprint"==e?"2":"1.3",d="3dprint"==e?"1.4":"0.8",c="3dprint"==e?"0.6":"0.3";return s+="<b>Line Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"linerad_"+e+"' value='"+i+"' size=4>"+t.htmlCls.space3+"(for stabilizers, hydrogen bonds, distance lines, default 0.1)<br/>",s+="<b>Coil Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"coilrad_"+e+"' value='"+n+"' size=4>"+t.htmlCls.space3+"(for coils, default 0.3)<br/>",s+="<b>Stick Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"stickrad_"+e+"' value='"+r+"' size=4>"+t.htmlCls.space3+"(for sticks, default 0.4)<br/>",s+="<b>Trace Radius</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"tracerad_"+e+"' value='"+a+"' size=4>"+t.htmlCls.space3+"(for C alpha trace, O3' trace, default 0.2)<br/>",s+="<b>Ribbon Thickness</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"ribbonthick_"+e+"' value='"+l+"' size=4>"+t.htmlCls.space3+"(for helix and sheet ribbons, nucleotide ribbons, default 0.2)<br/>",s+="<b>Protein Ribbon Width</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"prtribbonwidth_"+e+"' value='"+o+"' size=4>"+t.htmlCls.space3+"(for helix and sheet ribbons, default 1.3)<br/>",s+="<b>Nucleotide Ribbon Width</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"nucleotideribbonwidth_"+e+"' value='"+d+"' size=4>"+t.htmlCls.space3+"(for nucleotide ribbons, default 0.8)<br/>",s+="<b>Ball Scale</b>: "+t.htmlCls.inputTextStr+"id='"+t.pre+"ballscale_"+e+"' value='"+c+"' size=4>"+t.htmlCls.space3+"(for styles 'Ball and Stick' and 'Dot', default 0.3)<br/>",s+=t.htmlCls.spanNowrapStr+""+t.htmlCls.buttonStr+"apply_thickness_"+e+"'>Preview</button></span>"}setSequenceGuide(e,t){var s=this.icn3dui,i=s.icn3d,n="",r=i&&i.defNames2Atoms?Object.keys(i.defNames2Atoms).length:1;t?n+=s.htmlCls.divStr+"seqguide"+e+"'>":(n+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+s.pre+"seqguide"+e+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+"seqguide"+e+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',n+="<div style='min-width:200px; display:inline-block;'><b>Selection:</b> Name: "+s.htmlCls.inputTextStr+"id='"+s.pre+"seq_command_name"+e+"' value='seq_"+r+"' size='5'> "+s.htmlCls.space2+"<button style='white-space:nowrap;' id='"+s.pre+"seq_saveselection"+e+"'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+s.pre+"seq_clearselection"+e+"'>Clear</button></div><br/>",n+=s.htmlCls.divStr+"seqguide"+e+"' style='display:none; white-space:normal;' class='icn3d-box'>"),n+=this.getSelectionHints();return n+="<b>Residue labeling:</b> standard residue with coordinates: UPPER case letter; nonstandard residue with coordinates: the first UPPER case letter plus a period except that water residue uses the letter 'O'; residue missing coordinates: lower case letter."+(s.utilsCls.isMac()&&!s.utilsCls.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"")+"<br/></div>"}setAlignSequenceGuide(e,t){var s=this.icn3dui,i=s.icn3d,n="";var r=i&&i.defNames2Atoms?Object.keys(i.defNames2Atoms).length:1;n+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+s.pre+'alignseqguide_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+'alignseqguide_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',n+="<div style='min-width:200px; display:inline-block;''><b>Selection:</b> Name: "+s.htmlCls.inputTextStr+"id='"+s.pre+"alignseq_command_name' value='alseq_"+r+"' size='10'> "+s.htmlCls.space2+"<button style='white-space:nowrap;' id='"+s.pre+"alignseq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+s.pre+"alignseq_clearselection'>Clear</button></div><br/>",n+=s.htmlCls.divStr+"alignseqguide' style='display:none; white-space:normal;' class='icn3d-box'>",n+=this.getSelectionHints();return n+="<b>Residue labeling:</b> aligned residue with coordinates: UPPER case letter; non-aligned residue with coordinates: lower case letter which can be highlighted; residue missing coordinates: lower case letter which can NOT be highlighted."+(s.utilsCls.isMac()&&!s.utilsCls.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"")+"<br/></div>"}getSelectionHints(){var e=this.icn3dui;e.icn3d;var t="";e.utilsCls.isMobile()?t+='<b>Select Aligned Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>':(t+='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>',t+="<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains.<br/><br/>",t+="<b>Select on 3D structures:</b> "+(e.utilsCls.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick')+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/><br/>',t+='<b>Save the current selection</b>(either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>');return t}addGsizeSalt(e){var t=this.icn3dui;t.icn3d;var s="";s+="<span style='white-space:nowrap;font-weight:bold;'>Grid Size: <select id='"+t.pre+e+"gsize'>";s+=this.getOptionHtml(["65","97","129"],0),s+="</select></span>",s+="<span style='white-space:nowrap;font-weight:bold;margin-left:30px;'>Salt Concentration: <select id='"+t.pre+e+"salt'>";return s+=this.getOptionHtml(["0","0.15"],1),s+="</select> M</span><br/>"}getFootHtml(e,t){var s=this.icn3dui;s.icn3d;var i="<div style='width:500px;'>";return"delphi"==e?s.cfg.cid?i+="<b>Note</b>: Partial charges(MMFF94) are from PubChem Compound SDF files.<br/><br/>":(i+="<b>Note</b>: Only the selected residues are used for <a href='http://honig.c2b2.columbia.edu/delphi'>DelPhi</a> potential calculation by solving linear Poisson-Boltzmann equation.",i+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+s.pre+t+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+t+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',i+=s.htmlCls.divStr+t+"' style='display:none;'>",i+="<br>The hydrogens and partial charges of proteins and nucleotides are added using <a href='http://compbio.clemson.edu/pka_webserver'>DelPhiPKa</a> with the Amber charge and size files. The hydrogens of ligands are added using <a href='http://openbabel.org/wiki/Main_Page'>Open Babel</a>. The partial charges of ligands are calculated using <a href='http://ambermd.org/antechamber/ac.html'>Antechamber</a> with the Gasteiger charge method. All partial charges are calculated at pH 7.<br/><br/>",i+='Lipids are treated as ligands. Please use "HETATM" instead of "ATOM  " for each lipid atom in your PDB file. Each phosphate in lipids is assigned with a charge of -1. You can download PQR and modify it, or prepare your PQR file using other tools. Then load the PQR file at the menu "Analysis > Load PQR/Potential".<br/><br/>',i+="</div>"):(i+="<b>Note</b>: Always load a PDB file before loading a PQR or DelPhi potential file.",i+='<div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+s.pre+t+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+s.pre+t+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',i+=s.htmlCls.divStr+t+"' style='display:none;'>",i+='The PDB file can be loaded in the URL with "pdbid=" or at "File > Open File". The PQR file can be prepared at the menu "Analysis > Download PQR" with your modification or using other tools. The DelPhi potential file can be calculated at <a href=\'http://compbio.clemson.edu/sapp/delphi_webserver/\'>DelPhi Web Server</a> and be exported as a Cube file. ',"url"==e&&(i+="The PQR or potential file can be accessed in a URL if it is located in the same host as iCn3D."),i+="<br/><br/>",i+="</div>"),i+="</div>"}getPotentialHtml(e,t){var s=this.icn3dui;s.icn3d;var i,n,r,a="";"delphi"==e?n="delphi":"local"==e?(i="pqr",n="phi",r="cube"):"url"==e&&(i="pqrurl",n="phiurl",r="cubeurl"),a+=s.htmlCls.divStr+"dl_"+n+"' class='"+t+"'>",a+=s.htmlCls.divStr+"dl_"+n+"_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+n+"tab1'>Equipotential Map</a></li>",a+="<li><a href='#"+s.pre+n+"tab2'>Surface with Potential</a></li>",a+="</ul>",a+=s.htmlCls.divStr+n+"tab1'>","delphi"==e&&(a+=this.addGsizeSalt(n)+"<br>"),a+="<span style='white-space:nowrap;font-weight:bold;'>Potential contour at: <select id='"+s.pre+n+"contour'>";var l;a+=this.getOptionHtml(["0.5","1","2","4","6","8","10"],1),a+="</select> kT/e(25.6mV at 298K)</span><br/><br/>","delphi"==e?(a+=s.htmlCls.buttonStr+"reload_"+n+"file' style='margin-top: 6px;'>Equipotential Map</button>",a+=s.htmlCls.buttonStr+n+"mapNo' style='margin-left:30px;'>Remove Map</button><br>"):"local"==e?(a+=s.htmlCls.divStr+n+"tab1_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+n+"tab1_"+i+"'>PQR</a></li>",a+="<li><a href='#"+s.pre+n+"tab1_"+n+"'>Phi</a></li>",a+="<li><a href='#"+s.pre+n+"tab1_"+r+"'>Cube</a></li>",a+="</ul>",l="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+n+"mapNo'>Remove Map</button></span></div>",a+=s.htmlCls.divStr+n+"tab1_"+i+"'>",a+=this.addGsizeSalt(i)+"<br>",a+="<b>PQR File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+i+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+=s.htmlCls.divStr+n+"tab1_"+n+"'>",a+="<b>Phi File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+n+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+=s.htmlCls.divStr+n+"tab1_"+r+"'>",a+="<b>Cube File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+r+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+r+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+="</div>"):"url"==e&&(a+=s.htmlCls.divStr+n+"tab1_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+n+"tab1_"+i+"2'>PQR</a></li>",a+="<li><a href='#"+s.pre+n+"tab1_"+n+"2'>Phi</a></li>",a+="<li><a href='#"+s.pre+n+"tab1_"+r+"2'>Cube</a></li>",a+="</ul>",l="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+n+"mapNo'>Remove Map</button></span></div>",a+=s.htmlCls.divStr+n+"tab1_"+i+"2'>",a+=this.addGsizeSalt(i)+"<br>",a+="<b>PQR URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+i+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+=s.htmlCls.divStr+n+"tab1_"+n+"2'>",a+="<b>Phi URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+n+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+=s.htmlCls.divStr+n+"tab1_"+r+"2'>",a+="<b>Cube URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+r+"file'> <br><br>"+s.htmlCls.buttonStr+"reload_"+r+"file' style='margin-top: 6px;'>Equipotential Map</button>"+l,a+="</div>"),a+="<br>"+this.getFootHtml(e,n+"tab1_foot"),a+="</div>",a+=s.htmlCls.divStr+n+"tab2'>","delphi"==e&&(a+=this.addGsizeSalt(n)+"<br>"),a+="<span style='white-space:nowrap;font-weight:bold;'>Surface with max potential at: <select id='"+s.pre+n+"contour2'>";a+=this.getOptionHtml(["1","2","3","4","5","6","7","8","9","10"],2),a+="</select> kT/e(25.6mV at 298K)</span><br/><br/>",a+="<b>Surface</b>: <select id='"+s.pre+n+"surftype'>",a+="<option value='21'>Van der Waals</option>",a+="<option value='22' selected>Molecular Surface</option>",a+="<option value='23'>Solvent Accessible</option>",a+="</select>",a+="<span style='margin-left:20px'><b>Opacity</b>: <select id='"+s.pre+n+"surfop'>";return a+=this.getOptionHtml(["1.0","0.9","0.8","0.7","0.6","0.5","0.4","0.3","0.2","0.1"],0),a+="</select></span>",a+="<span style='margin-left:20px'><b>Wireframe</b>: <select id='"+s.pre+n+"surfwf'>",a+="<option value='yes'>Yes</option>",a+="<option value='no' selected>No</option>",a+="</select></span><br/>",a+="<br/>","delphi"==e?(a+=s.htmlCls.buttonStr+"reload_"+n+"file2' style='margin-top: 6px;'>Surface with Potential</button>",a+=s.htmlCls.buttonStr+n+"mapNo2' style='margin-left:30px;'>Remove Surface</button><br>"):"local"==e?(a+=s.htmlCls.divStr+n+"tab2_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+n+"tab2_"+i+"'>PQR</a></li>",a+="<li><a href='#"+s.pre+n+"tab2_"+n+"'>Phi</a></li>",a+="<li><a href='#"+s.pre+n+"tab2_"+r+"'>Cube</a></li>",a+="</ul>",l="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+n+"mapNo2'>Remove Surface</button></span></div>",a+=s.htmlCls.divStr+n+"tab2_"+i+"'>",a+=this.addGsizeSalt(i+"2")+"<br>",a+="<b>PQR File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+i+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+=s.htmlCls.divStr+n+"tab2_"+n+"'>",a+="<b>Phi File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+n+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+=s.htmlCls.divStr+n+"tab2_"+r+"'>",a+="<b>Cube File</b>: "+s.htmlCls.inputFileStr+"id='"+s.pre+r+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+r+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+="</div>"):"url"==e&&(a+=s.htmlCls.divStr+n+"tab2_tabs' style='border:0px;'>",a+="<ul>",a+="<li><a href='#"+s.pre+n+"tab2_"+i+"2'>PQR</a></li>",a+="<li><a href='#"+s.pre+n+"tab2_"+n+"2'>Phi</a></li>",a+="<li><a href='#"+s.pre+n+"tab2_"+r+"2'>Cube</a></li>",a+="</ul>",l="<span style='margin-left:30px'>"+s.htmlCls.buttonStr+n+"mapNo2'>Remove Surface</button></span></div>",a+=s.htmlCls.divStr+n+"tab2_"+i+"2'>",a+=this.addGsizeSalt(i+"2")+"<br>",a+="<b>PQR URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+i+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+i+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+=s.htmlCls.divStr+n+"tab2_"+n+"2'>",a+="<b>Phi URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+n+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+n+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+=s.htmlCls.divStr+n+"tab2_"+r+"2'>",a+="<b>Cube URL</b> in the same host: "+s.htmlCls.inputTextStr+"id='"+s.pre+r+"file2'> <br><br>"+s.htmlCls.buttonStr+"reload_"+r+"file2' style='margin-top: 6px;'>Surface with Potential</button>"+l,a+="</div>"),a+="<br>"+this.getFootHtml(e,n+"tab2_foot"),a+="</div>",a+="</div>",a+="</div>"}exportPqr(){var e=this.icn3dui,t=e.icn3d,s={},i={},n=e.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);for(var r in n)t.atoms[r],t.ions.hasOwnProperty(r)?s[r]=1:i[r]=1;if(e.cfg.cid){var a="";a+=t.saveFileCls.getPDBHeader(),a+=t.saveFileCls.getAtomPDB(i,!0)+t.saveFileCls.getAtomPDB(s,!0);var l=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(l+"_icn3d.pqr","text",[a])}else{if(e.utilsCls.isCalphaPhosOnly(e.hashUtilsCls.hash2Atoms(i,t.atoms)))return void alert("The potential will not be shown because the side chains are missing in the structure...");var o="";o+=t.saveFileCls.getPDBHeader(),o+=t.saveFileCls.getAtomPDB(i),o+=t.saveFileCls.getAtomPDB(s,!0);var d=e.cfg.cid?e.cfg.cid:Object.keys(t.structures).toString();$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/delphi/delphi.fcgi",type:"POST",data:{pdb2pqr:o,pdbid:d},dataType:"text",cache:!0,tryCount:0,retryLimit:0,beforeSend:function(){t.ParserUtilsCls.showLoading()},complete:function(){t.ParserUtilsCls.hideLoading()},success:function(e){var s=e,i=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(i+"_icn3d_residues.pqr","text",[s])},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}clickReload_pngimage(){var e=this.icn3dui;if(e.icn3d,!e.bNode){var t=this;e.myEventCls.onIds("#"+e.pre+"reload_pngimage","click",(function(s){var i=e.icn3d;s.preventDefault(),e.cfg.notebook||dialog.dialog("close"),e.cfg.notebook?i.resizeCanvasCls.closeDialogs():$(".ui-dialog-content").dialog("close"),i.init();var n=$("#"+e.pre+"pngimage")[0].files[0];if(n){t.fileSupport();var r=new FileReader;r.onload=function(t){var s=t.target.result,n="Share Link: ",r=s.indexOf(n),a="Start of state file======\n",l=s.indexOf(a);if(-1==r&&-1==l)alert('Please load a PNG image saved by clicking "Save Datas > PNG Image" in the Data menu...');else if(-1!=r){var o=s.substr(r+n.length);e.htmlCls.clickMenuCls.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1),window.open(o)}else if(-1!=l){var d="Start of data file======\n",c=s.indexOf(d);if(i.bInputfile=-1!=c,i.bInputfile){var h=s.indexOf("End of data file======\n"),m=s.substr(c+d.length,h-c-d.length);i.InputfileData=m;var p="Start of type file======\n",u=s.indexOf(p),C=s.indexOf("End of type file======\n"),v=s.substr(u+p.length,C-u-p.length-1);i.InputfileType=v;var g=s.indexOf("End of state file======\n"),f=s.substr(l+a.length,g-l-a.length);f=decodeURIComponent(f),"pdb"===v?$.when(i.pdbParserCls.loadPdbData(m)).then((function(){i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(f,!0)})):("mol2"===v?i.mol2ParserCls.loadMol2Data(m):"sdf"===v?i.sdfParserCls.loadSdfData(m):"xyz"===v?i.xyzParserCls.loadXyzData(m):"mmcif"===v&&i.mmcifParserCls.loadMmcifData(m),i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(f,!0))}else{g=s.indexOf("End of state file======\n"),f=s.substr(l+a.length,g-l-a.length);f=decodeURIComponent(f),i.commands=[],i.optsHistory=[],i.loadScriptCls.loadScript(f,!0)}e.htmlCls.clickMenuCls.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1)}},r.readAsText(n)}else alert("Please select a file before clicking 'Load'")}))}}fileSupport(){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.")}getLinkColor(){return", linkmap: {\n",'3: {"type": "peptidebond", "c":""},\n','4: {"type": "ssbond", "c":"FFA500"},\n','5: {"type": "ionic", "c":"0FF"},\n','6: {"type": "ionicInside", "c":"FFF"},\n','11: {"type": "contact", "c":"888"},\n','12: {"type": "contactInside", "c":"FFF"},\n','13: {"type": "hbond", "c":"0F0"},\n','14: {"type": "hbondInside", "c":"FFF"},\n','15: {"type": "clbond", "c":"006400"},\n','17: {"type": "halogen", "c":"F0F"},\n','18: {"type": "halogenInside", "c":"FFF"},\n','19: {"type": "pication", "c":"F00"},\n','20: {"type": "picationInside", "c":"FFF"},\n','21: {"type": "pistacking", "c":"00F"},\n','22: {"type": "pistackingInside", "c":"FFF"}\n',"}}\n",', linkmap: {\n3: {"type": "peptidebond", "c":""},\n4: {"type": "ssbond", "c":"FFA500"},\n5: {"type": "ionic", "c":"0FF"},\n6: {"type": "ionicInside", "c":"FFF"},\n11: {"type": "contact", "c":"888"},\n12: {"type": "contactInside", "c":"FFF"},\n13: {"type": "hbond", "c":"0F0"},\n14: {"type": "hbondInside", "c":"FFF"},\n15: {"type": "clbond", "c":"006400"},\n17: {"type": "halogen", "c":"F0F"},\n18: {"type": "halogenInside", "c":"FFF"},\n19: {"type": "pication", "c":"F00"},\n20: {"type": "picationInside", "c":"FFF"},\n21: {"type": "pistacking", "c":"00F"},\n22: {"type": "pistackingInside", "c":"FFF"}\n}}\n'}setLineThickness(e){var t=this.icn3dui,s=t.icn3d;s.bSetThickness=!0,s.lineRadius=parseFloat($("#"+t.pre+"linerad_"+e).val()),s.coilWidth=parseFloat($("#"+t.pre+"coilrad_"+e).val()),s.cylinderRadius=parseFloat($("#"+t.pre+"stickrad_"+e).val()),s.traceRadius=parseFloat($("#"+t.pre+"stickrad_"+e).val()),s.dotSphereScale=parseFloat($("#"+t.pre+"ballscale_"+e).val()),s.ribbonthickness=parseFloat($("#"+t.pre+"ribbonthick_"+e).val()),s.helixSheetWidth=parseFloat($("#"+t.pre+"prtribbonwidth_"+e).val()),s.nucleicAcidWidth=parseFloat($("#"+t.pre+"nucleotideribbonwidth_"+e).val()),t.htmlCls.clickMenuCls.setLogCmd("set thickness | linerad "+s.lineRadius+" | coilrad "+s.coilWidth+" | stickrad "+s.cylinderRadius+" | tracerad "+s.traceRadius+" | ribbonthick "+s.ribbonthickness+" | proteinwidth "+s.helixSheetWidth+" | nucleotidewidth "+s.nucleicAcidWidth+" | ballscale "+s.dotSphereScale,!0),s.drawCls.draw()}updateSurfPara(e){var t=this.icn3dui,s=t.icn3d;s.phisurftype=$("#"+t.pre+e+"surftype").val(),s.phisurfop=$("#"+t.pre+e+"surfop").val(),s.phisurfwf=$("#"+t.pre+e+"surfwf").val()}exportPdb(){var e=this.icn3dui,t=e.icn3d,s="";s+=t.saveFileCls.getPDBHeader();var i=e.hashUtilsCls.intHash(t.dAtoms,t.hAtoms);s+=t.saveFileCls.getAtomPDB(i);var n=t.inputid?t.inputid:"custom";t.saveFileCls.saveFile(n+"_icn3d.pdb","text",[s])}}class rt{constructor(e){var t=e;this.icn3dui=e,this.cfg=this.icn3dui.cfg,this.opts={},this.opts.background="transparent",this.WIDTH=400,this.HEIGHT=400,this.RESIDUE_WIDTH=10,t.utilsCls.isMobile()||this.cfg.mobilemenu?this.MENU_HEIGHT=0:this.MENU_HEIGHT=40,this.LOG_HEIGHT=40,this.MENU_WIDTH=750,this.LESSWIDTH=20,this.LESSWIDTH_RESIZE=20,this.LESSHEIGHT=20,this.CMD_HEIGHT=.8*this.LOG_HEIGHT,this.EXTRAHEIGHT=this.MENU_HEIGHT+this.CMD_HEIGHT,null!=this.cfg.showmenu&&0==this.cfg.showmenu&&(this.EXTRAHEIGHT-=this.MENU_HEIGHT),null!=this.cfg.showcommand&&0==this.cfg.showcommand&&(this.EXTRAHEIGHT-=this.CMD_HEIGHT),this.GREY8="#888888",this.GREYB="#BBBBBB",this.GREYC="#CCCCCC",this.GREYD="#DDDDDD",this.ORANGE="#FFA500",this.themecolor="blue",this.ssValue=3,this.coilValue=3,this.contactValue=11,this.contactInsideValue=12,this.hbondValue=13,this.hbondInsideValue=14,this.ssbondValue=4,this.ionicValue=5,this.ionicInsideValue=6,this.clbondValue=15,this.halogenValue=17,this.halogenInsideValue=18,this.picationValue=19,this.picationInsideValue=20,this.pistackingValue=21,this.pistackingInsideValue=22,this.contactColor="888",this.contactInsideColor="FFF",this.hbondColor="0F0",this.hbondInsideColor="FFF",this.ssbondColor="FFA500",this.ionicColor="0FF",this.ionicInsideColor="FFF",this.clbondColor="006400",this.halogenColor="F0F",this.halogenInsideColor="FFF",this.picationColor="F00",this.picationInsideColor="FFF",this.pistackingColor="00F",this.pistackingInsideColor="FFF",this.hideedges=1,this.force=4,this.simulation=void 0,this.baseUrl="https://www.ncbi.nlm.nih.gov/Structure/",this.divStr="<div id='"+this.icn3dui.pre,this.divNowrapStr="<div style='white-space:nowrap'>",this.spanNowrapStr="<span style='white-space:nowrap'>",this.inputTextStr="<input type='text' ",this.inputFileStr="<input type='file' ",this.inputRadioStr="<input type='radio' ",this.inputCheckStr="<input type='checkbox' ",this.optionStr="<option value=",this.buttonStr="<button id='"+this.icn3dui.pre,this.postfix="2",this.space2="&nbsp;&nbsp;",this.space3=this.space2+"&nbsp;",this.space4=this.space2+this.space2,this.wifiStr="",this.licenseStr="",this.closeAc={collapsible:!0,active:!1},this.clickMenuCls=new Je(this.icn3dui),this.setMenuCls=new Ze(this.icn3dui),this.dialogCls=new et(this.icn3dui),this.setDialogCls=new tt(this.icn3dui),this.eventsCls=new st(this.icn3dui),this.alignSeqCls=new it(this.icn3dui),this.setHtmlCls=new nt(this.icn3dui)}}class at{constructor(e){this.icn3d=e}alternateStructures(){var e=this.icn3d,t=e.icn3dui,s=Object.keys(e.hAtoms).length,i=Object.keys(e.atoms).length;e.dAtoms={};for(var n=Object.keys(e.structures),r=0,a=n.length;r<a;++r){var l=n[r];if(r>e.ALTERNATE_STRUCTURE||e.ALTERNATE_STRUCTURE===a-1&&0===r){for(var o in e.structures[l]){var d=e.structures[l][o];e.dAtoms=t.hashUtilsCls.unionHash(e.dAtoms,e.chains[d])}e.ALTERNATE_STRUCTURE=r,$("#"+e.pre+"title").html(l);break}}s<i&&(e.dAtoms=t.hashUtilsCls.intHash(e.dAtoms,e.hAtoms),e.bShowHighlight=!1,e.opts.rotationcenter="highlight center"),e.applyMapCls.removeSurfaces(),e.applyMapCls.applySurfaceOptions(),e.applyMapCls.removeMaps(),e.applyMapCls.applyMapOptions(),e.applyMapCls.removeEmmaps(),e.applyMapCls.applyEmmapOptions(),e.applyMapCls.removePhimaps(),e.axes=[],e.pc1&&e.axesCls.setPc1Axes(),e.drawCls.draw(),e.bShowHighlight=!0,e.opts.rotationcenter="molecule center"}alternateWrapper(){var e=this.icn3d;e.icn3dui,e.bAlternate=!0,this.alternateStructures(),e.bAlternate=!1}}class lt{constructor(e){this.icn3d=e}drawGraph(e,t){var s=this.icn3d,i=s.icn3dui;if(void 0===n)var n=d3;var r=JSON.parse(e),a=$("#"+t).width(),l=$("#"+t).height(),o=1*a,d=1*l,c=a,h=l,m=d3.select("#"+i.svgid).attr("width",a).attr("height",l).attr("viewBox","0,0,"+o+","+d);m.selectAll(".g-main").remove();var p=m.append("g").classed("g-main",!0),u=p.append("rect").attr("width",c).attr("height",h).style("fill","#FFF"),C=p.append("g"),v=n.zoom().on("zoom",(function(){C.attr("transform",n.event.transform)}));if(p.call(v),r.links){for(var g=[],f={},b=0,y=r.nodes.length;b<y;++b){f[(H=r.nodes[b]).id]=1}var w=!1;for(b=0,y=r.links.length;b<y;++b){var S=r.links[b];f.hasOwnProperty(S.source)&&f.hasOwnProperty(S.target)?g.push(S):(f.hasOwnProperty(S.source)||console.log("The node "+S.source+" is not found... "),f.hasOwnProperty(S.target)||console.log("The node "+S.target+" is not found... "),w=!0)}w&&console.log(JSON.stringify(r)),r.links=g;var _={};for(b=0;b<r.nodes.length;b++)i.htmlCls.force||(r.nodes[b].x*=10,r.nodes[b].y*=10),_[r.nodes[b].id]=r.nodes[b],r.nodes[b].weight=1.01;if(i.htmlCls.hideedges&&!i.htmlCls.force){var A=[];for(b=0;b<r.links.length;b++)"FFF"!=r.links[b].c&&A.push(r.links[b]);r.links=A}var x=C.append("g"),k=null,O=(S=C.append("g").attr("class","link").selectAll("line").data(r.links).enter().append("line").attr("stroke",(function(e){return e.v==i.htmlCls.contactInsideValue?"#"+i.htmlCls.contactInsideColor:e.v==i.htmlCls.hbondInsideValue?"#"+i.htmlCls.hbondInsideColor:e.v==i.htmlCls.ionicInsideValue?"#"+i.htmlCls.ionicInsideColor:e.v==i.htmlCls.halogenInsideValue?"#"+i.htmlCls.halogenInsideColor:e.v==i.htmlCls.picationInsideValue?"#"+i.htmlCls.picationInsideColor:e.v==i.htmlCls.pistackingInsideValue?"#"+i.htmlCls.pistackingInsideColor:"#"+e.c})).attr("stroke-width",(function(e){return e.v==i.htmlCls.contactValue||e.v==i.htmlCls.contactInsideValue||e.v==i.htmlCls.hbondInsideValue||e.v==i.htmlCls.ionicInsideValue||e.v==i.htmlCls.halogenInsideValue||e.v==i.htmlCls.picationInsideValue||e.v==i.htmlCls.pistackingInsideValue?"1px":e.v==i.htmlCls.hbondValue||e.v==i.htmlCls.ionicValue||e.v==i.htmlCls.halogenValue||e.v==i.htmlCls.picationValue||e.v==i.htmlCls.pistackingValue?"2px":e.v==i.htmlCls.ssbondValue||e.v==i.htmlCls.clbondValue?"3px":e.v+"px"})),C.append("g").attr("class","node")),H=O.selectAll("circle").data(r.nodes).enter().append("circle").attr("r",3).attr("fill",(function(e){return"#"+e.c})).attr("stroke",(function(e){return"#"+e.c})).attr("res",(function(e){return e.r})).attr("class","icn3d-node").call(n.drag().on("start",(function(e){n.event.active||i.htmlCls.simulation.alphaTarget(.9).restart();e.selected||U||H.classed("selected",(function(e){return e.selected=e.previouslySelected=!1}));n.select(this).classed("selected",(function(t){return e.previouslySelected=e.selected,e.selected=!0})),H.filter((function(e){return e.selected})).each((function(e){e.fx=e.x,e.fy=e.y}))})).on("drag",(function(e){H.filter((function(e){return e.selected})).each((function(e){e.fx+=n.event.dx,e.fy-=n.event.dy}))})).on("end",(function(e){n.event.active||i.htmlCls.simulation.alphaTarget(0);e.fx=null,e.fy=null,H.filter((function(e){return e.selected})).each((function(e){e.fx=null,e.fy=null}))}))),R=O.selectAll("text").data(r.nodes).enter().append("text").text((function(e){var t=e.id,s=t.indexOf(".");return-1!==s&&(t=t.substr(0,s)),t})).attr("fill",(function(e){return"#"+e.c})).attr("stroke","none").attr("class","icn3d-node-text8");H.append("title").text((function(e){return e.id}));var E=parseInt($("#"+s.pre+"dist_ss").val()),I=parseInt($("#"+s.pre+"dist_coil").val()),D=parseInt($("#"+s.pre+"dist_hbond").val()),T=parseInt($("#"+s.pre+"dist_inter").val()),M=parseInt($("#"+s.pre+"dist_ssbond").val()),P=parseInt($("#"+s.pre+"dist_ionic").val()),F=parseInt($("#"+s.pre+"dist_halogen").val()),L=parseInt($("#"+s.pre+"dist_pication").val()),N=parseInt($("#"+s.pre+"dist_pistacking").val());i.htmlCls.simulation=n.forceSimulation().force("link",n.forceLink().id((function(e){return e.id})).distance((function(e){return 30})).strength((function(e){return i.htmlCls.force?e.v==i.htmlCls.ssValue?isNaN(E)?1:E/100:e.v==i.htmlCls.coilValue||e.v==i.htmlCls.clbondValue?isNaN(I)?.5:I/100:e.v==i.htmlCls.hbondValue||e.v==i.htmlCls.hbondInsideValue?isNaN(D)?.5:D/100:e.v==i.htmlCls.contactValue||e.v==i.htmlCls.contactInsideValue?isNaN(T)?.25:T/100:e.v==i.htmlCls.ssbondValue?isNaN(M)?.5:M/100:e.v==i.htmlCls.ionicValue||e.v==i.htmlCls.ionicInsideValue?isNaN(P)?.5:P/100:e.v==i.htmlCls.halogenValue||e.v==i.htmlCls.halogenInsideValue?isNaN(F)?.5:F/100:e.v==i.htmlCls.picationValue||e.v==i.htmlCls.picationInsideValue?isNaN(L)?.5:L/100:e.v==i.htmlCls.pistackingValue||e.v==i.htmlCls.pistackingInsideValue?isNaN(N)?.5:N/100:0:0}))).force("center",n.forceCenter(c/2,h/2)),i.htmlCls.force&&i.htmlCls.simulation.force("charge",n.forceManyBody()),1==i.htmlCls.force?i.htmlCls.simulation.force("x",n.forceX((function(e){return"a"==e.s?c/4:.75*c})).strength((function(e){return.4}))).force("y",n.forceY(h/2).strength((function(e){return.02}))):2==i.htmlCls.force?i.htmlCls.simulation.force("y",n.forceY((function(e){return"a"==e.s?.75*h:h/4})).strength((function(e){return.4}))).force("x",n.forceX(c/2).strength((function(e){return.02}))):3==i.htmlCls.force?i.htmlCls.simulation.force("r",n.forceRadial((function(e){return"a"==e.s?200:100}),c/2,h/2).strength((function(e){return.8}))):i.htmlCls.force,i.htmlCls.simulation.nodes(r.nodes).on("tick",(function(){S.attr("x1",(function(e){return e.source.x})).attr("y1",(function(e){return h-e.source.y})).attr("x2",(function(e){return e.target.x})).attr("y2",(function(e){return h-e.target.y})),H.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return h-e.y})),R.attr("x",(function(e){return e.x+6})).attr("y",(function(e){return h-(e.y+3)}))})),i.htmlCls.simulation.force("link").links(r.links);var U,q=!1,j=!1,B=n.brush().on("start",(function(){j=!0,H.each((function(e){e.previouslySelected=U&&e.selected}))})).on("brush",(function(){if(!n.event.sourceEvent)return;if(!n.event.selection)return;var e=n.event.selection;H.classed("selected",(function(t){return t.selected=t.previouslySelected^(e[0][0]<=t.x&&t.x<e[1][0]&&e[0][1]<=h-t.y&&h-t.y<e[1][1])}))})).on("end",(function(){if(!n.event.sourceEvent)return;if(!n.event.selection)return;if(!k)return;k.call(B.move,null),q||(k.remove(),k=null);j=!1}));return u.on("click",(function(){H.each((function(e){e.selected=!1,e.previouslySelected=!1})),H.classed("selected",!1)})),n.select("body").on("keydown",(function(){if(U=n.event.ctrlKey){if(k)return;q=!0,k||(k=x.append("g")).call(B)}})),n.select("body").on("keyup",(function(){if(U=!1,q=!1,!k)return;j||(k.remove(),k=null)})),r}console.log("Graph is missing links")}}class ot{constructor(e){this.icn3d=e}densityCifParser(e,t,s,i){var n,r=this.icn3d,a=r.icn3dui,l=this,o=a.utilsCls.isMobile()||r.icn3dui.cfg.notebook?0:4;if("2fofc"==t||"fofc"==t?n="https://www.ebi.ac.uk/pdbe/densities/x-ray/"+e.toLowerCase()+"/cell?detail="+o:"em"==t&&(n="https://www.ebi.ac.uk/pdbe/densities/emd/"+i.toLowerCase()+"/cell?detail="+o),"2fofc"==t&&r.bAjax2fofc)r.mapData.sigma2=s,r.setOptionCls.setOption("map",t);else if("fofc"==t&&r.bAjaxfofc)r.mapData.sigma=s,r.setOptionCls.setOption("map",t);else if("em"==t&&r.bAjaxEm)r.mapData.sigmaEm=s,r.setOptionCls.setOption("emmap",t);else{var d=new XMLHttpRequest;d.open("GET",n,!0),d.responseType="arraybuffer",d.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var e=d.response;l.parseChannels(e,t,s),"2fofc"==t||"fofc"==t?(r.bAjax2fofc=!0,r.bAjaxfofc=!0,r.setOptionCls.setOption("map",t)):"em"==t&&(r.bAjaxEm=!0,r.setOptionCls.setOption("emmap",t))}else"2fofc"==t||"fofc"==t?alert("Density server at EBI has no corresponding electron density map for this structure."):"em"==t&&alert("Density server at EBI has no corresponding EM density map for this structure.");void 0!==r.deferredEmmap&&r.deferredEmmap.resolve()}else r.ParserUtilsCls.showLoading()},d.send()}}parseChannels(e,t,s){var i=this.icn3d;i.icn3dui;var n=this.BinaryParse(e);if("2fofc"==t||"fofc"==t){var r=this.getChannel(n,"2FO-FC"),a=this.getChannel(n,"FO-FC"),l={xExtent:(C=(u=r).box.sampleCount)[0],yExtent:C[1],zExtent:C[2],mean:u.valuesInfo.mean,sigma:u.valuesInfo.sigma};i.mapData.header2=l,i.mapData.data2=u.data;var o=u.box.origin,d=u.box.dimensions,c=u.spacegroup.basis,h=(new THREE.Matrix4).makeScale(d[0]/C[0],d[1]/C[1],d[2]/C[2]),m=(new THREE.Matrix4).makeTranslation(o[0],o[1],o[2]),p=(new THREE.Matrix4).set(c.x[0],c.y[0],c.z[0],0,0,c.y[1],c.z[1],0,0,0,c.z[2],0,0,0,0,1).multiply(m).multiply(h);i.mapData.matrix2=p,i.mapData.type2=t,i.mapData.sigma2=s,l={xExtent:(C=(u=a).box.sampleCount)[0],yExtent:C[1],zExtent:C[2],mean:u.valuesInfo.mean,sigma:u.valuesInfo.sigma},i.mapData.header=l,i.mapData.data=u.data,o=u.box.origin,d=u.box.dimensions,c=u.spacegroup.basis,h=(new THREE.Matrix4).makeScale(d[0]/C[0],d[1]/C[1],d[2]/C[2]),m=(new THREE.Matrix4).makeTranslation(o[0],o[1],o[2]),p=(new THREE.Matrix4).set(c.x[0],c.y[0],c.z[0],0,0,c.y[1],c.z[1],0,0,0,c.z[2],0,0,0,0,1).multiply(m).multiply(h),i.mapData.matrix=p,i.mapData.type=t,i.mapData.sigma=s}else if("em"==t){var u,C;l={xExtent:(C=(u=this.getChannel(n,"EM")).box.sampleCount)[0],yExtent:C[1],zExtent:C[2],max:u.valuesInfo.max,min:u.valuesInfo.min};i.mapData.headerEm=l,i.mapData.dataEm=u.data;o=u.box.origin,d=u.box.dimensions,c=u.spacegroup.basis,h=(new THREE.Matrix4).makeScale(d[0]/C[0],d[1]/C[1],d[2]/C[2]),m=(new THREE.Matrix4).makeTranslation(o[0],o[1],o[2]),p=(new THREE.Matrix4).set(c.x[0],c.y[0],c.z[0],0,0,c.y[1],c.z[1],0,0,0,c.z[2],0,0,0,0,1).multiply(m).multiply(h);i.mapData.matrixEm=p,i.mapData.typeEm=t,i.mapData.sigmaEm=s}}getChannel(e,t){this.icn3d.icn3dui;for(var s,i=e.toJSON(),n=0,r=i.length;n<r;++n)i[n].id==t&&(s=e.dataBlocks[n]);return this.CIFParse(s)}CIFParse(e){this.icn3d.icn3dui;var t=e.getCategory("_volume_data_3d_info");if(t){if(e.getCategory("_volume_data_3d")){var s={name:t.getColumn("name").getString(0),axisOrder:f("axis_order"),origin:f("origin"),dimensions:f("dimensions"),sampleCount:f("sample_count"),spacegroupNumber:0|b("spacegroup_number"),cellSize:f("spacegroup_cell_size"),cellAngles:f("spacegroup_cell_angles"),mean:b("mean_sampled"),sigma:b("sigma_sampled")},i=[0,0,0];i[s.axisOrder[0]]=0,i[s.axisOrder[1]]=1,i[s.axisOrder[2]]=2;var n,r,a,l,o,d,c,h,m,p,u,C,v=y(s.sampleCount),g=function(e,t,s,i){var n=new Float32Array(t[0]*t[1]*t[2]),r=[0,0,0],a=i[0],l=i[1],o=i[2],d=s[0],c=s[1],h=s[2];t[0],t[0],t[1];for(var m=t[2],p=t[1]*t[2],u=0,C=e.getFloat(0),v=C,g=0;g<h;g++){r[2]=g;for(var f=0;f<c;f++){r[1]=f;for(var b=0;b<d;b++){r[0]=b;var y=e.getFloat(u);u+=1,n[r[o]+r[l]*m+r[a]*p]=y,y<C?C=y:y>v&&(v=y)}}}return{data:n,min:C,max:v}}(e.getCategory("_volume_data_3d").getColumn("values"),v,s.sampleCount,i);return{name:s.name,spacegroup:(n=s.spacegroupNumber,r=s.cellSize,a=s.cellAngles,l=Math.PI/180*a[0],o=Math.PI/180*a[1],d=Math.PI/180*a[2],c=r[0],h=r[1],m=r[2],p=Math.cos(o),u=(Math.cos(l)-Math.cos(o)*Math.cos(d))/Math.sin(d),C=Math.sqrt(1-p*p-u*u),{number:n,size:r,angles:a,basis:{x:[c,0,0],y:[Math.cos(d)*h,Math.sin(d)*h,0],z:[p*m,u*m,C*m]}}),box:{origin:y(s.origin),dimensions:y(s.dimensions),sampleCount:v},data:g.data,valuesInfo:{min:g.min,max:g.max,mean:s.mean,sigma:s.sigma}}}conole.log("_volume_data_3d category is missing.")}else conole.log("_volume_data_3d_info category is missing.");function f(e){for(var s=[0,0,0],i=0;i<3;i++)s[i]=t.getColumn(e+"["+i+"]").getFloat(0);return s}function b(e){return t.getColumn(e).getFloat(0)}function y(e){return[e[i[0]],e[i[1]],e[i[2]]]}}BinaryParse(e){this.icn3d.icn3dui;var t=new Uint8Array(e),s=this.MessagePackParse({buffer:t,offset:0,dataView:new DataView(t.buffer)}),i=function(){function e(e){this.additionalData={},this.header=e.header,this.categoryList=e.categories.map((function(e){return new n(e)})),this.categoryMap=new Map;for(var t=0,s=this.categoryList;t<s.length;t++){var i=s[t];this.categoryMap.set(i.name,i)}}return Object.defineProperty(e.prototype,"categories",{get:function(){return this.categoryList},enumerable:!0,configurable:!0}),e.prototype.getCategory=function(e){return this.categoryMap.get(e)},e.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map((function(e){return e.toJSON()})),additionalData:this.additionalData}},e}(),n=function(){function e(e){this.name=e.name,this.columnCount=e.columns.length,this.rowCount=e.rowCount,this.columnNameList=[],this.encodedColumns=new Map;for(var t=0,s=e.columns;t<s.length;t++){var i=s[t];this.encodedColumns.set(i.name,i),this.columnNameList.push(i.name)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:!0,configurable:!0});var t=function(){function e(){this.isDefined=!1}return e.prototype.getString=function(e){return null},e.prototype.getInteger=function(e){return 0},e.prototype.getFloat=function(e){return 0},e.prototype.getValuePresence=function(e){return 1},e.prototype.areValuesEqual=function(e,t){return!0},e.prototype.stringEquals=function(e,t){return null===t},e}();return e.prototype.getColumn=function(e){var s=this.encodedColumns.get(e);return s?C(s):t},e.prototype.toJSON=function(){for(var e=this,t=[],s=this.columnNameList.map((function(t){return{name:t,column:e.getColumn(t)}})),i=0;i<this.rowCount;i++){for(var n={},r=0,a=s;r<a.length;r++){var l=a[r],o=l.column.getValuePresence(i);n[l.name]=0===o?l.column.getString(i):1===o?".":"?"}t[i]=n}return{name:this.name,columns:this.columnNames,rows:t}},e}();function r(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function a(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}var l,o,d,c=(l=new ArrayBuffer(2),o=new Uint8Array(l),d=new Uint16Array(l),o[0]=170,o[1]=187,48042===d[0]);function h(e,t,s){return new s(c?e.buffer:function(e,t){for(var s=new ArrayBuffer(e.length),i=new Uint8Array(s),n=0,r=e.length;n<r;n+=t)for(var a=0;a<t;a++)i[n+t-a-1]=e[n+a];return s}(e,t))}function m(e,t){return t.isUnsigned?function(e,t){for(var s=1===t.byteCount?255:65535,i=e.length,n=new Int32Array(t.srcSize),r=0,a=0;r<i;){for(var l=0,o=e[r];o===s;)l+=o,o=e[++r];l+=o,n[a]=l,r++,a++}return n}(e,t):function(e,t){for(var s=1===t.byteCount?127:32767,i=-s-1,n=e.length,r=new Int32Array(t.srcSize),a=0,l=0;a<n;){for(var o=0,d=e[a];d===s||d===i;)o+=d,d=e[++a];o+=d,r[l]=o,a++,l++}return r}(e,t)}function p(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case 2:return function(e){return h(e,2,Int16Array)}(e);case 5:return function(e){return h(e,2,Uint16Array)}(e);case 3:return function(e){return h(e,4,Int32Array)}(e);case 6:return function(e){return h(e,4,Uint32Array)}(e);case 32:return function(e){return h(e,4,Float32Array)}(e);case 33:return function(e){return h(e,8,Float64Array)}(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return function(e,t){for(var s=e.length,i=a(t.srcType,s),n=1/t.factor,r=0;r<s;r++)i[r]=n*e[r];return i}(e,t);case"IntervalQuantization":return function(e,t){for(var s=e.length,i=a(t.srcType,s),n=(t.max-t.min)/(t.numSteps-1),r=t.min,l=0;l<s;l++)i[l]=r+n*e[l];return i}(e,t);case"RunLength":return function(e,t){for(var s=r(t.srcType,t.srcSize),i=0,n=0,a=e.length;n<a;n+=2)for(var l=e[n],o=e[n+1],d=0;d<o;++d)s[i++]=l;return s}(e,t);case"Delta":return function(e,t){var s=e.length,i=r(t.srcType,s);if(!s)return i;i[0]=e[0]+(0|t.origin);for(var n=1;n<s;++n)i[n]=e[n]+i[n-1];return i}(e,t);case"IntegerPacking":return m(e,t);case"StringArray":return function(e,t){for(var s=t.stringData,i=u({encoding:t.offsetEncoding,data:t.offsets}),n=u({encoding:t.dataEncoding,data:e}),r=Object.create(null),a=new Array(n.length),l=0,o=0,d=n;o<d.length;o++){var c=d[o];if(c<0)a[l++]=null;else{var h=r[c];void 0===h&&(h=s.substring(i[c],i[c+1]),r[c]=h),a[l++]=h}}return a}(e,t)}}function u(e){for(var t=e.data,s=e.encoding.length-1;s>=0;s--)t=p(t,e.encoding[s]);return t}function C(e){if(!e.data.data)return _UndefinedColumn;var t=u(e.data),s=void 0;return e.mask&&(s=u(e.mask)),t.buffer&&t.byteLength&&t.BYTES_PER_ELEMENT?s?new b(t,s):new f(t):s?new w(t,s):new y(t)}function v(e,t,s){var i=0,n=1;for(45===e.charCodeAt(t)&&(n=-1,t++);t<s;t++){var r=e.charCodeAt(t)-48;if(r>9||r<0)return n*i|0;i=10*i+r|0}return n*i}function g(e,t,s){var i=1,n=0,r=0,a=1;for(45===e.charCodeAt(t)&&(i=-1,++t);t<s;){var l=e.charCodeAt(t)-48;if(!(l>=0&&l<10)){if(-2===l){for(++t;t<s;){if(!((l=e.charCodeAt(t)-48)>=0&&l<10))return 53===l||21===l?parseScientific(i*(n+r/a),e,t+1,s):i*(n+r/a);r=10*r+l,a*=10,++t}return i*(n+r/a)}if(53===l||21===l)return parseScientific(i*n,e,t+1,s);break}n=10*n+l,++t}return i*n}var f=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return""+this.data[e]},e.prototype.getInteger=function(e){return 0|this.data[e]},e.prototype.getFloat=function(e){return 1*this.data[e]},e.prototype.stringEquals=function(e,t){return this.data[e]===g(t,0,t.length)},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),b=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?""+this.data[e]:null},e.prototype.getInteger=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.getFloat=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.stringEquals=function(e,t){return 0===this.mask[e]?this.data[e]===g(t,0,t.length):null==t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),y=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return this.data[e]},e.prototype.getInteger=function(e){var t=this.data[e];return v(t,0,t.length)},e.prototype.getFloat=function(e){var t=this.data[e];return g(t,0,t.length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),w=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?this.data[e]:null},e.prototype.getInteger=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return v(t||"",0,(t||"").length)},e.prototype.getFloat=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return g(t||"",0,(t||"").length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}();return new(function(){function e(e){this.dataBlocks=e.dataBlocks.map((function(e){return new i(e)}))}return e.prototype.toJSON=function(){return this.dataBlocks.map((function(e){return e.toJSON()}))},e}())(s)}MessagePackParse(e){this.icn3d.icn3dui;var t=this;function s(e,s){for(var i={},n=0;n<s;n++){i[t.MessagePackParse(e)]=t.MessagePackParse(e)}return i}function i(e,t){for(var s=new Uint8Array(t),i=e.offset,n=0;n<t;n++)s[n]=e.buffer[n+i];return e.offset+=t,s}function n(e,s){for(var i=new Array(s),n=0;n<s;n++)i[n]=t.MessagePackParse(e);return i}function r(e,t){var s=function(e,t,s){for(var i=a,n=void 0,r=[],l=512,o=0,d=t,c=t+s;d<c;d++){var h=e[d];0==(128&h)?r[o++]=i[h]:192==(224&h)?r[o++]=i[(15&h)<<6|63&e[++d]]:224==(240&h)?r[o++]=String.fromCharCode((15&h)<<12|(63&e[++d])<<6|(63&e[++d])<<0):240==(248&h)?r[o++]=String.fromCharCode((7&h)<<18|(63&e[++d])<<12|(63&e[++d])<<6|(63&e[++d])<<0):throwError("Invalid byte "+h.toString(16)),o===l&&((n=n||[])[n.length]=r.join(""),o=0)}if(!n)return r.slice(0,o).join("");o>0&&(n[n.length]=r.slice(0,o).join(""));return n.join("")}(e.buffer,e.offset,t);return e.offset+=t,s}var a=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();var l,o,d=e.buffer[e.offset];if(0==(128&d))return e.offset++,d;if(128==(240&d))return o=15&d,e.offset++,s(e,o);if(144==(240&d))return o=15&d,e.offset++,n(e,o);if(160==(224&d))return o=31&d,e.offset++,r(e,o);if(224==(224&d))return l=e.dataView.getInt8(e.offset),e.offset++,l;switch(d){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return o=e.dataView.getUint8(e.offset+1),e.offset+=2,i(e,o);case 197:return o=e.dataView.getUint16(e.offset+1),e.offset+=3,i(e,o);case 198:return o=e.dataView.getUint32(e.offset+1),e.offset+=5,i(e,o);case 202:return l=e.dataView.getFloat32(e.offset+1),e.offset+=5,l;case 203:return l=e.dataView.getFloat64(e.offset+1),e.offset+=9,l;case 204:return l=e.buffer[e.offset+1],e.offset+=2,l;case 205:return l=e.dataView.getUint16(e.offset+1),e.offset+=3,l;case 206:return l=e.dataView.getUint32(e.offset+1),e.offset+=5,l;case 208:return l=e.dataView.getInt8(e.offset+1),e.offset+=2,l;case 209:return l=e.dataView.getInt16(e.offset+1),e.offset+=3,l;case 210:return l=e.dataView.getInt32(e.offset+1),e.offset+=5,l;case 217:return o=e.dataView.getUint8(e.offset+1),e.offset+=2,r(e,o);case 218:return o=e.dataView.getUint16(e.offset+1),e.offset+=3,r(e,o);case 219:return o=e.dataView.getUint32(e.offset+1),e.offset+=5,r(e,o);case 220:return o=e.dataView.getUint16(e.offset+1),e.offset+=3,n(e,o);case 221:return o=e.dataView.getUint32(e.offset+1),e.offset+=5,n(e,o);case 222:return o=e.dataView.getUint16(e.offset+1),e.offset+=3,s(e,o);case 223:return o=e.dataView.getUint32(e.offset+1),e.offset+=5,s(e,o)}}}class dt{constructor(e){this.icn3d=e}rayCaster(e,t){this.rayCasterBase(e,t)}rayCasterBase(e,t){var s=this.icn3d;s.icn3dui;var i=e.pageX,n=e.pageY;e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(i=e.originalEvent.targetTouches[0].pageX,n=e.originalEvent.targetTouches[0].pageY);var r=s.oriContainer.offset().left,a=s.oriContainer.offset().top,l=s.oriContainer.width(),o=s.oriContainer.height(),d=i-r,c=n-a;s.mouse.x=d/l*2-1,s.mouse.y=-c/o*2+1;var h=new THREE.Vector3;h.x=s.mouse.x,h.y=s.mouse.y,s.cam_z>0?h.z=-1:h.z=1,s.cam===s.perspectiveCamera?(s.cam_z>0?h.z=-1:h.z=1,h.unproject(s.cam),s.raycaster.set(s.cam.position,h.sub(s.cam.position).normalize())):s.cam===s.orthographicCamera&&(s.cam_z>0?h.z=1:h.z=-1,h.unproject(s.cam),s.raycaster.set(h,new THREE.Vector3(0,0,-1).transformDirection(s.cam.matrixWorld)));var m=this.isIntersect(s.objects,s.mdl,t,d,c);m||(m=this.isIntersect(s.objects_ghost,s.mdl_ghost,t,d,c))}isIntersect(e,t,s,i,n){var r=this.icn3d;r.icn3dui;var a=r.raycaster.intersectObjects(e),l=!1,o=t.position;if(a.length>0){a[0].point.sub(o);for(var d=.5,c=this.getAtomsFromPosition(a[0].point,d);!c&&d<10;)d+=.5,c=this.getAtomsFromPosition(a[0].point,d);c?(l=!0,r.pickpair?s&&(r.pAtomNum%2==0?r.pAtom=c:r.pAtom2=c,++r.pAtomNum):r.pAtom=c,s?r.pickingCls.showPicking(c):r.pickingCls.showPicking(c,i,n)):console.log("No atoms were found in 10 andstrom range")}return l}getAtomsFromPosition(e,t){var s,i=this.icn3d,n=i.icn3dui;for(s in null==t&&(t=1),i.dAtoms){var r=i.atoms[s];if(i.ions.hasOwnProperty(s)&&"sphere"===i.opts.ions){var a=n.parasCls.vdwRadii[r.elem.toUpperCase()];if(Math.abs(r.coord.x-e.x)-a>t)continue;if(Math.abs(r.coord.y-e.y)-a>t)continue;if(Math.abs(r.coord.z-e.z)-a>t)continue}else{if(r.coord.x<e.x-t||r.coord.x>e.x+t)continue;if(r.coord.y<e.y-t||r.coord.y>e.y+t)continue;if(r.coord.z<e.z-t||r.coord.z>e.z+t)continue}return r}return null}}class ct{constructor(e){this.icn3d=e}setControl(){var e=this.icn3d;if(e.icn3dui,!e.icn3dui.bNode){var t=this;e.WIDTH=e.container.width(),e.HEIGHT=e.container.height(),e.applyCenterCls.setWidthHeight(e.WIDTH,e.HEIGHT),e._zoomFactor=1,e.mouseChange=new THREE.Vector2(0,0),e.quaternion=new THREE.Quaternion(0,0,0,1),e.container.bind("contextmenu",(function(e){e.preventDefault()})),e.typetext=!1,$(document).bind("keyup",(function(t){16===t.keyCode&&(e.bShift=!1),17!==t.keyCode&&224!==t.keyCode&&91!==t.keyCode||(e.bCtrl=!1)})),$("input[type=text], textarea").focus((function(){e.typetext=!0})),$("input[type=text], textarea").blur((function(){e.typetext=!1})),$(document).bind("keydown",(function(t){if((t.shiftKey||16===t.keyCode)&&(e.bShift=!0),(t.ctrlKey||17===t.keyCode||224===t.keyCode||91===t.keyCode)&&(e.bCtrl=!0),(e.bControlGl||e.controls)&&(!e.bControlGl||window.controls)){e.bStopRotate=!0;var s=e.bShift?90:5;if(!e.typetext)if(90===t.keyCode){var i={};e.bControlGl&&!e.icn3dui.bNode?window.cam===e.perspectiveCamera?i._zoomFactor=.9:window.cam===e.orthographicCamera&&(e._zoomFactor<.1?e._zoomFactor=.1:e._zoomFactor>1&&(e._zoomFactor=1),i._zoomFactor=.8*e._zoomFactor,i._zoomFactor<.1&&(i._zoomFactor=.1)):e.cam===e.perspectiveCamera?i._zoomFactor=.9:e.cam===e.orthographicCamera&&(e._zoomFactor<.1?e._zoomFactor=.1:e._zoomFactor>1&&(e._zoomFactor=1),i._zoomFactor=.8*e._zoomFactor,i._zoomFactor<.1&&(i._zoomFactor=.1)),i.update=!0,e.bControlGl&&!e.icn3dui.bNode?window.controls.update(i):e.controls.update(i),e.bRender&&e.drawCls.render()}else if(88===t.keyCode){i={};e.bControlGl&&!e.icn3dui.bNode?window.cam===e.perspectiveCamera?i._zoomFactor=1.03:window.cam===e.orthographicCamera&&(e._zoomFactor>10?e._zoomFactor=10:e._zoomFactor<1&&(e._zoomFactor=1),i._zoomFactor=1.01*e._zoomFactor,i._zoomFactor>10&&(i._zoomFactor=10)):e.cam===e.perspectiveCamera?i._zoomFactor=1.03:e.cam===e.orthographicCamera&&(e._zoomFactor>10?e._zoomFactor=10:e._zoomFactor<1&&(e._zoomFactor=1),i._zoomFactor=1.01*e._zoomFactor,i._zoomFactor>10&&(i._zoomFactor=10)),i.update=!0,e.bControlGl&&!e.icn3dui.bNode?window.controls.update(i):e.controls.update(i),e.bRender&&e.drawCls.render()}else if(76===t.keyCode){var n=new THREE.Vector3(0,1,0),r=-s/180*Math.PI;e.transformCls.setRotation(n,r)}else if(74===t.keyCode){n=new THREE.Vector3(0,1,0),r=s/180*Math.PI;e.transformCls.setRotation(n,r)}else if(73===t.keyCode){n=new THREE.Vector3(1,0,0),r=-s/180*Math.PI;e.transformCls.setRotation(n,r)}else if(77===t.keyCode){n=new THREE.Vector3(1,0,0),r=s/180*Math.PI;e.transformCls.setRotation(n,r)}else 65===t.keyCode&&Object.keys(e.structures).length>1&&e.alternateCls.alternateWrapper()}})),e.container.bind("mouseup",(function(t){e.isDragging=!1})),e.container.bind("touchend",(function(t){e.isDragging=!1})),e.container.bind("mousedown",(function(t){if(e.isDragging=!0,e.scene){if(e.bStopRotate=!0,e.pk&&(t.altKey||t.ctrlKey||t.shiftKey||18===t.keyCode||16===t.keyCode||17===t.keyCode||224===t.keyCode||91===t.keyCode)){e.highlightlevel=e.pk;e.rayCls.rayCaster(t,!0)}e.bControlGl&&!e.icn3dui.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render()}})),e.container.bind("touchstart",(function(t){if(e.isDragging=!0,e.scene){e.bStopRotate=!0,$("#"+e.pre+"popup").hide();e.rayCls.rayCaster(t,!0),e.bControlGl&&!e.icn3dui.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render()}})),e.container.bind("mousemove touchmove",(function(e){t.mouseMove(e)})),e.container.bind("mousewheel",(function(t){e.scene&&(e.bStopRotate=!0,e.bControlGl&&!e.icn3dui.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render())})),e.container.bind("DOMMouseScroll",(function(t){e.scene&&(e.bStopRotate=!0,e.bControlGl&&!e.icn3dui.bNode?(window.controls.handleResize(),window.controls.update()):(e.controls.handleResize(),e.controls.update()),e.bRender&&e.drawCls.render())}))}}mouseMove(e){var t=this.icn3d;if(t.icn3dui,!t.icn3dui.bNode&&t.scene){$("#"+t.pre+"popup").hide();if(t.rayCls.rayCaster(e,!1),t.bControlGl&&!t.icn3dui.bNode)for(var s in window.controls.handleResize(),window.controls.update(),window.icn3duiHash){var i=window.icn3duiHash[s].icn3d;i.bRender&&i.drawCls.render()}else t.controls.handleResize(),t.controls.update(),t.bRender&&t.drawCls.render()}}}class ht{constructor(e){var t=e;if(this.icn3dui=e,this.id=this.icn3dui.pre+"canvas",this.pre=this.icn3dui.pre,this.container=$("#"+this.id),this.oriContainer=$("#"+this.id),this.bControlGl=!1,this.maxatomcnt=1e5,this.overdraw=0,this.bDrawn=!1,this.bOpm=!1,this.crossstrucinter=0,this.bSecondaryStructure=!1,this.bHighlight=1,this.renderOrderPicking=-1,this.bInitial=!0,this.bDoublecolor=!1,this.originSize=1,this.ALTERNATE_STRUCTURE=-1,this.bUsePdbNum=!0,!this.icn3dui.bNode){var s=document.createElement("canvas");!(!window.WebGLRenderingContext||!s.getContext("webgl")&&!s.getContext("experimental-webgl"))?(this.renderer=new THREE.WebGLRenderer({canvas:this.oriContainer.get(0),antialias:!0,preserveDrawingBuffer:!0,sortObjects:!1,alpha:!0}),this.overdraw=0):alert("Currently your web browser has a problem on WebGL. If you are using Chrome, open a new tab for the same URL and WebGL may work again.")}this.frac=new THREE.Color(.1,.1,.1),this.scaleFactor=1,this.labelScale=1,this.bImpo=!0,this.bInstanced=!0,this.icn3dui.bNode||(this.bExtFragDepth=this.renderer.extensions.get("EXT_frag_depth"),this.bExtFragDepth?console.log("EXT_frag_depth is supported. All spheres and cylinders are drawn using shaders."):(this.bImpo=!1,console.log("EXT_frag_depth is NOT supported. All spheres and cylinders are drawn using geometry.")),this.bInstanced=this.renderer.extensions.get("ANGLE_instanced_arrays"),this.bInstanced?console.log("ANGLE_instanced_arrays is supported. Assembly is drawn with one copy of the asymmetric unit using hardware instancing."):console.log("ANGLE_instanced_arrays is NOT supported. Assembly is drawn by making copies of the asymmetric unit.")),this.posArray=new Array,this.colorArray=new Array,this.pos2Array=new Array,this.color2Array=new Array,this.radiusArray=new Array,this.posArraySphere=new Array,this.colorArraySphere=new Array,this.radiusArraySphere=new Array,this.axis=!1,this.pk=1,this.highlightlevel=1,this.pickpair=!1,this.pAtomNum=0,this.pAtom=void 0,this.pAtom2=void 0,this.bCtrl=!1,this.bShift=!1,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bAllAtoms=!0,this.bConsiderNeighbors=!1,this.bShowCrossResidueBond=!0,this.bExtrude=!0,this.effects={none:this.renderer},this.maxD=500,this.oriMaxD=this.maxD,this.cam_z=2*this.maxD,this.commands=[],this.optsHistory=[],this.logs=[],this.bRender=!0,this.hColor=new THREE.Color(16776960),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,!0),this.axisDIV=15,this.strandDIV=6,this.tubeDIV=8,this.nucleicAcidStrandDIV=6,this.linewidth=1,this.hlLineRadius=.1,this.lineRadius=.1,this.coilWidth=.3,this.cylinderRadius=.4,this.traceRadius=.4,this.dotSphereScale=.3,this.sphereRadius=1.5,this.cylinderHelixRadius=1.6,this.ribbonthickness=.2,this.helixSheetWidth=1.3,this.nucleicAcidWidth=.8,this.threshbox=180,this.maxAtoms3DMultiFile=4e4,this.tsHbond=3.8,this.tsIonic=6,this.tsContact=4,this.tsHalogen=3.8,this.tsPication=6,this.tsPistacking=5.5,this.LABELSIZE=30,this.optsOri={},this.optsOri.camera="perspective",this.optsOri.background="transparent",this.optsOri.color="chain",this.optsOri.proteins="ribbon",this.optsOri.sidec="nothing",this.optsOri.nucleotides="nucleotide cartoon",this.optsOri.surface="nothing",this.optsOri.opacity="1.0",this.optsOri.wireframe="no",this.optsOri.map="nothing",this.optsOri.mapwireframe="yes",this.optsOri.emmap="nothing",this.optsOri.emmapwireframe="yes",this.optsOri.phimap="nothing",this.optsOri.phimapwireframe="yes",this.optsOri.phisurface="nothing",this.optsOri.phisurftype="nothing",this.optsOri.phisurfop="1.0",this.optsOri.phisurfwf="yes",this.optsOri.chemicals="stick",this.optsOri.water="nothing",this.optsOri.ions="sphere",this.optsOri.hbonds="no",this.optsOri.saltbridge="no",this.optsOri.contact="no",this.optsOri.halogen="no",this.optsOri["pi-cation"]="no",this.optsOri["pi-stacking"]="no",this.optsOri.ssbonds="yes",this.optsOri.clbonds="yes",this.optsOri.rotationcenter="molecule center",this.optsOri.axis="no",this.optsOri.fog="no",this.optsOri.slab="no",this.optsOri.pk="residue",this.optsOri.chemicalbinding="hide",this.opts=t.hashUtilsCls.cloneHash(this.optsOri),this.sheetcolor="green",this.bShowHighlight=!0,this.mapData={},this.bFullUi=!0,this.divid=this.icn3dui.cfg.divid,this.inputid="",this.setOperation="or",this.ROT_DIR="right",this.currSelectedSets=[],this.selectedResidues={},this.bHideSelection=!0,this.bSelectResidue=!1,this.bSelectAlignResidue=!1,this.bAnnoShown=!1,this.bSetChainsAdvancedMenu=!1,this.b2DShown=!1,this.bCrashed=!1,this.bAddCommands=!0,this.bAddLogs=!0,this.bNotLoadStructure=!1,this.sceneCls=new Ve(this),this.cameraCls=new o(this),this.fogCls=new c(this),this.boxCls=new v(this),this.brickCls=new b(this),this.curveStripArrowCls=new u(this),this.curveCls=new p(this),this.cylinderCls=new S(this),this.lineCls=new y(this),this.reprSubCls=new C(this),this.sphereCls=new w(this),this.stickCls=new Le(this),this.strandCls=new f(this),this.stripCls=new m(this),this.tubeCls=new g(this),this.cartoonNuclCls=new Ne(this),this.surfaceCls=new H(this),this.labelCls=new Ue(this),this.axesCls=new z(this),this.glycanCls=new je(this),this.applyCenterCls=new d(this),this.applyClbondsCls=new _(this),this.applyDisplayCls=new qe(this),this.applyMapCls=new D(this),this.applyOtherCls=new ze(this),this.applySsbondsCls=new Ge(this),this.applySymdCls=new Be(this),this.hlObjectsCls=new E(this),this.residueLabelsCls=new G(this),this.alternateCls=new at(this),this.drawCls=new Xe(this),this.firstAtomObjCls=new h(this),this.impostorCls=new We(this),this.instancingCls=new Ye(this),this.contactCls=new A(this),this.hBondCls=new P(this),this.piHalogenCls=new F(this),this.saltbridgeCls=new L(this),this.loadPDBCls=new X(this),this.transformCls=new Ke(this),this.setStyleCls=new Fe(this),this.setColorCls=new B(this),this.threeDPrintCls=new I(this),this.export3DCls=new T(this),this.annoCddSiteCls=new Ce(this),this.annoContactCls=new ke(this),this.annoCrossLinkCls=new Oe(this),this.annoDomainCls=new He(this),this.annoSnpClinVarCls=new Re(this),this.annoSsbondCls=new ve(this),this.annoTransMemCls=new Ee(this),this.addTrackCls=new pe(this),this.annotationCls=new Ie(this),this.showAnnoCls=new xe(this),this.showSeqCls=new he(this),this.hlSeqCls=new Ae(this),this.hlUpdateCls=new Te(this),this.lineGraphCls=new U(this),this.getGraphCls=new N(this),this.showInterCls=new j(this),this.viewInterPairsCls=new q(this),this.drawGraphCls=new lt(this),this.alignParserCls=new ie(this),this.chainalignParserCls=new le(this),this.dsn6ParserCls=new oe(this),this.mmcifParserCls=new _e(this),this.mmdbParserCls=new re(this),this.mmtfParserCls=new se(this),this.mol2ParserCls=new Z(this),this.opmParserCls=new ne(this),this.pdbParserCls=new te(this),this.sdfParserCls=new Q(this),this.xyzParserCls=new J(this),this.realignParserCls=new ae(this),this.densityCifParserCls=new ot(this),this.ParserUtilsCls=new Se(this),this.loadAtomDataCls=new K(this),this.setSeqAlignCls=new we(this),this.applyCommandCls=new fe(this),this.definedSetsCls=new M(this),this.loadScriptCls=new de(this),this.selByCommCls=new be(this),this.selectionCls=new Me(this),this.resid2specCls=new ye(this),this.delphiCls=new V(this),this.dsspCls=new ee(this),this.scapCls=new W(this),this.symdCls=new Y(this),this.analysisCls=new ue(this),this.resizeCanvasCls=new ce(this),this.saveFileCls=new Qe(this),this.setOptionCls=new Pe(this),this.shareLinkCls=new R(this),this.diagram2dCls=new De(this),this.rayCls=new dt(this),this.controlCls=new ct(this),this.pickingCls=new ge(this),this.matShader=this.setColorCls.setOutlineColor("yellow")}}ht.prototype.init=function(){this.init_base(),this.molTitle="",this.ssbondpnts={},this.clbondpnts={},this.biomtMatrices=[],this.bAssembly=!0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1,this.axes=[]},ht.prototype.init_base=function(){this.resetConfig(),this.structures={},this.chains={},this.tddomains={},this.residues={},this.secondaries={},this.alnChains={},this.chainsSeq={},this.chainsColor={},this.chainsGene={},this.chainsAn={},this.chainsAnTitle={},this.alnChainsSeq={},this.alnChainsAnno={},this.alnChainsAnTtl={},this.pickedAtomList={},this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.prevPhimaps=[],this.prevOtherMesh=[],this.defNames2Residues={},this.defNames2Atoms={},this.defNames2Descr={},this.defNames2Command={},this.residueId2Name={},this.atoms={},this.dAtoms={},this.hAtoms={},this.proteins={},this.sidec={},this.nucleotides={},this.nucleotidesO3={},this.chemicals={},this.ions={},this.water={},this.calphas={},this.hbondpnts=[],this.saltbridgepnts=[],this.contactpnts=[],this.stabilizerpnts=[],this.halogenpnts=[],this.picationpnts=[],this.pistackingpnts=[],this.distPnts=[],this.doublebonds={},this.triplebonds={},this.aromaticbonds={},this.atomPrevColors={},this.style2atoms={},this.labels={},this.lines={},this.resids2inter={},this.resids2interAll={},this.transformCls.rotateCount=0,this.transformCls.rotateCountMax=20,this.commands=[],this.axes=[],this.bGlycansCartoon=!0,this.chainid2offset={}},ht.prototype.reinitAfterLoad=function(){var e=this,t=e.icn3dui;e.resetConfig(),e.setStyleCls.setAtomStyleByOptions(),e.setColorCls.setColorByOptions(e.opts,e.atoms),e.dAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.hAtoms=t.hashUtilsCls.cloneHash(e.atoms),e.prevHighlightObjects=[],e.prevHighlightObjects_ghost=[],e.prevSurfaces=[],e.prevMaps=[],e.prevEmmaps=[],e.prevPhimaps=[],e.prevOtherMesh=[],e.labels={},e.lines={},e.bAssembly=!0},ht.prototype.resetConfig=function(){var e=this.icn3dui;this.opts=e.hashUtilsCls.cloneHash(this.optsOri),void 0===e.cfg.align&&void 0===e.cfg.chainalign||(this.opts.color="identity",this.opts.proteins="c alpha trace",this.opts.nucleotides="o3 trace"),void 0!==e.cfg.cid&&(this.opts.color="atom",this.opts.pk="atom",this.opts.chemicals="ball and stick"),void 0!==e.cfg.blast_rep_id&&(this.opts.color="conservation"),void 0!==e.cfg.options&&$.extend(this.opts,e.cfg.options)};class mt{constructor(e){this.cfg=e,this.pre=this.cfg.divid+"_",this.REVISION="3.0.0",this.bNode=Object.keys(window).length<2,void 0===this.cfg.command&&(this.cfg.command=""),void 0===this.cfg.width&&(this.cfg.width="100%"),void 0===this.cfg.height&&(this.cfg.height="100%"),void 0===this.cfg.resize&&(this.cfg.resize=!0),void 0===this.cfg.showmenu&&(this.cfg.showmenu=!0),void 0===this.cfg.showtitle&&(this.cfg.showtitle=!0),void 0===this.cfg.showcommand&&(this.cfg.showcommand=!0),void 0===this.cfg.simplemenu&&(this.cfg.simplemenu=!1),void 0===this.cfg.mobilemenu&&(this.cfg.mobilemenu=!1),void 0===this.cfg.closepopup&&(this.cfg.closepopup=!1),void 0===this.cfg.showanno&&(this.cfg.showanno=!1),void 0===this.cfg.showseq&&(this.cfg.showseq=!1),void 0===this.cfg.showalignseq&&(this.cfg.showalignseq=!1),void 0===this.cfg.show2d&&(this.cfg.show2d=!1),void 0===this.cfg.showsets&&(this.cfg.showsets=!1),void 0===this.cfg.rotate&&(this.cfg.rotate="right"),this.hashUtilsCls=new t(this),this.utilsCls=new i(this),this.parasCls=new s(this),this.myEventCls=new n(this),this.rmsdSuprCls=new r(this),this.subdivideCls=new a(this),this.convertTypeCls=new l(this),this.htmlCls=new rt(this)}allCustomEvents(){}}mt.prototype.show3DStructure=function(){var e=this,t=this;return e.deferred=$.Deferred((function(){e.setIcn3d();var s=e.icn3d;e.utilsCls.isSessionStorageSupported()&&s.setStyleCls.getCommandsBeforeCrash();var i=e.htmlCls.WIDTH,n=e.htmlCls.HEIGHT;e.oriWidth=i,e.oriHeight=n,e.htmlCls.eventsCls.allEventFunctions(),t.allCustomEvents();var r=0;if((null==e.cfg.showmenu||e.cfg.showmenu)&&(r+=e.htmlCls.MENU_HEIGHT),(null==e.cfg.showcommand||e.cfg.showcommand)&&(r+=e.htmlCls.CMD_HEIGHT),null!=e.cfg.showmenu&&0==e.cfg.showmenu?e.htmlCls.setMenuCls.hideMenu():e.htmlCls.setMenuCls.showMenu(),null!=e.cfg.showtitle&&0==e.cfg.showtitle?$("#"+s.pre+"title").hide():$("#"+s.pre+"title").show(),$("#"+s.pre+"viewer").width(i).height(parseInt(n)+r),$("#"+s.pre+"canvas").width(i).height(parseInt(n)),$("#"+s.pre+"canvas").resizable({resize:function(t,i){e.htmlCls.WIDTH=$("#"+s.pre+"canvas").width(),e.htmlCls.HEIGHT=$("#"+s.pre+"canvas").height(),void 0===s.icn3d||e.icn3d.bFullscreen||s.resizeCanvasCls.resizeCanvas(e.htmlCls.WIDTH,e.htmlCls.HEIGHT,!0)}}),void 0!==e.cfg.usepdbnum?e.icn3d.bUsePdbNum=e.cfg.usepdbnum:void 0!==e.cfg.date?e.icn3d.bUsePdbNum=parseInt(e.cfg.date)>=20201222:"1tup"==e.cfg.mmdbid&&1==e.cfg.showanno&&1==e.cfg.show2d&&1==e.cfg.showsets||"118496"==e.cfg.mmdbid&&0==e.cfg.showanno&&-1!=e.cfg.inpara.indexOf("bu=1")||"163605,1,91105,1,1,1"==e.cfg.align&&-1!=e.cfg.inpara.indexOf("atype=1")?e.icn3d.bUsePdbNum=!1:e.icn3d.bUsePdbNum=!0,e.cfg.replay?(s.bReplay=1,$("#"+s.pre+"replay").show()):(s.bReplay=0,$("#"+s.pre+"replay").hide()),e.utilsCls.isMobile()&&(s.threshbox=60),e.cfg.controlGl&&(s.bControlGl=!0,s.container=s.bControlGl&&!s.icn3dui.bNode?$(document):$("#"+s.id)),s.setStyleCls.handleContextLost(),s.applyCenterCls.setWidthHeight(i,n),s.ori_chemicalbinding=s.opts.chemicalbinding,void 0!==e.cfg.bCalphaOnly&&(s.bCalphaOnly=e.cfg.bCalphaOnly),s.opts=e.hashUtilsCls.cloneHash(s.opts),s.STATENUMBER=s.commands.length,e.utilsCls.isSessionStorageSupported()&&s.bCrashed){s.bCrashed=!1;var a=s.commandsBeforeCrash.split("|||")[0],l=a.substr(a.lastIndexOf(" ")+1);if(l===e.cfg.mmtfid||l===e.cfg.pdbid||l===e.cfg.opmid||l===e.cfg.mmdbid||l===e.cfg.gi||l===e.cfg.blast_rep_id||l===e.cfg.cid||l===e.cfg.mmcifid||l===e.cfg.align||l===e.cfg.chainalign)return void s.loadScriptCls.loadScript(s.commandsBeforeCrash,!0)}if(s.molTitle="",s.loadCmd,void 0!==e.cfg.url){var o=e.cfg.url.split("|"),d=o[0],c=o[1];s.molTitle="",s.inputid=c,s.loadCmd="load url "+c+" | type "+d,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.pdbParserCls.downloadUrl(c,d)}else if(void 0!==e.cfg.mmtfid)s.inputid=e.cfg.mmtfid,s.loadCmd="load mmtf "+e.cfg.mmtfid,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmtfParserCls.downloadMmtf(e.cfg.mmtfid);else if(void 0!==e.cfg.pdbid)s.inputid=e.cfg.pdbid,s.loadCmd="load pdb "+e.cfg.pdbid,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.pdbParserCls.downloadPdb(e.cfg.pdbid);else if(void 0!==e.cfg.opmid)s.inputid=e.cfg.opmid,s.loadCmd="load opm "+e.cfg.opmid,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.opmParserCls.downloadOpm(e.cfg.opmid);else if(void 0!==e.cfg.mmdbid)s.inputid=e.cfg.mmdbid,s.loadCmd="load mmdb "+e.cfg.mmdbid+" | parameters "+e.cfg.inpara,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmdbParserCls.downloadMmdb(e.cfg.mmdbid);else if(void 0!==e.cfg.gi)s.loadCmd="load gi "+e.cfg.gi,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmdbParserCls.downloadGi(e.cfg.gi);else if(void 0!==e.cfg.blast_rep_id)if("Query"!==e.cfg.query_id.substr(0,5)&&void 0===e.cfg.rid)s.inputid=e.cfg.query_id+"_"+e.cfg.blast_rep_id,s.loadCmd="load seq_struct_ids "+e.cfg.query_id+","+e.cfg.blast_rep_id,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmdbParserCls.downloadBlast_rep_id(e.cfg.query_id+","+e.cfg.blast_rep_id);else if(void 0!==e.cfg.rid){c="https://blast.ncbi.nlm.nih.gov/Blast.cgi?RESULTS_FILE=on&FORMAT_TYPE=JSON2_S&FORMAT_OBJECT=Alignment&CMD=Get&RID="+e.cfg.rid;$.ajax({url:c,dataType:"json",tryCount:0,retryLimit:1,success:function(t){for(var i=0,n=t.BlastOutput2.length;i<n;++i)if(t.BlastOutput2[i].report.results.search.query_id==e.cfg.query_id){for(var r=t.BlastOutput2[i].report.results.search.hits,a=void 0,l=0,o=r.length;l<o;++l){for(var d=r[l],c=!1,h=0,m=d.description.length;h<m;++h){if(d.description[h].accession==e.cfg.blast_rep_id){c=!0;break}}if(c){a=(a=d.hsps[0].qseq).replace(/-/g,"");break}}void 0!==a&&(e.cfg.query_id=a),s.inputid=e.cfg.query_id+"_"+e.cfg.blast_rep_id,s.loadCmd="load seq_struct_ids "+e.cfg.query_id+","+e.cfg.blast_rep_id,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmdbParserCls.downloadBlast_rep_id(e.cfg.query_id+","+e.cfg.blast_rep_id);break}},error:function(t,s,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):alert("The RID "+e.cfg.rid+" may have expired...")}})}else alert('BLAST "RID" is a required parameter...');else if(void 0!==e.cfg.cid){s.inputid=e.cfg.cid;c="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+s.inputid+"/description/jsonp";$.ajax({url:c,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(e){void 0!==e.InformationList&&void 0!==e.InformationList.Information&&(s.molTitle=e.InformationList.Information[0].Title)},error:function(e,t,s){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}),s.loadCmd="load cid "+e.cfg.cid,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.sdfParserCls.downloadCid(e.cfg.cid)}else if(void 0!==e.cfg.mmcifid)s.inputid=e.cfg.mmcifid,s.loadCmd="load mmcif "+e.cfg.mmcifid,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.mmcifParserCls.downloadMmcif(e.cfg.mmcifid);else if(void 0!==e.cfg.align){var h=e.cfg.align.split(",");6===h.length?s.inputid=h[0]+"_"+h[3]:2===h.length&&(s.inputid=h[0]+"_"+h[1]),s.loadCmd="load alignment "+e.cfg.align+" | parameters "+e.cfg.inpara,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.alignParserCls.downloadAlignment(e.cfg.align)}else void 0!==e.cfg.chainalign?(s.bChainAlign=!0,s.inputid=e.cfg.chainalign,s.loadCmd="load chainalignment "+e.cfg.chainalign+" | resnum "+e.cfg.resnum+" | parameters "+e.cfg.inpara,e.htmlCls.clickMenuCls.setLogCmd(s.loadCmd,!0),s.chainalignParserCls.downloadChainalignment(e.cfg.chainalign,e.cfg.resnum)):void 0!==e.cfg.command&&""!==e.cfg.command?(-1!==e.cfg.command.indexOf("url=")&&(s.bInputUrlfile=!0),s.loadScriptCls.loadScript(e.cfg.command)):e.htmlCls.dialogCls.openDlg("dl_mmdbid","Please input MMDB or PDB ID")})),e.deferred.promise()},mt.prototype.setIcn3d=function(){var e=this,t="<label class='icn3d-switch'><input id='"+e.pre+"modeswitch' type='checkbox'><div class='icn3d-slider icn3d-round' style='width:34px; height:18px; margin: 6px 0px 0px 3px;' title='Left(\"All atoms\"): Style and color menu options will be applied to all atoms in the structure&#13;Right(\"Selection\"): Style and color menu options will be applied only to selected atoms'></div></label>",s="<span id='"+e.pre+"modeall' title='Style and color menu options will be applied to all atoms in the structure'>All atoms&nbsp;&nbsp;</span><span id='"+e.pre+"modeselection' class='icn3d-modeselection' style='display:none;' title='Style and color menu options will be applied only to selected atoms'>Selection&nbsp;&nbsp;</span></div></div></td>";e.utilsCls.setViewerWidthHeight(e),e.utilsCls.isMobile()||e.cfg.mobilemenu?e.htmlCls.setMenuCls.setTopMenusHtmlMobile(e.cfg.divid,t,s):e.htmlCls.setMenuCls.setTopMenusHtml(e.cfg.divid,t,s),e.icn3d=new ht(e),e.icn3d.controlCls.setControl(),e.setDialogAjax()},mt.prototype.setDialogAjax=function(){this.bNode||$.ui.dialog.prototype._makeDraggableBase||($.ui.dialog.prototype._makeDraggableBase=$.ui.dialog.prototype._makeDraggable,$.ui.dialog.prototype._makeDraggable=function(){this._makeDraggableBase(),this.uiDialog.draggable("option","containment",!1)}),$.ajaxTransport("+binary",(function(e,t,s){if(window.FormData&&(e.dataType&&"binary"==e.dataType||e.data&&(window.ArrayBuffer&&e.data instanceof ArrayBuffer||window.Blob&&e.data instanceof Blob)))return{send:function(t,s){var i=new XMLHttpRequest,n=e.url,r=e.type,a=e.async||!0,l=e.responseType||"blob",o=e.data||null;for(var d in i.addEventListener("load",(function(){var t={};t[e.dataType]=i.response,s(i.status,i.statusText,t,i.getAllResponseHeaders())})),i.open(r,n,a),t)i.setRequestHeader(d,t[d]);i.responseType=l,i.send(o)},abort:function(){s.abort()}}}))};return e.iCn3DUI=mt,e.printMsg=class{constructor(){console.log("This is a message from the icn3d package")}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
